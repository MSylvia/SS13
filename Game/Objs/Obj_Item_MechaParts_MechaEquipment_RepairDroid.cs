// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_MechaParts_MechaEquipment_RepairDroid : Obj_Item_MechaParts_MechaEquipment {

		public int health_boost = 2;
		public GlobalIterator_MechaRepairDroid pr_repair_droid = null;
		public Icon droid_overlay = null;
		public ByTable repairable_damage = new ByTable(new object [] { 2, 8 });

		protected override void __FieldInit() {
			base.__FieldInit();

			this.origin_tech = "magnets=3;programming=3";
			this.equip_cooldown = 20;
			this.energy_drain = 100;
			this.range = 0;
			this.icon_state = "repair_droid";
		}

		// Function from file: tools.dm
		public Obj_Item_MechaParts_MechaEquipment_RepairDroid ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.pr_repair_droid = new GlobalIterator_MechaRepairDroid( new ByTable(new object [] { this }), false );
			this.pr_repair_droid.set_delay( this.equip_cooldown );
			return;
		}

		// Function from file: tools.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hclient = null, HtmlInterface currui = null ) {
			base.Topic( href, href_list, (object)(hclient) );

			if ( Lang13.Bool( href_list["toggle_repairs"] ) ) {
				this.chassis.overlays.Remove( this.droid_overlay );

				if ( this.pr_repair_droid.toggle() ) {
					this.droid_overlay = new Icon( this.icon, "repair_droid_a" );
					this.log_message( "Activated." );
				} else {
					this.droid_overlay = new Icon( this.icon, "repair_droid" );
					this.log_message( "Deactivated." );
					this.set_ready_state( true );
				}
				this.chassis.overlays.Add( this.droid_overlay );
				GlobalFuncs.send_byjax( this.chassis.occupant, "exosuit.browser", new Txt().Ref( this ).ToString(), this.get_equip_info() );
			}
			return null;
		}

		// Function from file: tools.dm
		public override string get_equip_info(  ) {
			
			if ( !( this.chassis != null ) ) {
				return null;
			}
			return new Txt( "<span style=\"color:" ).item( ( this.equip_ready ? "#0f0" : "#f00" ) ).str( ";\">*</span>&nbsp;" ).item( this.name ).str( " - <a href='?src=" ).Ref( this ).str( ";toggle_repairs=1'>" ).item( ( this.pr_repair_droid.active() ? "Dea" : "A" ) ).str( "ctivate</a>" ).ToString();
		}

		// Function from file: tools.dm
		public override void detach( dynamic moveto = null ) {
			this.chassis.overlays.Remove( this.droid_overlay );
			this.pr_repair_droid.stop();
			base.detach( (object)(moveto) );
			return;
		}

		// Function from file: tools.dm
		public override void destroy(  ) {
			this.chassis.overlays.Remove( this.droid_overlay );
			base.destroy();
			return;
		}

		// Function from file: tools.dm
		public override void attach( Obj_Mecha M = null ) {
			base.attach( M );
			this.droid_overlay = new Icon( this.icon, "repair_droid" );
			M.overlays.Add( this.droid_overlay );
			return;
		}

	}

}