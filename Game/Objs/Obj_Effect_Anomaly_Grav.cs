// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_Anomaly_Grav : Obj_Effect_Anomaly {

		public bool boing = false;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.icon_state = "shield2";
		}

		// Function from file: anomalies.dm
		public Obj_Effect_Anomaly_Grav ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.aSignal.origin_tech = "magnets=5;powerstorage=4";
			return;
		}

		// Function from file: anomalies.dm
		public void gravShock( dynamic A = null ) {
			dynamic target = null;

			
			if ( this.boing && A is Mob_Living && !Lang13.Bool( A.stat ) ) {
				((Mob)A).Weaken( 2 );
				target = GlobalFuncs.get_edge_target_turf( A, Map13.GetDistance( this, Map13.GetStepAway( A, this, null ) ) );
				((Ent_Dynamic)A).throw_at( target, 5, 1 );
				this.boing = false;
				return;
			}
			return;
		}

		// Function from file: anomalies.dm
		public override bool Bumped( dynamic AM = null ) {
			this.gravShock( AM );
			return false;
		}

		// Function from file: anomalies.dm
		public override dynamic Bump( Ent_Static Obstacle = null, dynamic yes = null ) {
			this.gravShock( Obstacle );
			return null;
		}

		// Function from file: anomalies.dm
		public override dynamic Crossed( Ent_Dynamic O = null, dynamic X = null ) {
			this.gravShock( O );
			return null;
		}

		// Function from file: anomalies.dm
		public override void anomalyEffect(  ) {
			Obj O = null;
			Mob_Living M = null;
			Mob_Living M2 = null;
			Obj O2 = null;
			dynamic target = null;

			base.anomalyEffect();
			this.boing = true;

			foreach (dynamic _a in Lang13.Enumerate( Map13.FetchInRangeExcludeThis( this, 4 ), typeof(Obj) )) {
				O = _a;
				

				if ( !Lang13.Bool( O.anchored ) ) {
					Map13.StepTowardsSimple( O, this );
				}
			}

			foreach (dynamic _b in Lang13.Enumerate( Map13.FetchInRange( this, 0 ), typeof(Mob_Living) )) {
				M = _b;
				
				this.gravShock( M );
			}

			foreach (dynamic _c in Lang13.Enumerate( Map13.FetchInRangeExcludeThis( this, 4 ), typeof(Mob_Living) )) {
				M2 = _c;
				
				Map13.StepTowardsSimple( M2, this );
			}

			foreach (dynamic _d in Lang13.Enumerate( Map13.FetchInRange( this, 0 ), typeof(Obj) )) {
				O2 = _d;
				

				if ( !Lang13.Bool( O2.anchored ) ) {
					target = Lang13.FindIn( typeof(Mob_Living), Map13.FetchInView( this, 4 ) );

					if ( Lang13.Bool( target ) && !Lang13.Bool( target.stat ) ) {
						O2.throw_at( target, 5, 10 );
					}
				}
			}
			return;
		}

	}

}