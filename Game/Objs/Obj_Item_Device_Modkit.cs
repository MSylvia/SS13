// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Device_Modkit : Obj_Item_Device {

		public ByTable parts = new ByTable();
		public ByTable original = new ByTable();
		public ByTable finished = new ByTable();

		protected override void __FieldInit() {
			base.__FieldInit();

			this.origin_tech = "materials=2;engineering=2";
			this.icon_state = "modkit";
		}

		// Function from file: modkit.dm
		public Obj_Item_Device_Modkit ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.parts = new ByTable( 2 );
			this.original = new ByTable( 2 );
			this.finished = new ByTable( 2 );
			this.parts[1] = 1;
			this.original[1] = typeof(Obj_Item_Clothing_Head_Helmet_Space_Rig);
			this.finished[1] = typeof(Obj_Item_Clothing_Head_Cardborg);
			this.parts[2] = 1;
			this.original[2] = typeof(Obj_Item_Clothing_Suit_Space_Rig);
			this.finished[2] = typeof(Obj_Item_Clothing_Suit_Cardborg);
			return;
		}

		// Function from file: modkit.dm
		public override bool afterattack( dynamic A = null, dynamic user = null, bool? flag = null, dynamic _params = null, bool? struggle = null ) {
			dynamic to_type = null;
			bool parts_left = false;
			int? j = null;
			int? i = null;
			dynamic original_type = null;
			dynamic N = null;
			bool has_parts = false;
			int? i2 = null;

			
			if ( Map13.GetDistance( A, user ) > 1 ) {
				return false;
			}
			to_type = null;
			parts_left = false;
			j = 0;
			i = null;
			i = 1;

			while (( i ??0) <= this.original.len) {
				original_type = this.original[i];

				if ( Lang13.Bool( original_type.IsInstanceOfType( A ) ) ) {
					to_type = this.finished[i];
					parts_left = Lang13.Bool( this.parts[i] );
					j = i;
				}
				i++;
			}

			if ( !Lang13.Bool( to_type ) ) {
				GlobalFuncs.to_chat( user, new Txt( "<span class='warning'>You cannot modify " ).the( A ).item().str( " with this kit.</span>" ).ToString() );
				return false;
			}

			if ( ( parts_left ?1:0) <= 0 ) {
				GlobalFuncs.to_chat( user, "<span class='warning'>This kit has no parts for this modification left.</span>" );
				return false;
			}

			if ( Lang13.Bool( to_type.IsInstanceOfType( A ) ) ) {
				GlobalFuncs.to_chat( user, new Txt( "<span class='notice'>" ).The( A ).item().str( " is already modified.</span>" ).ToString() );
				return false;
			}

			if ( !( A.loc is Tile ) ) {
				GlobalFuncs.to_chat( user, new Txt( "<span class='warning'>" ).The( A ).item().str( " must be safely placed on the ground for modification.</span>" ).ToString() );
				return false;
			}
			GlobalFuncs.playsound( user.loc, "sound/items/Screwdriver.ogg", 100, 1 );
			N = Lang13.Call( to_type, A.loc );
			((Ent_Static)user).visible_message( new Txt( "<span class='warning'>" ).item( user ).str( " opens " ).the( this ).item().str( " and modifies " ).the( A ).item().str( " into " ).the( N ).item().str( ".</span>" ).ToString(), new Txt( "<span class='warning'>You open " ).the( this ).item().str( " and modify " ).the( A ).item().str( " into " ).the( N ).item().str( ".</span>" ).ToString() );
			GlobalFuncs.qdel( A );
			has_parts = false;
			i2 = null;
			i2 = 1;

			while (( i2 ??0) <= this.original.len) {
				
				if ( i2 == j ) {
					this.parts[i2]--;
				}

				if ( Convert.ToDouble( this.parts[i2] ) > 0 ) {
					has_parts = true;
				}
				i2++;
			}

			if ( !has_parts ) {
				GlobalFuncs.qdel( this );
			}
			return false;
		}

	}

}