// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_Grenade : Obj_Item_Weapon {

		public bool active = false;
		public int det_time = 50;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.w_class = 2;
			this.item_state = "flashbang";
			this.throw_speed = 4;
			this.throw_range = 20;
			this.slot_flags = 512;
			this.icon = "icons/obj/grenade.dmi";
			this.icon_state = "grenade";
		}

		public Obj_Item_Weapon_Grenade ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: grenade.dm
		public override dynamic attack_paw( Mob a = null, dynamic b = null, dynamic c = null ) {
			return this.attack_hand( a );
		}

		// Function from file: grenade.dm
		public override dynamic attack_hand( dynamic a = null, dynamic b = null, dynamic c = null ) {
			Map13.Walk( this, 0, 0 );
			base.attack_hand( (object)(a), (object)(b), (object)(c) );
			return null;
		}

		// Function from file: grenade.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			
			if ( a is Obj_Item_Weapon_Screwdriver ) {
				
				switch ((int)( this.det_time )) {
					case "1":
						this.det_time = 10;
						GlobalFuncs.to_chat( b, "<span class='notice'>You set the " + this.name + " for 1 second detonation time.</span>" );
						break;
					case "10":
						this.det_time = 30;
						GlobalFuncs.to_chat( b, "<span class='notice'>You set the " + this.name + " for 3 second detonation time.</span>" );
						break;
					case "30":
						this.det_time = 50;
						GlobalFuncs.to_chat( b, "<span class='notice'>You set the " + this.name + " for 5 second detonation time.</span>" );
						break;
					case "50":
						this.det_time = 1;
						GlobalFuncs.to_chat( b, "<span class='notice'>You set the " + this.name + " for instant detonation.</span>" );
						break;
				}
				this.add_fingerprint( b );
			}
			base.attackby( (object)(a), (object)(b), (object)(c) );
			return null;
		}

		// Function from file: grenade.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			dynamic C = null;

			
			if ( !this.active ) {
				
				if ( this.clown_check( user ) ) {
					GlobalFuncs.to_chat( user, new Txt( "<span class='attack'>You prime " ).the( this.name ).item().str( "! " ).item( this.det_time / 10 ).str( " seconds!</span>" ).ToString() );
					this.activate( user );
					this.add_fingerprint( user );

					if ( user is Mob_Living_Carbon ) {
						C = user;
						((Mob_Living_Carbon)C).throw_mode_on();
					}
				}
			}
			return null;
		}

		// Function from file: grenade.dm
		public override dynamic examine( dynamic user = null, string size = null ) {
			base.examine( (object)(user), size );

			if ( this.det_time > 1 ) {
				GlobalFuncs.to_chat( user, "<span class='info'>The timer is set to " + this.det_time / 10 + " seconds.</span>" );
				return null;
			}
			GlobalFuncs.to_chat( user, new Txt( "<span class='warning'>" ).The( this ).item().str( " is set for instant detonation.</span>" ).ToString() );
			return null;
		}

		// Function from file: grenade.dm
		public void update_mob(  ) {
			Ent_Static M = null;

			
			if ( this.loc is Mob ) {
				M = this.loc;
				((dynamic)M).drop_from_inventory( this );
			}
			return;
		}

		// Function from file: grenade.dm
		public virtual void prime( dynamic L = null ) {
			dynamic T = null;

			T = GlobalFuncs.get_turf( this );

			if ( Lang13.Bool( T ) ) {
				((Tile)T).hotspot_expose( 700, 125, null, this.loc is Tile );
			}
			return;
		}

		// Function from file: grenade.dm
		public virtual void activate( dynamic user = null ) {
			
			if ( this.active ) {
				return;
			}

			if ( Lang13.Bool( user ) ) {
				GlobalVars.diaryofmeanpeople.WriteMsg( String13.HtmlDecode( "[" + GlobalFuncs.time_stamp() + "]ATTACK: " + new Txt( "<font color='red'>" ).item( user.name ).str( " (" ).item( user.ckey ).str( ") primed " ).a( this ).item().str( "</font>" ).ToString() ) );
				GlobalFuncs.log_admin( new Txt( "ATTACK: " ).item( user ).str( " (" ).item( user.ckey ).str( ") primed " ).a( this ).item().ToString() );
				GlobalFuncs.message_admins( new Txt( "ATTACK: " ).item( user ).str( " (" ).item( user.ckey ).str( ") primed " ).a( this ).item().ToString() );
			}
			this.icon_state = Lang13.Initial( this, "icon_state" ) + "_active";
			this.active = true;
			GlobalFuncs.playsound( this.loc, "sound/weapons/armbomb.ogg", 75, 1, -3 );
			Task13.Schedule( this.det_time, (Task13.Closure)(() => {
				this.prime( user );
				return;
				return;
			}));
			return;
		}

		// Function from file: grenade.dm
		public bool clown_check( dynamic user = null ) {
			Interface13.Stat( null, user.mutations.Contains( 5 ) );

			if ( false && Rand13.PercentChance( 50 ) ) {
				GlobalFuncs.to_chat( user, "<span class='warning'>Huh? How does this thing work?</span>" );
				this.activate( user );
				this.add_fingerprint( user );
				Task13.Schedule( 5, (Task13.Closure)(() => {
					this.prime( user );
					return;
				}));
				return false;
			}
			return true;
		}

	}

}