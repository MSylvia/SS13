// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_CellCharger : Obj_Machinery {

		public dynamic charging = null;
		public int chargelevel = -1;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.anchored = 1;
			this.idle_power_usage = 5;
			this.active_power_usage = 60;
			this.icon = "icons/obj/power.dmi";
			this.icon_state = "ccharger0";
		}

		public Obj_Machinery_CellCharger ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: cell_charger.dm
		public override int? process( dynamic seconds = null ) {
			
			if ( !Lang13.Bool( this.charging ) || !Lang13.Bool( this.anchored ) || ( this.stat & 3 ) != 0 ) {
				return null;
			}

			if ( ((Obj_Item_Weapon_StockParts_Cell)this.charging).percent() >= 100 ) {
				return null;
			}
			this.f_use_power( 200 );
			this.charging.give( 175 );
			this.updateicon();
			return null;
		}

		// Function from file: cell_charger.dm
		public override double emp_act( int severity = 0 ) {
			
			if ( ( this.stat & 3 ) != 0 ) {
				return 0;
			}

			if ( Lang13.Bool( this.charging ) ) {
				((Ent_Static)this.charging).emp_act( severity );
			}
			base.emp_act( severity );
			return 0;
		}

		// Function from file: cell_charger.dm
		public override dynamic attack_ai( dynamic user = null ) {
			return null;
		}

		// Function from file: cell_charger.dm
		public override void attack_tk( Mob_Living_Carbon_Human user = null ) {
			
			if ( !Lang13.Bool( this.charging ) ) {
				return;
			}
			this.charging.loc = this.loc;
			user.WriteMsg( "<span class='notice'>You telekinetically remove " + this.charging + " from " + this + ".</span>" );
			this.removecell();
			return;
		}

		// Function from file: cell_charger.dm
		public override dynamic attack_hand( dynamic a = null, bool? b = null, bool? c = null ) {
			
			if ( !Lang13.Bool( this.charging ) ) {
				return null;
			}
			((Mob)a).put_in_hands( this.charging );
			((Ent_Static)this.charging).add_fingerprint( a );
			((Ent_Static)a).visible_message( "" + a + " removes the cell from the charger.", "<span class='notice'>You remove the cell from the charger.</span>" );
			this.removecell();
			return null;
		}

		// Function from file: cell_charger.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			Ent_Static a = null;

			
			if ( ( this.stat & 1 ) != 0 ) {
				return null;
			}

			if ( A is Obj_Item_Weapon_StockParts_Cell && Lang13.Bool( this.anchored ) ) {
				
				if ( Lang13.Bool( this.charging ) ) {
					user.WriteMsg( "<span class='warning'>There is already a cell in the charger!</span>" );
					return null;
				} else {
					a = this.loc.loc;

					if ( !( a is Zone ) ) {
						return null;
					}

					if ( Lang13.Bool( ((dynamic)a).power_equip ) == false ) {
						user.WriteMsg( "<span class='warning'>The " + this.name + " blinks red as you try to insert the cell!</span>" );
						return null;
					}

					if ( !Lang13.Bool( user.drop_item() ) ) {
						return null;
					}
					A.loc = this;
					this.charging = A;
					((Ent_Static)user).visible_message( "" + user + " inserts a cell into the charger.", "<span class='notice'>You insert a cell into the charger.</span>" );
					this.chargelevel = -1;
					this.updateicon();
				}
			} else if ( A is Obj_Item_Weapon_Wrench ) {
				
				if ( Lang13.Bool( this.charging ) ) {
					user.WriteMsg( "<span class='warning'>Remove the cell first!</span>" );
					return null;
				}
				this.anchored = !Lang13.Bool( this.anchored );
				user.WriteMsg( "<span class='notice'>You " + ( Lang13.Bool( this.anchored ) ? "attach" : "detach" ) + " the cell charger " + ( Lang13.Bool( this.anchored ) ? "to" : "from" ) + " the ground</span>" );
				GlobalFuncs.playsound( this.loc, "sound/items/ratchet.ogg", 75, 1 );
			}
			return null;
		}

		// Function from file: cell_charger.dm
		public override double examine( dynamic user = null ) {
			base.examine( (object)(user) );
			user.WriteMsg( "There's " + ( Lang13.Bool( this.charging ) ? "a" : "no" ) + " cell in the charger." );

			if ( Lang13.Bool( this.charging ) ) {
				user.WriteMsg( "Current charge: " + Num13.Round( ((Obj_Item_Weapon_StockParts_Cell)this.charging).percent(), 1 ) + "%" );
			}
			return 0;
		}

		// Function from file: cell_charger.dm
		public void removecell(  ) {
			this.charging.updateicon();
			this.charging = null;
			this.chargelevel = -1;
			this.updateicon();
			return;
		}

		// Function from file: cell_charger.dm
		public void updateicon(  ) {
			int newlevel = 0;

			this.icon_state = "ccharger" + ( Lang13.Bool( this.charging ) ? true : false );

			if ( Lang13.Bool( this.charging ) && !( ( this.stat & 3 ) != 0 ) ) {
				newlevel = Num13.Floor( ((Obj_Item_Weapon_StockParts_Cell)this.charging).percent() * 4 / 100 );

				if ( this.chargelevel != newlevel ) {
					this.chargelevel = newlevel;
					this.overlays.Cut();
					this.overlays.Add( "ccharger-o" + newlevel );
				}
			} else {
				this.overlays.Cut();
			}
			return;
		}

	}

}