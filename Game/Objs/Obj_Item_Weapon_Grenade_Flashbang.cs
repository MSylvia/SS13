// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_Grenade_Flashbang : Obj_Item_Weapon_Grenade {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.origin_tech = "materials=2;combat=1";
			this.icon_state = "flashbang";
		}

		public Obj_Item_Weapon_Grenade_Flashbang ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: flashbang.dm
		public void bang( dynamic T = null, Mob_Living M = null ) {
			bool ear_safety = false;
			int distance = 0;

			M.show_message( "<span class='warning'>BANG</span>", 2 );
			GlobalFuncs.playsound( this.loc, "sound/weapons/flashbang.ogg", 100, 1 );
			ear_safety = M.check_ear_prot();
			distance = Num13.MaxInt( 1, Map13.GetDistance( this, T ) );

			if ( M.weakeyes ) {
				M.visible_message( "<span class='disarm'><b>" + M + "</b> screams and collapses!</span>" );
				M.WriteMsg( "<span class='userdanger'><font size=3>AAAAGH!</font></span>" );
				M.Weaken( 15 );
				M.Stun( 15 );
				M.adjust_eye_damage( 8 );
			}

			if ( M.flash_eyes( null, null, true ) ) {
				M.Stun( Num13.MaxInt( ((int)( 10 / distance )), 3 ) );
				M.Weaken( Num13.MaxInt( ((int)( 10 / distance )), 3 ) );
			}

			if ( this.loc == M || this.loc == M.loc ) {
				M.Stun( 10 );
				M.Weaken( 10 );
			}

			if ( !ear_safety ) {
				M.WriteMsg( new Sound( "sound/weapons/flash_ring.ogg", false, true, 0, 100 ) );
				M.Stun( Num13.MaxInt( ((int)( 10 / distance )), 3 ) );
				M.Weaken( Num13.MaxInt( ((int)( 10 / distance )), 3 ) );
				M.setEarDamage( M.ear_damage + Rand13.Int( 0, 5 ), Num13.MaxInt( ((int)( M.ear_deaf ??0 )), 15 ) );

				if ( M.ear_damage >= 15 ) {
					M.WriteMsg( "<span class='warning'>Your ears start to ring badly!</span>" );

					if ( Rand13.PercentChance( M.ear_damage - 10 + 5 ) ) {
						M.WriteMsg( "<span class='warning'>You can't hear anything!</span>" );
						M.disabilities |= 4;
					}
				} else if ( M.ear_damage >= 5 ) {
					M.WriteMsg( "<span class='warning'>Your ears start to ring!</span>" );
				}
			}
			return;
		}

		// Function from file: flashbang.dm
		public override void prime(  ) {
			dynamic flashbang_turf = null;
			Mob_Living M = null;
			Obj_Effect_Blob B = null;
			double damage = 0;

			this.update_mob();
			flashbang_turf = GlobalFuncs.get_turf( this );

			if ( !Lang13.Bool( flashbang_turf ) ) {
				return;
			}

			foreach (dynamic _a in Lang13.Enumerate( GlobalFuncs.get_hearers_in_view( 7, flashbang_turf ), typeof(Mob_Living) )) {
				M = _a;
				
				this.bang( GlobalFuncs.get_turf( M ), M );
			}

			foreach (dynamic _b in Lang13.Enumerate( GlobalFuncs.get_hear( 8, flashbang_turf ), typeof(Obj_Effect_Blob) )) {
				B = _b;
				
				damage = Num13.Floor( 40 / ( Map13.GetDistance( B, GlobalFuncs.get_turf( this ) ) + 1 ) );
				B.take_damage( damage, "fire" );
			}
			GlobalFuncs.qdel( this );
			return;
		}

	}

}