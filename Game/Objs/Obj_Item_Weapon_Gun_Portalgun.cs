// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_Gun_Portalgun : Obj_Item_Weapon_Gun {

		public bool setting = false;
		public Obj_Effect_Portal blue_portal = null;
		public Obj_Effect_Portal red_portal = null;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.item_state = "portalgun0";
			this.origin_tech = "materials=7;bluespace=6;magnets=5";
			this.inhand_states = new ByTable().Set( "left_hand", "icons/mob/in-hand/left/guns_experimental.dmi" ).Set( "right_hand", "icons/mob/in-hand/right/guns_experimental.dmi" );
			this.fire_delay = 0;
			this.fire_sound = "sound/weapons/portalgun_blue.ogg";
			this.icon = "icons/obj/gun_experimental.dmi";
			this.icon_state = "portalgun0";
		}

		public Obj_Item_Weapon_Gun_Portalgun ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: special.dm
		public void sync_portals(  ) {
			
			if ( !( this.blue_portal != null ) ) {
				
				if ( this.red_portal != null ) {
					this.red_portal.overlays.len = 0;
					this.red_portal.target = null;
				}
				return;
			}

			if ( !( this.red_portal != null ) ) {
				
				if ( this.blue_portal != null ) {
					this.blue_portal.overlays.len = 0;
					this.blue_portal.target = null;
				}
				return;
			}
			this.blue_portal.target = this.red_portal;
			this.red_portal.target = this.blue_portal;
			this.blue_portal.blend_icon( this.red_portal );
			this.red_portal.blend_icon( this.blue_portal );
			this.blue_portal.purge_beams();
			this.red_portal.purge_beams();
			this.blue_portal.add_beams();
			this.red_portal.add_beams();
			return;
		}

		// Function from file: special.dm
		public void open_portal( bool proj_setting = false, Ent_Static T = null, Obj A = null ) {
			Obj_Effect_Portal new_portal = null;

			
			if ( !( T != null ) ) {
				return;
			}
			new_portal = new Obj_Effect_Portal( T, 3000 );

			switch ( this.setting ) {
				case false:
					
					if ( this.blue_portal != null ) {
						GlobalFuncs.qdel( this.blue_portal );
						this.blue_portal = null;
					}
					this.blue_portal = new_portal;
					this.blue_portal.creator = this;
					break;
				case true:
					
					if ( this.red_portal != null ) {
						GlobalFuncs.qdel( this.red_portal );
						this.red_portal = null;
					}
					this.red_portal = new_portal;
					this.red_portal.icon_state = "portal1";
					this.red_portal.creator = this;
					break;
			}
			this.sync_portals();

			if ( A != null && A is Mob_Living ) {
				new_portal.Crossed( A );
			}
			return;
		}

		// Function from file: special.dm
		public override bool? update_icon( dynamic location = null, dynamic target = null ) {
			this.icon_state = "portalgun" + this.setting;
			this.item_state = "portalgun" + this.setting;
			return null;
		}

		// Function from file: special.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			
			switch ( this.setting ) {
				case false:
					this.setting = true;
					this.fire_sound = "sound/weapons/portalgun_red.ogg";
					GlobalFuncs.to_chat( user, "Now set to fire <span style='color: #FF6600;'>red portals</span>." );
					break;
				case true:
					this.setting = false;
					this.fire_sound = "sound/weapons/portalgun_blue.ogg";
					GlobalFuncs.to_chat( user, "Now set to fire <span style='color: #0066FF;'>blue portals</span>." );
					break;
			}
			this.update_icon();
			((Mob)user).regenerate_icons();
			return null;
		}

		// Function from file: special.dm
		public override bool process_chambered(  ) {
			dynamic P = null;

			
			if ( Lang13.Bool( this.in_chamber ) ) {
				return true;
			}
			this.in_chamber = new Obj_Item_Projectile_Portalgun( this );
			P = this.in_chamber;
			P.icon_state = "portalgun" + this.setting;
			P.setting = this.setting;
			return true;
		}

		// Function from file: special.dm
		public override dynamic Destroy( dynamic brokenup = null ) {
			
			if ( this.blue_portal != null ) {
				GlobalFuncs.qdel( this.blue_portal );
				this.blue_portal = null;
			}

			if ( this.red_portal != null ) {
				GlobalFuncs.qdel( this.red_portal );
				this.red_portal = null;
			}
			base.Destroy( (object)(brokenup) );
			return null;
		}

		// Function from file: special.dm
		public override dynamic examine( dynamic user = null, string size = null ) {
			base.examine( (object)(user), size );

			switch ((bool)( this.setting )) {
				case 0:
					GlobalFuncs.to_chat( user, "It's current setting is <span style='color: #0066FF;'>blue</span>." );
					break;
				case 1:
					GlobalFuncs.to_chat( user, "It's current setting is <span style='color: #FF6600;'>red</span>." );
					break;
			}
			return null;
		}

	}

}