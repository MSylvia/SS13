// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_Computer_Arcade_OrionTrail : Obj_Machinery_Computer_Arcade {

		public bool busy = false;
		public int engine = 0;
		public int hull = 0;
		public int electronics = 0;
		public double food = 80;
		public double fuel = 60;
		public int turns = 4;
		public int alive = 4;
		public string eventdat = null;
		public dynamic v_event = null;
		public ByTable settlers = new ByTable(new object [] { "Harry", "Larry", "Bob" });
		public ByTable events = new ByTable().Set( "Raiders", 3 ).Set( "Interstellar Flux", 1 ).Set( "Illness", 3 ).Set( "Breakdown", 2 ).Set( "Changelings?", 3 ).Set( "Malfunction", 2 ).Set( "Collision", 1 ).Set( "Spaceport", 2 );
		public ByTable stops = new ByTable();
		public ByTable stopblurbs = new ByTable();
		public int lings_aboard = 0;
		public bool spaceport_raided = false;
		public int spaceport_freebie = 0;
		public string last_spaceport_action = "";
		public int gameStatus = 1;
		public bool canContinueEvent = false;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.circuit = typeof(Obj_Item_Weapon_Circuitboard_Arcade_OrionTrail);
		}

		// Function from file: arcade.dm
		public Obj_Machinery_Computer_Arcade_OrionTrail ( dynamic location = null, dynamic C = null ) : base( (object)(location), (object)(C) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.stops = new ByTable(new object [] { "Pluto", "Asteroid Belt", "Proxima Centauri", "Dead Space", "Rigel Prime", "Tau Ceti Beta", "Black Hole", "Space Outpost Beta-9", "Orion Prime" });
			this.stopblurbs = new ByTable(new object [] { 
				"Pluto, long since occupied with long-range sensors and scanners, stands ready to, and indeed continues to probe the far reaches of the galaxy.", 
				"At the edge of the Sol system lies a treacherous asteroid belt. Many have been crushed by stray asteroids and misguided judgement.", 
				"The nearest star system to Sol, in ages past it stood as a reminder of the boundaries of sub-light travel, now a low-population sanctuary for adventurers and traders.", 
				"This region of space is particularly devoid of matter. Such low-density pockets are known to exist, but the vastness of it is astounding.", 
				"Rigel Prime, the center of the Rigel system, burns hot, basking its planetary bodies in warmth and radiation.", 
				"Tau Ceti Beta has recently become a waypoint for colonists headed towards Orion. There are many ships and makeshift stations in the vicinity.", 
				"Sensors indicate that a black hole's gravitational field is affecting the region of space we were headed through. We could stay of course, but risk of being overcome by its gravity, or we could change course to go around, which will take longer.", 
				"You have come into range of the first man-made structure in this region of space. It has been constructed not by travellers from Sol, but by colonists from Orion. It stands as a monument to the colonists' success.", 
				"You have made it to Orion! Congratulations! Your crew is one of the few to start a new foothold for mankind!"
			 });
			return;
		}

		// Function from file: arcade.dm
		public override bool emag_act( dynamic user = null ) {
			
			if ( !Lang13.Bool( this.emagged ) ) {
				user.WriteMsg( "<span class='notice'>You override the cheat code menu and skip to Cheat #" + Rand13.Int( 1, 50 ) + ": Realism Mode.</span>" );
				this.name = "The Orion Trail: Realism Edition";
				this.desc = "Learn how our ancestors got to Orion, and try not to die in the process!";
				this.newgame();
				this.emagged = 1;
			}
			return false;
		}

		// Function from file: arcade.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hsrc = null ) {
			Mob M = null;
			int severity = 0;
			Tile_Simulated_Floor F = null;
			Tile_Space T = null;
			double oldfood = 0;
			double oldfuel = 0;
			Obj_Singularity_Academy S = null;
			dynamic sheriff = null;
			dynamic bought = null;
			dynamic sold = null;
			int success = 0;
			int FU = 0;
			int FO = 0;
			dynamic lost_crew = null;
			int? i = null;
			Mob_Living_SimpleAnimal_Hostile_Syndicate_Ranged_Orion O = null;

			
			if ( Lang13.Bool( base.Topic( href, href_list, (object)(hsrc) ) ) ) {
				return null;
			}

			if ( Lang13.Bool( href_list["close"] ) ) {
				Task13.User.unset_machine();
				Interface13.Browse( Task13.User, null, "window=arcade" );
			}

			if ( this.busy ) {
				return null;
			}
			this.busy = true;

			if ( Lang13.Bool( href_list["continue"] ) ) {
				
				if ( this.gameStatus == 2 && !Lang13.Bool( this.v_event ) && this.turns != 7 ) {
					
					if ( this.turns >= 9 ) {
						this.win();
					} else {
						this.food -= ( this.alive + this.lings_aboard ) * 2;
						this.fuel -= 5;

						if ( this.turns == 2 && Rand13.PercentChance( 30 ) ) {
							this.v_event = "Collision";
							this.f_event();
						} else if ( Rand13.PercentChance( 75 ) ) {
							this.v_event = GlobalFuncs.pickweight( this.events );

							if ( this.lings_aboard != 0 ) {
								
								if ( this.v_event == "Changelings?" || Rand13.PercentChance( 55 ) ) {
									this.v_event = "Changeling Ambush";
								}
							}
							this.f_event();
						}
						this.turns += 1;
					}

					if ( Lang13.Bool( this.emagged ) ) {
						M = Task13.User;

						dynamic _c = this.v_event; // Was a switch-case, sorry for the mess.
						if ( _c=="Raiders" ) {
							
							if ( Rand13.PercentChance( 50 ) ) {
								Task13.User.WriteMsg( "<span class='userdanger'>You hear battle shouts. The tramping of boots on cold metal. Screams of agony. The rush of venting air. Are you going insane?</span>" );
								((dynamic)M).hallucination += 30;
							} else {
								Task13.User.WriteMsg( "<span class='userdanger'>Something strikes you from behind! It hurts like hell and feel like a blunt weapon, but nothing is there...</span>" );
								((dynamic)M).take_organ_damage( 30 );
								GlobalFuncs.playsound( this.loc, "sound/weapons/genhit2.ogg", 100, 1 );
							}
						} else if ( _c=="Illness" ) {
							severity = Rand13.Int( 1, 3 );

							if ( severity == 1 ) {
								M.WriteMsg( "<span class='userdanger'>You suddenly feel slightly nauseous.</span>" );
							}

							if ( severity == 2 ) {
								Task13.User.WriteMsg( "<span class='userdanger'>You suddenly feel extremely nauseous and hunch over until it passes.</span>" );
								M.Stun( 3 );
							}

							if ( severity >= 3 ) {
								M.WriteMsg( "<span class='warning'>An overpowering wave of nausea consumes over you. You hunch over, your stomach's contents preparing for a spectacular exit.</span>" );
								M.Stun( 5 );
								Task13.Sleep( 30 );
								((dynamic)M).vomit( 50 );
							}
						} else if ( _c=="Interstellar Flux" ) {
							
							if ( Rand13.PercentChance( 75 ) ) {
								M.Weaken( 3 );
								this.say( "A sudden gust of powerful wind slams " + M + " into the floor!" );
								((dynamic)M).take_organ_damage( 25 );
								GlobalFuncs.playsound( this.loc, "sound/weapons/genhit.ogg", 100, 1 );
							} else {
								M.WriteMsg( "<span class='userdanger'>A violent gale blows past you, and you barely manage to stay standing!</span>" );
							}
						} else if ( _c=="Collision" ) {
							
							if ( Rand13.PercentChance( 90 ) ) {
								GlobalFuncs.playsound( this.loc, "sound/effects/bang.ogg", 100, 1 );

								foreach (dynamic _a in Lang13.Enumerate( Map13.FetchInRangeExcludeThis( this, 1 ), typeof(Tile_Simulated_Floor) )) {
									F = _a;
									
									F.ChangeTurf( F.baseturf );
								}
								this.say( "Something slams into the floor around " + this + ", exposing it to space!" );

								if ( this.hull != 0 ) {
									Task13.Sleep( 10 );
									this.say( "A new floor suddenly appears around " + this + ". What the hell?" );
									GlobalFuncs.playsound( this.loc, "sound/weapons/genhit.ogg", 100, 1 );

									foreach (dynamic _b in Lang13.Enumerate( Map13.FetchInRangeExcludeThis( this, 1 ), typeof(Tile_Space) )) {
										T = _b;
										
										T.ChangeTurf( typeof(Tile_Simulated_Floor_Plating) );
									}
								}
							} else {
								this.say( "Something slams into the floor around " + this + " - luckily, it didn't get through!" );
								GlobalFuncs.playsound( this.loc, "sound/effects/bang.ogg", 50, 1 );
							}
						} else if ( _c=="Malfunction" ) {
							GlobalFuncs.playsound( this.loc, "sound/effects/EMPulse.ogg", 50, 1 );
							this.visible_message( "<span class='danger'>" + this + " malfunctions, randomizing in-game stats!</span>" );
							oldfood = this.food;
							oldfuel = this.fuel;
							this.food = Rand13.Int( 10, 80 ) / Rand13.Int( 1, 2 );
							this.fuel = Rand13.Int( 10, 60 ) / Rand13.Int( 1, 2 );

							if ( this.electronics != 0 ) {
								Task13.Sleep( 10 );

								if ( oldfuel > this.fuel && oldfood > this.food ) {
									this.audible_message( "<span class='danger'>" + this + " lets out a somehow reassuring chime.</span>" );
								} else if ( oldfuel < this.fuel || oldfood < this.food ) {
									this.audible_message( "<span class='danger'>" + this + " lets out a somehow ominous chime.</span>" );
								}
								this.food = oldfood;
								this.fuel = oldfuel;
								GlobalFuncs.playsound( this.loc, "sound/machines/chime.ogg", 50, 1 );
							}
						}
					}
				}
			} else if ( Lang13.Bool( href_list["newgame"] ) ) {
				
				if ( this.gameStatus == 1 ) {
					this.newgame();
				}
			} else if ( Lang13.Bool( href_list["menu"] ) ) {
				
				if ( this.gameStatus == 3 ) {
					this.gameStatus = 1;
					this.v_event = null;
					this.food = 80;
					this.fuel = 60;
					this.settlers = new ByTable(new object [] { "Harry", "Larry", "Bob" });
				}
			} else if ( Lang13.Bool( href_list["slow"] ) ) {
				
				if ( this.v_event == "Interstellar Flux" ) {
					this.food -= ( this.alive + this.lings_aboard ) * 2;
					this.fuel -= 5;
				}
				this.v_event = null;
			} else if ( Lang13.Bool( href_list["pastblack"] ) ) {
				
				if ( this.turns == 7 ) {
					this.food -= ( this.alive + this.lings_aboard ) * 6;
					this.fuel -= 15;
					this.turns += 1;
					this.v_event = null;
				}
			} else if ( Lang13.Bool( href_list["useengine"] ) ) {
				
				if ( this.v_event == "Breakdown" ) {
					this.engine = Num13.MaxInt( 0, --this.engine );
					this.v_event = null;
				}
			} else if ( Lang13.Bool( href_list["useelec"] ) ) {
				
				if ( this.v_event == "Malfunction" ) {
					this.electronics = Num13.MaxInt( 0, --this.electronics );
					this.v_event = null;
				}
			} else if ( Lang13.Bool( href_list["usehull"] ) ) {
				
				if ( this.v_event == "Collision" ) {
					this.hull = Num13.MaxInt( 0, --this.hull );
					this.v_event = null;
				}
			} else if ( Lang13.Bool( href_list["wait"] ) ) {
				
				if ( this.v_event == "Breakdown" || this.v_event == "Malfunction" || this.v_event == "Collision" ) {
					this.food -= ( this.alive + this.lings_aboard ) * 6;
					this.v_event = null;
				}
			} else if ( Lang13.Bool( href_list["keepspeed"] ) ) {
				
				if ( this.v_event == "Interstellar Flux" ) {
					
					if ( Rand13.PercentChance( 75 ) ) {
						this.v_event = "Breakdown";
						this.f_event();
					} else {
						this.v_event = null;
					}
				}
			} else if ( Lang13.Bool( href_list["blackhole"] ) ) {
				
				if ( this.turns == 7 ) {
					
					if ( Rand13.PercentChance( 75 ) ) {
						this.v_event = "BlackHole";
						this.f_event();

						if ( Lang13.Bool( this.emagged ) ) {
							GlobalFuncs.playsound( this.loc, "sound/effects/supermatter.ogg", 100, 1 );
							this.say( "A miniature black hole suddenly appears in front of " + this + ", devouring " + Task13.User + " alive!" );
							Task13.User.Stun( 10 );
							S = new Obj_Singularity_Academy( Task13.User.loc );
							this.emagged = 0;
							Task13.Sleep( 50 );
							this.say( "" + S + " winks out, just as suddenly as it appeared." );
							GlobalFuncs.qdel( S );
						}
					} else {
						this.v_event = null;
						this.turns += 1;
					}
				}
			} else if ( Lang13.Bool( href_list["holedeath"] ) ) {
				
				if ( this.v_event == "BlackHole" ) {
					this.gameStatus = 3;
					this.v_event = null;
				}
			} else if ( Lang13.Bool( href_list["eventclose"] ) ) {
				
				if ( this.canContinueEvent ) {
					this.v_event = null;
				}
			} else if ( Lang13.Bool( href_list["killcrew"] ) ) {
				
				if ( this.gameStatus == 2 || this.v_event == "Changelings?" ) {
					sheriff = this.remove_crewmember();
					GlobalFuncs.playsound( this.loc, "sound/weapons/gunshot.ogg", 100, 1 );

					if ( this.settlers.len == 0 || this.alive == 0 ) {
						this.say( "The last crewmember " + sheriff + ", shot themselves, GAME OVER!" );

						if ( Lang13.Bool( this.emagged ) ) {
							Task13.User.death( false );
							this.emagged = 0;
						}
						this.gameStatus = 3;
						this.v_event = null;
					} else if ( Lang13.Bool( this.emagged ) ) {
						
						if ( Task13.User.name == sheriff ) {
							this.say( "The crew of the ship chose to kill " + Task13.User.name + "!" );
							Task13.User.death( false );
						}
					}

					if ( this.v_event == "Changelings?" ) {
						this.v_event = null;
					}
				}
			} else if ( Lang13.Bool( href_list["buycrew"] ) ) {
				
				if ( this.gameStatus == 4 ) {
					
					if ( !this.spaceport_raided && this.food >= 10 && this.fuel >= 10 ) {
						bought = this.add_crewmember();
						this.last_spaceport_action = "You hired " + bought + " as a new crewmember.";
						this.fuel -= 10;
						this.food -= 10;
						this.f_event();
					}
				}
			} else if ( Lang13.Bool( href_list["sellcrew"] ) ) {
				
				if ( this.gameStatus == 4 ) {
					
					if ( !this.spaceport_raided && this.settlers.len > 1 ) {
						sold = this.remove_crewmember();
						this.last_spaceport_action = "You sold your crewmember, " + sold + "!";
						this.fuel += 7;
						this.food += 7;
						this.f_event();
					}
				}
			} else if ( Lang13.Bool( href_list["leave_spaceport"] ) ) {
				
				if ( this.gameStatus == 4 ) {
					this.v_event = null;
					this.gameStatus = 2;
					this.spaceport_raided = false;
					this.spaceport_freebie = 0;
					this.last_spaceport_action = "";
				}
			} else if ( Lang13.Bool( href_list["raid_spaceport"] ) ) {
				
				if ( this.gameStatus == 4 ) {
					
					if ( !this.spaceport_raided ) {
						success = Num13.MinInt( this.alive * 15, 100 );
						this.spaceport_raided = true;
						FU = 0;
						FO = 0;

						if ( Rand13.PercentChance( success ) ) {
							FU = Rand13.Int( 5, 15 );
							FO = Rand13.Int( 5, 15 );
							this.last_spaceport_action = "You successfully raided the spaceport! you gained " + FU + " Fuel and " + FO + " Food! (+" + FU + "FU,+" + FO + "FO)";
						} else {
							FU = Rand13.Int( -5, -15 );
							FO = Rand13.Int( -5, -15 );
							this.last_spaceport_action = "You failed to raid the spaceport! you lost " + FU * -1 + " Fuel and " + FO * -1 + " Food in your scramble to escape! (" + FU + "FU," + FO + "FO)";

							if ( Rand13.PercentChance( success * 5 ) ) {
								lost_crew = this.remove_crewmember();
								this.last_spaceport_action = "You failed to raid the spaceport! you lost " + FU * -1 + " Fuel and " + FO * -1 + " Food, AND " + lost_crew + " in your scramble to escape! (" + FU + "FI," + FO + "FO,-Crew)";

								if ( Lang13.Bool( this.emagged ) ) {
									this.say( "WEEWOO WEEWOO, Spaceport Security en route!" );
									i = null;

									while (( i ??0) <= 3) {
										O = new Mob_Living_SimpleAnimal_Hostile_Syndicate_Ranged_Orion( GlobalFuncs.get_turf( this ) );
										O.target = Task13.User;
										i++;
									}
								}
							}
						}
						this.fuel += FU;
						this.food += FO;
						this.f_event();
					}
				}
			} else if ( Lang13.Bool( href_list["buyparts"] ) ) {
				
				if ( this.gameStatus == 4 ) {
					
					if ( !this.spaceport_raided && this.fuel > 5 ) {
						
						switch ((int?)( String13.ParseNumber( href_list["buyparts"] ) )) {
							case 1:
								this.engine++;
								this.last_spaceport_action = "Bought Engine Parts";
								break;
							case 2:
								this.hull++;
								this.last_spaceport_action = "Bought Hull Plates";
								break;
							case 3:
								this.electronics++;
								this.last_spaceport_action = "Bought Spare Electronics";
								break;
						}
						this.fuel -= 5;
						this.f_event();
					}
				}
			} else if ( Lang13.Bool( href_list["trade"] ) ) {
				
				if ( this.gameStatus == 4 ) {
					
					if ( !this.spaceport_raided ) {
						
						switch ((int?)( String13.ParseNumber( href_list["trade"] ) )) {
							case 1:
								
								if ( this.fuel > 5 ) {
									this.fuel -= 5;
									this.food += 5;
									this.last_spaceport_action = "Traded Fuel for Food";
									this.f_event();
								}
								break;
							case 2:
								
								if ( this.food > 5 ) {
									this.fuel += 5;
									this.food -= 5;
									this.last_spaceport_action = "Traded Food for Fuel";
									this.f_event();
								}
								break;
						}
					}
				}
			}
			this.add_fingerprint( Task13.User );
			this.updateUsrDialog();
			this.busy = false;
			return null;
		}

		// Function from file: arcade.dm
		public override dynamic attack_hand( dynamic a = null, bool? b = null, bool? c = null ) {
			string dat = null;
			dynamic M = null;
			dynamic title = null;
			dynamic subtext = null;
			Browser popup = null;

			
			if ( Lang13.Bool( base.attack_hand( (object)(a), b, c ) ) ) {
				return null;
			}

			if ( this.fuel <= 0 || this.food <= 0 || this.settlers.len == 0 ) {
				this.gameStatus = 3;
				this.v_event = null;
			}
			((Mob)a).set_machine( this );
			dat = "";

			if ( this.gameStatus == 3 ) {
				dat = "<center><h1>Game Over</h1></center>";
				dat += "Like many before you, your crew never made it to Orion, lost to space... <br><b>Forever</b>.";

				if ( this.settlers.len == 0 ) {
					dat += "<br>Your entire crew died, your ship joins the fleet of ghost-ships littering the galaxy.";
				} else {
					
					if ( this.food <= 0 ) {
						dat += "<br>You ran out of food and starved.";

						if ( Lang13.Bool( this.emagged ) ) {
							a.nutrition = 0;
							a.WriteMsg( "<span class='userdanger'><font size=3>Your body instantly contracts to that of one who has not eaten in months. Agonizing cramps seize you as you fall to the floor.</span>" );
						}
					}

					if ( this.fuel <= 0 ) {
						dat += "<br>You ran out of fuel, and drift, slowly, into a star.";

						if ( Lang13.Bool( this.emagged ) ) {
							M = a;
							((Mob_Living)M).adjust_fire_stacks( 5 );
							M.IgniteMob();
							a.WriteMsg( "<span class='userdanger'><font size=3>You feel an immense wave of heat emanate from the arcade machine. Your skin bursts into flames.</span>" );
						}
					}
				}
				dat += new Txt( "<br><P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";menu=1'>OK...</a></P>" ).ToString();

				if ( Lang13.Bool( this.emagged ) ) {
					a.WriteMsg( "<span class='userdanger'><font size=3>You're never going to make it to Orion...</span></font>" );
					((Mob)a).death();
					this.emagged = 0;
					this.gameStatus = 1;
					this.name = "The Orion Trail";
					this.desc = "Learn how our ancestors got to Orion, and have fun in the process!";
				}
			} else if ( Lang13.Bool( this.v_event ) ) {
				dat = this.eventdat;
			} else if ( this.gameStatus == 2 ) {
				title = this.stops[this.turns];
				subtext = this.stopblurbs[this.turns];
				dat = "<center><h1>" + title + "</h1></center>";
				dat += "" + subtext;
				dat += "<h3><b>Crew:</b></h3>";
				dat += GlobalFuncs.english_list( this.settlers );
				dat += "<br><b>Food: </b>" + this.food + " | <b>Fuel: </b>" + this.fuel;
				dat += "<br><b>Engine Parts: </b>" + this.engine + " | <b>Hull Panels: </b>" + this.hull + " | <b>Electronics: </b>" + this.electronics;

				if ( this.turns == 7 ) {
					dat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";pastblack=1'>Go Around</a> <a href='byond://?src=" ).Ref( this ).str( ";blackhole=1'>Continue</a></P>" ).ToString();
				} else {
					dat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";continue=1'>Continue</a></P>" ).ToString();
				}
				dat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";killcrew=1'>Kill a crewmember</a></P>" ).ToString();
				dat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";close=1'>Close</a></P>" ).ToString();
			} else {
				dat = "<center><h2>The Orion Trail</h2></center>";
				dat += "<br><center><h3>Experience the journey of your ancestors!</h3></center><br><br>";
				dat += new Txt( "<center><b><a href='byond://?src=" ).Ref( this ).str( ";newgame=1'>New Game</a></b></center>" ).ToString();
				dat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";close=1'>Close</a></P>" ).ToString();
			}
			popup = new Browser( a, "arcade", "The Orion Trail", 400, 700 );
			popup.set_content( dat );
			popup.set_title_image( ((Mob)a).browse_rsc_icon( this.icon, this.icon_state ) );
			popup.open();
			return null;
		}

		// Function from file: arcade.dm
		public void win(  ) {
			this.gameStatus = 1;
			this.say( "Congratulations, you made it to Orion!" );

			if ( Lang13.Bool( this.emagged ) ) {
				new Obj_Item_Weapon_OrionShip( this.loc );
				GlobalFuncs.message_admins( "" + GlobalFuncs.key_name_admin( Task13.User ) + " made it to Orion on an emagged machine and got an explosive toy ship." );
				GlobalFuncs.log_game( "" + GlobalFuncs.key_name( Task13.User ) + " made it to Orion on an emagged machine and got an explosive toy ship." );
			} else {
				this.prizevend();
			}
			this.emagged = 0;
			this.name = "The Orion Trail";
			this.desc = "Learn how our ancestors got to Orion, and have fun in the process!";
			return;
		}

		// Function from file: arcade.dm
		public dynamic remove_crewmember( string specific = null, string dont_remove = null ) {
			specific = specific ?? "";
			dont_remove = dont_remove ?? "";

			ByTable safe2remove = null;
			dynamic removed = null;

			safe2remove = this.settlers;
			removed = "";

			if ( Lang13.Bool( dont_remove ) ) {
				safe2remove.Remove( dont_remove );
			}

			if ( Lang13.Bool( specific ) && specific != dont_remove ) {
				safe2remove = new ByTable(new object [] { specific });
			} else {
				removed = Rand13.PickFromTable( safe2remove );
			}

			if ( Lang13.Bool( removed ) ) {
				
				if ( this.lings_aboard != 0 && Rand13.PercentChance( this.lings_aboard * 40 ) ) {
					this.lings_aboard = Num13.MaxInt( 0, --this.lings_aboard );
				}
				this.settlers.Remove( removed );
				this.alive--;
			}
			return removed;
		}

		// Function from file: arcade.dm
		public dynamic add_crewmember( string specific = null ) {
			specific = specific ?? "";

			dynamic newcrew = null;

			newcrew = "";

			if ( Lang13.Bool( specific ) ) {
				newcrew = specific;
			} else if ( Rand13.PercentChance( 50 ) ) {
				newcrew = Rand13.PickFromTable( GlobalVars.first_names_male );
			} else {
				newcrew = Rand13.PickFromTable( GlobalVars.first_names_female );
			}

			if ( Lang13.Bool( newcrew ) ) {
				this.settlers.Add( newcrew );
				this.alive++;
			}
			return newcrew;
		}

		// Function from file: arcade.dm
		[VerbInfo( name: "event" )]
		public void f_event(  ) {
			int sfood = 0;
			int sfuel = 0;
			dynamic deadname = null;
			dynamic deadname2 = null;
			int sfood2 = 0;
			int sfuel2 = 0;
			dynamic deadname3 = null;
			dynamic ling1 = null;
			dynamic ling2 = null;
			int chance2attack = 0;
			int chancetokill = 0;
			dynamic deadguy = null;
			int FU = 0;
			int FO = 0;
			int freecrew = 0;

			this.eventdat = "<center><h1>" + this.v_event + "</h1></center>";
			this.canContinueEvent = false;

			dynamic _a = this.v_event; // Was a switch-case, sorry for the mess.
			if ( _a=="Raiders" ) {
				this.eventdat += "Raiders have come aboard your ship!";

				if ( Rand13.PercentChance( 50 ) ) {
					sfood = Rand13.Int( 1, 10 );
					sfuel = Rand13.Int( 1, 10 );
					this.food -= sfood;
					this.fuel -= sfuel;
					this.eventdat += "<br>They have stolen " + sfood + " <b>Food</b> and " + sfuel + " <b>Fuel</b>.";
				} else if ( Rand13.PercentChance( 10 ) ) {
					deadname = this.remove_crewmember();
					this.eventdat += "<br>" + deadname + " tried to fight back but was killed.";
				} else {
					this.eventdat += "<br>Fortunately you fended them off without any trouble.";
				}
				this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";eventclose=1'>Continue</a></P>" ).ToString();
				this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";close=1'>Close</a></P>" ).ToString();
				this.canContinueEvent = true;
			} else if ( _a=="Interstellar Flux" ) {
				this.eventdat += "This region of space is highly turbulent. <br>If we go slowly we may avoid more damage, but if we keep our speed we won't waste supplies.";
				this.eventdat += "<br>What will you do?";
				this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";slow=1'>Slow Down</a> <a href='byond://?src=" ).Ref( this ).str( ";keepspeed=1'>Continue</a></P>" ).ToString();
				this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";close=1'>Close</a></P>" ).ToString();
			} else if ( _a=="Illness" ) {
				this.eventdat += "A deadly illness has been contracted!";
				deadname2 = this.remove_crewmember();
				this.eventdat += "<br>" + deadname2 + " was killed by the disease.";
				this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";eventclose=1'>Continue</a></P>" ).ToString();
				this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";close=1'>Close</a></P>" ).ToString();
				this.canContinueEvent = true;
			} else if ( _a=="Breakdown" ) {
				this.eventdat += "Oh no! The engine has broken down!";
				this.eventdat += "<br>You can repair it with an engine part, or you can make repairs for 3 days.";

				if ( this.engine >= 1 ) {
					this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";useengine=1'>Use Part</a><a href='byond://?src=" ).Ref( this ).str( ";wait=1'>Wait</a></P>" ).ToString();
				} else {
					this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";wait=1'>Wait</a></P>" ).ToString();
				}
				this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";close=1'>Close</a></P>" ).ToString();
			} else if ( _a=="Malfunction" ) {
				this.eventdat += "The ship's systems are malfunctioning!";
				this.eventdat += "<br>You can replace the broken electronics with spares, or you can spend 3 days troubleshooting the AI.";

				if ( this.electronics >= 1 ) {
					this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";useelec=1'>Use Part</a><a href='byond://?src=" ).Ref( this ).str( ";wait=1'>Wait</a></P>" ).ToString();
				} else {
					this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";wait=1'>Wait</a></P>" ).ToString();
				}
				this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";close=1'>Close</a></P>" ).ToString();
			} else if ( _a=="Collision" ) {
				this.eventdat += "Something hit us! Looks like there's some hull damage.";

				if ( Rand13.PercentChance( 25 ) ) {
					sfood2 = Rand13.Int( 5, 15 );
					sfuel2 = Rand13.Int( 5, 15 );
					this.food -= sfood2;
					this.fuel -= sfuel2;
					this.eventdat += "<br>" + sfood2 + " <b>Food</b> and " + sfuel2 + " <b>Fuel</b> was vented out into space.";
				}

				if ( Rand13.PercentChance( 10 ) ) {
					deadname3 = this.remove_crewmember();
					this.eventdat += "<br>" + deadname3 + " was killed by rapid depressurization.";
				}
				this.eventdat += "<br>You can repair the damage with hull plates, or you can spend the next 3 days welding scrap together.";

				if ( this.hull >= 1 ) {
					this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";usehull=1'>Use Part</a><a href='byond://?src=" ).Ref( this ).str( ";wait=1'>Wait</a></P>" ).ToString();
				} else {
					this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";wait=1'>Wait</a></P>" ).ToString();
				}
				this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";close=1'>Close</a></P>" ).ToString();
			} else if ( _a=="BlackHole" ) {
				this.eventdat += "You were swept away into the black hole.";
				this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";holedeath=1'>Oh...</a></P>" ).ToString();
				this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";close=1'>Close</a></P>" ).ToString();
				this.settlers = new ByTable();
			} else if ( _a=="Changelings?" ) {
				this.eventdat += "Strange reports warn of changelings infiltrating crews on trips to Orion...";

				if ( this.settlers.len <= 2 ) {
					this.eventdat += "<br>Your crew's chance of reaching Orion is so slim the changelings likely avoided your ship...";
					this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";eventclose=1'>Continue</a></P>" ).ToString();
					this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";close=1'>Close</a></P>" ).ToString();

					if ( Rand13.PercentChance( 10 ) ) {
						this.lings_aboard = Num13.MinInt( ++this.lings_aboard, 2 );
					}
				} else {
					
					if ( this.lings_aboard != 0 ) {
						
						if ( Rand13.PercentChance( 20 ) ) {
							this.lings_aboard = Num13.MinInt( ++this.lings_aboard, 2 );
						}
					} else if ( Rand13.PercentChance( 70 ) ) {
						this.lings_aboard = Num13.MinInt( ++this.lings_aboard, 2 );
					}
					this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";killcrew=1'>Kill a crewmember</a></P>" ).ToString();
					this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";eventclose=1'>Risk it</a></P>" ).ToString();
					this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";close=1'>Close</a></P>" ).ToString();
				}
				this.canContinueEvent = true;
			} else if ( _a=="Changeling Ambush" ) {
				
				if ( this.lings_aboard <= 0 ) {
					this.eventdat += "Haha, fooled you, there are no changelings on board!";
					this.eventdat += "<br>(You should report this to a coder :S)";
				} else {
					ling1 = this.remove_crewmember();
					ling2 = "";

					if ( this.lings_aboard >= 2 ) {
						ling2 = this.remove_crewmember();
					}
					this.eventdat += "Oh no, some of your crew are Changelings!";

					if ( Lang13.Bool( ling2 ) ) {
						this.eventdat += "<br>" + ling1 + " and " + ling2 + "'s arms twist and contort into grotesque blades!";
					} else {
						this.eventdat += "<br>" + ling1 + "'s arm twists and contorts into a grotesque blade!";
					}
					chance2attack = this.alive * 20;

					if ( Rand13.PercentChance( chance2attack ) ) {
						chancetokill = this.lings_aboard * 30 - this.alive * 5;

						if ( Rand13.PercentChance( chancetokill ) ) {
							deadguy = this.remove_crewmember();
							this.eventdat += "<br>The Changeling" + ( Lang13.Bool( ling2 ) ? "s" : "" ) + " run" + ( Lang13.Bool( ling2 ) ? "" : "s" ) + " up to " + deadguy + " and capitulates them!";
						} else {
							this.eventdat += "<br>You valiantly fight off the Changeling" + ( Lang13.Bool( ling2 ) ? "s" : "" ) + "!";
							this.eventdat += "<br>You cut the Changeling" + ( Lang13.Bool( ling2 ) ? "s" : "" ) + " up into meat... Eww";

							if ( Lang13.Bool( ling2 ) ) {
								this.food += 30;
								this.lings_aboard = Num13.MaxInt( 0, this.lings_aboard - 2 );
							} else {
								this.food += 15;
								this.lings_aboard = Num13.MaxInt( 0, --this.lings_aboard );
							}
						}
					} else {
						this.eventdat += "<br>The Changeling" + ( Lang13.Bool( ling2 ) ? "s" : "" ) + " run" + ( Lang13.Bool( ling2 ) ? "" : "s" ) + " away, What wimps!";

						if ( Lang13.Bool( ling2 ) ) {
							this.lings_aboard = Num13.MaxInt( 0, this.lings_aboard - 2 );
						} else {
							this.lings_aboard = Num13.MaxInt( 0, --this.lings_aboard );
						}
					}
				}
				this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";eventclose=1'>Continue</a></P>" ).ToString();
				this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";close=1'>Close</a></P>" ).ToString();
				this.canContinueEvent = true;
			} else if ( _a=="Spaceport" ) {
				this.gameStatus = 4;

				if ( this.spaceport_raided ) {
					this.eventdat += "The Spaceport is on high alert! they wont let you dock since you tried to attack them!";

					if ( Lang13.Bool( this.last_spaceport_action ) ) {
						this.eventdat += "<br>Last Spaceport Action: " + this.last_spaceport_action;
					}
					this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";leave_spaceport=1'>Depart Spaceport</a></P>" ).ToString();
					this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";close=1'>Close</a></P>" ).ToString();
				} else {
					this.eventdat += "You pull the ship up to dock at a nearby Spaceport, lucky find!";
					this.eventdat += "<br>This Spaceport is home to travellers who failed to reach Orion, but managed to find a different home...";
					this.eventdat += "<br>Trading terms: FU = Fuel, FO = Food";

					if ( Lang13.Bool( this.last_spaceport_action ) ) {
						this.eventdat += "<br>Last Spaceport Action: " + this.last_spaceport_action;
					}
					this.eventdat += "<h3><b>Crew:</b></h3>";
					this.eventdat += GlobalFuncs.english_list( this.settlers );
					this.eventdat += "<br><b>Food: </b>" + this.food + " | <b>Fuel: </b>" + this.fuel;
					this.eventdat += "<br><b>Engine Parts: </b>" + this.engine + " | <b>Hull Panels: </b>" + this.hull + " | <b>Electronics: </b>" + this.electronics;

					if ( !( this.spaceport_freebie != 0 ) && ( this.fuel < 20 || this.food < 20 ) ) {
						this.spaceport_freebie++;
						FU = 10;
						FO = 10;
						freecrew = 0;

						if ( Rand13.PercentChance( 30 ) ) {
							FU = 25;
							FO = 25;
						}

						if ( Rand13.PercentChance( 10 ) ) {
							this.add_crewmember();
							freecrew++;
						}
						this.eventdat += "<br>The traders of the spaceport take pitty on you, and give you some food and fuel (+" + FU + "FU,+" + FO + "FO)";

						if ( freecrew != 0 ) {
							this.eventdat += "<br>You also gain a new crewmember!";
						}
						this.fuel += FU;
						this.food += FO;
					}
					this.eventdat += "<P ALIGN=Right>Crew Management:</P>";

					if ( this.food >= 10 && this.fuel >= 10 ) {
						this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";buycrew=1'>Hire a new Crewmember (-10FU,-10FO)</a></P>" ).ToString();
					} else {
						this.eventdat += "<P ALIGN=Right>Cant afford a new Crewmember</P>";
					}

					if ( this.settlers.len > 1 ) {
						this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";sellcrew=1'>Sell crew for Fuel and Food (+7FU,+7FO)</a></P>" ).ToString();
					} else {
						this.eventdat += "<P ALIGN=Right>Cant afford to sell a Crewmember</P>";
					}
					this.eventdat += "<P ALIGN=Right>Spare Parts:</P>";

					if ( this.fuel > 5 ) {
						this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";buyparts=1'>Buy Engine Parts (-5FU)</a></P>" ).ToString();
					} else {
						this.eventdat += "<P ALIGN=Right>Cant afford to buy Engine Parts</a>";
					}

					if ( this.fuel > 5 ) {
						this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";buyparts=2'>Buy Hull Plates (-5FU)</a></P>" ).ToString();
					} else {
						this.eventdat += "<P ALIGN=Right>Cant afford to buy Hull Plates</a>";
					}

					if ( this.fuel > 5 ) {
						this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";buyparts=3'>Buy Spare Electronics (-5FU)</a></P>" ).ToString();
					} else {
						this.eventdat += "<P ALIGN=Right>Cant afford to buy Spare Electronics</a>";
					}

					if ( this.fuel > 5 ) {
						this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";trade=1'>Trade Fuel for Food (-5FU,+5FO)</a></P>" ).ToString();
					} else {
						this.eventdat += "<P ALIGN=Right>Cant afford to Trade Fuel for Food</P";
					}

					if ( this.food > 5 ) {
						this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";trade=2'>Trade Food for Fuel (+5FU,-5FO)</a></P>" ).ToString();
					} else {
						this.eventdat += "<P ALIGN=Right>Cant afford to Trade Food for Fuel</P";
					}
					this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";raid_spaceport=1'>!! Raid Spaceport !!</a></P>" ).ToString();
					this.eventdat += new Txt( "<P ALIGN=Right><a href='byond://?src=" ).Ref( this ).str( ";leave_spaceport=1'>Depart Spaceport</a></P>" ).ToString();
				}
			}
			return;
		}

		// Function from file: arcade.dm
		public void newgame(  ) {
			int? i = null;

			this.settlers = new ByTable();
			i = null;
			i = 1;

			while (( i ??0) <= 3) {
				this.add_crewmember();
				i++;
			}
			this.add_crewmember( "" + Task13.User );
			this.engine = 1;
			this.hull = 1;
			this.electronics = 1;
			this.food = 80;
			this.fuel = 60;
			this.alive = 4;
			this.turns = 1;
			this.v_event = null;
			this.gameStatus = 2;
			this.lings_aboard = 0;
			this.spaceport_raided = false;
			this.spaceport_freebie = 0;
			this.last_spaceport_action = "";
			return;
		}

	}

}