// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Toy_Gun : Obj_Item_Toy {

		public double bullets = 7;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.item_state = "gun";
			this.slot_flags = 512;
			this.starting_materials = new ByTable().Set( "$iron", 10 ).Set( "$glass", 10 );
			this.w_type = 1;
			this.melt_temperature = 453.41;
			this.attack_verb = new ByTable(new object [] { "struck", "pistol whipped", "hit", "bashed" });
			this.icon = "icons/obj/gun.dmi";
			this.icon_state = "revolver";
		}

		public Obj_Item_Toy_Gun ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: toys.dm
		public override bool afterattack( dynamic A = null, dynamic user = null, bool? flag = null, dynamic _params = null, bool? struggle = null ) {
			dynamic O = null;

			
			if ( flag == true ) {
				return false;
			}

			if ( !Lang13.Bool( user.dexterity_check() ) ) {
				GlobalFuncs.to_chat( user, "<span class = 'warning'>You don't have the dexterity to do this!</span>" );
				return false;
			}
			this.add_fingerprint( user );

			if ( this.bullets < 1 ) {
				user.show_message( "<span class = 'danger'>*click* *click*</span>", 2 );
				GlobalFuncs.playsound( user, "sound/weapons/empty.ogg", 100, 1 );
				return false;
			}
			GlobalFuncs.playsound( user, "sound/weapons/Gunshot.ogg", 100, 1 );
			this.bullets--;

			foreach (dynamic _a in Lang13.Enumerate( Map13.FetchViewers( null, user ) )) {
				O = _a;
				
				O.show_message( "<span class = 'danger'><B>" + user + " fires a cap gun at " + A + "!</B></span>", 1, "<span class = 'danger'>You hear a gunshot</span>", 2 );
			}
			return false;
		}

		// Function from file: toys.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			
			if ( a is Obj_Item_Toy_Ammo_Gun ) {
				
				if ( this.bullets >= 7 ) {
					GlobalFuncs.to_chat( b, "<span class = 'notice'>It's already fully loaded!</span>" );
					return 1;
				}

				if ( a.amount_left <= 0 ) {
					GlobalFuncs.to_chat( b, "<span class = 'warning'>There is no more caps!</span>" );
					return 1;
				}

				if ( a.amount_left < 7 - this.bullets ) {
					this.bullets += a.amount_left;
					GlobalFuncs.to_chat( b, new Txt( "<span class = 'warning'>You reload " ).item( a.amount_left ).str( " caps" ).s().str( "!</span>" ).ToString() );
					a.amount_left = 0;
				} else {
					GlobalFuncs.to_chat( b, new Txt( "<span class = 'warning'>You reload " ).item( 7 - this.bullets ).str( " caps" ).s().str( "!</span>" ).ToString() );
					a.amount_left -= 7 - this.bullets;
					this.bullets = 7;
				}
				a.update_icon();
				return 1;
			}
			return null;
		}

		// Function from file: toys.dm
		public override dynamic examine( dynamic user = null, string size = null ) {
			base.examine( (object)(user), size );
			GlobalFuncs.to_chat( user, new Txt( "There " ).item( ( this.bullets == 1 ? "is" : "are" ) ).str( " " ).item( this.bullets ).str( " cap" ).s().str( " left." ).ToString() );
			return null;
		}

	}

}