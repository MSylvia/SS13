// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Structure_Cult_Pylon : Obj_Structure_Cult {

		public bool isbroken = false;
		public dynamic wepon = null;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.light_range = 5;
			this.light_color = "#FA8282";
			this.icon_state = "pylon";
		}

		public Obj_Structure_Cult_Pylon ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: cult_structures.dm
		public void repair( Mob user = null ) {
			
			if ( this.isbroken ) {
				GlobalFuncs.to_chat( user, "You repair the pylon." );
				this.isbroken = false;
				this.density = true;
				this.icon_state = "pylon";
				this.set_light( 5 );
			}
			return;
		}

		// Function from file: cult_structures.dm
		public void attackpylon( dynamic user = null, dynamic damage = null ) {
			dynamic M = null;

			
			if ( !this.isbroken ) {
				
				if ( Rand13.PercentChance( Convert.ToInt32( damage * 5 + 1 ) ) ) {
					GlobalFuncs.to_chat( user, "You hit the pylon, and its crystal breaks apart!" );

					foreach (dynamic _a in Lang13.Enumerate( Map13.FetchViewers( null, this ) )) {
						M = _a;
						

						if ( M == user ) {
							continue;
						}
						M.show_message( "" + user.name + " smashed the pylon!", 1, "You hear a tinkle of crystal shards.", 2 );
					}
					GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/effects/Glassbr3.ogg", 75, 1 );
					this.isbroken = true;
					this.density = false;
					this.icon_state = "pylon-broken";
					this.set_light( 0 );
				} else {
					GlobalFuncs.to_chat( user, "You hit the pylon!" );
					GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/effects/Glasshit.ogg", 75, 1 );
				}
			} else {
				
				if ( Rand13.PercentChance( Convert.ToInt32( damage * 2 ) ) ) {
					GlobalFuncs.to_chat( user, "You pulverize what was left of the pylon!" );
					GlobalFuncs.qdel( this );
				} else {
					GlobalFuncs.to_chat( user, "You hit the pylon!" );
				}
				GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/effects/Glasshit.ogg", 75, 1 );
			}
			return;
		}

		// Function from file: cult_structures.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			this.attackpylon( b, a.force );
			return null;
		}

		// Function from file: cult_structures.dm
		public override dynamic attack_animal( Mob_Living user = null ) {
			this.attackpylon( user, ((dynamic)user).melee_damage_upper );
			return null;
		}

		// Function from file: cult_structures.dm
		public override dynamic attack_hand( dynamic a = null, dynamic b = null, dynamic c = null ) {
			this.attackpylon( a, 5 );
			return null;
		}

	}

}