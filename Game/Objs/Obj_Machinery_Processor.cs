// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_Processor : Obj_Machinery {

		public bool broken = false;
		public bool processing = false;
		public bool opened = false;
		public double time_coeff = 1;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.anchored = 1;
			this.machine_flags = 30;
			this.idle_power_usage = 20;
			this.active_power_usage = 500;
			this.icon = "icons/obj/kitchen.dmi";
			this.icon_state = "processor";
		}

		// Function from file: processor.dm
		public Obj_Machinery_Processor ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.component_parts = new ByTable(new object [] { 
				new Obj_Item_Weapon_Circuitboard_Processor(), 
				new Obj_Item_Weapon_StockParts_ScanningModule(), 
				new Obj_Item_Weapon_StockParts_Manipulator(), 
				new Obj_Item_Weapon_StockParts_Manipulator()
			 });
			this.RefreshParts();
			return;
		}

		// Function from file: processor.dm
		public override bool MouseDrop_T( Ent_Static O = null, dynamic user = null, bool? needs_opened = null, bool? show_message = null, bool? move_them = null ) {
			this.attackby( O, user );
			return false;
		}

		// Function from file: processor.dm
		public override dynamic attack_hand( dynamic a = null, dynamic b = null, dynamic c = null ) {
			dynamic O = null;
			dynamic P = null;

			
			if ( this.stat != 0 ) {
				return null;
			}

			if ( !Lang13.Bool( this.anchored ) ) {
				GlobalFuncs.to_chat( a, "<span class='warning'>" + this + " must be anchored first!</span>" );
				return null;
			}

			if ( this.processing ) {
				GlobalFuncs.to_chat( a, "<span class='warning'>" + this + " is already processing!</span>" );
				return 1;
			}

			if ( this.contents.len == 0 ) {
				GlobalFuncs.to_chat( a, "<span class='warning'>" + this + " is empty!</span>" );
				return 1;
			}

			foreach (dynamic _a in Lang13.Enumerate( this.contents )) {
				O = _a;
				
				P = this.select_recipe( O );

				if ( !Lang13.Bool( P ) ) {
					GlobalFuncs.log_admin( "DEBUG: " + O + " in processor is not suitable. How did you put it in?" );
					continue;
				}
				this.processing = true;
				((Ent_Static)a).visible_message( "<span class='notice'>" + a + " turns on " + this + "</span>.", new Txt( "You turn on " ).a( this ).item().str( "." ).ToString(), "You hear " + this + " start" );
				GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/machines/blender.ogg", 50, 1 );
				this.f_use_power( 500 );
				Task13.Sleep( Convert.ToInt32( P.time * this.time_coeff ) );
				P.process( this.loc, O );
				this.processing = false;
			}
			this.visible_message( "<span class='notice'>" + this + " is done.</span>", "You hear " + this + " stop" );
			return null;
		}

		// Function from file: processor.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			dynamic what = null;
			dynamic G = null;
			dynamic P = null;

			
			if ( this.processing ) {
				GlobalFuncs.to_chat( b, "<span class='warning'>" + this + " is already processing!</span>" );
				return 1;
			}

			if ( Lang13.Bool( base.attackby( (object)(a), (object)(b), (object)(c) ) ) ) {
				return 1;
			}

			if ( this.contents.len > 0 ) {
				GlobalFuncs.to_chat( b, "<span class='warning'>Something is already in " + this + "</span>." );
				return 1;
			}
			what = a;

			if ( a is Obj_Item_Weapon_Grab ) {
				G = a;
				what = G.affecting;
			}
			P = this.select_recipe( what );

			if ( !Lang13.Bool( P ) ) {
				GlobalFuncs.to_chat( b, "<span class='warning'>This probably won't blend.</span>" );
				return 1;
			}
			((Ent_Static)b).visible_message( "<span class='notice'>" + b + " puts " + what + " into " + this + ".</span>", "You put " + what + " into the " + this + "." );

			if ( what == ((Mob)b).get_active_hand() ) {
				b.drop_item( what, this );
			} else {
				
				if ( a.loc == b ) {
					b.drop_item( a );
				}
				what.loc = this;
			}
			return null;
		}

		// Function from file: processor.dm
		public override int crowbarDestroy( dynamic user = null ) {
			
			if ( this.contents.len != 0 ) {
				GlobalFuncs.to_chat( user, new Txt( "You can't do that while something is loaded in " ).the( this ).item().str( "." ).ToString() );
				return -1;
			}
			return base.crowbarDestroy( (object)(user) );
		}

		// Function from file: processor.dm
		public dynamic select_recipe( dynamic X = null ) {
			dynamic Type = null;
			dynamic P = null;

			
			foreach (dynamic _a in Lang13.Enumerate( Lang13.GetTypes( typeof(FoodProcessorProcess) ) - typeof(FoodProcessorProcess) - typeof(FoodProcessorProcess_Mob) )) {
				Type = _a;
				
				P = Lang13.Call( Type );

				if ( !Lang13.Bool( P.input.IsInstanceOfType( X ) ) ) {
					continue;
				}
				return P;
			}
			return 0;
		}

		// Function from file: processor.dm
		public override dynamic RefreshParts(  ) {
			int manipcount = 0;
			Obj_Item_Weapon_StockParts SP = null;

			manipcount = 0;

			foreach (dynamic _a in Lang13.Enumerate( this.component_parts, typeof(Obj_Item_Weapon_StockParts) )) {
				SP = _a;
				

				if ( SP is Obj_Item_Weapon_StockParts_Manipulator ) {
					manipcount += SP.rating;
				}
			}
			this.time_coeff = 2 / manipcount;
			return null;
		}

	}

}