// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_LazarusInjector : Obj_Item_Weapon {

		public bool loaded = true;
		public bool malfunctioning = false;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.item_state = "hypo";
			this.w_class = 2;
			this.throw_speed = 3;
			this.throw_range = 5;
			this.origin_tech = "biotech=4";
			this.icon = "icons/obj/syringe.dmi";
			this.icon_state = "lazarus_hypo";
		}

		public Obj_Item_Weapon_LazarusInjector ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: equipment_locker.dm
		public override double examine( dynamic user = null ) {
			base.examine( (object)(user) );

			if ( !this.loaded ) {
				user.WriteMsg( "<span class='info'>" + this + " is empty.</span>" );
			}

			if ( this.malfunctioning ) {
				user.WriteMsg( "<span class='info'>The display on " + this + " seems to be flickering.</span>" );
			}
			return 0;
		}

		// Function from file: equipment_locker.dm
		public override double emp_act( int severity = 0 ) {
			
			if ( !this.malfunctioning ) {
				this.malfunctioning = true;
			}
			return 0;
		}

		// Function from file: equipment_locker.dm
		public override bool afterattack( dynamic target = null, dynamic user = null, bool? proximity_flag = null, string click_parameters = null ) {
			dynamic M = null;
			dynamic H = null;

			
			if ( !this.loaded ) {
				return false;
			}

			if ( target is Mob_Living && proximity_flag == true ) {
				
				if ( target is Mob_Living_SimpleAnimal ) {
					M = target;

					if ( Convert.ToInt32( M.stat ) == 2 ) {
						M.faction = new ByTable(new object [] { "neutral" });
						M.revive();

						if ( target is Mob_Living_SimpleAnimal_Hostile ) {
							H = M;

							if ( this.malfunctioning ) {
								H.faction |= new ByTable(new object [] { "lazarus", new Txt().Ref( user ).ToString() });
								H.robust_searching = true;
								H.friends.Add( user );
								H.attack_same = 1;
								GlobalFuncs.log_game( "" + user + " has revived hostile mob " + target + " with a malfunctioning lazarus injector" );
							} else {
								H.attack_same = 0;
							}
						}
						this.loaded = false;
						((Ent_Static)user).visible_message( "<span class='notice'>" + user + " injects " + M + " with " + this + ", reviving it.</span>" );
						GlobalFuncs.playsound( this, "sound/effects/refill.ogg", 50, 1 );
						this.icon_state = "lazarus_empty";
						return false;
					} else {
						user.WriteMsg( "<span class='info'>" + this + " is only effective on the dead.</span>" );
						return false;
					}
				} else {
					user.WriteMsg( "<span class='info'>" + this + " is only effective on lesser beings.</span>" );
					return false;
				}
			}
			return false;
		}

	}

}