// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_ProcHolder_Spell_Targeted_Barnyardcurse : Obj_Effect_ProcHolder_Spell_Targeted {

		public ByTable compatible_mobs = new ByTable(new object [] { typeof(Mob_Living_Carbon_Human), typeof(Mob_Living_Carbon_Monkey) });

		protected override void __FieldInit() {
			base.__FieldInit();

			this.school = "transmutation";
			this.charge_max = 150;
			this.clothes_req = 0;
			this.invocation = "KN'A FTAGHU, PUCK 'BTHNK!";
			this.invocation_type = "shout";
			this.cooldown_min = 30;
			this.selection_type = "range";
			this.action_icon_state = "barn";
		}

		public Obj_Effect_ProcHolder_Spell_Targeted_Barnyardcurse ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: barnyard.dm
		public override bool cast( dynamic targets = null, dynamic thearea = null, dynamic user = null ) {
			thearea = thearea ?? Task13.User;

			Mob target = null;
			ByTable masks = null;
			ByTable mSounds = null;
			int randM = 0;
			dynamic choice = null;
			dynamic magichead = null;

			
			if ( !( targets.len != 0 ) ) {
				thearea.WriteMsg( "<span class='notice'>No target found in range.</span>" );
				return false;
			}
			target = targets[1];

			if ( !this.compatible_mobs.Contains( target.type ) ) {
				thearea.WriteMsg( "<span class='notice'>You are unable to curse " + target + "'s head!</span>" );
				return false;
			}

			if ( !Map13.FetchInViewExcludeThis( null, this.range ).Contains( target ) ) {
				thearea.WriteMsg( "<span class='notice'>They are too far away!</span>" );
				return false;
			}
			masks = new ByTable(new object [] { typeof(Obj_Item_Clothing_Mask_Spig), typeof(Obj_Item_Clothing_Mask_Cowmask), typeof(Obj_Item_Clothing_Mask_Horsehead) });
			mSounds = new ByTable(new object [] { "sound/magic/PigHead_curse.ogg", "sound/magic/CowHead_Curse.ogg", "sound/magic/HorseHead_curse.ogg" });
			randM = Rand13.Int( 1, 3 );
			choice = masks[randM];
			magichead = Lang13.Call( choice );
			magichead.flags |= 2;
			magichead.flags_inv = null;
			target.visible_message( "<span class='danger'>" + target + "'s face lights up in fire, and after the event a barnyard animal's head takes it's place!</span>", "<span class='danger'>Your face burns up, and shortly after the fire you realise you have the face of a barnyard animal!</span>" );

			if ( !target.unEquip( ((dynamic)target).wear_mask ) ) {
				GlobalFuncs.qdel( ((dynamic)target).wear_mask );
			}
			target.equip_to_slot_if_possible( magichead, 2, true, true );
			GlobalFuncs.playsound( GlobalFuncs.get_turf( target ), mSounds[randM], 50, 1 );
			((dynamic)target).flash_eyes();
			return false;
		}

	}

}