// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Pizzabox : Obj_Item {

		public bool open = false;
		public string boxtag = "";
		public ByTable boxes = new ByTable();
		public dynamic pizza = null;
		public dynamic bomb = null;
		public int? bomb_active = 0;
		public int? bomb_defused = 1;
		public dynamic bomb_timer = 1;
		public bool BOMB_TIMER_MIN = true;
		public int BOMB_TIMER_MAX = 10;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.item_state = "pizzabox";
			this.icon = "icons/obj/food/containers.dmi";
			this.icon_state = "pizzabox1";
		}

		// Function from file: pizzabox.dm
		public Obj_Item_Pizzabox ( dynamic loc = null ) : base( (object)(loc) ) {
			this.update_icon();
			return;
		}

		// Function from file: pizzabox.dm
		public void unprocess(  ) {
			GlobalVars.SSobj.processing.Remove( this );
			GlobalFuncs.qdel( this.wires );
			this.wires = null;
			this.update_icon();
			return;
		}

		// Function from file: pizzabox.dm
		public override int? process( dynamic seconds = null ) {
			
			if ( Lang13.Bool( this.bomb_active ) && !Lang13.Bool( this.bomb_defused ) && Convert.ToDouble( this.bomb_timer ) > 0 ) {
				GlobalFuncs.playsound( this.loc, "sound/items/timer.ogg", 50, 0 );
				this.bomb_timer--;
			}

			if ( Lang13.Bool( this.bomb_active ) && !Lang13.Bool( this.bomb_defused ) && Convert.ToDouble( this.bomb_timer ) <= 0 ) {
				
				if ( Lang13.Bool( ((dynamic)this).Contains( this.bomb ) ) ) {
					this.bomb.detonate();
					this.unprocess();
				}
			}

			if ( !Lang13.Bool( this.bomb_active ) || Lang13.Bool( this.bomb_defused ) ) {
				
				if ( Lang13.Bool( ((dynamic)this).Contains( Lang13.Bool( this.bomb_defused ) && Lang13.Bool( this.bomb ) ) ) ) {
					this.bomb.defuse();
					this.bomb_active = GlobalVars.FALSE;
					this.unprocess();
				}
			}
			return null;
		}

		// Function from file: pizzabox.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			dynamic newbox = null;
			ByTable add = null;
			Obj_Item_Pizzabox box = null;

			
			if ( A is Obj_Item_Pizzabox ) {
				newbox = A;

				if ( !this.open && !Lang13.Bool( newbox.open ) ) {
					add = new ByTable();
					add.Add( newbox );
					add.Add( newbox.boxes );

					if ( this.boxes.len + add.len + 1 <= 5 ) {
						
						if ( !Lang13.Bool( user.drop_item() ) ) {
							return null;
						}
						this.boxes.Add( add );
						newbox.boxes.Cut();
						newbox.loc = this;
						user.WriteMsg( "<span class='notice'>You put " + newbox + " on top of " + this + "!</span>" );
						newbox.update_icon();
						this.update_icon();
						return null;
					} else {
						user.WriteMsg( "<span class='notice'>The stack is dangerously high!</span>" );
					}
				} else {
					user.WriteMsg( "<span class='notice'>Close " + ( this.open ? ((dynamic)( this )) : newbox ) + " first!</span>" );
				}
			} else if ( A is Obj_Item_Weapon_ReagentContainers_Food_Snacks_Pizza || A is Obj_Item_Weapon_ReagentContainers_Food_Snacks_Customizable_Pizza ) {
				
				if ( this.open ) {
					
					if ( !Lang13.Bool( user.drop_item() ) ) {
						return null;
					}
					this.pizza = A;
					A.loc = this;
					user.WriteMsg( "<span class='notice'>You put " + A + " in " + this + ".</span>" );
					this.update_icon();
					return null;
				}
			} else if ( A is Obj_Item_Weapon_Bombcore_Pizza ) {
				
				if ( this.open && !Lang13.Bool( this.bomb ) ) {
					
					if ( !Lang13.Bool( user.drop_item() ) ) {
						return null;
					}
					this.wires = new Wires_Explosive_Pizza( this );
					this.bomb = A;
					A.loc = this;
					user.WriteMsg( "<span class='notice'>You put " + A + " in " + this + ". Sneeki breeki...</span>" );
					this.update_icon();
					return null;
				} else if ( Lang13.Bool( this.bomb ) ) {
					user.WriteMsg( "<span class='notice'>" + this + " already has a bomb in it!</span>" );
				}
			} else if ( A is Obj_Item_Weapon_Pen ) {
				
				if ( !this.open ) {
					box = ( this.boxes.len != 0 ? this.boxes[this.boxes.len] : this );
					box.boxtag += GlobalFuncs.stripped_input( user, "Write on " + box + "'s tag:", box, "", 30 );
					user.WriteMsg( "<span class='notice'>You write with " + A + " on " + this + ".</span>" );
					this.update_icon();
					return null;
				}
			} else if ( Lang13.Bool( GlobalFuncs.is_wire_tool( A ) ) ) {
				
				if ( Lang13.Bool( this.wires ) && Lang13.Bool( this.bomb ) ) {
					this.wires.interact( user );
				}
			} else if ( A is Obj_Item_Weapon_ReagentContainers_Food ) {
				user.WriteMsg( "<span class='notice'>That's not a pizza!</span>" );
			}
			base.attackby( (object)(A), (object)(user), _params, silent, replace_spent );
			return null;
		}

		// Function from file: pizzabox.dm
		public override dynamic attack_hand( dynamic a = null, bool? b = null, bool? c = null ) {
			dynamic topbox = null;

			
			if ( ((Mob)a).get_inactive_hand() != this ) {
				base.attack_hand( (object)(a), b, c );
				return null;
			}

			if ( this.open ) {
				
				if ( Lang13.Bool( this.pizza ) ) {
					((Mob)a).put_in_hands( this.pizza );
					a.WriteMsg( "<span class='notice'>You take " + this.pizza + " out of " + this + ".</span>" );
					this.pizza = null;
					this.update_icon();
					return null;
				} else if ( Lang13.Bool( this.bomb ) ) {
					
					if ( Lang13.Bool( ((Wires)this.wires).is_all_cut() ) && Lang13.Bool( this.bomb_defused ) ) {
						((Mob)a).put_in_hands( this.bomb );
						a.WriteMsg( "<span class='notice'>You carefully remove the " + this.bomb + " from " + this + ".</span>" );
						this.bomb = null;
						this.update_icon();
						return null;
					} else {
						this.bomb_timer = Interface13.Input( a, "Set the " + this.bomb + " timer from " + GlobalVars.BOMB_TIMER_MIN + " to " + GlobalVars.BOMB_TIMER_MAX + ".", this.bomb, this.bomb_timer, null, InputType.Num );
						this.bomb_timer = Num13.MaxInt( GlobalVars.BOMB_TIMER_MIN ?1:0, Num13.MinInt( GlobalFuncs.Ceiling( this.bomb_timer / 2 ), GlobalVars.BOMB_TIMER_MAX ) );
						this.bomb_defused = GlobalVars.FALSE;
						GlobalFuncs.message_admins( new Txt().item( GlobalFuncs.key_name_admin( a ) ).str( "<A HREF='?_src_=holder;adminmoreinfo=" ).Ref( a ).str( "'>?</A> (<A HREF='?_src_=holder;adminplayerobservefollow=" ).Ref( a ).str( "'>FLW</A>) has trapped a " ).item( this ).str( " with " ).item( this.bomb ).str( " set to " ).item( this.bomb_timer * 2 ).str( " seconds." ).ToString() );
						GlobalFuncs.log_game( "" + GlobalFuncs.key_name( a ) + " has trapped a " + this + " with " + this.bomb + " set to " + this.bomb_timer * 2 + " seconds." );
						this.bomb.adminlog = "The " + this.bomb.name + " in " + this.name + " that " + GlobalFuncs.key_name( a ) + " activated has detonated!";
						a.WriteMsg( "<span class='warning'>You trap " + this + " with " + this.bomb + ".</span>" );
						this.update_icon();
					}
					return null;
				}
			} else if ( this.boxes.len != 0 ) {
				topbox = this.boxes[this.boxes.len];
				this.boxes.Remove( topbox );
				((Mob)a).put_in_hands( topbox );
				a.WriteMsg( "<span class='notice'>You remove the topmost " + this.name + " from the stack.</span>" );
				topbox.update_icon();
				this.update_icon();
				return null;
			}
			base.attack_hand( (object)(a), b, c );
			return null;
		}

		// Function from file: pizzabox.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			
			if ( this.boxes.len > 0 ) {
				return null;
			}
			this.open = !this.open;

			if ( this.open && !Lang13.Bool( this.bomb_defused ) ) {
				this.audible_message( new Txt( "<span class='warning'>" ).icon( this ).str( " *beep*</span>" ).ToString() );
				this.bomb_active = GlobalVars.TRUE;
				GlobalVars.SSobj.processing.Or( this );
			}
			this.update_icon();
			return null;
		}

		// Function from file: pizzabox.dm
		public override bool update_icon( dynamic new_state = null, dynamic new_icon = null, int? new_px = null, int? new_py = null ) {
			Obj_Item_Pizzabox box = null;
			Image pizzaimg = null;
			Image bombimg = null;
			Obj_Item_Pizzabox box2 = null;
			Image tagimg = null;

			this.desc = Lang13.Initial( this, "desc" );

			if ( this.open ) {
				
				if ( Lang13.Bool( this.pizza ) ) {
					this.desc = new Txt().item( this.desc ).str( " It appears to have " ).a( this.pizza ).item().str( " inside." ).ToString();
				}

				if ( Lang13.Bool( this.bomb ) ) {
					this.desc = new Txt().item( this.desc ).str( " Wait, what?! It has " ).a( this.bomb ).item().str( " inside!" ).ToString();

					if ( Lang13.Bool( this.bomb_defused ) ) {
						this.desc = "" + this.desc + " The bomb seems inert.";
					}

					if ( Lang13.Bool( this.bomb_active ) ) {
						this.desc = "" + this.desc + " It looks like its about to go off!";
					}
				}
			} else {
				box = ( this.boxes.len != 0 ? this.boxes[this.boxes.len] : this );

				if ( this.boxes.len != 0 ) {
					this.desc = "A pile of boxes suited for pizzas. There appears to be " + ( this.boxes.len + 1 ) + " boxes in the pile.";
				}

				if ( box.boxtag != "" ) {
					this.desc = "" + this.desc + " The " + ( this.boxes.len != 0 ? "top box" : "box" ) + "'s tag reads: " + box.boxtag;
				}
			}
			this.overlays.Cut();

			if ( this.open ) {
				this.icon_state = "pizzabox_open";

				if ( Lang13.Bool( this.pizza ) ) {
					this.icon_state = "pizzabox_messy";
					pizzaimg = new Image( this.pizza.icon, null, this.pizza.icon_state );
					pizzaimg.pixel_y = -3;
					this.overlays.Add( pizzaimg );
				}

				if ( Lang13.Bool( this.bomb ) ) {
					this.bomb.icon_state = "pizzabomb_" + ( Lang13.Bool( this.bomb_active ) ? "active" : "inactive" );
					bombimg = new Image( this.bomb.icon, null, this.bomb.icon_state );
					bombimg.pixel_y = 5;
					this.overlays.Add( bombimg );
				}
			} else {
				this.icon_state = "pizzabox" + ( this.boxes.len + 1 );
				box2 = ( this.boxes.len != 0 ? this.boxes[this.boxes.len] : this );

				if ( box2.boxtag != "" ) {
					tagimg = new Image( this.icon, null, "pizzabox_tag" );
					tagimg.pixel_y = this.boxes.len * 3;
					this.overlays.Add( tagimg );
				}
			}
			return false;
		}

		// Function from file: pizzabox.dm
		public override dynamic Destroy(  ) {
			this.unprocess();
			return null;
		}

	}

}