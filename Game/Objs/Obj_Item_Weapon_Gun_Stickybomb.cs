// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_Gun_Stickybomb : Obj_Item_Weapon_Gun {

		public ByTable loaded = new ByTable();
		public ByTable fired = new ByTable();
		public int current_shells = 200;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.origin_tech = "materials=3;combat=4;programming=3";
			this.inhand_states = new ByTable().Set( "left_hand", "icons/mob/in-hand/left/guns_experimental.dmi" ).Set( "right_hand", "icons/mob/in-hand/right/guns_experimental.dmi" );
			this.recoil = 1;
			this.fire_sound = "sound/weapons/grenadelauncher.ogg";
			this.icon = "icons/obj/gun_experimental.dmi";
			this.icon_state = "stickybomb";
		}

		// Function from file: stickylauncher.dm
		public Obj_Item_Weapon_Gun_Stickybomb ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.loaded = new ByTable(new object [] { 
				new Obj_Item_Stickybomb( this ), 
				new Obj_Item_Stickybomb( this ), 
				new Obj_Item_Stickybomb( this ), 
				new Obj_Item_Stickybomb( this ), 
				new Obj_Item_Stickybomb( this ), 
				new Obj_Item_Stickybomb( this )
			 });
			return;
		}

		// Function from file: stickylauncher.dm
		public override bool process_chambered(  ) {
			dynamic B = null;
			dynamic SB = null;
			Obj_Item_Projectile_Stickybomb SB2 = null;

			
			if ( Lang13.Bool( this.in_chamber ) ) {
				return true;
			}

			if ( this.loaded.len != 0 ) {
				B = Rand13.PickFromTable( this.loaded );
				this.loaded.Remove( B );

				if ( this.fired.len >= 4 ) {
					SB = Rand13.PickFromTable( this.fired );
					Task13.Schedule( 0, (Task13.Closure)(() => {
						SB.detonate();
						return;
					}));

					if ( this.loc is Mob ) {
						GlobalFuncs.to_chat( this.loc, "<span class='warning'>One of the stickybombs detonates to leave room for the next one.</span>" );
					}
				}
				this.fired.Add( B );
				SB2 = new Obj_Item_Projectile_Stickybomb();
				SB2.sticky = B;
				B.fired_from = this;
				B.loc = SB2;
				this.in_chamber = SB2;
				return true;
			}
			return false;
		}

		// Function from file: stickylauncher.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			dynamic B = null;

			
			if ( a is Obj_Item_Stickybomb ) {
				B = a;

				if ( B.live ) {
					GlobalFuncs.to_chat( b, "<span class='warning'>You cannot load a live stickybomb!</span>" );
				} else if ( this.loaded.len >= 6 ) {
					GlobalFuncs.to_chat( b, "<span class='warning'>You cannot fit any more stickybombs in there!</span>" );
				} else if ( Lang13.Bool( b.drop_item( a, this ) ) ) {
					GlobalFuncs.to_chat( b, new Txt( "<span class='notice'>You load " ).the( a ).item().str( " into " ).the( this ).item().str( ".</span>" ).ToString() );
					this.loaded.Add( a );
				}
			} else {
				base.attackby( (object)(a), (object)(b), (object)(c) );
			}
			return null;
		}

		// Function from file: stickylauncher.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			Obj_Item_Stickybomb B = null;

			
			if ( this.fired.len != 0 ) {
				GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/weapons/stickybomb_det.ogg", 30, 1 );

				foreach (dynamic _a in Lang13.Enumerate( this.fired, typeof(Obj_Item_Stickybomb) )) {
					B = _a;
					
					Task13.Schedule( 0, (Task13.Closure)(() => {
						
						if ( B.live ) {
							B.detonate();
						}
						return;
					}));
				}
			}
			return null;
		}

		// Function from file: stickylauncher.dm
		public override bool? update_icon( dynamic location = null, dynamic target = null ) {
			return null;
		}

		// Function from file: stickylauncher.dm
		public override dynamic examine( dynamic user = null, string size = null ) {
			base.examine( (object)(user), size );
			GlobalFuncs.to_chat( user, new Txt( "<span class='info'>Has " ).item( this.loaded.len ).str( " stickybomb" ).s().str( " loaded, and " ).item( this.fired.len ).str( " stickybomb" ).s().str( " placed.</span>" ).ToString() );
			return null;
		}

		// Function from file: stickylauncher.dm
		public override dynamic Destroy( dynamic brokenup = null ) {
			Obj_Item_Stickybomb S = null;
			Obj_Item_Stickybomb B = null;

			
			foreach (dynamic _a in Lang13.Enumerate( this.loaded, typeof(Obj_Item_Stickybomb) )) {
				S = _a;
				
				GlobalFuncs.qdel( S );
			}
			this.loaded = null;

			foreach (dynamic _b in Lang13.Enumerate( this.fired, typeof(Obj_Item_Stickybomb) )) {
				B = _b;
				
				B.deactivate();
				B.unstick();
			}
			base.Destroy( (object)(brokenup) );
			return null;
		}

		// Function from file: stickylauncher.dm
		public override bool isHandgun(  ) {
			return false;
		}

	}

}