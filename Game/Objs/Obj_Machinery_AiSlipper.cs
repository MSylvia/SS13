// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_AiSlipper : Obj_Machinery {

		public int uses = 20;
		public bool disabled = true;
		public bool lethal = false;
		public bool locked = true;
		public int cooldown_time = 0;
		public double cooldown_timeleft = 0;
		public bool cooldown_on = false;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.anchored = 1;
			this.req_access = new ByTable(new object [] { 16 });
			this.icon = "icons/obj/device.dmi";
			this.icon_state = "motion3";
		}

		public Obj_Machinery_AiSlipper ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: ai_slipper.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hclient = null, HtmlInterface currui = null ) {
			
			if ( Lang13.Bool( base.Topic( href, href_list, (object)(hclient) ) ) ) {
				return 1;
			}

			if ( this.locked ) {
				
				if ( !( Task13.User is Mob_Living_Silicon ) ) {
					GlobalFuncs.to_chat( Task13.User, "<span class='warning'>Control panel is locked!</span>" );
					return null;
				}
			}

			if ( Lang13.Bool( href_list["toggleOn"] ) ) {
				this.disabled = !this.disabled;
				this.icon_state = ( this.disabled ? "motion0" : "motion3" );
			}

			if ( Lang13.Bool( href_list["toggleUse"] ) ) {
				
				if ( this.cooldown_on || this.disabled ) {
					return null;
				} else {
					new Obj_Effect_Effect_Foam( this.loc );
					this.uses--;
					this.cooldown_on = true;
					this.cooldown_time = Game13.timeofday + 100;
					this.slip_process();
					return null;
				}
			}
			this.attack_hand( Task13.User );
			return null;
		}

		// Function from file: ai_slipper.dm
		public override dynamic attack_ai( dynamic user = null ) {
			string t = null;

			this.add_hiddenprint( user );

			if ( ( this.stat & 3 ) != 0 ) {
				return null;
			}
			((Mob)user).set_machine( this );
			t = "<TT><B>Foam Dispenser</B> (" + this.areaMaster.name + ")<HR>";

			if ( this.locked && !( user is Mob_Living_Silicon ) ) {
				t += "<I>(Swipe ID card to unlock control panel.)</I><BR>";
			} else {
				t += new Txt( "Dispenser " ).item( ( this.disabled ? "unactive" : "active" ) ).str( " - <A href='?src=" ).Ref( this ).str( ";toggleOn=1'>" ).item( ( this.disabled ? "Enable" : "Disable" ) ).str( "?</a><br>\n" ).ToString();
				t += new Txt( "Uses Left: " ).item( this.uses ).str( ". <A href='?src=" ).Ref( this ).str( ";toggleUse=1'>Activate the dispenser?</A><br>\n" ).ToString();
			}
			Interface13.Browse( user, t, "window=computer;size=575x450" );
			GlobalFuncs.onclose( user, "computer" );
			return null;
		}

		// Function from file: ai_slipper.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			
			if ( ( this.stat & 3 ) != 0 ) {
				return null;
			}

			if ( b is Mob_Living_Silicon ) {
				this.add_hiddenprint( b );
				return this.attack_hand( b );
			} else if ( this.allowed( b ) ) {
				this.locked = !this.locked;
				GlobalFuncs.to_chat( b, "<span class='notice'>You " + ( this.locked ? "lock" : "unlock" ) + " the device.</span>" );

				if ( this.locked ) {
					
					if ( b.machine == this ) {
						((Mob)b).unset_machine();
						Interface13.Browse( b, null, "window=ai_slipper" );
					}
				} else if ( b.machine == this ) {
					this.attack_hand( Task13.User );
				}
			} else {
				GlobalFuncs.to_chat( b, "<span class='warning'>Access denied.</span>" );
				return null;
			}
			return null;
		}

		// Function from file: vgstation13.dme
		public void slip_process(  ) {
			int ticksleft = 0;

			
			while (this.cooldown_time - Game13.timeofday > 0) {
				ticksleft = this.cooldown_time - Game13.timeofday;

				if ( ticksleft > 100000 ) {
					this.cooldown_time = Game13.timeofday + 10;
				}
				this.cooldown_timeleft = ticksleft / 10;
				Task13.Sleep( 5 );
			}

			if ( this.uses <= 0 ) {
				return;
			}

			if ( this.uses >= 0 ) {
				this.cooldown_on = false;
			}
			this.power_change();
			return;
		}

		// Function from file: ai_slipper.dm
		public void setState( dynamic enabled = null, dynamic uses = null ) {
			this.disabled = this.disabled;
			this.uses = Convert.ToInt32( uses );
			this.power_change();
			return;
		}

		// Function from file: ai_slipper.dm
		public override dynamic power_change(  ) {
			
			if ( ( this.stat & 1 ) != 0 ) {
				return null;
			} else if ( Lang13.Bool( this.powered() ) ) {
				this.stat &= 65533;
			} else {
				this.icon_state = "motion0";
				this.stat |= 2;
			}
			return null;
		}

	}

}