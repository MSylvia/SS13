// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Device_NecromanticStone : Obj_Item_Device {

		public ByTable spooky_scaries = new ByTable();
		public bool unlimited = false;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.item_state = "electronic";
			this.origin_tech = "bluespace=4;materials=4";
			this.w_class = 1;
			this.icon = "icons/obj/wizard.dmi";
			this.icon_state = "necrostone";
		}

		public Obj_Item_Device_NecromanticStone ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: artefact.dm
		public void equip_roman_skeleton( dynamic H = null ) {
			Obj_Item I = null;
			dynamic hat = null;

			
			foreach (dynamic _a in Lang13.Enumerate( H, typeof(Obj_Item) )) {
				I = _a;
				
				((Mob)H).unEquip( I );
			}
			hat = Rand13.Pick(new object [] { typeof(Obj_Item_Clothing_Head_Helmet_Roman), typeof(Obj_Item_Clothing_Head_Helmet_Roman_Legionaire) });
			((Mob)H).equip_to_slot_or_del( Lang13.Call( hat, H ), 11 );
			((Mob)H).equip_to_slot_or_del( new Obj_Item_Clothing_Under_Roman( H ), 14 );
			((Mob)H).equip_to_slot_or_del( new Obj_Item_Clothing_Shoes_Roman( H ), 12 );
			((Mob)H).equip_to_slot_or_del( new Obj_Item_Weapon_Shield_Riot_Roman( H ), 4 );
			((Mob)H).equip_to_slot_or_del( new Obj_Item_Weapon_Claymore( H ), 5 );
			((Mob)H).equip_to_slot_or_del( new Obj_Item_Weapon_Twohanded_Spear( H ), 1 );
			return;
		}

		// Function from file: artefact.dm
		public void check_spooky(  ) {
			Mob_Living_Carbon_Human X = null;
			Mob_Living_Carbon_Human H = null;

			
			if ( this.unlimited ) {
				return;
			}

			foreach (dynamic _a in Lang13.Enumerate( this.spooky_scaries, typeof(Mob_Living_Carbon_Human) )) {
				X = _a;
				
				H = X;

				if ( H.stat == 2 ) {
					this.spooky_scaries.Remove( X );
					continue;
				}
			}
			GlobalFuncs.listclearnulls( this.spooky_scaries );
			return;
		}

		// Function from file: artefact.dm
		public override bool attack( dynamic M = null, dynamic user = null, bool? def_zone = null ) {
			
			if ( !( M is Mob_Living_Carbon_Human ) ) {
				return base.attack( (object)(M), (object)(user), def_zone );
			}

			if ( !( user is Mob_Living_Carbon_Human ) || !((Mob)user).canUseTopic( M, true ) ) {
				return false;
			}

			if ( Convert.ToInt32( M.stat ) != 2 ) {
				user.WriteMsg( "<span class='warning'>This artifact can only affect the dead!</span>" );
				return false;
			}

			if ( !Lang13.Bool( M.mind ) || !Lang13.Bool( M.client ) ) {
				user.WriteMsg( "<span class='warning'>There is no soul connected to this body...</span>" );
				return false;
			}
			this.check_spooky();

			if ( this.spooky_scaries.len >= 3 && !this.unlimited ) {
				user.WriteMsg( "<span class='warning'>This artifact can only affect three undead at a time!</span>" );
				return false;
			}
			((Mob)M).set_species( typeof(Species_Skeleton), false );
			M.revive();
			this.spooky_scaries.Or( M );
			M.WriteMsg( "<span class='userdanger'>You have been revived by </span><B>" + user.real_name + "!</B>" );
			M.WriteMsg( "<span class='userdanger'>They are your master now, assist them even if it costs you your new life!</span>" );
			this.equip_roman_skeleton( M );
			this.desc = "A shard capable of resurrecting humans as skeleton thralls" + ( this.unlimited ? "." : ", " + this.spooky_scaries.len + "/3 active thralls." );
			return false;
		}

	}

}