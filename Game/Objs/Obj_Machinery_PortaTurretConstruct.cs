// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_PortaTurretConstruct : Obj_Machinery {

		public int build_step = 0;
		public dynamic finish_name = "turret";
		public Type installation = null;
		public bool gun_charge = false;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.icon = "icons/obj/turrets.dmi";
			this.icon_state = "turret_frame";
		}

		public Obj_Machinery_PortaTurretConstruct ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: portable_turret.dm
		public override dynamic attack_hand( dynamic a = null, dynamic b = null, dynamic c = null ) {
			dynamic Gun = null;

			
			switch ((int)( this.build_step )) {
				case 4:
					
					if ( !( this.installation != null ) ) {
						return null;
					}
					this.build_step = 3;
					Gun = Lang13.Call( this.installation, this.loc );
					Gun.power_supply.charge = this.gun_charge;
					Gun.update_icon();
					this.installation = null;
					this.gun_charge = false;
					GlobalFuncs.to_chat( a, new Txt( "You remove " ).the( Gun ).item().str( " from the turret frame." ).ToString() );
					break;
				case 5:
					GlobalFuncs.to_chat( a, "You remove the prox sensor from the turret frame." );
					new Obj_Item_Device_Assembly_ProxSensor( Map13.GetTile( this.x, this.y, this.z ) );
					this.build_step = 4;
					break;
			}
			return null;
		}

		// Function from file: portable_turret.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			Game_Data M = null;
			dynamic WT = null;
			Game_Data M2 = null;
			dynamic E = null;
			dynamic WT2 = null;
			Obj_Machinery_PortaTurret Turret = null;
			Game_Data M3 = null;
			dynamic t = null;

			
			switch ((int)( this.build_step )) {
				case 0:
					
					if ( a is Obj_Item_Weapon_Wrench && !Lang13.Bool( this.anchored ) ) {
						GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/items/Ratchet.ogg", 100, 1 );
						GlobalFuncs.to_chat( b, "<span class='notice'>You secure the external bolts.</span>" );
						this.anchored = 1;
						this.build_step = 1;
						return null;
					} else if ( a is Obj_Item_Weapon_Crowbar && !Lang13.Bool( this.anchored ) ) {
						GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/items/Crowbar.ogg", 75, 1 );
						GlobalFuncs.to_chat( b, "You dismantle the turret construction." );
						M = GlobalFuncs.getFromPool( typeof(Obj_Item_Stack_Sheet_Metal), this.loc );
						((dynamic)M).amount = 5;
						GlobalFuncs.qdel( this );
						return null;
					}
					break;
				case 1:
					
					if ( a is Obj_Item_Stack_Sheet_Metal ) {
						
						if ( Convert.ToDouble( a.amount ) >= 2 ) {
							GlobalFuncs.to_chat( b, "<span class='notice'>You add some metal armor to the interior frame.</span>" );
							this.build_step = 2;
							a.amount -= 2;
							this.icon_state = "turret_frame2";

							if ( Convert.ToDouble( a.amount ) <= 0 ) {
								GlobalFuncs.returnToPool( a );
							}
							return null;
						}
					} else if ( a is Obj_Item_Weapon_Wrench ) {
						GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/items/Ratchet.ogg", 75, 1 );
						GlobalFuncs.to_chat( b, "You unfasten the external bolts." );
						this.anchored = 0;
						this.build_step = 0;
						return null;
					}
					break;
				case 2:
					
					if ( a is Obj_Item_Weapon_Wrench ) {
						GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/items/Ratchet.ogg", 100, 1 );
						GlobalFuncs.to_chat( b, "<span class='notice'>You bolt the metal armor into place.</span>" );
						this.build_step = 3;
						return null;
					} else if ( a is Obj_Item_Weapon_Weldingtool ) {
						WT = a;

						if ( !((Obj_Item_Weapon_Weldingtool)WT).isOn() ) {
							return null;
						}

						if ( ( ((Obj_Item_Weapon_Weldingtool)WT).get_fuel() ?1:0) < 5 ) {
							GlobalFuncs.to_chat( b, "<span class='warning'>You need more fuel to complete this task.</span>" );
							return null;
						}
						GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), Rand13.Pick(new object [] { "sound/items/welder.ogg", "sound/items/welder2.ogg" }), 50, 1 );

						if ( GlobalFuncs.do_after( b, this, 20 ) ) {
							
							if ( !( this != null ) || !Lang13.Bool( WT.remove_fuel( 5, b ) ) ) {
								return null;
							}
							this.build_step = 1;
							GlobalFuncs.to_chat( b, "You remove the turret's interior metal armor." );
							M2 = GlobalFuncs.getFromPool( typeof(Obj_Item_Stack_Sheet_Metal), this.loc );
							((dynamic)M2).amount = 2;
							return null;
						}
					}
					break;
				case 3:
					
					if ( a is Obj_Item_Weapon_Gun_Energy ) {
						GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/items/Deconstruct.ogg", 100, 1 );
						E = a;
						this.installation = a.type;
						this.gun_charge = Lang13.Bool( E.power_supply.charge );
						GlobalFuncs.to_chat( b, new Txt( "<span class='notice'>You add " ).the( a ).item().str( " to the turret.</span>" ).ToString() );
						this.build_step = 4;
						GlobalFuncs.qdel( a );
						return null;
					} else if ( a is Obj_Item_Weapon_Wrench ) {
						GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/items/Ratchet.ogg", 100, 1 );
						GlobalFuncs.to_chat( b, "You remove the turret's metal armor bolts." );
						this.build_step = 2;
						return null;
					}
					break;
				case 4:
					
					if ( GlobalFuncs.isprox( a ) ) {
						GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/items/Deconstruct.ogg", 100, 1 );
						this.build_step = 5;
						GlobalFuncs.to_chat( b, "<span class='notice'>You add the prox sensor to the turret.</span>" );
						GlobalFuncs.qdel( a );
						return null;
					}
					break;
				case 5:
					
					if ( a is Obj_Item_Weapon_Screwdriver ) {
						GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/items/Screwdriver.ogg", 100, 1 );
						this.build_step = 6;
						GlobalFuncs.to_chat( b, "<span class='notice'>You close the internal access hatch.</span>" );
						return null;
					}
					break;
				case 6:
					
					if ( a is Obj_Item_Stack_Sheet_Metal ) {
						
						if ( Convert.ToDouble( a.amount ) >= 2 ) {
							GlobalFuncs.to_chat( b, "<span class='notice'>You add some metal armor to the exterior frame.</span>" );
							this.build_step = 7;
							a.amount -= 2;

							if ( Convert.ToDouble( a.amount ) <= 0 ) {
								GlobalFuncs.qdel( a );
							}
							return null;
						}
					} else if ( a is Obj_Item_Weapon_Screwdriver ) {
						GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/items/Screwdriver.ogg", 100, 1 );
						this.build_step = 5;
						GlobalFuncs.to_chat( b, "You open the internal access hatch." );
						return null;
					}
					break;
				case 7:
					
					if ( a is Obj_Item_Weapon_Weldingtool ) {
						WT2 = a;

						if ( !((Obj_Item_Weapon_Weldingtool)WT2).isOn() ) {
							return null;
						}

						if ( ( ((Obj_Item_Weapon_Weldingtool)WT2).get_fuel() ?1:0) < 5 ) {
							GlobalFuncs.to_chat( b, "<span class='warning'>You need more fuel to complete this task.</span>" );
						}
						GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), Rand13.Pick(new object [] { "sound/items/welder.ogg", "sound/items/welder2.ogg" }), 50, 1 );

						if ( GlobalFuncs.do_after( b, this, 30 ) ) {
							
							if ( !( this != null ) || !Lang13.Bool( WT2.remove_fuel( 5, b ) ) ) {
								return null;
							}
							this.build_step = 8;
							GlobalFuncs.to_chat( b, "<span class='notice'>You weld the turret's armor down.</span>" );
							Turret = new Obj_Machinery_PortaTurret( Map13.GetTile( this.x, this.y, this.z ) );
							Turret.name = this.finish_name;
							Turret.installation = this.installation;
							Turret.gun_charge = this.gun_charge;
							Turret.update_gun();
							GlobalFuncs.qdel( this );
						}
					} else if ( a is Obj_Item_Weapon_Crowbar ) {
						GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/items/Crowbar.ogg", 75, 1 );
						GlobalFuncs.to_chat( b, "You pry off the turret's exterior armor." );
						M3 = GlobalFuncs.getFromPool( typeof(Obj_Item_Stack_Sheet_Metal), this.loc );
						((dynamic)M3).amount = 2;
						this.build_step = 6;
						return null;
					}
					break;
			}

			if ( a is Obj_Item_Weapon_Pen ) {
				t = Interface13.Input( b, "Enter new turret name", this.name, this.finish_name, null, InputType.Str );
				t = String13.SubStr( GlobalFuncs.sanitize( t ), 1, 1024 );

				if ( !Lang13.Bool( t ) ) {
					return null;
				}

				if ( !GlobalFuncs.in_range( this, Task13.User ) && this.loc != Task13.User ) {
					return null;
				}
				this.finish_name = t;
				return null;
			}
			base.attackby( (object)(a), (object)(b), (object)(c) );
			return null;
		}

	}

}