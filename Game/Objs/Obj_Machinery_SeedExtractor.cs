// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_SeedExtractor : Obj_Machinery {

		public ByTable piles = new ByTable();
		public dynamic max_seeds = 1000;
		public dynamic seed_multiplier = 1;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.anchored = 1;
			this.icon = "icons/obj/hydroponics/equipment.dmi";
			this.icon_state = "sextractor";
		}

		// Function from file: seed_extractor.dm
		public Obj_Machinery_SeedExtractor ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.component_parts = new ByTable();
			this.component_parts.Add( new Obj_Item_Weapon_Circuitboard_SeedExtractor( null ) );
			this.component_parts.Add( new Obj_Item_Weapon_StockParts_MatterBin( null ) );
			this.component_parts.Add( new Obj_Item_Weapon_StockParts_Manipulator( null ) );
			this.RefreshParts();
			return;
		}

		// Function from file: seed_extractor.dm
		public bool add( dynamic O = null ) {
			Ent_Static M = null;
			Ent_Static S = null;
			SeedPile N = null;

			
			if ( this.contents.len >= 999 ) {
				Task13.User.WriteMsg( new Txt( "<span class='notice'>" ).The( this ).item().str( " is full.</span>" ).ToString() );
				return false;
			}

			if ( O.loc is Mob ) {
				M = O.loc;

				if ( !((Mob)M).unEquip( O ) ) {
					Task13.User.WriteMsg( new Txt( "<span class='warning'>" ).the( O ).item().str( " is stuck to your hand, you cannot put it in " ).the( this ).item().str( "!</span>" ).ToString() );
					return false;
				}
			} else if ( O.loc is Obj_Item_Weapon_Storage ) {
				S = O.loc;
				((dynamic)S).remove_from_storage( O, this );
			}
			O.loc = this;

			foreach (dynamic _a in Lang13.Enumerate( this.piles, typeof(SeedPile) )) {
				N = _a;
				

				if ( O.plantname == N.name && Lang13.Bool( O.lifespan ) == N.lifespan && Lang13.Bool( O.endurance ) == N.endurance && Lang13.Bool( O.maturation ) == N.maturation && Lang13.Bool( O.production ) == N.production && Lang13.Bool( O.yield ) == N.yield && Lang13.Bool( O.potency ) == N.potency ) {
					N.amount++;
					return false;
				}
			}
			this.piles.Add( new SeedPile( O.plantname, O.lifespan, O.endurance, O.maturation, O.production, O.yield, O.potency ) );
			return false;
		}

		// Function from file: seed_extractor.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hsrc = null ) {
			SeedPile N = null;
			Obj T = null;
			Obj O = null;

			
			if ( Lang13.Bool( base.Topic( href, href_list, (object)(hsrc) ) ) ) {
				return null;
			}
			Task13.User.set_machine( this );
			href_list["li"] = String13.ParseNumber( href_list["li"] );
			href_list["en"] = String13.ParseNumber( href_list["en"] );
			href_list["ma"] = String13.ParseNumber( href_list["ma"] );
			href_list["pr"] = String13.ParseNumber( href_list["pr"] );
			href_list["yi"] = String13.ParseNumber( href_list["yi"] );
			href_list["pot"] = String13.ParseNumber( href_list["pot"] );

			foreach (dynamic _a in Lang13.Enumerate( this.piles, typeof(SeedPile) )) {
				N = _a;
				

				if ( href_list["name"] == N.name && Lang13.Bool( href_list["li"] ) == N.lifespan && Lang13.Bool( href_list["en"] ) == N.endurance && Lang13.Bool( href_list["ma"] ) == N.maturation && Lang13.Bool( href_list["pr"] ) == N.production && Lang13.Bool( href_list["yi"] ) == N.yield && Lang13.Bool( href_list["pot"] ) == N.potency ) {
					
					if ( ( N.amount ??0) <= 0 ) {
						return null;
					}
					N.amount = Num13.MaxInt( ( N.amount ??0) - 1, 0 );

					if ( ( N.amount ??0) <= 0 ) {
						this.piles.Remove( N );
						GlobalFuncs.qdel( N );
					}
					break;
				}
			}

			foreach (dynamic _b in Lang13.Enumerate( this.contents, typeof(Obj) )) {
				T = _b;
				
				O = T;

				if ( ((dynamic)O).plantname == href_list["name"] && ((dynamic)O).lifespan == href_list["li"] && ((dynamic)O).endurance == href_list["en"] && ((dynamic)O).maturation == href_list["ma"] && ((dynamic)O).production == href_list["pr"] && ((dynamic)O).yield == href_list["yi"] && ((dynamic)O).potency == href_list["pot"] ) {
					O.loc = this.loc;
					break;
				}
			}
			this.updateUsrDialog();
			return null;
		}

		// Function from file: seed_extractor.dm
		public override dynamic interact( dynamic user = null, bool? flag1 = null ) {
			string dat = null;
			SeedPile O = null;
			Browser popup = null;

			
			if ( this.stat != 0 ) {
				return 0;
			}
			dat = "<b>Stored seeds:</b><br>";

			if ( this.contents.len == 0 ) {
				dat += "<font color='red'>No seeds</font>";
			} else {
				dat += "<table cellpadding='3' style='text-align:center;'><tr><td>Name</td><td>Lifespan</td><td>Endurance</td><td>Maturation</td><td>Production</td><td>Yield</td><td>Potency</td><td>Stock</td></tr>";

				foreach (dynamic _a in Lang13.Enumerate( this.piles, typeof(SeedPile) )) {
					O = _a;
					
					dat += "<tr><td>" + O.name + "</td><td>" + O.lifespan + "</td><td>" + O.endurance + "</td><td>" + O.maturation + "</td>";
					dat += "<td>" + O.production + "</td><td>" + O.yield + "</td><td>" + O.potency + "</td><td>";
					dat += new Txt( "<a href='byond://?src=" ).Ref( this ).str( ";name=" ).item( O.name ).str( ";li=" ).item( O.lifespan ).str( ";en=" ).item( O.endurance ).str( ";ma=" ).item( O.maturation ).str( ";pr=" ).item( O.production ).str( ";yi=" ).item( O.yield ).str( ";pot=" ).item( O.potency ).str( "'>Vend</a> (" ).item( O.amount ).str( " left)</td></tr>" ).ToString();
				}
				dat += "</table>";
			}
			popup = new Browser( user, "seed_ext", this.name, 700, 400 );
			popup.set_content( dat );
			popup.open();
			return null;
		}

		// Function from file: seed_extractor.dm
		public override dynamic attack_hand( dynamic a = null, bool? b = null, bool? c = null ) {
			((Mob)a).set_machine( this );
			this.interact( a );
			return null;
		}

		// Function from file: seed_extractor.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			dynamic P = null;
			int loaded = 0;
			Obj_Item_Seeds G = null;

			
			if ( this.default_deconstruction_screwdriver( user, "sextractor_open", "sextractor", A ) ) {
				return null;
			}

			if ( this.exchange_parts( user, A ) ) {
				return null;
			}

			if ( this.default_pry_open( A ) ) {
				return null;
			}

			if ( this.default_unfasten_wrench( user, A ) ) {
				return null;
			}
			this.default_deconstruction_crowbar( A );

			if ( user is Mob_Living_Silicon_Robot ) {
				return null;
			}

			if ( A is Obj_Item_Weapon_Storage_Bag_Plants ) {
				P = A;
				loaded = 0;

				foreach (dynamic _a in Lang13.Enumerate( P.contents, typeof(Obj_Item_Seeds) )) {
					G = _a;
					

					if ( this.contents.len >= Convert.ToDouble( this.max_seeds ) ) {
						break;
					}
					loaded++;
					this.add( G );
				}

				if ( loaded != 0 ) {
					user.WriteMsg( new Txt( "<span class='notice'>You put the seeds from " ).the( A.name ).item().str( " into " ).item( this ).str( ".</span>" ).ToString() );
				} else {
					user.WriteMsg( new Txt( "<span class='notice'>There are no seeds in " ).the( A.name ).item().str( ".</span>" ).ToString() );
				}
				return null;
			}

			if ( !Lang13.Bool( user.drop_item() ) ) {
				user.WriteMsg( new Txt( "<span class='warning'>" ).The( A ).item().str( " is stuck to your hand, you cannot put it in the seed extractor!</span>" ).ToString() );
				return null;
			}

			if ( Lang13.Bool( A ) && A.loc != null ) {
				A.loc = this.loc;
			}

			if ( GlobalFuncs.seedify( A, -1 ) ) {
				user.WriteMsg( "<span class='notice'>You extract some seeds.</span>" );
				return null;
			} else if ( A is Obj_Item_Seeds ) {
				this.add( A );
				user.WriteMsg( "<span class='notice'>You add " + A + " to " + this.name + ".</span>" );
				this.updateUsrDialog();
				return null;
			} else {
				user.WriteMsg( new Txt( "<span class='warning'>You can't extract any seeds from " ).the( A.name ).item().str( "!</span>" ).ToString() );
			}
			return null;
		}

		// Function from file: seed_extractor.dm
		public override void RefreshParts(  ) {
			Obj_Item_Weapon_StockParts_MatterBin B = null;
			Obj_Item_Weapon_StockParts_Manipulator M = null;

			
			foreach (dynamic _a in Lang13.Enumerate( this.component_parts, typeof(Obj_Item_Weapon_StockParts_MatterBin) )) {
				B = _a;
				
				this.max_seeds = B.rating * 1000;
			}

			foreach (dynamic _b in Lang13.Enumerate( this.component_parts, typeof(Obj_Item_Weapon_StockParts_Manipulator) )) {
				M = _b;
				
				this.seed_multiplier = M.rating;
			}
			return;
		}

	}

}