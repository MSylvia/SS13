// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_Hallucination_Whispers : Obj_Effect_Hallucination {

		// Function from file: Hallucination.dm
		public Obj_Effect_Hallucination_Whispers ( dynamic loc = null, Mob_Living_Carbon T = null ) : base( (object)(loc) ) {
			ByTable speak_messages = null;
			ByTable radio_messages = null;
			ByTable people = null;
			dynamic person = null;
			Mob_Living_Carbon H = null;
			ByTable humans = null;
			Mob_Living_Carbon_Human H2 = null;

			this.target = T;
			speak_messages = new ByTable(new object [] { 
				"I'm watching you...", 
				"" + this.target.name + "!", 
				"Go away!", 
				"Kchck-Chkck? Kchchck!", 
				"Did you hear that?", 
				"What did you do ?", 
				"Why?", 
				"Give me that!", 
				"Honk!", 
				"HELP!!"
			 });
			radio_messages = new ByTable(new object [] { 
				"Xenos!", 
				"Singularity loose!", 
				"They are arming the nuke!", 
				"They butchered Ian!", 
				"H-help!", 
				"" + Rand13.PickFromTable( GlobalVars.teleportlocs ) + "!!", 
				"Where's " + this.target.name + "?", 
				"Call the shuttle!"
			 });
			people = new ByTable();
			person = null;

			foreach (dynamic _a in Lang13.Enumerate( Map13.FetchInView( null, this.target ), typeof(Mob_Living_Carbon) )) {
				H = _a;
				

				if ( H == this.target ) {
					continue;
				}

				if ( !Lang13.Bool( person ) ) {
					person = H;
				} else if ( Map13.GetDistance( this.target, H ) < Map13.GetDistance( this.target, person ) ) {
					person = H;
				}
				people.Add( H );
			}

			if ( Lang13.Bool( person ) ) {
				((dynamic)this.target).WriteMsg( ((dynamic)this.target).compose_message( person, person.languages, Rand13.PickFromTable( speak_messages ), null, person.get_spans() ) );
			} else {
				humans = new ByTable();

				foreach (dynamic _b in Lang13.Enumerate( GlobalVars.living_mob_list, typeof(Mob_Living_Carbon_Human) )) {
					H2 = _b;
					
					humans.Add( H2 );
				}
				person = Rand13.PickFromTable( humans );
				((dynamic)this.target).WriteMsg( ((dynamic)this.target).compose_message( person, person.languages, Rand13.PickFromTable( radio_messages ), "1459", person.get_spans() ) );
			}
			GlobalFuncs.qdel( this );
			return;
		}

	}

}