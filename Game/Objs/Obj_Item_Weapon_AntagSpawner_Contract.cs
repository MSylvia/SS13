// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_AntagSpawner_Contract : Obj_Item_Weapon_AntagSpawner {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.icon = "icons/obj/wizard.dmi";
			this.icon_state = "scroll2";
		}

		public Obj_Item_Weapon_AntagSpawner_Contract ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: antag_spawner.dm
		public override void equip_antag( Mob_Living_Carbon_Human target = null ) {
			target.equip_to_slot_or_del( new Obj_Item_Device_Radio_Headset(  ), 8 );
			target.equip_to_slot_or_del( new Obj_Item_Clothing_Under_Lightpurple( target ), 14 );
			target.equip_to_slot_or_del( new Obj_Item_Clothing_Shoes_Sandal( target ), 12 );
			target.equip_to_slot_or_del( new Obj_Item_Clothing_Suit_Wizrobe( target ), 13 );
			target.equip_to_slot_or_del( new Obj_Item_Clothing_Head_Wizard( target ), 11 );
			target.equip_to_slot_or_del( new Obj_Item_Weapon_Storage_Backpack( target ), 1 );
			target.equip_to_slot_or_del( new Obj_Item_Weapon_Storage_Box( target ), 18 );
			target.equip_to_slot_or_del( new Obj_Item_Weapon_TeleportationScroll_Apprentice( target ), 16 );
			return;
		}

		// Function from file: antag_spawner.dm
		public override void spawn_antag( dynamic C = null, dynamic T = null, string type = null ) {
			type = type ?? "";

			Mob_Living_Carbon_Human M = null;
			dynamic wizard_name_first = null;
			dynamic wizard_name_second = null;
			string randomname = null;
			string newname = null;
			Objective_Protect new_objective = null;

			new Effect_Effect_System_SmokeSpread( /* Pruned args, no ctor exists. */ );
			M = new Mob_Living_Carbon_Human( T );
			M.key = C.key;
			GlobalFuncs.to_chat( M, "<B>You are the " + Task13.User.real_name + "'s apprentice! You are bound by magic contract to follow their orders and help them in accomplishing their goals." );

			switch ((string)( type )) {
				case "destruction":
					M.add_spell( new Spell_Targeted_Projectile_MagicMissile() );
					M.add_spell( new Spell_Targeted_Projectile_Dumbfire_Fireball() );
					GlobalFuncs.to_chat( M, "<B>Your service has not gone unrewarded, however. Studying under " + Task13.User.real_name + ", you have learned powerful, destructive spells. You are able to cast magic missile and fireball." );
					break;
				case "bluespace":
					M.add_spell( new Spell_AreaTeleport() );
					M.add_spell( new Spell_Targeted_EtherealJaunt() );
					GlobalFuncs.to_chat( M, "<B>Your service has not gone unrewarded, however. Studying under " + Task13.User.real_name + ", you have learned reality bending mobility spells. You are able to cast teleport and ethereal jaunt." );
					break;
				case "robeless":
					M.add_spell( new Spell_AoeTurf_Knock() );
					M.add_spell( new Spell_Targeted_MindTransfer() );
					GlobalFuncs.to_chat( M, "<B>Your service has not gone unrewarded, however. Studying under " + Task13.User.real_name + ", you have learned stealthy, robeless spells. You are able to cast knock and mindswap." );
					break;
				case "clown":
					M.add_spell( new Spell_Targeted_EquipItem_Clowncurse() );
					M.add_spell( new Spell_Targeted_Shoesnatch() );
					GlobalFuncs.to_chat( M, "<B>Your service has not gone unrewarded, however. Studying under " + Task13.User.real_name + ", you have learned the venerable and ancient art of Clown Magic. You are able to cast the clown curse and shoe snatch." );
					break;
				case "misdirection":
					M.add_spell( new Spell_Targeted_Subjugation() );
					M.add_spell( new Spell_Targeted_Genetic_Blind() );
					GlobalFuncs.to_chat( M, "<B>Your service has not gone unrewarded, however. Studying under " + Task13.User.real_name + ", you have learned spells for misdirection and trickery. You are able to cast subjugate and blind." );
					break;
				case "muscle":
					M.add_spell( new Spell_Targeted_Genetic_Mutate() );
					M.add_spell( new Spell_AoeTurf_Blink() );
					GlobalFuncs.to_chat( M, "<B>Your service has not gone unrewarded, however. Studying under " + Task13.User.real_name + ", you have gained great strength and a natty physique. You are able to cast mutate and blink." );
					break;
				case "technology":
					M.add_spell( new Spell_AoeTurf_DisableTech() );
					M.add_spell( new Spell_Lightning() );
					GlobalFuncs.to_chat( M, "<B>Your service has not gone unrewarded, however. Studying under " + Task13.User.real_name + ", you have futuristic, technological spells. You are able to cast disable tech and lightning." );
					break;
			}
			this.equip_antag( M );
			wizard_name_first = Rand13.PickFromTable( GlobalVars.wizard_first );
			wizard_name_second = Rand13.PickFromTable( GlobalVars.wizard_second );
			randomname = "" + wizard_name_first + " " + wizard_name_second;
			newname = String13.SubStr( GlobalFuncs.sanitize( Interface13.Input( M, "You are the wizard's apprentice. Would you like to change your name to something else?", "Name change", randomname, null, InputType.Str | InputType.Null ) ), 1, 26 );

			if ( !Lang13.Bool( newname ) ) {
				newname = randomname;
			}
			M.mind.name = newname;
			M.real_name = newname;
			M.name = newname;
			new_objective = new Objective_Protect();
			new_objective.owner = M.mind;
			new_objective.target = Task13.User.mind;
			new_objective.explanation_text = "Protect " + Task13.User.real_name + ", the wizard.";
			M.mind.objectives.Add( new_objective );
			GlobalVars.ticker.mode.traitors.Add( M.mind );
			M.mind.special_role = "apprentice";
			return;
		}

		// Function from file: antag_spawner.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hclient = null, HtmlInterface currui = null ) {
			Mob H = null;
			ByTable candidates = null;
			dynamic C = null;

			base.Topic( href, href_list, (object)(hclient) );
			H = Task13.User;

			if ( H.isUnconscious() || H.restrained() ) {
				return null;
			}

			if ( !( H is Mob_Living_Carbon_Human ) ) {
				return 1;
			}

			if ( this.loc == H || GlobalFuncs.in_range( this, H ) && this.loc is Tile ) {
				H.set_machine( this );

				if ( Lang13.Bool( href_list["school"] ) ) {
					
					if ( this.used ) {
						GlobalFuncs.to_chat( H, "You already used this contract!" );
						return null;
					}
					candidates = GlobalFuncs.get_candidates( "wizard" );

					if ( candidates.len != 0 ) {
						this.used = true;
						C = Rand13.PickFromTable( candidates );
						this.spawn_antag( C, GlobalFuncs.get_turf( H.loc ), href_list["school"] );
					} else {
						GlobalFuncs.to_chat( H, "Unable to reach your apprentice! You can either attack the spellbook with the contract to refund your points, or wait and try again later." );
					}
				}
			}
			return null;
		}

		// Function from file: antag_spawner.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			string dat = null;

			((Mob)user).set_machine( this );

			if ( this.used ) {
				dat = "<B>You have already summoned your apprentice.</B><BR>";
			} else {
				dat = "<B>Contract of Apprenticeship:</B><BR>";
				dat += "<I>Using this contract, you may summon an apprentice to aid you on your mission.</I><BR>";
				dat += "<I>If you are unable to establish contact with your apprentice, you can feed the contract back to the spellbook to refund your points.</I><BR>";
				dat += "<B>Which school of magic is your apprentice studying?:</B><BR>";
				dat += new Txt( "<A href='byond://?src=" ).Ref( this ).str( ";school=destruction'>Destruction</A><BR>" ).ToString();
				dat += "<I>Your apprentice is skilled in offensive magic. They know Magic Missile and Fireball.</I><BR>";
				dat += new Txt( "<A href='byond://?src=" ).Ref( this ).str( ";school=bluespace'>Bluespace Manipulation</A><BR>" ).ToString();
				dat += "<I>Your apprentice is able to defy physics, melting through solid objects and travelling great distances in the blink of an eye. They know Teleport and Ethereal Jaunt.</I><BR>";
				dat += new Txt( "<A href='byond://?src=" ).Ref( this ).str( ";school=clown'>Clowning</A><BR>" ).ToString();
				dat += "<I>Your apprentice is skilled in the ancient art of Clown Magic. They know The Clown Curse and Shoe Snatch</I><BR>";
				dat += new Txt( "<A href='byond://?src=" ).Ref( this ).str( ";school=misdirection'>Misdirection</A><BR>" ).ToString();
				dat += "<I>Your apprentice is skilled in misdirection and trickery. They know Subjugate and Blind</I><BR>";
				dat += new Txt( "<A href='byond://?src=" ).Ref( this ).str( ";school=muscle'>Muscle Magic</A><BR>" ).ToString();
				dat += "<I>Your apprentice is skilled in muscle based wizardry. They know Mutate and Blink</I><BR>";
				dat += new Txt( "<A href='byond://?src=" ).Ref( this ).str( ";school=technology'>Technology</A><BR>" ).ToString();
				dat += "<I>Your apprentice is skilled in technology and future magic. They know Disable Tech and Lightning</I><BR>";
				dat += "<I>The school of healing has been closed for renovations, so you cannot find an apprentice specializing in this school. (Bug #99 on Redmine for more info)</I><BR>";
				dat += new Txt( "<A href='byond://?src=" ).Ref( this ).str( ";school=robeless'>Robeless</A><BR>" ).ToString();
				dat += "<I>Your apprentice is training to cast spells without their robes. They know Knock and Mindswap.</I><BR>";
			}
			Interface13.Browse( user, dat, "window=radio" );
			GlobalFuncs.onclose( user, "radio" );
			return null;
		}

	}

}