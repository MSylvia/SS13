// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_RND_DestructiveAnalyzer : Obj_Machinery_RND {

		public dynamic loaded_item = null;
		public double decon_mod = 1;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.research_flags = 1;
			this.icon_state = "d_analyzer";
		}

		// Function from file: destructive_analyzer.dm
		public Obj_Machinery_RND_DestructiveAnalyzer ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.component_parts = new ByTable(new object [] { 
				new Obj_Item_Weapon_Circuitboard_DestructiveAnalyzer(), 
				new Obj_Item_Weapon_StockParts_ScanningModule(), 
				new Obj_Item_Weapon_StockParts_Manipulator(), 
				new Obj_Item_Weapon_StockParts_MicroLaser()
			 });
			this.RefreshParts();
			return;
		}

		// Function from file: destructive_analyzer.dm
		public override dynamic attack_ghost( Mob_Dead_Observer user = null ) {
			return null;
		}

		// Function from file: destructive_analyzer.dm
		public override dynamic attack_hand( dynamic a = null, dynamic b = null, dynamic c = null ) {
			
			if ( Lang13.Bool( base.attack_hand( (object)(a), (object)(b), (object)(c) ) ) ) {
				return null;
			}

			if ( Lang13.Bool( this.loaded_item ) && !this.panel_open && !this.busy ) {
				GlobalFuncs.to_chat( a, "<span class='notice'>You remove the " + this.loaded_item.name + " from the " + this + ".</span>" );
				this.loaded_item.loc = this.loc;
				this.loaded_item = null;
				this.icon_state = "d_analyzer";
			}
			return null;
		}

		// Function from file: destructive_analyzer.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			dynamic mommi = null;
			ByTable temp_tech = null;

			
			if ( Lang13.Bool( base.attackby( (object)(a), (object)(b), (object)(c) ) ) ) {
				return 1;
			}

			if ( a is Obj_Item && !Lang13.Bool( this.loaded_item ) && !this.panel_open ) {
				
				if ( b is Mob_Living_Silicon_Robot ) {
					
					if ( b is Mob_Living_Silicon_Robot_Mommi ) {
						mommi = b;

						if ( Lang13.Bool( ((Mob_Living_Silicon_Robot_Mommi)mommi).is_in_modules( a, true ) ) ) {
							GlobalFuncs.to_chat( b, "<span class='warning'>You cannot insert something that is part of you.</span>" );
							return null;
						}
					} else {
						return null;
					}
				}

				if ( !Lang13.Bool( a.origin_tech ) ) {
					GlobalFuncs.to_chat( b, "<span class='warning'>This doesn't seem to have a tech origin!</span>" );
					return null;
				}
				temp_tech = this.ConvertReqString2List( a.origin_tech );

				if ( temp_tech.len == 0 ) {
					GlobalFuncs.to_chat( b, "<span class='warning'>You cannot deconstruct this item!</span>" );
					return null;
				}

				if ( Lang13.Bool( b.drop_item( a, this ) ) ) {
					this.busy = true;
					this.loaded_item = a;
					GlobalFuncs.to_chat( b, "<span class='notice'>You add the " + a.name + " to the machine!</span>" );
					Icon13.Flick( "d_analyzer_la", this );
					Task13.Schedule( 10, (Task13.Closure)(() => {
						this.icon_state = "d_analyzer_l";
						this.busy = false;
						return;
					}));
				}
			}
			return null;
		}

		// Function from file: destructive_analyzer.dm
		public override int crowbarDestroy( dynamic user = null ) {
			
			if ( base.crowbarDestroy( (object)(user) ) == 1 ) {
				
				if ( Lang13.Bool( this.loaded_item ) ) {
					((Ent_Dynamic)this.loaded_item).forceMove( this.loc );
				}
				return 1;
			}
			return -1;
		}

		// Function from file: destructive_analyzer.dm
		public override int togglePanelOpen( dynamic toggleitem = null, dynamic user = null, dynamic CC = null ) {
			
			if ( Lang13.Bool( this.loaded_item ) ) {
				GlobalFuncs.to_chat( user, "<span class='rose'>You can't open the maintenance panel while an item is loaded!</span>" );
				return -1;
			}
			return base.togglePanelOpen( (object)(toggleitem), (object)(user), (object)(CC) );
		}

		// Function from file: destructive_analyzer.dm
		public ByTable ConvertReqString2List( string source_list = null ) {
			ByTable temp_list = null;
			dynamic O = null;

			temp_list = String13.ParseUrlParams( source_list );

			foreach (dynamic _a in Lang13.Enumerate( temp_list )) {
				O = _a;
				
				temp_list[O] = String13.ParseNumber( temp_list[O] );
			}
			return temp_list;
		}

		// Function from file: destructive_analyzer.dm
		public override dynamic RefreshParts(  ) {
			double T = 0;
			Obj_Item_Weapon_StockParts S = null;

			T = 0;

			foreach (dynamic _a in Lang13.Enumerate( this.component_parts, typeof(Obj_Item_Weapon_StockParts) )) {
				S = _a;
				
				T += S.rating * 0.1;
			}
			T = ( T <= 0 ? 0 : ( T >= 1 ? 1 : T ) );
			this.decon_mod = T;
			return null;
		}

		// Function from file: destructive_analyzer.dm
		public override dynamic Destroy( dynamic brokenup = null ) {
			dynamic _default = null;

			
			if ( this.linked_console != null && this.linked_console.linked_destroy == this ) {
				this.linked_console.linked_destroy = null;
			}
			_default = base.Destroy( (object)(brokenup) );
			return _default;
		}

	}

}