// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Structure_Morgue : Obj_Structure {

		public Obj_Structure_MTray connected = null;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.anchored = 1;
			this.icon = "icons/obj/stationobjs.dmi";
			this.icon_state = "morgue1";
			this.dir = 4;
		}

		public Obj_Structure_Morgue ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: morgue.dm
		public override void on_log(  ) {
			this.update();
			return;
		}

		// Function from file: morgue.dm
		public override dynamic relaymove( Mob M = null, double? direction = null ) {
			Tile T = null;
			dynamic A = null;

			
			if ( Lang13.Bool( M.stat ) ) {
				return null;
			}
			this.connected = new Obj_Structure_MTray( this.loc );
			Map13.Step( this.connected, ((int)( GlobalVars.EAST )) );
			this.connected.layer = GlobalVars.OBJ_LAYER;
			T = Map13.GetStep( this, ((int)( GlobalVars.EAST )) );

			if ( T.contents.Find( this.connected ) != 0 ) {
				this.connected.connected = this;
				this.icon_state = "morgue0";

				foreach (dynamic _a in Lang13.Enumerate( this )) {
					A = _a;
					
					A.loc = this.connected.loc;
				}
				this.connected.icon_state = "morguet";
			} else {
				GlobalFuncs.qdel( this.connected );
			}
			return null;
		}

		// Function from file: morgue.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			dynamic t = null;

			
			if ( a is Obj_Item_Weapon_Crowbar && !( this.contents.len != 0 ) ) {
				
				if ( GlobalFuncs.do_after( b, this, 50 ) ) {
					GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/items/Deconstruct.ogg", 50, 1 );
					new Obj_Structure_Closet_BodyBag( this.loc );
					new Obj_Item_Stack_Sheet_Metal( this.loc, 5 );
					GlobalFuncs.qdel( this );
				}
			}

			if ( a is Obj_Item_Weapon_Wrench ) {
				GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/items/Ratchet.ogg", 50, 1 );

				if ( this.dir == 4 ) {
					this.dir = 8;
				} else {
					this.dir = 4;
				}
			}

			if ( a is Obj_Item_Weapon_Pen ) {
				t = Interface13.Input( b, "What would you like the label to be?", "" + this.name, null, null, InputType.Str );

				if ( ((Mob)b).get_active_hand() != a ) {
					return null;
				}

				if ( !this.Adjacent( b ) || Lang13.Bool( b.stat ) ) {
					return null;
				}
				t = String13.SubStr( GlobalFuncs.sanitize( t ), 1, 1024 );

				if ( Lang13.Bool( t ) ) {
					this.name = "Morgue- '" + t + "'";
				} else {
					this.name = "Morgue";
				}
			}
			this.add_fingerprint( b );
			return null;
		}

		// Function from file: morgue.dm
		public override dynamic attack_hand( dynamic a = null, dynamic b = null, dynamic c = null ) {
			dynamic A = null;
			Tile T = null;
			dynamic A2 = null;

			
			if ( this.connected != null ) {
				
				foreach (dynamic _a in Lang13.Enumerate( this.connected.loc )) {
					A = _a;
					

					if ( !Lang13.Bool( A.anchored ) ) {
						A.loc = this;
					}
				}
				GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/items/Deconstruct.ogg", 50, 1 );
				GlobalFuncs.qdel( this.connected );
				this.connected = null;
			} else {
				GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/items/Deconstruct.ogg", 50, 1 );
				this.connected = new Obj_Structure_MTray( this.loc );
				Map13.Step( this.connected, this.dir );
				this.connected.layer = GlobalVars.OBJ_LAYER;
				T = Map13.GetStep( this, this.dir );

				if ( T.contents.Find( this.connected ) != 0 ) {
					this.connected.connected = this;
					this.icon_state = "morgue0";

					foreach (dynamic _b in Lang13.Enumerate( this )) {
						A2 = _b;
						
						A2.loc = this.connected.loc;
					}
					this.connected.icon_state = "morguet";
					this.connected.dir = this.dir;
				} else {
					GlobalFuncs.qdel( this.connected );
					this.connected = null;
				}
			}
			this.add_fingerprint( a );
			this.update();
			return null;
		}

		// Function from file: morgue.dm
		public override dynamic attack_paw( Mob a = null, dynamic b = null, dynamic c = null ) {
			return this.attack_hand( a );
		}

		// Function from file: morgue.dm
		public override dynamic alter_health( Mob_Living M = null ) {
			return this.loc;
		}

		// Function from file: morgue.dm
		public override bool ex_act( double? severity = null, dynamic child = null ) {
			dynamic A = null;
			dynamic A2 = null;
			dynamic A3 = null;

			
			switch ((double?)( severity )) {
				case 1:
					
					foreach (dynamic _a in Lang13.Enumerate( this )) {
						A = _a;
						
						A.loc = this.loc;
						this.ex_act( severity );
					}
					GlobalFuncs.qdel( this );
					return false;
					break;
				case 2:
					
					if ( Rand13.PercentChance( 50 ) ) {
						
						foreach (dynamic _b in Lang13.Enumerate( this )) {
							A2 = _b;
							
							A2.loc = this.loc;
							this.ex_act( severity );
						}
						GlobalFuncs.qdel( this );
						return false;
					}
					break;
				case 3:
					
					if ( Rand13.PercentChance( 5 ) ) {
						
						foreach (dynamic _c in Lang13.Enumerate( this )) {
							A3 = _c;
							
							A3.loc = this.loc;
							this.ex_act( severity );
						}
						GlobalFuncs.qdel( this );
						return false;
					}
					break;
			}
			return false;
		}

		// Function from file: morgue.dm
		public void update(  ) {
			ByTable inside = null;
			dynamic body = null;

			
			if ( this.connected != null ) {
				this.icon_state = "morgue0";
			} else if ( this.contents.len > 0 ) {
				inside = GlobalFuncs.recursive_type_check( this, typeof(Mob) );

				if ( !( inside.len != 0 ) ) {
					this.icon_state = "morgue3";
				} else {
					
					foreach (dynamic _a in Lang13.Enumerate( inside )) {
						body = _a;
						

						if ( Lang13.Bool( body ) && Lang13.Bool( body.client ) ) {
							this.icon_state = "morgue4";
							return;
						}
					}
					this.icon_state = "morgue2";
				}
			} else {
				this.icon_state = "morgue1";
			}
			return;
		}

	}

}