// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Structure_Closet_BodyBag : Obj_Structure_Closet {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.icon_closed = "bodybag_closed";
			this.icon_opened = "bodybag_open";
			this.icon = "icons/obj/bodybag.dmi";
			this.icon_state = "bodybag_closed";
		}

		public Obj_Structure_Closet_BodyBag ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: bodybag.dm
		public override bool? update_icon( dynamic location = null, dynamic target = null ) {
			
			if ( !this.opened ) {
				this.icon_state = this.icon_closed;
			} else {
				this.icon_state = this.icon_opened;
			}
			return null;
		}

		// Function from file: bodybag.dm
		public override dynamic MouseDrop( Mob over_object = null, dynamic src_location = null, Ent_Static over_location = null, dynamic src_control = null, dynamic over_control = null, string _params = null ) {
			base.MouseDrop( over_object, (object)(src_location), over_location, (object)(src_control), (object)(over_control), _params );

			if ( over_object == Task13.User && ( GlobalFuncs.in_range( this, Task13.User ) || Task13.User.contents.Find( this ) != 0 ) ) {
				
				if ( !( Task13.User is Mob_Living_Carbon_Human ) || Task13.User.incapacitated() || Task13.User.lying == true ) {
					return null;
				}

				if ( this.opened ) {
					return 0;
				}

				if ( this.contents.len != 0 ) {
					return 0;
				}
				this.visible_message( "" + Task13.User + " folds up the " + this.name );
				new Obj_Item_Bodybag( GlobalFuncs.get_turf( this ) );
				Task13.Schedule( 0, (Task13.Closure)(() => {
					GlobalFuncs.qdel( this );
					return;
				}));
				return null;
			}
			return null;
		}

		// Function from file: bodybag.dm
		public override bool close(  ) {
			
			if ( base.close() ) {
				this.density = false;
				return true;
			}
			return false;
		}

		// Function from file: bodybag.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			dynamic S = null;
			string t = null;

			
			if ( a is Obj_Item_Stack_Sheet_Metal ) {
				S = a;

				if ( Convert.ToDouble( S.amount ) < 5 ) {
					return null;
				}
				S.use( 5 );
				new Obj_Structure_Morgue( this.loc );
				GlobalFuncs.qdel( this );
			}

			if ( a is Obj_Item_Weapon_Pen ) {
				t = String13.SubStr( GlobalFuncs.sanitize( Interface13.Input( b, "What would you like the label to be?", "" + this.name, null, null, InputType.Str | InputType.Null ) ), 1, 26 );

				if ( ((Mob)b).get_active_hand() != a ) {
					return null;
				}

				if ( !this.Adjacent( b ) || Lang13.Bool( b.stat ) ) {
					return null;
				}
				t = String13.SubStr( GlobalFuncs.sanitize( t ), 1, 1024 );
				this.name = "body bag";

				if ( Lang13.Bool( t ) ) {
					this.name += " (" + t + ")";
					this.overlays.Add( new Image( this.icon, "bodybag_label" ) );
				}
				return null;
			} else if ( a is Obj_Item_Weapon_Wirecutters ) {
				GlobalFuncs.to_chat( b, "You cut the tag off the bodybag" );
				this.name = "body bag";
				this.overlays.len = 0;
				return null;
			}
			return null;
		}

	}

}