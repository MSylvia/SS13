// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_Rcl : Obj_Item_Weapon {

		public int max_amount = 90;
		public bool active = false;
		public Game_Data last = null;
		public dynamic loaded = null;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.item_state = "rcl-0";
			this.inhand_states = new ByTable().Set( "left_hand", "icons/mob/in-hand/left/electronics.dmi" ).Set( "right_hand", "icons/mob/in-hand/right/electronics.dmi" );
			this.force = 5;
			this.throwforce = 5;
			this.throw_speed = 1;
			this.throw_range = 10;
			this.w_type = 5;
			this.melt_temperature = 453.41;
			this.origin_tech = "engineering=2;materials=4";
			this.icon_state = "rcl-0";
		}

		public Obj_Item_Weapon_Rcl ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: RCL.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			this.active = !this.active;
			GlobalFuncs.to_chat( user, "<span class='notice'>You turn the " + this + " " + ( this.active ? "on" : "off" ) + ".<span>" );

			if ( this.active ) {
				this.trigger( user );
			}
			return null;
		}

		// Function from file: RCL.dm
		public override dynamic dropped( dynamic user = null ) {
			base.dropped( (object)(user) );
			this.active = false;
			return null;
		}

		// Function from file: RCL.dm
		public void trigger( dynamic user = null ) {
			
			if ( !Lang13.Bool( this.loaded ) ) {
				GlobalFuncs.to_chat( user, new Txt( "<span class='warning'>" ).The( this ).item().str( " is empty!</span>" ).ToString() );
				return;
			}

			if ( this.last != null ) {
				
				if ( Map13.GetDistance( this.last, user ) == 0 ) {
					this.last = null;
				} else if ( Map13.GetDistance( this.last, user ) == 1 ) {
					
					if ( Map13.GetDistance( this.last, user ) == Convert.ToInt32( ((dynamic)this.last).d2 ) ) {
						this.last = null;
						return;
					}
					((Obj_Item_Stack_CableCoil)this.loaded).cable_join( this.last, user );

					if ( this.is_empty( user ) ) {
						return;
					}
				} else {
					this.last = null;
				}
			}
			this.last = ((Obj_Item_Stack_CableCoil)this.loaded).turf_place( GlobalFuncs.get_turf( this.loc ), user, Num13.Rotate( user.dir, 180 ) );
			this.is_empty( user );
			return;
		}

		// Function from file: RCL.dm
		public bool is_empty( dynamic user = null ) {
			this.update_icon();

			if ( !Lang13.Bool( this.loaded.amount ) ) {
				GlobalFuncs.to_chat( user, new Txt( "<span class='notice'>The last of the cables unreel from " ).the( this ).item().str( ".</span>" ).ToString() );
				GlobalFuncs.returnToPool( this.loaded );
				this.loaded = null;
				return true;
			}
			return false;
		}

		// Function from file: RCL.dm
		public override bool? update_icon( dynamic location = null, dynamic target = null ) {
			
			if ( !Lang13.Bool( this.loaded ) ) {
				this.icon_state = "rcl-0";
				this.item_state = "rcl-0";
				return null;
			}

			dynamic _a = this.loaded.amount; // Was a switch-case, sorry for the mess.
			if ( 61<=_a&&_a<=Double.PositiveInfinity ) {
				this.icon_state = "rcl-30";
				this.item_state = "rcl";
			} else if ( 31<=_a&&_a<=60 ) {
				this.icon_state = "rcl-20";
				this.item_state = "rcl";
			} else if ( 1<=_a&&_a<=30 ) {
				this.icon_state = "rcl-10";
				this.item_state = "rcl";
			} else {
				this.icon_state = "rcl-0";
				this.item_state = "rcl-0";
			}
			return null;
		}

		// Function from file: RCL.dm
		public override dynamic Destroy( dynamic brokenup = null ) {
			GlobalFuncs.qdel( this.loaded );
			this.loaded = null;
			this.last = null;
			base.Destroy( (object)(brokenup) );
			return null;
		}

		// Function from file: RCL.dm
		public override dynamic examine( dynamic user = null, string size = null ) {
			base.examine( (object)(user), size );

			if ( Lang13.Bool( this.loaded ) ) {
				GlobalFuncs.to_chat( user, "<span class='info'>It contains " + this.loaded.amount + "/90 cables.</span>" );
			}
			return null;
		}

		// Function from file: RCL.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			double? diff = null;

			
			if ( a is Obj_Item_Stack_CableCoil ) {
				
				if ( !Lang13.Bool( this.loaded ) ) {
					
					if ( Lang13.Bool( b.drop_item( a, this ) ) ) {
						this.loaded = a;
						this.loaded.max_amount = this.max_amount;
					}
				} else {
					((Obj_Item)this.loaded).preattack( a, b, true );
				}
				this.update_icon();
				GlobalFuncs.to_chat( b, "<span class='notice'>You add the cables to the " + this + ". It now contains " + this.loaded.amount + ".</span>" );
			} else if ( a is Obj_Item_Weapon_Screwdriver ) {
				
				if ( !Lang13.Bool( this.loaded ) ) {
					return null;
				}
				GlobalFuncs.to_chat( b, "<span class='notice'>You loosen the securing screws on the side, allowing you to lower the guiding edge and retrieve the wires.</span>" );

				while (Convert.ToDouble( this.loaded.amount ) > 30) {
					diff = Lang13.DoubleNullable( this.loaded.amount % 30 );

					if ( Lang13.Bool( diff ) ) {
						((Obj_Item_Stack)this.loaded).use( diff );
						GlobalFuncs.getFromPool( typeof(Obj_Item_Stack_CableCoil), b.loc, diff );
					} else {
						((Obj_Item_Stack)this.loaded).use( 30 );
						GlobalFuncs.getFromPool( typeof(Obj_Item_Stack_CableCoil), b.loc, 30 );
					}
				}
				this.loaded.max_amount = Lang13.Initial( this.loaded, "max_amount" );
				this.loaded.loc = b.loc;
				((Mob)b).put_in_hands( this.loaded );
				this.loaded = null;
				this.update_icon();
			} else {
				base.attackby( (object)(a), (object)(b), (object)(c) );
			}
			return null;
		}

	}

}