// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Device_Assembly_Voice : Obj_Item_Device_Assembly {

		public bool listening = false;
		public dynamic recorded = "";
		public int mode = 1;
		public dynamic modes = null;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.materials = new ByTable().Set( "$metal", 500 ).Set( "$glass", 50 );
			this.flags = 16;
			this.attachable = true;
			this.verb_say = "beeps";
			this.verb_ask = "beeps";
			this.verb_exclaim = "beeps";
			this.icon_state = "voice";
		}

		public Obj_Item_Device_Assembly_Voice ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: voice.dm
		public override bool toggle_secure(  ) {
			bool _default = false;

			_default = base.toggle_secure();
			this.listening = false;
			return _default;
		}

		// Function from file: voice.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			
			if ( !Lang13.Bool( user ) ) {
				return 0;
			}
			this.activate();
			return 1;
		}

		// Function from file: voice.dm
		public override bool activate(  ) {
			
			if ( this.secured ) {
				
				if ( !( this.holder != null ) ) {
					this.listening = !this.listening;
					this.say( "" + ( this.listening ? "Now" : "No longer" ) + " recording input." );
				}
			}
			return false;
		}

		// Function from file: voice.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			
			if ( A is Obj_Item_Device_Multitool ) {
				this.mode %= GlobalVars.modes.len;
				this.mode++;
				user.WriteMsg( "You set " + this + " into a " + GlobalVars.modes[this.mode] + " mode." );
				this.listening = false;
				this.recorded = "";
			} else {
				return base.attackby( (object)(A), (object)(user), _params, silent, replace_spent );
			}
			return null;
		}

		// Function from file: voice.dm
		public bool check_activation( dynamic speaker = null, dynamic raw_message = null ) {
			bool _default = false;

			_default = false;

			switch ((int)( this.mode )) {
				case 1:
					
					if ( String13.Find( raw_message, this.recorded, 1, 0 ) != 0 ) {
						_default = true;
					}
					break;
				case 2:
					
					if ( raw_message == this.recorded ) {
						_default = true;
					}
					break;
				case 3:
					
					if ( ((Ent_Dynamic)speaker).GetVoice() == this.recorded ) {
						_default = true;
					}
					break;
				case 4:
					
					if ( Lang13.Length( raw_message ) != 0 ) {
						_default = true;
					}
					break;
			}
			return _default;
		}

		// Function from file: voice.dm
		public void record_speech( dynamic speaker = null, dynamic raw_message = null ) {
			
			switch ((int)( this.mode )) {
				case 1:
					this.recorded = raw_message;
					this.listening = false;
					this.say( "Activation message is '" + this.recorded + "'." );
					break;
				case 2:
					this.recorded = raw_message;
					this.listening = false;
					this.say( "Activation message is '" + this.recorded + "'." );
					break;
				case 3:
					this.recorded = ((Ent_Dynamic)speaker).GetVoice();
					this.listening = false;
					this.say( "Your voice pattern is saved." );
					break;
				case 4:
					
					if ( Lang13.Length( raw_message ) != 0 ) {
						Task13.Schedule( 10, (Task13.Closure)(() => {
							this.pulse( false );
							return;
						}));
					}
					break;
			}
			return;
		}

		// Function from file: voice.dm
		public override string Hear( string message = null, dynamic speaker = null, int message_langs = 0, dynamic raw_message = null, dynamic radio_freq = null, ByTable spans = null ) {
			
			if ( speaker == this ) {
				return null;
			}

			if ( this.listening && !Lang13.Bool( radio_freq ) ) {
				this.record_speech( speaker, raw_message );
			} else if ( this.check_activation( speaker, raw_message ) ) {
				Task13.Schedule( 10, (Task13.Closure)(() => {
					this.pulse( false );
					return;
				}));
			}
			return null;
		}

	}

}