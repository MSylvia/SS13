// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_ProcHolder_Changeling_Biodegrade : Obj_Effect_ProcHolder_Changeling {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.helptext = "This is obvious to nearby people, and can destroy standard restraints and closets.";
			this.chemical_cost = 30;
			this.dna_cost = 2;
			this.req_human = true;
			this.genetic_damage = 10;
			this.max_genetic_damage = 0;
		}

		public Obj_Effect_ProcHolder_Changeling_Biodegrade ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: biodegrade.dm
		public override dynamic sting_action( Mob user = null, Ent_Static target = null ) {
			bool used = false;
			dynamic O = null;
			dynamic S = null;
			Ent_Static C = null;

			used = false;

			if ( !user.restrained() && !( user.loc is Obj_Structure_Closet ) ) {
				user.WriteMsg( "<span class='warning'>We are already free!</span>" );
				return 0;
			}

			if ( Lang13.Bool( ((dynamic)user).handcuffed ) ) {
				used = true;
				O = user.get_item_by_slot( 3 );

				if ( !Lang13.Bool( O ) || !( O is Obj ) ) {
					return 0;
				}
				user.visible_message( new Txt( "<span class='warning'>" ).item( user ).str( " vomits a glob of acid on " ).his_her_its_their().str( " " ).item( O ).str( "!</span>" ).ToString(), "<span class='warning'>We vomit acidic ooze onto our restraints!</span>" );
				Task13.Schedule( 30, (Task13.Closure)(() => {
					
					if ( Lang13.Bool( O ) && ((dynamic)user).handcuffed == O ) {
						user.unEquip( O );
						((Ent_Static)O).visible_message( "<span class='warning'>" + O + " dissolves into a puddle of sizzling goop.</span>" );
						O.loc = GlobalFuncs.get_turf( user );
						GlobalFuncs.qdel( O );
					}
					return;
				}));
			}

			if ( Lang13.Bool( ((dynamic)user).wear_suit ) && ((dynamic)user).wear_suit.breakouttime != 0 && !used ) {
				used = true;
				S = user.get_item_by_slot( 13 );

				if ( !Lang13.Bool( S ) || !( S is Obj_Item_Clothing_Suit ) ) {
					return 0;
				}
				user.visible_message( new Txt( "<span class='warning'>" ).item( user ).str( " vomits a glob of acid across the front of " ).his_her_its_their().str( " " ).item( S ).str( "!</span>" ).ToString(), "<span class='warning'>We vomit acidic ooze onto our straight jacket!</span>" );
				Task13.Schedule( 30, (Task13.Closure)(() => {
					
					if ( Lang13.Bool( S ) && ((dynamic)user).wear_suit == S ) {
						user.unEquip( S );
						((Ent_Static)S).visible_message( "<span class='warning'>" + S + " dissolves into a puddle of sizzling goop.</span>" );
						S.loc = GlobalFuncs.get_turf( user );
						GlobalFuncs.qdel( S );
					}
					return;
				}));
			}

			if ( user.loc is Obj_Structure_Closet && !used ) {
				used = true;
				C = user.loc;

				if ( !( C != null ) || !( C is Obj_Structure_Closet ) ) {
					return 0;
				}
				C.visible_message( "<span class='warning'>" + C + "'s hinges suddenly begin to melt and run!</span>" );
				user.WriteMsg( "<span class='warning'>We vomit acidic goop onto the interior of " + C + "!</span>" );
				Task13.Schedule( 70, (Task13.Closure)(() => {
					
					if ( C != null && user.loc == C ) {
						C.visible_message( "<span class='warning'>" + C + "'s door breaks and opens!</span>" );
						((dynamic)C).welded = 0;
						((dynamic)C).locked = 0;
						((dynamic)C).broken = 1;
						((dynamic)C).open();
						user.WriteMsg( "<span class='warning'>We open the container restraining us!</span>" );
					}
					return;
				}));
			}
			GlobalFuncs.feedback_add_details( "changeling_powers", "BD" );
			return 1;
		}

	}

}