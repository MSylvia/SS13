// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_Portal_JauntTunnel : Obj_Effect_Portal {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.icon = "icons/effects/effects.dmi";
			this.icon_state = "bhole3";
		}

		public Obj_Effect_Portal_JauntTunnel ( dynamic loc = null, int? lifespan = null ) : base( (object)(loc), lifespan ) {
			
		}

		// Function from file: mine_items.dm
		public override void teleport( dynamic M = null ) {
			dynamic T = null;
			dynamic L = null;
			dynamic V = null;

			
			if ( M is Obj_Effect ) {
				return;
			}

			if ( !( M is Ent_Dynamic ) ) {
				return;
			}

			if ( !Lang13.Bool( this.target ) ) {
				GlobalFuncs.qdel( this );
			}
			T = this.target;

			if ( !( T is Tile ) ) {
				T = GlobalFuncs.get_turf( this.target );
			}

			if ( Rand13.PercentChance( 1 ) ) {
				T = Map13.GetTile( Rand13.Int( 5, Game13.map_size_x - 10 ), Rand13.Int( 5, Game13.map_size_y - 10 ), 3 );
			}
			GlobalFuncs.do_teleport( M, T, 6 );

			if ( M is Mob_Living ) {
				L = M;
				((Mob)L).Weaken( 3 );

				if ( L is Mob_Living_Carbon_Human ) {
					GlobalFuncs.shake_camera( L, 20, 1 );
					Task13.Schedule( 20, (Task13.Closure)(() => {
						
						if ( Lang13.Bool( L ) ) {
							((Ent_Static)L).visible_message( new Txt( "<span class='danger'>" ).item( L ).str( " vomits from travelling through " ).the( this ).item().str( "!</span>" ).ToString() );
							L.nutrition = Num13.MaxInt( ((int)( L.nutrition - 20 )), 0 );
							((Mob_Living)L).adjustToxLoss( -3 );
							V = GlobalFuncs.get_turf( L );
							((Ent_Static)V).add_vomit_floor( L );
							GlobalFuncs.playsound( V, "sound/effects/splat.ogg", 50, 1 );
							return;
						}
						return;
					}));
				}
			}
			return;
		}

	}

}