// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_Computer_Arcade_Battle : Obj_Machinery_Computer_Arcade {

		public dynamic enemy_name = "Space Villian";
		public string temp = "Winners don't use space drugs";
		public int player_hp = 30;
		public int player_mp = 10;
		public int enemy_hp = 45;
		public int enemy_mp = 20;
		public bool gameover = false;
		public bool blocked = false;
		public int turtle = 0;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.circuit = typeof(Obj_Item_Weapon_Circuitboard_Arcade_Battle);
		}

		// Function from file: arcade.dm
		public Obj_Machinery_Computer_Arcade_Battle ( dynamic location = null, dynamic C = null ) : base( (object)(location), (object)(C) ) {
			dynamic name_action = null;
			dynamic name_part1 = null;
			dynamic name_part2 = null;

			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			name_action = Rand13.Pick(new object [] { "Defeat ", "Annihilate ", "Save ", "Strike ", "Stop ", "Destroy ", "Robust ", "Romance ", "Pwn ", "Own ", "Ban " });
			name_part1 = Rand13.Pick(new object [] { "the Automatic ", "Farmer ", "Lord ", "Professor ", "the Cuban ", "the Evil ", "the Dread King ", "the Space ", "Lord ", "the Great ", "Duke ", "General " });
			name_part2 = Rand13.Pick(new object [] { "Melonoid", "Murdertron", "Sorcerer", "Ruin", "Jeff", "Ectoplasm", "Crushulon", "Uhangoid", "Vhakoid", "Peteoid", "slime", "Griefer", "ERPer", "Lizard Man", "Unicorn", "Bloopers" });
			this.enemy_name = GlobalFuncs.replacetext( name_part1 + name_part2, "the ", "" );
			this.name = name_action + name_part1 + name_part2;
			return;
		}

		// Function from file: arcade.dm
		public override bool emag_act( dynamic user = null ) {
			
			if ( !Lang13.Bool( this.emagged ) ) {
				this.temp = "If you die in the game, you die for real!";
				this.player_hp = 30;
				this.player_mp = 10;
				this.enemy_hp = 45;
				this.enemy_mp = 20;
				this.gameover = false;
				this.blocked = false;
				this.emagged = 1;
				this.enemy_name = "Cuban Pete";
				this.name = "Outbomb Cuban Pete";
				this.updateUsrDialog();
			}
			return false;
		}

		// Function from file: arcade.dm
		public void arcade_action(  ) {
			int boomamt = 0;
			int stealamt = 0;
			int attackamt = 0;

			
			if ( this.enemy_mp <= 0 || this.enemy_hp <= 0 ) {
				
				if ( !this.gameover ) {
					this.gameover = true;
					this.temp = "" + this.enemy_name + " has fallen! Rejoice!";
					GlobalFuncs.playsound( this.loc, "sound/arcade/Win.ogg", 50, 1, -3, 10 );

					if ( Lang13.Bool( this.emagged ) ) {
						GlobalFuncs.feedback_inc( "arcade_win_emagged" );
						new Obj_Effect_Spawner_Newbomb_Timer_Syndicate( this.loc );
						new Obj_Item_Clothing_Head_Collectable_Petehat( this.loc );
						GlobalFuncs.message_admins( "" + GlobalFuncs.key_name_admin( Task13.User ) + " has outbombed Cuban Pete and been awarded a bomb." );
						GlobalFuncs.log_game( "" + GlobalFuncs.key_name( Task13.User ) + " has outbombed Cuban Pete and been awarded a bomb." );
						((dynamic)this).New();
						this.emagged = 0;
					} else {
						GlobalFuncs.feedback_inc( "arcade_win_normal" );
						this.prizevend();
					}
				}
			} else if ( Lang13.Bool( this.emagged ) && this.turtle >= 4 ) {
				boomamt = Rand13.Int( 5, 10 );
				this.temp = "" + this.enemy_name + " throws a bomb, exploding you for " + boomamt + " damage!";
				GlobalFuncs.playsound( this.loc, "sound/arcade/Boom.ogg", 50, 1, -3, 10 );
				this.player_hp -= boomamt;
			} else if ( this.enemy_mp <= 5 && Rand13.PercentChance( 70 ) ) {
				stealamt = Rand13.Int( 2, 3 );
				this.temp = "" + this.enemy_name + " steals " + stealamt + " of your power!";
				GlobalFuncs.playsound( this.loc, "sound/arcade/Steal.ogg", 50, 1, -3, 10 );
				this.player_mp -= stealamt;
				this.updateUsrDialog();

				if ( this.player_mp <= 0 ) {
					this.gameover = true;
					Task13.Sleep( 10 );
					this.temp = "You have been drained! GAME OVER";
					GlobalFuncs.playsound( this.loc, "sound/arcade/Lose.ogg", 50, 1, -3, 10 );

					if ( Lang13.Bool( this.emagged ) ) {
						GlobalFuncs.feedback_inc( "arcade_loss_mana_emagged" );
						Task13.User.gib();
					} else {
						GlobalFuncs.feedback_inc( "arcade_loss_mana_normal" );
					}
				}
			} else if ( this.enemy_hp <= 10 && this.enemy_mp > 4 ) {
				this.temp = "" + this.enemy_name + " heals for 4 health!";
				GlobalFuncs.playsound( this.loc, "sound/arcade/Heal.ogg", 50, 1, -3, 10 );
				this.enemy_hp += 4;
				this.enemy_mp -= 4;
			} else {
				attackamt = Rand13.Int( 3, 6 );
				this.temp = "" + this.enemy_name + " attacks for " + attackamt + " damage!";
				GlobalFuncs.playsound( this.loc, "sound/arcade/Hit.ogg", 50, 1, -3, 10 );
				this.player_hp -= attackamt;
			}

			if ( this.player_mp <= 0 || this.player_hp <= 0 ) {
				this.gameover = true;
				this.temp = "You have been crushed! GAME OVER";
				GlobalFuncs.playsound( this.loc, "sound/arcade/Lose.ogg", 50, 1, -3, 10 );

				if ( Lang13.Bool( this.emagged ) ) {
					GlobalFuncs.feedback_inc( "arcade_loss_hp_emagged" );
					Task13.User.gib();
				} else {
					GlobalFuncs.feedback_inc( "arcade_loss_hp_normal" );
				}
			}
			this.blocked = false;
			return;
		}

		// Function from file: arcade.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hsrc = null ) {
			int attackamt = 0;
			int pointamt = 0;
			int healamt = 0;
			int chargeamt = 0;

			
			if ( Lang13.Bool( base.Topic( href, href_list, (object)(hsrc) ) ) ) {
				return null;
			}

			if ( !this.blocked && !this.gameover ) {
				
				if ( Lang13.Bool( href_list["attack"] ) ) {
					this.blocked = true;
					attackamt = Rand13.Int( 2, 6 );
					this.temp = "You attack for " + attackamt + " damage!";
					GlobalFuncs.playsound( this.loc, "sound/arcade/Hit.ogg", 50, 1, -3, 10 );
					this.updateUsrDialog();

					if ( this.turtle > 0 ) {
						this.turtle--;
					}
					Task13.Sleep( 10 );
					this.enemy_hp -= attackamt;
					this.arcade_action();
				} else if ( Lang13.Bool( href_list["heal"] ) ) {
					this.blocked = true;
					pointamt = Rand13.Int( 1, 3 );
					healamt = Rand13.Int( 6, 8 );
					this.temp = "You use " + pointamt + " magic to heal for " + healamt + " damage!";
					GlobalFuncs.playsound( this.loc, "sound/arcade/Heal.ogg", 50, 1, -3, 10 );
					this.updateUsrDialog();
					this.turtle++;
					Task13.Sleep( 10 );
					this.player_mp -= pointamt;
					this.player_hp += healamt;
					this.blocked = true;
					this.updateUsrDialog();
					this.arcade_action();
				} else if ( Lang13.Bool( href_list["charge"] ) ) {
					this.blocked = true;
					chargeamt = Rand13.Int( 4, 7 );
					this.temp = "You regain " + chargeamt + " points";
					GlobalFuncs.playsound( this.loc, "sound/arcade/Mana.ogg", 50, 1, -3, 10 );
					this.player_mp += chargeamt;

					if ( this.turtle > 0 ) {
						this.turtle--;
					}
					this.updateUsrDialog();
					Task13.Sleep( 10 );
					this.arcade_action();
				}
			}

			if ( Lang13.Bool( href_list["close"] ) ) {
				Task13.User.unset_machine();
				Interface13.Browse( Task13.User, null, "window=arcade" );
			} else if ( Lang13.Bool( href_list["newgame"] ) ) {
				this.temp = "New Round";
				this.player_hp = 30;
				this.player_mp = 10;
				this.enemy_hp = 45;
				this.enemy_mp = 20;
				this.gameover = false;
				this.turtle = 0;

				if ( Lang13.Bool( this.emagged ) ) {
					((dynamic)this).New();
					this.emagged = 0;
				}
			}
			this.add_fingerprint( Task13.User );
			this.updateUsrDialog();
			return null;
		}

		// Function from file: arcade.dm
		public override dynamic attack_hand( dynamic a = null, bool? b = null, bool? c = null ) {
			string dat = null;
			Browser popup = null;

			
			if ( Lang13.Bool( base.attack_hand( (object)(a), b, c ) ) ) {
				return null;
			}
			((Mob)a).set_machine( this );
			dat = new Txt( "<a href='byond://?src=" ).Ref( this ).str( ";close=1'>Close</a>" ).ToString();
			dat += "<center><h4>" + this.enemy_name + "</h4></center>";
			dat += "<br><center><h3>" + this.temp + "</h3></center>";
			dat += "<br><center>Health: " + this.player_hp + " | Magic: " + this.player_mp + " | Enemy Health: " + this.enemy_hp + "</center>";

			if ( this.gameover ) {
				dat += new Txt( "<center><b><a href='byond://?src=" ).Ref( this ).str( ";newgame=1'>New Game</a>" ).ToString();
			} else {
				dat += new Txt( "<center><b><a href='byond://?src=" ).Ref( this ).str( ";attack=1'>Attack</a> | " ).ToString();
				dat += new Txt( "<a href='byond://?src=" ).Ref( this ).str( ";heal=1'>Heal</a> | " ).ToString();
				dat += new Txt( "<a href='byond://?src=" ).Ref( this ).str( ";charge=1'>Recharge Power</a>" ).ToString();
			}
			dat += "</b></center>";
			popup = new Browser( a, "arcade", "Space Villian 2000" );
			popup.set_content( dat );
			popup.set_title_image( ((Mob)a).browse_rsc_icon( this.icon, this.icon_state ) );
			popup.open();
			return null;
		}

	}

}