// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_Resonance : Obj_Effect {

		public int resonance_damage = 30;
		public dynamic creator = null;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.icon = "icons/effects/effects.dmi";
			this.icon_state = "shield1";
			this.layer = 4.1;
		}

		// Function from file: mine_items.dm
		public Obj_Effect_Resonance ( dynamic loc = null ) : base( (object)(loc) ) {
			dynamic proj_turf = null;
			dynamic M = null;
			GasMixture environment = null;
			dynamic pressure = null;
			Mob_Living L = null;
			Mob_Living L2 = null;

			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			proj_turf = GlobalFuncs.get_turf( this );

			if ( !( proj_turf is Tile ) ) {
				return;
			}

			if ( proj_turf is Tile_Unsimulated_Mineral ) {
				M = proj_turf;
				GlobalFuncs.playsound( this, "sound/effects/sparks4.ogg", 50, 1 );
				((Tile_Unsimulated_Mineral)M).GetDrilled();
				Task13.Schedule( 5, (Task13.Closure)(() => {
					GlobalFuncs.qdel( this );
					return;
				}));
			} else {
				environment = ((Ent_Static)proj_turf).return_air();
				pressure = environment.return_pressure();

				if ( Convert.ToDouble( pressure ) < 50 ) {
					this.name = "strong resonance field";
					this.resonance_damage = 60;
				}
				Task13.Schedule( 50, (Task13.Closure)(() => {
					GlobalFuncs.playsound( this, "sound/effects/sparks4.ogg", 50, 1 );

					if ( Lang13.Bool( this.creator ) ) {
						
						foreach (dynamic _a in Lang13.Enumerate( this.loc, typeof(Mob_Living) )) {
							L = _a;
							
							GlobalFuncs.add_logs( this.creator, L, "used a resonator field on", null, "resonator" );
							GlobalFuncs.to_chat( L, new Txt( "<span class='danger'>" ).The( this ).item().str( " ruptured with you in it!</span>" ).ToString() );
							L.adjustBruteLoss( this.resonance_damage );
						}
					} else {
						
						foreach (dynamic _b in Lang13.Enumerate( this.loc, typeof(Mob_Living) )) {
							L2 = _b;
							
							GlobalFuncs.to_chat( L2, new Txt( "<span class='danger'>" ).The( this ).item().str( " ruptured with you in it!</span>" ).ToString() );
							L2.adjustBruteLoss( this.resonance_damage );
						}
					}
					GlobalFuncs.qdel( this );
					return;
				}));
			}
			return;
		}

	}

}