// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_Computer_Teleporter : Obj_Machinery_Computer {

		public dynamic locked = null;
		public string id = null;
		public bool one_time_use = false;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.circuit = "/obj/item/weapon/circuitboard/teleporter";
			this.light_color = "#6496FA";
			this.icon_state = "teleport";
		}

		// Function from file: teleporter.dm
		public Obj_Machinery_Computer_Teleporter ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.id = "" + Rand13.Int( 1000, 9999 );
			return;
		}

		// Function from file: teleporter.dm
		public ByTable get_avail_dests(  ) {
			ByTable _default = null;

			ByTable L = null;
			ByTable areaindex = null;
			Obj_Item_Beacon R = null;
			dynamic T = null;
			string tmpname = null;
			Obj_Item_Weapon_Implant_Tracking I = null;
			Ent_Static M = null;
			dynamic T2 = null;
			string tmpname2 = null;

			L = new ByTable();
			areaindex = new ByTable();

			foreach (dynamic _a in Lang13.Enumerate( GlobalVars.beacons, typeof(Obj_Item_Beacon) )) {
				R = _a;
				
				T = GlobalFuncs.get_turf( R );

				if ( !Lang13.Bool( T ) ) {
					continue;
				}

				if ( Convert.ToInt32( T.z ) == 2 || Convert.ToDouble( T.z ) > GlobalVars.map.zLevels.len ) {
					continue;
				}
				tmpname = T.loc.name;

				if ( Lang13.Bool( areaindex[tmpname] ) ) {
					tmpname = "" + tmpname + " (" + ++areaindex[tmpname] + ")";
				} else {
					areaindex[tmpname] = 1;
				}
				L[tmpname] = R;
			}

			foreach (dynamic _b in Lang13.Enumerate( GlobalVars.tracking_implants, typeof(Obj_Item_Weapon_Implant_Tracking) )) {
				I = _b;
				

				if ( !I.implanted || !( I.loc is Mob ) ) {
					continue;
				} else {
					M = I.loc;

					if ( Convert.ToInt32( ((dynamic)M).stat ) == 2 ) {
						
						if ( Convert.ToDouble( ((dynamic)M).timeofdeath + 6000 ) < Game13.time ) {
							continue;
						}
					}
					T2 = GlobalFuncs.get_turf( M );

					if ( Lang13.Bool( T2 ) ) {
						continue;
					}

					if ( Convert.ToInt32( T2.z ) == 2 ) {
						continue;
					}
					tmpname2 = ((dynamic)M).real_name;

					if ( Lang13.Bool( areaindex[tmpname2] ) ) {
						tmpname2 = "" + tmpname2 + " (" + ++areaindex[tmpname2] + ")";
					} else {
						areaindex[tmpname2] = 1;
					}
					L[tmpname2] = I;
				}
			}
			_default = L;
			return _default;
		}

		// Function from file: teleporter.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hclient = null, HtmlInterface currui = null ) {
			dynamic _default = null;

			ByTable dests = null;
			double? idx = null;

			_default = base.Topic( href, href_list, (object)(hclient) );

			if ( Lang13.Bool( _default ) ) {
				return _default;
			}

			if ( Lang13.Bool( href_list["clear"] ) ) {
				this.locked = null;
				this.updateUsrDialog();
				return 1;
			}

			if ( Lang13.Bool( href_list["dest"] ) ) {
				dests = this.get_avail_dests();
				idx = ( ( String13.ParseNumber( href_list["dest"] ) ??0) <= 1 ? 1 : ( ( String13.ParseNumber( href_list["dest"] ) ??0) >= dests.len ? dests.len : String13.ParseNumber( href_list["dest"] ) ) );
				this.locked = dests[dests[idx]];
				this.say( "Locked in" );
				this.updateUsrDialog();
				return 1;
			}
			return _default;
		}

		// Function from file: teleporter.dm
		public override dynamic interact( dynamic user = null, bool? flag1 = null ) {
			dynamic _default = null;

			dynamic locked_area = null;
			ByTable dests = null;
			dynamic name = null;
			Browser popup = null;

			
			if ( Lang13.Bool( this.locked ) ) {
				locked_area = GlobalFuncs.get_area( this.locked );

				if ( !Lang13.Bool( locked_area ) ) {
					this.locked = null;
				}

				if ( Lang13.Bool( this.locked ) ) {
					locked_area = GlobalFuncs.get_area( this.locked );

					if ( !Lang13.Bool( locked_area ) ) {
						this.locked = null;
					}
					_default = new Txt( "\n			<b>Destination:</b> " ).item( GlobalFuncs.sanitize( locked_area.name ) ).str( "<br>\n			<a href='?src=" ).Ref( this ).str( ";clear=1'>Clear destination</a><br>\n			" ).ToString();
				}
			} else {
				_default = "\n		<b>Destination unset!</b><br>\n		";
			}
			_default += "\n		<br><b>Available destinations:<b><br>\n		<lu>\n	";
			dests = this.get_avail_dests();

			foreach (dynamic _a in Lang13.Enumerate( dests )) {
				name = _a;
				
				_default += new Txt( "\n			<li><a href='?src=" ).Ref( this ).str( ";dest=" ).item( dests.Find( name ) ).str( "'" ).item( ( dests[name] == this.locked ? " class='linkOn'" : "" ) ).str( ">" ).item( GlobalFuncs.sanitize( name ) ).str( "</a></li>\n		" ).ToString();
			}
			_default += "</lu>";
			popup = new Browser( user, "teleporter_console", this.name, 250, 500, this );
			popup.set_content( _default );
			popup.open();
			((Mob)user).set_machine( this );
			return _default;
		}

		// Function from file: teleporter.dm
		public override dynamic attack_hand( dynamic a = null, dynamic b = null, dynamic c = null ) {
			dynamic _default = null;

			_default = base.attack_hand( (object)(a), (object)(b), (object)(c) );

			if ( Lang13.Bool( _default ) ) {
				((Mob)a).unset_machine();
				return _default;
			}
			this.interact( a );
			return _default;
		}

		// Function from file: teleporter.dm
		public override dynamic attack_paw( Mob a = null, dynamic b = null, dynamic c = null ) {
			this.attack_hand( a );
			return null;
		}

		// Function from file: teleporter.dm
		public override dynamic examine( dynamic user = null, string size = null ) {
			dynamic locked_area = null;

			base.examine( (object)(user), size );

			if ( Lang13.Bool( this.locked ) ) {
				locked_area = GlobalFuncs.get_area( this.locked );
				GlobalFuncs.to_chat( user, "The destination is set to \"" + locked_area.name + "\"" );
			}
			return null;
		}

		// Function from file: teleporter.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			dynamic C = null;
			dynamic L = null;
			Obj_Effect_Landmark sloc = null;

			
			if ( Lang13.Bool( base.attackby( (object)(a), (object)(b), (object)(c) ) ) ) {
				return 1;
			} else if ( a is Obj_Item_Weapon_Card_Data ) {
				C = a;

				if ( ( this.stat & ( C.function != "teleporter" ?1:0) & 3 ) != 0 ) {
					this.attack_hand();
				}
				L = null;

				foreach (dynamic _a in Lang13.Enumerate( GlobalVars.landmarks_list, typeof(Obj_Effect_Landmark) )) {
					sloc = _a;
					

					if ( sloc.name != C.data ) {
						continue;
					}

					if ( Lang13.Bool( Lang13.FindIn( typeof(Mob_Living), sloc.loc ) ) ) {
						continue;
					}
					L = sloc;
					break;
				}

				if ( !Lang13.Bool( L ) ) {
					L = Lang13.FindObj( "landmark*" + C.data );
				}

				if ( L is Obj_Effect_Landmark && L.loc is Tile ) {
					
					if ( !Lang13.Bool( b.drop_item( a ) ) ) {
						b.WriteMsg( new Txt( "<span class='warning'>You can't let go of " ).the( a ).item().str( "!</span>" ).ToString() );
						return null;
					}
					GlobalFuncs.to_chat( Task13.User, "You insert the coordinates into the machine." );
					GlobalFuncs.to_chat( Task13.User, "A message flashes across the screen reminding the traveller that the nuclear authentication disk is to remain on the station at all times." );
					GlobalFuncs.qdel( a );
					this.say( "Locked in" );
					this.locked = L;
					this.one_time_use = true;
					this.add_fingerprint( Task13.User );
				}
			}
			return null;
		}

		// Function from file: teleporter.dm
		[Verb]
		[VerbInfo( name: "Set teleporter ID", desc: "ID Tag:", group: "Object", access: VerbAccess.InViewExcludeThis, range: 1 )]
		[VerbArg( 1, InputType.Str )]
		public void set_id( dynamic t = null ) {
			
			if ( ( this.stat & 3 ) != 0 || !( Task13.User is Mob_Living ) ) {
				return;
			}

			if ( Lang13.Bool( t ) ) {
				this.id = t;
			}
			return;
		}

	}

}