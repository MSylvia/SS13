// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Device_ReagentScanner : Obj_Item_Device {

		public bool details = false;
		public bool recent_fail = false;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.item_state = "analyzer";
			this.w_class = 2;
			this.slot_flags = 512;
			this.throwforce = 5;
			this.throw_speed = 4;
			this.throw_range = 20;
			this.starting_materials = new ByTable().Set( "$iron", 30 ).Set( "$glass", 20 );
			this.w_type = 5;
			this.origin_tech = "magnets=2;biotech=2";
			this.icon_state = "spectrometer";
		}

		public Obj_Item_Device_ReagentScanner ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: scanners.dm
		public override bool afterattack( dynamic A = null, dynamic user = null, bool? flag = null, dynamic _params = null, bool? struggle = null ) {
			bool _default = false;

			string dat = null;
			Reagent R = null;
			double reagent_percent = 0;

			_default = base.afterattack( (object)(A), (object)(user), flag, (object)(_params), struggle );

			if ( _default ) {
				return _default;
			}

			if ( !( A is Obj ) ) {
				return _default;
			}

			if ( !Lang13.Bool( user.dexterity_check() ) ) {
				GlobalFuncs.to_chat( user, "<span class='warning'>You don't have the dexterity to do this!</span>" );
				return _default;
			}

			if ( Lang13.Bool( A.reagents ) ) {
				dat = "";

				if ( A.reagents.reagent_list.len != 0 ) {
					
					foreach (dynamic _a in Lang13.Enumerate( A.reagents.reagent_list, typeof(Reagent) )) {
						R = _a;
						
						reagent_percent = ( R.volume ??0) / ( A.reagents.total_volume ??0) * 100;
						dat += "<br><span class='notice'>" + R + " " + ( this.details ? "(" + R.volume + " units, " + reagent_percent + "%)" : "" ) + "</span>";
					}
				}

				if ( Lang13.Bool( dat ) ) {
					GlobalFuncs.to_chat( user, new Txt( "<span class='notice'>Chemicals found in " ).the( A ).item().str( ":" ).item( dat ).str( "</span>" ).ToString() );
				} else {
					GlobalFuncs.to_chat( user, new Txt( "<span class='notice'>No active chemical agents found in " ).the( A ).item().str( ".</span>" ).ToString() );
				}
			}
			return _default;
		}

	}

}