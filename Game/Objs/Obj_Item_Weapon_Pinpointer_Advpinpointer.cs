// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_Pinpointer_Advpinpointer : Obj_Item_Weapon_Pinpointer {

		public int mode = 0;
		public Tile location = null;
		public dynamic target = null;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.watches_nuke = false;
		}

		public Obj_Item_Weapon_Pinpointer_Advpinpointer ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: pinpointer.dm
		public override dynamic process(  ) {
			
			switch ((int)( this.mode )) {
				case 0:
					this.workdisk();
					break;
				case 1:
					this.point_at( this.location );
					break;
				case 2:
					this.point_at( this.target );
					break;
			}
			return null;
		}

		// Function from file: pinpointer.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			
			if ( !this.active ) {
				this.active = true;
				GlobalVars.processing_objects.Add( this );
				this.process();
				GlobalFuncs.to_chat( Task13.User, "<span class='notice'>You activate the pinpointer</span>" );
			} else {
				GlobalVars.processing_objects.Remove( this );
				this.active = false;
				this.icon_state = "pinoff";
				GlobalFuncs.to_chat( Task13.User, "<span class='notice'>You deactivate the pinpointer</span>" );
			}
			return null;
		}

		// Function from file: pinpointer.dm
		[Verb]
		[VerbInfo( name: "Toggle Pinpointer Mode", group: "Object", access: VerbAccess.InView, range: 1 )]
		public dynamic toggle_mode(  ) {
			dynamic locationx = null;
			dynamic locationy = null;
			dynamic Z = null;
			ByTable item_names = null;
			ByTable item_paths = null;
			dynamic typepath = null;
			dynamic tmp_object = null;
			string n = null;
			dynamic targetitem = null;
			dynamic DNAstring = null;
			Mob_Living_Carbon M = null;

			this.active = false;
			this.icon_state = "pinoff";
			this.target = null;
			this.location = null;

			switch ((string)( Interface13.Alert( "Please select the mode you want to put the pinpointer in.", "Pinpointer Mode Select", "Location", "Disk Recovery", "Other Signature" ) )) {
				case "Location":
					this.mode = 1;
					locationx = Interface13.Input( Task13.User, "Please input the x coordinate to search for.", "Location?", "", null, InputType.Num );

					if ( !Lang13.Bool( locationx ) || !this.Adjacent( Task13.User ) ) {
						return null;
					}
					locationy = Interface13.Input( Task13.User, "Please input the y coordinate to search for.", "Location?", "", null, InputType.Num );

					if ( !Lang13.Bool( locationy ) || !( !this.Adjacent( Task13.User ) ) ) {
						return null;
					}
					Z = GlobalFuncs.get_turf( this );
					this.location = Map13.GetTile( Convert.ToInt32( locationx ), Convert.ToInt32( locationy ), Convert.ToInt32( Z.z ) );
					GlobalFuncs.to_chat( Task13.User, "You set the pinpointer to locate " + locationx + "," + locationy );
					return this.attack_self();
					break;
				case "Disk Recovery":
					this.mode = 0;
					return this.attack_self();
					break;
				case "Other Signature":
					this.mode = 2;

					switch ((string)( Interface13.Alert( "Search for item signature or DNA fragment?", "Signature Mode Select", "", "Item", "DNA" ) )) {
						case "Item":
							item_names = null;
							item_names = new ByTable( 0 );
							item_paths = null;
							item_paths = new ByTable( 0 );

							foreach (dynamic _a in Lang13.Enumerate( GlobalVars.potential_theft_objectives )) {
								typepath = _a;
								
								tmp_object = Lang13.Call( typepath );
								n = "" + tmp_object;
								item_names.Add( n );
								item_paths[n] = typepath;
								GlobalFuncs.qdel( tmp_object );
							}
							targetitem = Interface13.Input( "Select item to search for.", "Item Mode Select", "", null, GlobalVars.potential_theft_objectives, InputType.Null | InputType.Any );

							if ( !Lang13.Bool( targetitem ) ) {
								return null;
							}
							this.target = Lang13.FindObj( item_paths[targetitem] );

							if ( !Lang13.Bool( this.target ) ) {
								GlobalFuncs.to_chat( Task13.User, "Failed to locate " + targetitem + "!" );
								return null;
							}
							GlobalFuncs.to_chat( Task13.User, "You set the pinpointer to locate " + targetitem );
							break;
						case "DNA":
							DNAstring = Interface13.Input( "Input DNA string to search for.", "Please Enter String.", "", null, null, InputType.Any );

							if ( !Lang13.Bool( DNAstring ) ) {
								return null;
							}

							foreach (dynamic _b in Lang13.Enumerate( GlobalVars.mob_list, typeof(Mob_Living_Carbon) )) {
								M = _b;
								

								if ( !( M.dna != null ) ) {
									continue;
								}

								if ( M.dna.unique_enzymes == DNAstring ) {
									this.target = M;
									break;
								}
							}
							break;
					}
					return this.attack_self();
					break;
			}
			return null;
		}

	}

}