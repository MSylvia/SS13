// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_Disease2_Isolator : Obj_Machinery_Disease2 {

		public dynamic virus2 = null;
		public int isolating = 0;
		public dynamic beaker = null;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.anchored = 1;
			this.icon = "icons/obj/virology.dmi";
			this.icon_state = "isolator";
		}

		public Obj_Machinery_Disease2_Isolator ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: isolator.dm
		public override dynamic process(  ) {
			Obj_Item_Weapon_Virusdish d = null;

			
			if ( this.isolating > 0 ) {
				this.isolating -= 1;

				if ( this.isolating == 0 ) {
					d = new Obj_Item_Weapon_Virusdish( this.loc );
					d.virus2 = ((Disease2_Disease)this.virus2).getcopy();
					this.virus2 = null;
					this.icon_state = "isolator_in";
				}
			}
			return null;
		}

		// Function from file: isolator.dm
		public override dynamic attack_hand( dynamic a = null, dynamic b = null, dynamic c = null ) {
			string dat = null;
			Reagents R = null;
			Reagent_Blood G = null;
			dynamic virus = null;
			Disease2_Disease V = null;

			
			if ( ( this.stat & 1 ) != 0 ) {
				return null;
			}
			a.machine = this;
			dat = "";

			if ( !Lang13.Bool( this.beaker ) ) {
				dat = new Txt( "Please insert sample into the isolator.<BR>\n<A href='?src=" ).Ref( this ).str( ";close=1'>Close</A>" ).ToString();
			} else if ( this.isolating != 0 ) {
				dat = "Isolating";
			} else {
				R = this.beaker.reagents;
				dat += new Txt( "<A href='?src=" ).Ref( this ).str( ";eject=1'>Eject</A><BR><BR>" ).ToString();

				if ( !Lang13.Bool( R.total_volume ) ) {
					dat += "" + this.beaker + " is empty.";
				} else {
					dat += "Contained reagents:<ul>";

					foreach (dynamic _b in Lang13.Enumerate( R.reagent_list, typeof(Reagent_Blood) )) {
						G = _b;
						

						if ( Lang13.Bool( G.data["virus2"] ) ) {
							virus = G.data["virus2"];

							foreach (dynamic _a in Lang13.Enumerate( virus, typeof(Disease2_Disease) )) {
								V = _a;
								
								dat += new Txt( "<li>" ).item( G.name ).str( ": <A href='?src=" ).Ref( this ).str( ";isolate=" ).item( V.uniqueID ).str( "'>Isolate pathogen #" ).item( V.uniqueID ).str( "</a></li>" ).ToString();
							}
						} else {
							dat += "<li><em>No pathogen</em></li>";
						}
					}
				}
			}
			Interface13.Browse( a, "<TITLE>Pathogenic Isolator</TITLE>Isolator menu:<BR><BR>" + dat + "</ul>", "window=isolator;size=575x400" );
			GlobalFuncs.onclose( a, "isolator" );
			return null;
		}

		// Function from file: isolator.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hclient = null, HtmlInterface currui = null ) {
			dynamic R = null;
			Reagent_Blood Blood = null;
			Reagent_Blood B = null;
			ByTable virus = null;
			double? choice = null;
			Disease2_Disease V = null;

			
			if ( Lang13.Bool( base.Topic( href, href_list, (object)(hclient) ) ) ) {
				return null;
			}
			Task13.User.machine = this;

			if ( !Lang13.Bool( this.beaker ) ) {
				return null;
			}
			R = this.beaker.reagents;

			if ( Lang13.Bool( href_list["isolate"] ) ) {
				
				foreach (dynamic _a in Lang13.Enumerate( R.reagent_list, typeof(Reagent_Blood) )) {
					B = _a;
					

					if ( B != null && Lang13.Bool( B.data["virus2"] ) ) {
						Blood = B;
						break;
					}
				}

				if ( !( Blood != null ) ) {
					GlobalFuncs.to_chat( Task13.User, "<span class='warning'>ERROR: Unable to locate blood within the beaker.  Bug?</span>" );
					Game13.log.WriteMsg( "## TESTING: " + ( "Unable to locate blood in " + this.beaker + "!" ) );
					return null;
				}
				virus = GlobalFuncs.virus_copylist( Blood.data["virus2"] );
				choice = String13.ParseNumber( href_list["isolate"] );

				foreach (dynamic _b in Lang13.Enumerate( virus, typeof(Disease2_Disease) )) {
					V = _b;
					

					if ( V.uniqueID == choice ) {
						this.virus2 = virus;
						this.isolating = 40;
						this.icon_state = "isolator_processing";
					}
				}
				this.updateUsrDialog();
				return null;
			} else if ( Lang13.Bool( href_list["main"] ) ) {
				this.attack_hand( Task13.User );
				return null;
			} else if ( Lang13.Bool( href_list["eject"] ) ) {
				this.beaker.loc = this.loc;
				this.beaker = null;
				this.icon_state = "isolator";
				this.updateUsrDialog();
				return null;
			}
			return null;
		}

		// Function from file: isolator.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			dynamic B = null;

			
			if ( !( a is Obj_Item_Weapon_ReagentContainers_Syringe ) ) {
				return null;
			}
			B = a;

			if ( Lang13.Bool( this.beaker ) ) {
				GlobalFuncs.to_chat( b, "A syringe is already loaded into the machine." );
				return null;
			}

			if ( Lang13.Bool( b.drop_item( B, this ) ) ) {
				this.beaker = B;

				if ( B is Obj_Item_Weapon_ReagentContainers_Syringe ) {
					GlobalFuncs.to_chat( b, "You add the syringe to the machine!" );
					this.updateUsrDialog();
					this.icon_state = "isolator_in";
				}
			}
			return null;
		}

	}

}