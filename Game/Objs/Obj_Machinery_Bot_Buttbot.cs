// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_Bot_Buttbot : Obj_Machinery_Bot {

		public int buttchance = 80;
		public int sincelastfart = 0;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.health = 25;
			this.maxhealth = 25;
			this.flags = 16;
			this.icon_state = "buttbot";
			this.layer = 5;
		}

		public Obj_Machinery_Bot_Buttbot ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: buttbot.dm
		public override void explode(  ) {
			dynamic Tsec = null;
			Effect_Effect_System_SparkSpread s = null;

			this.on = false;
			this.visible_message( "<span class='danger'>" + this + " blows apart!</span>", 1 );
			GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/effects/superfart.ogg", 50, 1 );
			Tsec = GlobalFuncs.get_turf( this );
			new Obj_Item_Clothing_Head_Butt( Tsec );

			if ( Rand13.PercentChance( 50 ) ) {
				new Obj_Item_RobotParts_LArm( Tsec );
			}
			s = new Effect_Effect_System_SparkSpread();
			s.set_up( 3, 1, this );
			s.start();
			new Obj_Effect_Decal_Cleanable_Blood_Oil( this.loc );
			GlobalFuncs.qdel( this );
			return;
		}

		// Function from file: buttbot.dm
		public override dynamic Hear( dynamic speech = null, dynamic rendered_speech = null, params object[] _ ) {
			ByTable _args = new ByTable( new object[] { speech, rendered_speech } ).Extend(_);

			ByTable split_phrase = null;
			ByTable prepared_words = null;
			int i = 0;
			dynamic word = null;
			int index = 0;

			
			if ( _args[2] == null ) {
				_args[2] = "";
			}

			if ( Rand13.PercentChance( this.buttchance ) && !( String13.FindIgnoreCase( _args[1].message, "butt", 1, 0 ) != 0 ) ) {
				split_phrase = GlobalFuncs.text2list( _args[1].message, " " );
				prepared_words = split_phrase.Copy();
				i = Rand13.Int( 1, 3 );

				while (i > 0) {
					
					if ( !( prepared_words.len != 0 ) ) {
						break;
					}
					word = Rand13.PickFromTable( prepared_words );
					prepared_words.Remove( word );
					index = split_phrase.Find( word );
					split_phrase[index] = "butt";
					i--;
				}
				this.say( GlobalFuncs.list2text( split_phrase, " " ), _args[1].language );
			}
			return null;
		}

		// Function from file: buttbot.dm
		public void speak( string message = null ) {
			dynamic O = null;

			
			if ( !this.on || !Lang13.Bool( message ) ) {
				return;
			}

			foreach (dynamic _a in Lang13.Enumerate( Map13.FetchHearers( null, this ) )) {
				O = _a;
				
				O.show_message( "<b>" + this + "</b> beeps, '" + message + "'" );
			}
			return;
		}

		// Function from file: buttbot.dm
		public override dynamic attack_hand( dynamic a = null, dynamic b = null, dynamic c = null ) {
			dynamic _default = null;

			_default = base.attack_hand( (object)(a), (object)(b), (object)(c) );

			if ( Lang13.Bool( _default ) ) {
				return _default;
			}

			if ( this.sincelastfart + 5 < Game13.timeofday ) {
				this.speak( "butt" );
				GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/misc/fart.ogg", 50, 1 );
				this.sincelastfart = Game13.timeofday;
			}
			return _default;
		}

	}

}