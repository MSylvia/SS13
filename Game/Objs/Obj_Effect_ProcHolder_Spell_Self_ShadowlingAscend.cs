// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_ProcHolder_Spell_Self_ShadowlingAscend : Obj_Effect_ProcHolder_Spell_Self {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.panel = "Shadowling Evolution";
			this.charge_max = 3000;
			this.clothes_req = 0;
			this.action_icon_state = "ascend";
		}

		public Obj_Effect_ProcHolder_Spell_Self_ShadowlingAscend ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: special_shadowling_abilities.dm
		public override bool cast( dynamic targets = null, dynamic thearea = null, dynamic user = null ) {
			thearea = thearea ?? Task13.User;

			dynamic H = null;
			string hatch_or_no = null;
			Obj_Item I = null;
			Mob_Living M = null;
			Obj_Machinery_Power_Apc A = null;
			Mob_Living_SimpleAnimal_AscendantShadowling A2 = null;
			Obj_Effect_ProcHolder_Spell S = null;

			H = thearea;

			if ( !this.shadowling_check( H ) ) {
				return false;
			}
			hatch_or_no = Interface13.Alert( H, "It is time to ascend. Are you sure about this?", null, "Yes", "No" );

			switch ((string)( hatch_or_no )) {
				case "No":
					H.WriteMsg( "<span class='warning'>You decide against ascending for now." );
					this.charge_counter = this.charge_max;
					return false;
					break;
				case "Yes":
					H.notransform = 1;
					((Ent_Static)H).visible_message( "<span class='warning'>" + H + "'s things suddenly slip off. They gently rise into the air, red light glowing in their eyes.</span>", "<span class='shadowling'>You rise into the air and get ready for your transformation.</span>" );

					foreach (dynamic _d in Lang13.Enumerate( H, typeof(Obj_Item) )) {
						I = _d;
						
						((Mob)H).unEquip( I );
						Task13.Sleep( 50 );
						((Ent_Static)H).visible_message( "<span class='warning'>" + H + "'s skin begins to crack and harden.</span>", "<span class='shadowling'>Your flesh begins creating a shield around yourself.</span>" );
						Task13.Sleep( 100 );
						((Ent_Static)H).visible_message( "<span class='warning'>The small horns on " + H + "'s head slowly grow and elongate.</span>", "<span class='shadowling'>Your body continues to mutate. Your telepathic abilities grow.</span>" );
						Task13.Sleep( 90 );
						((Ent_Static)H).visible_message( "<span class='warning'>" + H + "'s body begins to violently stretch and contort.</span>", "<span class='shadowling'>You begin to rend apart the final barriers to godhood.</span>" );
						Task13.Sleep( 40 );
						H.WriteMsg( "<i><b>Yes!</b></i>" );
						Task13.Sleep( 10 );
						H.WriteMsg( "<i><b><span class='big'>YES!!</span></b></i>" );
						Task13.Sleep( 10 );
						H.WriteMsg( "<i><b><span class='reallybig'>YE--</span></b></i>" );
						Task13.Sleep( 1 );

						foreach (dynamic _a in Lang13.Enumerate( Map13.FetchInRangeExcludeThis( H, 7 ), typeof(Mob_Living) )) {
							M = _a;
							
							M.Weaken( 10 );
							M.WriteMsg( "<span class='userdanger'>An immense pressure slams you onto the ground!</span>" );
						}
						Game13.WriteMsg( "<font size=5><span class='shadowling'><b>\"VYSHA NERADA YEKHEZET U'RUU!!\"</font></span>" );
						Game13.WriteMsg( "sound/hallucinations/veryfar_noise.ogg" );

						foreach (dynamic _b in Lang13.Enumerate( GlobalVars.apcs_list, typeof(Obj_Machinery_Power_Apc) )) {
							A = _b;
							
							A.overload_lighting();
						}
						A2 = new Mob_Living_SimpleAnimal_AscendantShadowling( H.loc );

						foreach (dynamic _c in Lang13.Enumerate( H.mind.spell_list, typeof(Obj_Effect_ProcHolder_Spell) )) {
							S = _c;
							

							if ( S == this ) {
								continue;
							}
							((Mind)H.mind).remove_spell( S );
						}
						H.mind.AddSpell( new Obj_Effect_ProcHolder_Spell_Targeted_Annihilate( null ) );
						H.mind.AddSpell( new Obj_Effect_ProcHolder_Spell_Targeted_Hypnosis( null ) );
						H.mind.AddSpell( new Obj_Effect_ProcHolder_Spell_Self_ShadowlingPhaseShift( null ) );
						H.mind.AddSpell( new Obj_Effect_ProcHolder_Spell_AoeTurf_AscendantStorm( null ) );
						H.mind.AddSpell( new Obj_Effect_ProcHolder_Spell_Self_ShadowlingHivemindAscendant( null ) );
						((Mind)H.mind).transfer_to( A2 );
						A2.name = H.real_name;

						if ( Lang13.Bool( A2.real_name ) ) {
							A2.real_name = H.real_name;
						}
						H.invisibility = 60;
						H.loc = A2;
						Task13.Sleep( 50 );

						if ( !GlobalVars.ticker.mode.shadowling_ascended ) {
							GlobalVars.SSshuttle.emergency.request( null, 0.3 );
						}
						GlobalVars.ticker.mode.shadowling_ascended = true;
						A2.mind.remove_spell( this );
						GlobalFuncs.qdel( H );
					}
					break;
			}
			return false;
		}

	}

}