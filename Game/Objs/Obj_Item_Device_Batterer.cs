// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Device_Batterer : Obj_Item_Device {

		public int times_used = 0;
		public int max_uses = 2;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.throwforce = 5;
			this.w_class = 1;
			this.throw_speed = 4;
			this.throw_range = 10;
			this.item_state = "electronic";
			this.origin_tech = "magnets=3;combat=3;syndicate=3";
			this.icon_state = "batterer";
		}

		public Obj_Item_Device_Batterer ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: traitordevices.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			flag = flag ?? 0;
			emp = emp ?? false;

			Mob_Living_Carbon_Human M = null;

			
			if ( !Lang13.Bool( user ) ) {
				return null;
			}

			if ( this.times_used >= this.max_uses ) {
				GlobalFuncs.to_chat( user, "<span class='warning'>The mind batterer has been burnt out!</span>" );
				return null;
			}
			user.attack_log.Add( "[" + GlobalFuncs.time_stamp() + "] <font color='red'>Used " + this + " to knock down people in the area.</font>" );

			foreach (dynamic _a in Lang13.Enumerate( Map13.FetchInRangeExcludeThis( user, 10 ), typeof(Mob_Living_Carbon_Human) )) {
				M = _a;
				
				Task13.Schedule( 0, (Task13.Closure)(() => {
					
					if ( Rand13.PercentChance( 50 ) ) {
						M.Weaken( Rand13.Int( 10, 20 ) );

						if ( Rand13.PercentChance( 25 ) ) {
							M.Stun( Rand13.Int( 5, 10 ) );
						}
						GlobalFuncs.to_chat( M, "<span class='danger'>You feel a tremendous, paralyzing wave flood your mind.</span>" );

						if ( !( user is Mob_Living_Carbon ) ) {
							M.LAssailant = null;
						} else {
							M.LAssailant = user;
						}
					} else {
						GlobalFuncs.to_chat( M, "<span class='danger'>You feel a sudden, electric jolt travel through your head.</span>" );
					}
					return;
				}));
			}
			GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/misc/interference.ogg", 50, 1 );
			GlobalFuncs.to_chat( user, "<span class='notice'>You trigger " + this + ".</span>" );
			this.times_used += 1;

			if ( this.times_used >= this.max_uses ) {
				this.icon_state = "battererburnt";
			}
			return null;
		}

	}

}