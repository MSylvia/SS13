// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_Tray : Obj_Item_Weapon {

		public ByTable carrying = new ByTable();
		public int cooldown = 0;
		public double max_carry = 10;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.throwforce = 10;
			this.force = 5;
			this.throw_speed = 1;
			this.throw_range = 5;
			this.starting_materials = new ByTable().Set( "$iron", 3000 );
			this.w_type = 4;
			this.melt_temperature = 1783.1500244140625;
			this.icon = "icons/obj/food.dmi";
			this.icon_state = "tray";
		}

		public Obj_Item_Weapon_Tray ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: kitchen.dm
		public override dynamic throw_impact( dynamic hit_atom = null, dynamic speed = null, Mob user = null ) {
			
			if ( hit_atom is Tile ) {
				this.whoops();
			}
			base.throw_impact( (object)(hit_atom), (object)(speed), user );
			return null;
		}

		// Function from file: kitchen.dm
		public override dynamic dropped( dynamic user = null ) {
			Obj_Structure_Table T = null;

			Task13.Schedule( 0, (Task13.Closure)(() => {
				
				if ( this.throwing != 0 ) {
					base.dropped( (object)(user) ); return;
				}

				if ( this.loc is Tile ) {
					
					foreach (dynamic _a in Lang13.Enumerate( this.loc, typeof(Obj_Structure_Table) )) {
						T = _a;
						
						this.remove_items();
						base.dropped( (object)(user) ); return;
					}
					this.whoops();
				}
				base.dropped( (object)(user) );
				return;
			}));
			return null;
		}

		// Function from file: kitchen.dm
		public override dynamic prepickup( Mob user = null ) {
			Obj_Item I = null;
			int add = 0;
			Image image = null;

			base.prepickup( user );

			if ( !( this.loc is Tile ) ) {
				return null;
			}

			foreach (dynamic _a in Lang13.Enumerate( this.loc, typeof(Obj_Item) )) {
				I = _a;
				

				if ( I != this && !Lang13.Bool( I.anchored ) && !GlobalFuncs.is_type_in_list( I, new ByTable(new object [] { typeof(Obj_Item_Clothing_Under), typeof(Obj_Item_Clothing_Suit), typeof(Obj_Item_Projectile), typeof(Obj_Item_Weapon_Tray) }) ) ) {
					add = 0;

					if ( I.w_class == 1 ) {
						add = 1;
					} else if ( I.w_class == 2 ) {
						add = 3;
					} else if ( I.w_class == 3 ) {
						add = 5;
					} else {
						continue;
					}

					if ( this.calc_carry() + add >= this.max_carry ) {
						break;
					}
					I.loc = this;
					this.carrying.Add( I );
					image = new Image( null );
					image.appearance = I.appearance;
					image.layer = I.layer + 30;
					this.overlays.Add( image );
				}
			}
			return null;
		}

		// Function from file: kitchen.dm
		public void whoops(  ) {
			
			if ( Rand13.PercentChance( 50 ) ) {
				GlobalFuncs.playsound( this, "sound/items/trayhit1.ogg", 35, 1 );
			} else {
				GlobalFuncs.playsound( this, "sound/items/trayhit2.ogg", 35, 1 );
			}
			this.send_items_flying();
			return;
		}

		// Function from file: kitchen.dm
		public void send_items_flying(  ) {
			Obj_Item I = null;

			this.overlays.len = 0;

			foreach (dynamic _a in Lang13.Enumerate( this.carrying, typeof(Obj_Item) )) {
				I = _a;
				
				I.forceMove( GlobalFuncs.get_turf( this ) );
				this.carrying.Remove( I );
				Task13.Schedule( Rand13.Int( 1, 3 ), (Task13.Closure)(() => {
					
					if ( I != null && Rand13.PercentChance( 75 ) ) {
						Map13.Step( I, Convert.ToInt32( Rand13.PickFromTable( GlobalVars.alldirs ) ) );
					}
					return;
				}));
			}
			return;
		}

		// Function from file: kitchen.dm
		public void remove_items(  ) {
			Obj_Item I = null;

			this.overlays.len = 0;

			foreach (dynamic _a in Lang13.Enumerate( this.carrying, typeof(Obj_Item) )) {
				I = _a;
				
				I.forceMove( GlobalFuncs.get_turf( this ) );
				this.carrying.Remove( I );
			}
			return;
		}

		// Function from file: kitchen.dm
		public double calc_carry(  ) {
			double val = 0;
			Obj_Item I = null;

			val = 0;

			foreach (dynamic _a in Lang13.Enumerate( this.carrying, typeof(Obj_Item) )) {
				I = _a;
				

				if ( I.w_class == 1 ) {
					val++;
				} else if ( I.w_class == 2 ) {
					val += 3;
				} else if ( I.w_class == 3 ) {
					val += 5;
				} else {
					val += Double.PositiveInfinity;
				}
			}
			return val;
		}

		// Function from file: kitchen.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			
			if ( a is Obj_Item_Weapon_Kitchen_Rollingpin ) {
				
				if ( this.cooldown < Game13.time - 25 ) {
					((Ent_Static)b).visible_message( "<span class='warning'>" + b + " bashes " + this + " with " + a + "!</span>" );
					GlobalFuncs.playsound( b.loc, "sound/effects/shieldbash.ogg", 50, 1 );
					this.cooldown = Game13.time;
				}
			} else {
				base.attackby( (object)(a), (object)(b), (object)(c) );
			}
			return null;
		}

		// Function from file: kitchen.dm
		public override bool? attack( dynamic M = null, dynamic user = null, string def_zone = null, bool? eat_override = null ) {
			dynamic H = null;
			Ent_Static location = null;
			dynamic O = null;
			dynamic O2 = null;
			Ent_Static location2 = null;
			dynamic O3 = null;
			dynamic O4 = null;
			Ent_Static location3 = null;
			dynamic O5 = null;
			dynamic O6 = null;

			this.send_items_flying();

			if ( Lang13.Bool( user.mutations.Contains( 5 ) ) && Rand13.PercentChance( 50 ) ) {
				GlobalFuncs.to_chat( M, "<span class='warning'>You accidentally slam yourself with the " + this + "!</span>" );
				((Mob)M).Weaken( 1 );
				((Mob_Living)user).take_organ_damage( 2 );

				if ( Rand13.PercentChance( 50 ) ) {
					GlobalFuncs.playsound( M, "sound/items/trayhit1.ogg", 50, 1 );
					return null;
				} else {
					GlobalFuncs.playsound( M, "sound/items/trayhit2.ogg", 50, 1 );
					return null;
				}
			}
			H = M;

			if ( !( ((dynamic)user.zone_sel).selecting == "eyes" ) ) {
				
				if ( Rand13.PercentChance( 33 ) ) {
					this.add_blood( H );
					location = H.loc;

					if ( location is Tile_Simulated ) {
						location.add_blood( H );
					}
				}
				M.attack_log.Add( "[" + GlobalFuncs.time_stamp() + "] <font color='orange'>Has been attacked with " + this.name + " by " + user.name + " (" + user.ckey + ")</font>" );
				user.attack_log.Add( "[" + GlobalFuncs.time_stamp() + "] <font color='red'>Used the " + this.name + " to attack " + M.name + " (" + M.ckey + ")</font>" );
				GlobalVars.diaryofmeanpeople.WriteMsg( String13.HtmlDecode( "[" + GlobalFuncs.time_stamp() + "]ATTACK: " + ( "<font color='red'>" + user.name + " (" + user.ckey + ") used the " + this.name + " to attack " + M.name + " (" + M.ckey + ")</font>" ) ) );

				if ( !( user is Mob_Living_Carbon ) ) {
					M.LAssailant = null;
				} else {
					M.LAssailant = user;
				}

				if ( Rand13.PercentChance( 15 ) ) {
					((Mob)M).Weaken( 3 );
					((Mob_Living)M).take_organ_damage( 3 );
				} else {
					((Mob_Living)M).take_organ_damage( 5 );
				}

				if ( Rand13.PercentChance( 50 ) ) {
					GlobalFuncs.playsound( M, "sound/items/trayhit1.ogg", 50, 1 );

					foreach (dynamic _a in Lang13.Enumerate( Map13.FetchViewers( null, M ) )) {
						O = _a;
						
						O.show_message( "<span class='danger'>" + user + " slams " + M + " with the tray!</span>", 1 );
					}
					return null;
				} else {
					GlobalFuncs.playsound( M, "sound/items/trayhit2.ogg", 50, 1 );

					foreach (dynamic _b in Lang13.Enumerate( Map13.FetchViewers( null, M ) )) {
						O2 = _b;
						
						O2.show_message( "<span class='danger'>" + user + " slams " + M + " with the tray!</span>", 1 );
					}
					return null;
				}
			}

			if ( M is Mob_Living_Carbon_Human && ((Mob_Living_Carbon_Human)H).check_body_part_coverage( 2048 ) ) {
				GlobalFuncs.to_chat( H, "<span class='warning'>You get slammed in the face with the tray, against your mask!</span>" );

				if ( Rand13.PercentChance( 33 ) ) {
					this.add_blood( H );

					if ( Lang13.Bool( H.wear_mask ) ) {
						((Ent_Static)H.wear_mask).add_blood( H );
					}

					if ( Lang13.Bool( H.head ) ) {
						((Ent_Static)H.head).add_blood( H );
					}

					if ( Lang13.Bool( H.glasses ) && Rand13.PercentChance( 33 ) ) {
						((Ent_Static)H.glasses).add_blood( H );
					}
					location2 = H.loc;

					if ( location2 is Tile_Simulated ) {
						location2.add_blood( H );
					}
				}

				if ( Rand13.PercentChance( 50 ) ) {
					GlobalFuncs.playsound( M, "sound/items/trayhit1.ogg", 50, 1 );

					foreach (dynamic _c in Lang13.Enumerate( Map13.FetchViewers( null, M ) )) {
						O3 = _c;
						
						O3.show_message( "<span class='danger'>" + user + " slams " + M + " with the tray!</span>", 1 );
					}
				} else {
					GlobalFuncs.playsound( M, "sound/items/trayhit2.ogg", 50, 1 );

					foreach (dynamic _d in Lang13.Enumerate( Map13.FetchViewers( null, M ) )) {
						O4 = _d;
						
						O4.show_message( "<span class='danger'>" + user + " slams " + M + " with the tray!</span>", 1 );
					}
				}

				if ( Rand13.PercentChance( 10 ) ) {
					((Mob)M).Stun( Rand13.Int( 1, 3 ) );
					((Mob_Living)M).take_organ_damage( 3 );
					return null;
				} else {
					((Mob_Living)M).take_organ_damage( 5 );
					return null;
				}
			} else {
				GlobalFuncs.to_chat( M, "<span class='warning'>You get slammed in the face with the tray!</span>" );

				if ( Rand13.PercentChance( 33 ) ) {
					this.add_blood( M );
					location3 = H.loc;

					if ( location3 is Tile_Simulated ) {
						location3.add_blood( H );
					}
				}

				if ( Rand13.PercentChance( 50 ) ) {
					GlobalFuncs.playsound( M, "sound/items/trayhit1.ogg", 50, 1 );

					foreach (dynamic _e in Lang13.Enumerate( Map13.FetchViewers( null, M ) )) {
						O5 = _e;
						
						O5.show_message( "<span class='danger'>" + user + " slams " + M + " in the face with the tray!</span>", 1 );
					}
				} else {
					GlobalFuncs.playsound( M, "sound/items/trayhit2.ogg", 50, 1 );

					foreach (dynamic _f in Lang13.Enumerate( Map13.FetchViewers( null, M ) )) {
						O6 = _f;
						
						O6.show_message( "<span class='danger'>" + user + " slams " + M + " in the face with the tray!</span>", 1 );
					}
				}

				if ( Rand13.PercentChance( 30 ) ) {
					((Mob)M).Stun( Rand13.Int( 2, 4 ) );
					((Mob_Living)M).take_organ_damage( 4 );
					return null;
				} else {
					((Mob_Living)M).take_organ_damage( 8 );

					if ( Rand13.PercentChance( 30 ) ) {
						((Mob)M).Weaken( 2 );
						return null;
					}
					return null;
				}
			}
			return null;
		}

		// Function from file: kitchen.dm
		public override dynamic Destroy( dynamic brokenup = null ) {
			Ent_Static thing = null;

			
			foreach (dynamic _a in Lang13.Enumerate( this.carrying, typeof(Ent_Static) )) {
				thing = _a;
				
				GlobalFuncs.qdel( thing );
			}
			this.carrying = null;
			base.Destroy( (object)(brokenup) );
			return null;
		}

	}

}