// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_Computer : Obj_Machinery {

		public dynamic circuit = null;
		public bool processing = false;
		public int brightness_on = 2;
		public string icon_keyboard = "generic_key";
		public string icon_screen = "generic";

		protected override void __FieldInit() {
			base.__FieldInit();

			this.anchored = 1;
			this.idle_power_usage = 300;
			this.active_power_usage = 300;
			this.icon = "icons/obj/computer.dmi";
			this.icon_state = "computer";
		}

		// Function from file: computer.dm
		public Obj_Machinery_Computer ( dynamic location = null, dynamic C = null ) : base( (object)(location) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;

			if ( Lang13.Bool( C ) && C is Obj_Item_Weapon_Circuitboard ) {
				this.circuit = C;
			} else if ( Lang13.Bool( this.circuit ) ) {
				this.circuit = Lang13.Call( this.circuit, null );
			}
			this.power_change();
			this.update_icon();
			return;
		}

		// Function from file: computer.dm
		public override bool attack_alien( dynamic user = null ) {
			((Ent_Dynamic)user).do_attack_animation( this );

			if ( Lang13.Bool( this.circuit ) ) {
				
				if ( Rand13.PercentChance( 80 ) ) {
					((Ent_Static)user).visible_message( "<span class='danger'>" + user.name + " smashes the " + this.name + " with its claws.</span>", "<span class='danger'>You smash the " + this.name + " with your claws.</span>", "<span class='italics'>You hear a smashing sound.</span>" );
					this.set_broken();
					return false;
				}
			}
			((Ent_Static)user).visible_message( "<span class='danger'>" + user.name + " smashes against the " + this.name + " with its claws.</span>", "<span class='danger'>You smash against the " + this.name + " with your claws.</span>", "<span class='italics'>You hear a clicking sound.</span>" );
			return false;
		}

		// Function from file: computer.dm
		public override dynamic attack_paw( dynamic a = null, dynamic b = null, dynamic c = null ) {
			((Ent_Dynamic)a).do_attack_animation( this );

			if ( Lang13.Bool( this.circuit ) ) {
				
				if ( Rand13.PercentChance( 10 ) ) {
					((Ent_Static)a).visible_message( "<span class='danger'>" + a.name + " smashes the " + this.name + " with its paws.</span>", "<span class='danger'>You smash the " + this.name + " with your paws.</span>", "<span class='italics'>You hear a smashing sound.</span>" );
					this.set_broken();
					return null;
				}
			}
			((Ent_Static)a).visible_message( "<span class='danger'>" + a.name + " smashes against the " + this.name + " with its paws.</span>", "<span class='danger'>You smash against the " + this.name + " with your paws.</span>", "<span class='italics'>You hear hear a clicking sound.</span>" );
			return null;
		}

		// Function from file: computer.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			Obj_Structure_Computerframe A2 = null;
			Obj C = null;

			
			if ( A is Obj_Item_Weapon_Screwdriver && Lang13.Bool( this.circuit ) && !Lang13.Bool( this.flags & 128 ) ) {
				GlobalFuncs.playsound( this.loc, "sound/items/Screwdriver.ogg", 50, 1 );
				user.WriteMsg( "<span class='notice'> You start to disconnect the monitor...</span>" );

				if ( GlobalFuncs.do_after( user, 20 / A.toolspeed, null, this ) ) {
					A2 = new Obj_Structure_Computerframe( this.loc );
					A2.circuit = this.circuit;
					A2.anchored = 1;
					this.circuit = null;

					foreach (dynamic _a in Lang13.Enumerate( this, typeof(Obj) )) {
						C = _a;
						
						C.loc = this.loc;
					}

					if ( ( this.stat & 1 ) != 0 ) {
						user.WriteMsg( "<span class='notice'>The broken glass falls out.</span>" );
						new Obj_Item_Weapon_Shard( this.loc );
						A2.state = 3;
						A2.icon_state = "3";
					} else {
						user.WriteMsg( "<span class='notice'>You disconnect the monitor.</span>" );
						A2.state = 4;
						A2.icon_state = "4";
					}
					GlobalFuncs.qdel( this );
				}
			}
			return null;
		}

		// Function from file: computer.dm
		public virtual void set_broken(  ) {
			
			if ( Lang13.Bool( this.circuit ) ) {
				this.stat |= 1;
				this.update_icon();
			}
			return;
		}

		// Function from file: computer.dm
		public override void power_change(  ) {
			base.power_change();

			if ( ( this.stat & 2 ) != 0 ) {
				this.SetLuminosity( 0 );
			} else {
				this.SetLuminosity( this.brightness_on );
			}
			this.update_icon();
			return;
		}

		// Function from file: computer.dm
		public override bool update_icon( dynamic new_state = null, dynamic new_icon = null, int? new_px = null, int? new_py = null ) {
			this.overlays.Cut();

			if ( ( this.stat & 2 ) != 0 ) {
				this.overlays.Add( "" + this.icon_keyboard + "_off" );
				return false;
			}
			this.overlays.Add( this.icon_keyboard );

			if ( ( this.stat & 1 ) != 0 ) {
				this.overlays.Add( "" + this.icon_state + "_broken" );
			} else {
				this.overlays.Add( this.icon_screen );
			}
			return false;
		}

		// Function from file: computer.dm
		public override dynamic bullet_act( dynamic P = null, dynamic def_zone = null ) {
			
			if ( Rand13.PercentChance( Convert.ToInt32( P.damage ) ) ) {
				
				if ( P.damage_type == "brute" || P.damage_type == "fire" ) {
					this.set_broken();
				}
			}
			base.bullet_act( (object)(P), (object)(def_zone) );
			return null;
		}

		// Function from file: computer.dm
		public override bool ex_act( double? severity = null, dynamic target = null ) {
			
			if ( target == this ) {
				GlobalFuncs.qdel( this );
				return false;
			}

			switch ((int?)( severity )) {
				case 1:
					GlobalFuncs.qdel( this );
					return false;
					break;
				case 2:
					
					if ( Rand13.PercentChance( 25 ) ) {
						GlobalFuncs.qdel( this );
						return false;
					}

					if ( Rand13.PercentChance( 50 ) ) {
						this.verbs.Cut();
						this.set_broken();
					}
					break;
				case 3:
					
					if ( Rand13.PercentChance( 25 ) ) {
						this.verbs.Cut();
						this.set_broken();
					}
					break;
			}
			return false;
		}

		// Function from file: computer.dm
		public override double emp_act( int severity = 0 ) {
			
			if ( Rand13.PercentChance( ((int)( 20 / severity )) ) ) {
				this.set_broken();
			}
			base.emp_act( severity );
			return 0;
		}

		// Function from file: computer.dm
		public override int? process( dynamic seconds = null ) {
			
			if ( ( this.stat & 3 ) != 0 ) {
				return 0;
			}
			return 1;
		}

		// Function from file: computer.dm
		public override void initialize(  ) {
			this.power_change();
			return;
		}

	}

}