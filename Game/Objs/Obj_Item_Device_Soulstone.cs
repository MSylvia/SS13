// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Device_Soulstone : Obj_Item_Device {

		public string imprinted = "empty";

		protected override void __FieldInit() {
			base.__FieldInit();

			this.item_state = "shard-soulstone";
			this.w_class = 1;
			this.slot_flags = 512;
			this.origin_tech = "bluespace=4;materials=4";
			this.icon = "icons/obj/wizard.dmi";
			this.icon_state = "soulstone";
		}

		public Obj_Item_Device_Soulstone ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: soulstone.dm
		public override dynamic cultify(  ) {
			return null;
		}

		// Function from file: soulstone.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hclient = null, HtmlInterface currui = null ) {
			Mob U = null;
			Mob_Living_SimpleAnimal_Shade A = null;

			U = Task13.User;

			if ( !GlobalFuncs.in_range( this, U ) || U.machine != this ) {
				Interface13.Browse( U, null, "window=aicard" );
				U.unset_machine();
				return null;
			}
			this.add_fingerprint( U );
			U.set_machine( this );

			dynamic _b = href_list["choice"]; // Was a switch-case, sorry for the mess.
			if ( _b=="Close" ) {
				Interface13.Browse( U, null, "window=aicard" );
				U.unset_machine();
				return null;
			} else if ( _b=="Summon" ) {
				
				foreach (dynamic _a in Lang13.Enumerate( this, typeof(Mob_Living_SimpleAnimal_Shade) )) {
					A = _a;
					
					A.status_flags &= 61439;
					A.canmove = true;
					GlobalFuncs.to_chat( A, "<b>You have been released from your prison, but you are still bound to " + U.name + "'s will. Help them suceed in their goals at all costs.</b>" );
					A.loc = U.loc;
					A.__CallVerb("Cancel Camera View" );
					this.icon_state = "soulstone";
				}
			}
			this.attack_self( U );
			return null;
		}

		// Function from file: soulstone.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			string dat = null;
			Mob_Living_SimpleAnimal_Shade A = null;

			
			if ( !GlobalFuncs.in_range( this, user ) ) {
				return null;
			}
			((Mob)user).set_machine( this );
			dat = "<TT><B>Soul Stone</B><BR>";

			foreach (dynamic _a in Lang13.Enumerate( this, typeof(Mob_Living_SimpleAnimal_Shade) )) {
				A = _a;
				
				dat += "Captured Soul: " + A.name + "<br>";
				dat += new Txt( "<A href='byond://?src=" ).Ref( this ).str( ";choice=Summon'>Summon Shade</A>" ).ToString();
				dat += "<br>";
				dat += new Txt( "<a href='byond://?src=" ).Ref( this ).str( ";choice=Close'> Close</a>" ).ToString();
			}
			Interface13.Browse( user, dat, "window=aicard" );
			GlobalFuncs.onclose( user, "aicard" );
			return null;
		}

		// Function from file: soulstone.dm
		public override bool? attack( dynamic M = null, dynamic user = null, string def_zone = null, bool? eat_override = null ) {
			
			if ( !( M is Mob_Living_Carbon_Human ) ) {
				return base.attack( (object)(M), (object)(user), def_zone, eat_override );
			}

			if ( M is Mob_Living_Carbon_Human_Manifested ) {
				GlobalFuncs.to_chat( user, "The soul stone shard seems unable to pull the soul out of that poor manifested ghost back onto our plane." );
				return null;
			}
			GlobalFuncs.add_logs( user, M, "captured " + M.name + "'s soul", null, this );
			this.transfer_soul( "VICTIM", M, user );
			return null;
		}

		// Function from file: soulstone.dm
		public override dynamic Destroy( dynamic brokenup = null ) {
			Mob_Living L = null;

			
			foreach (dynamic _a in Lang13.Enumerate( this, typeof(Mob_Living) )) {
				L = _a;
				
				L.loc = GlobalFuncs.get_turf( this.loc );
			}
			base.Destroy( (object)(brokenup) );
			return null;
		}

	}

}