// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Device_TScanner : Obj_Item_Device {

		public bool on = false;
		public string base_state = "t-ray";
		public bool ray_range = true;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.slot_flags = 512;
			this.w_class = 2;
			this.item_state = "electronic";
			this.starting_materials = new ByTable().Set( "$iron", 150 ).Set( "$glass", 50 );
			this.w_type = 5;
			this.melt_temperature = 453.41;
			this.origin_tech = "magnets=1;engineering=1";
			this.icon_state = "t-ray0";
		}

		public Obj_Item_Device_TScanner ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: scanners.dm
		public override dynamic process(  ) {
			dynamic T = null;
			Obj O = null;
			Ent_Static U = null;
			Mob_Living M = null;
			int oldalpha = 0;
			dynamic M2 = null;

			
			if ( !this.on ) {
				GlobalVars.processing_objects.Remove( this );
				return null;
			}

			foreach (dynamic _c in Lang13.Enumerate( GlobalFuncs.trange( this.ray_range, GlobalFuncs.get_turf( this ) ) )) {
				T = _c;
				

				if ( !( T.intact == true ) ) {
					continue;
				}

				foreach (dynamic _a in Lang13.Enumerate( T.contents, typeof(Obj) )) {
					O = _a;
					

					if ( O.level != 1 ) {
						continue;
					}

					if ( O.invisibility == 101 ) {
						O.invisibility = 0;
						Task13.Schedule( 10, (Task13.Closure)(() => {
							
							if ( O != null ) {
								U = O.loc;

								if ( U != null && Lang13.Bool( ((dynamic)U).intact ) ) {
									O.invisibility = 101;
								}
							}
							return;
						}));
					}
				}

				foreach (dynamic _b in Lang13.Enumerate( T.contents, typeof(Mob_Living) )) {
					M = _b;
					
					oldalpha = M.alpha;

					if ( M.alpha < 255 && M is Mob_Living ) {
						M.alpha = 255;
						Task13.Schedule( 10, (Task13.Closure)(() => {
							
							if ( M != null ) {
								M.alpha = oldalpha;
							}
							return;
						}));
					}
				}
				M2 = Lang13.FindIn( typeof(Mob_Living), T );

				if ( Lang13.Bool( M2 ) && Convert.ToInt32( M2.invisibility ) == 2 ) {
					M2.invisibility = 0;
					Task13.Schedule( 10, (Task13.Closure)(() => {
						
						if ( Lang13.Bool( M2 ) ) {
							M2.invisibility = 45;
						}
						return;
					}));
				}
			}
			return null;
		}

		// Function from file: scanners.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			this.on = !this.on;
			this.icon_state = "" + this.base_state + this.on;

			if ( this.on ) {
				GlobalVars.processing_objects.Add( this );
			}
			return null;
		}

		// Function from file: scanners.dm
		public override dynamic Destroy( dynamic brokenup = null ) {
			
			if ( this.on ) {
				GlobalVars.processing_objects.Remove( this );
			}
			base.Destroy( (object)(brokenup) );
			return null;
		}

	}

}