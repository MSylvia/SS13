// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_Storage_Backpack_Holding : Obj_Item_Weapon_Storage_Backpack {

		public string pshoom = "sound/items/PSHOOM.ogg";
		public string alt_sound = "sound/items/PSHOOM_2.ogg";

		protected override void __FieldInit() {
			base.__FieldInit();

			this.origin_tech = "bluespace=4";
			this.max_w_class = 5;
			this.max_combined_w_class = 35;
			this.icon_state = "holdingpack";
		}

		public Obj_Item_Weapon_Storage_Backpack_Holding ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: backpack.dm
		public override double singularity_act( int? current_size = null, Obj_Singularity S = null ) {
			int dist = 0;

			dist = Num13.MaxInt( ( current_size ??0) - 2, 1 );
			GlobalFuncs.explosion( this.loc, dist, dist * 2, dist * 4 );
			return 0;
		}

		// Function from file: backpack.dm
		public bool failcheck( dynamic user = null ) {
			Obj O = null;

			
			if ( Rand13.PercentChance( ((int)( this.reliability )) ) ) {
				return true;
			}

			if ( Rand13.PercentChance( ((int)( this.reliability )) ) ) {
				user.WriteMsg( "<span class='danger'>The Bluespace portal resists your attempt to add another item.</span>" );
			} else {
				user.WriteMsg( "<span class='danger'>The Bluespace generator malfunctions!</span>" );

				foreach (dynamic _a in Lang13.Enumerate( this.contents, typeof(Obj) )) {
					O = _a;
					
					GlobalFuncs.qdel( O );
				}
				this.crit_fail = true;
				this.icon_state = "brokenpack";
			}
			return false;
		}

		// Function from file: backpack.dm
		public override bool handle_item_insertion( dynamic W = null, bool? prevent_warning = null, dynamic user = null ) {
			prevent_warning = prevent_warning ?? false;

			string safety = null;
			Obj_Singularity singulo = null;

			
			if ( W is Obj_Item_Weapon_Storage_Backpack_Holding && !W.crit_fail ) {
				safety = Interface13.Alert( user, "You feel this may not be the best idea.", "Put in " + this.name + "?", "Proceed", "Abort" );

				if ( safety == "Abort" || !( Map13.GetDistance( this, user ) <= 1 ) || !( this != null ) || !Lang13.Bool( W ) || ((Mob)user).incapacitated() ) {
					return false;
				}
				this.investigate_log( "has become a singularity. Caused by " + user.key, "singulo" );
				user.WriteMsg( "<span class='danger'>The Bluespace interfaces of the two devices catastrophically malfunction!</span>" );
				GlobalFuncs.qdel( W );
				singulo = new Obj_Singularity( GlobalFuncs.get_turf( this ) );
				singulo.energy = 300;
				GlobalFuncs.message_admins( "" + GlobalFuncs.key_name_admin( user ) + " detonated a bag of holding" );
				GlobalFuncs.log_game( "" + GlobalFuncs.key_name( user ) + " detonated a bag of holding" );
				GlobalFuncs.qdel( this );
				singulo.process();
				return false;
			}
			base.handle_item_insertion( (object)(W), prevent_warning, (object)(user) );
			return false;
		}

		// Function from file: backpack.dm
		public override bool content_can_dump( dynamic dest_object = null, Mob user = null ) {
			
			if ( this.Adjacent( user ) ) {
				
				if ( Map13.GetDistance( user, dest_object ) < 8 ) {
					
					if ( ((Ent_Static)dest_object).storage_contents_dump_act( this, user ) ) {
						
						if ( Lang13.Bool( this.alt_sound ) && Rand13.PercentChance( 1 ) ) {
							GlobalFuncs.playsound( this, this.alt_sound, 40, 1 );
						} else {
							GlobalFuncs.playsound( this, this.pshoom, 40, 1 );
						}
						user.Beam( dest_object, "rped_upgrade", "icons/effects/effects.dmi", 5 );
						return true;
					}
				}
				user.WriteMsg( "The " + this.name + " buzzes." );
				GlobalFuncs.playsound( this, "sound/machines/buzz-sigh.ogg", 50, 0 );
			}
			return false;
		}

		// Function from file: backpack.dm
		public override bool can_be_inserted( dynamic W = null, bool? stop_messages = null, dynamic user = null ) {
			stop_messages = stop_messages ?? false;

			
			if ( this.crit_fail ) {
				user.WriteMsg( "<span class='danger'>The Bluespace generator isn't working.</span>" );
				return false;
			}
			return base.can_be_inserted( (object)(W), stop_messages, (object)(user) );
		}

		// Function from file: backpack.dm
		public override int suicide_act( Mob_Living_Carbon_Human user = null ) {
			user.visible_message( new Txt( "<span class='suicide'>" ).item( user ).str( " is jumping into " ).item( this ).str( "! It looks like " ).he_she_it_they().str( "'s trying to commit suicide.</span>" ).ToString() );
			user.drop_item();
			user.Stun( 5 );
			Task13.Sleep( 20 );
			GlobalFuncs.playsound( this, "rustle", 50, 1, -5 );
			GlobalFuncs.qdel( user );
			return 0;
		}

	}

}