// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_Power_Battery_Smes : Obj_Machinery_Power_Battery {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.starting_terminal = true;
		}

		// Function from file: smes.dm
		public Obj_Machinery_Power_Battery_Smes ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.component_parts = new ByTable(new object [] { 
				new Obj_Item_Weapon_Circuitboard_Smes(), 
				new Obj_Item_Weapon_StockParts_Capacitor(), 
				new Obj_Item_Weapon_StockParts_Capacitor(), 
				new Obj_Item_Weapon_StockParts_Capacitor(), 
				new Obj_Item_Weapon_StockParts_Capacitor(), 
				new Obj_Item_Weapon_StockParts_MicroLaser(), 
				new Obj_Item_Weapon_StockParts_MicroLaser(), 
				new Obj_Item_Weapon_StockParts_MicroLaser(), 
				new Obj_Item_Weapon_StockParts_MicroLaser(), 
				new Obj_Item_Weapon_StockParts_ConsoleScreen(), 
				new Obj_Item_Weapon_StockParts_ConsoleScreen()
			 });
			this.RefreshParts();

			if ( GlobalVars.ticker != null ) {
				this.initialize();
			}
			return;
		}

		// Function from file: smes.dm
		public override bool add_load( dynamic amount = null ) {
			
			if ( this.terminal != null ) {
				this.terminal.add_load( amount );
			}
			return false;
		}

		// Function from file: smes.dm
		public override dynamic surplus(  ) {
			
			if ( this.terminal != null ) {
				return this.terminal.surplus();
			}
			return 0;
		}

		// Function from file: smes.dm
		public override bool can_attach_terminal( dynamic user = null ) {
			return base.can_attach_terminal( (object)(user) ) && this.panel_open;
		}

		// Function from file: smes.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			dynamic CC = null;
			dynamic T = null;
			Effect_Effect_System_SparkSpread s = null;

			
			if ( a is Obj_Item_Weapon_Crowbar && this.panel_open && this.terminal != null ) {
				GlobalFuncs.to_chat( b, "<span class='warning'>You must first cut the terminal from the SMES!</span>" );
				return 1;
			}

			if ( Lang13.Bool( base.attackby( (object)(a), (object)(b), (object)(c) ) ) ) {
				return 1;
			}

			if ( this.panel_open ) {
				
				if ( a is Obj_Item_Stack_CableCoil && !( this.terminal != null ) ) {
					CC = a;

					if ( Convert.ToDouble( CC.amount ) < 10 ) {
						GlobalFuncs.to_chat( b, "<span class=\"warning\">You need 10 length cable coil to make a terminal.</span>" );
						return null;
					}

					if ( this.make_terminal( b ) ) {
						CC.use( 10 );
						this.terminal.connect_to_network();
						((Ent_Static)b).visible_message( "<span class='warning'>" + b.name + " has added cables to the SMES!</span>", "You added cables the SMES." );
						this.stat = 0;
						return 1;
					}
				} else if ( a is Obj_Item_Weapon_Wirecutters && this.terminal != null ) {
					T = GlobalFuncs.get_turf( this.terminal );

					if ( T.intact == true ) {
						GlobalFuncs.to_chat( b, "<span class='warning'>You must remove the floor plating in front of the SMES first.</span>" );
						return null;
					}
					GlobalFuncs.to_chat( b, "You begin to cut the cables..." );
					GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/items/Deconstruct.ogg", 50, 1 );

					if ( GlobalFuncs.do_after( b, this, 50 ) && this.panel_open && this.terminal != null && !( T.intact == true ) ) {
						
						if ( Rand13.PercentChance( 50 ) && Lang13.Bool( GlobalFuncs.electrocute_mob( Task13.User, this.terminal.get_powernet(), this.terminal ) ) ) {
							s = new Effect_Effect_System_SparkSpread();
							s.set_up( 5, 1, this );
							s.start();
							return null;
						}
						GlobalFuncs.getFromPool( typeof(Obj_Item_Stack_CableCoil), GlobalFuncs.get_turf( this ), 10 );
						((Ent_Static)b).visible_message( "<span class='warning'>" + b.name + " cut the cables and dismantled the power terminal.</span>", "You cut the cables and dismantle the power terminal." );
						GlobalFuncs.qdel( this.terminal );
						this.terminal = null;
					}
				} else {
					((Mob)b).set_machine( this );
					this.interact( b );
					return 1;
				}
			}
			return null;
		}

		// Function from file: smes.dm
		public override bool initialize( bool? suppress_icon_check = null ) {
			base.initialize( suppress_icon_check );

			if ( !( this.terminal != null ) ) {
				this.stat |= 1;
			}
			return false;
		}

	}

}