// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_Spellbook_Oneuse : Obj_Item_Weapon_Spellbook {

		public Type spell = typeof(Spell_Targeted_Projectile_MagicMissile);
		public string spellname = "sandbox";
		public bool used = false;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.uses = 1;
			this.max_uses = 1;
		}

		// Function from file: spellbook.dm
		public Obj_Item_Weapon_Spellbook_Oneuse ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.name += this.spellname;
			return;
		}

		// Function from file: spellbook.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			return null;
		}

		// Function from file: spellbook.dm
		public virtual void onlearned( dynamic user = null ) {
			this.used = true;
			((Ent_Static)user).visible_message( "<span class='caution'>" + this + " glows dark for a second!</span>" );
			return;
		}

		// Function from file: spellbook.dm
		public virtual void recoil( dynamic user = null ) {
			((Ent_Static)user).visible_message( "<span class='warning'>" + this + " glows in a black light!</span>" );
			return;
		}

		// Function from file: spellbook.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			dynamic S = null;
			Spell knownspell = null;

			S = Lang13.Call( this.spell, user );

			foreach (dynamic _a in Lang13.Enumerate( user.spell_list, typeof(Spell) )) {
				knownspell = _a;
				

				if ( knownspell.type == S.type ) {
					
					if ( Lang13.Bool( user.mind ) ) {
						
						if ( user.mind.special_role == "apprentice" || user.mind.special_role == "Wizard" ) {
							GlobalFuncs.to_chat( user, "<span class='notice'>You're already far more versed in this spell than this flimsy how-to book can provide.</span>" );
						} else {
							GlobalFuncs.to_chat( user, "<span class='notice'>You've already read this one.</span>" );
						}
					}
					return null;
				}
			}

			if ( this.used ) {
				this.recoil( user );
			} else {
				user.add_spell( S );
				GlobalFuncs.to_chat( user, "<span class='notice'>you rapidly read through the arcane book. Suddenly you realize you understand " + this.spellname + "!</span>" );
				user.attack_log.Add( "[" + GlobalFuncs.time_stamp() + "] <font color='orange'>" + user.real_name + " (" + user.ckey + ") learned the spell " + this.spellname + " (" + S + ").</font>" );
				this.onlearned( user );
			}
			return null;
		}

	}

}