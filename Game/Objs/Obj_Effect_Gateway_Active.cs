// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_Gateway_Active : Obj_Effect_Gateway {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.luminosity = 5;
			this.light_color = "#FA8282";
			this.spawnable = new ByTable(new object [] { typeof(Mob_Living_SimpleAnimal_Hostile_Scarybat), typeof(Mob_Living_SimpleAnimal_Hostile_Creature), typeof(Mob_Living_SimpleAnimal_Hostile_Faithless) });
		}

		// Function from file: cult_structures.dm
		public Obj_Effect_Gateway_Active ( dynamic loc = null ) : base( (object)(loc) ) {
			dynamic t = null;

			Task13.Schedule( Rand13.Int( 30, 60 ) * 10, (Task13.Closure)(() => {
				t = Rand13.PickFromTable( this.spawnable );
				Lang13.Call( t, this.loc );
				GlobalFuncs.qdel( this );
				return;
			}));
			return;
		}

		// Function from file: cult_structures.dm
		public override dynamic Crossed( Ent_Dynamic O = null, dynamic X = null ) {
			Ent_Dynamic M = null;
			Ent_Dynamic I = null;
			Ent_Dynamic Robot = null;
			Obj_Item W = null;
			Mob_Living_SimpleAnimal_Hostile_Retaliate_Cluwne new_mob = null;

			
			if ( !( O is Mob_Living ) ) {
				return null;
			}
			M = O;

			if ( Convert.ToInt32( ((dynamic)M).stat ) != 2 ) {
				
				if ( Lang13.Bool( ((dynamic)M).monkeyizing ) ) {
					return null;
				}

				if ( GlobalFuncs.iscultist( M ) ) {
					return null;
				}

				if ( !( M is Mob_Living_Carbon_Human ) && !( M is Mob_Living_Silicon_Robot ) ) {
					return null;
				}
				((dynamic)M).monkeyizing = 1;
				((dynamic)M).canmove = 0;
				M.icon = null;
				M.overlays.len = 0;
				M.invisibility = 101;

				if ( M is Mob_Living_Carbon ) {
					I = M;
					((dynamic)I).dropBorers();
				}

				if ( M is Mob_Living_Silicon_Robot ) {
					Robot = M;

					if ( Lang13.Bool( ((dynamic)Robot).mmi ) ) {
						GlobalFuncs.qdel( ((dynamic)Robot).mmi );
						((dynamic)Robot).mmi = null;
					}
				} else {
					
					foreach (dynamic _a in Lang13.Enumerate( M, typeof(Obj_Item) )) {
						W = _a;
						

						if ( W is Obj_Item_Weapon_Implant ) {
							GlobalFuncs.qdel( W );
							continue;
						}
						W.layer = Convert.ToDouble( Lang13.Initial( W, "layer" ) );
						W.loc = M.loc;
						W.dropped( M );
					}
				}
				new_mob = new Mob_Living_SimpleAnimal_Hostile_Retaliate_Cluwne( O.loc );
				new_mob.setGender( this.gender );
				new_mob.name = Rand13.PickFromTable( GlobalVars.clown_names );
				new_mob.real_name = new_mob.name;
				new_mob.mutations.Add( 5 );
				new_mob.mutations.Add( 6 );
				new_mob.setBrainLoss( 100 );
				new_mob.a_intent = "hurt";

				if ( Lang13.Bool( ((dynamic)M).mind ) ) {
					((Mind)((dynamic)M).mind).transfer_to( new_mob );
				} else {
					new_mob.key = ((dynamic)M).key;
				}
				GlobalFuncs.to_chat( new_mob, "<B>Your form morphs into that of a cluwne.</B>" );
			}
			return null;
		}

	}

}