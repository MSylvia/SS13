// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_Computer_CameraAdvanced : Obj_Machinery_Computer {

		public Mob_Camera_AiEye_Remote eyeobj = null;
		public dynamic current_user = null;
		public ByTable networks = new ByTable(new object [] { "SS13" });
		public Action_Innate_CameraOff off_action = new Action_Innate_CameraOff();
		public Action_Innate_CameraJump jump_action = new Action_Innate_CameraJump();

		protected override void __FieldInit() {
			base.__FieldInit();

			this.icon_screen = "cameras";
			this.icon_keyboard = "security_key";
		}

		public Obj_Machinery_Computer_CameraAdvanced ( dynamic location = null, dynamic C = null ) : base( (object)(location), (object)(C) ) {
			
		}

		// Function from file: camera_advanced.dm
		public override dynamic attack_hand( dynamic a = null, bool? b = null, bool? c = null ) {
			dynamic L = null;
			dynamic camera_location = null;
			Obj_Machinery_Camera C = null;

			
			if ( Lang13.Bool( this.current_user ) ) {
				a.WriteMsg( "The console is already in use!" );
				return null;
			}

			if ( !( a is Mob_Living_Carbon ) ) {
				return null;
			}

			if ( Lang13.Bool( base.attack_hand( (object)(a), b, c ) ) ) {
				return null;
			}
			L = a;

			if ( !( this.eyeobj != null ) ) {
				this.CreateEye();
			}

			if ( !this.eyeobj.initialized ) {
				
				foreach (dynamic _a in Lang13.Enumerate( GlobalVars.cameranet.cameras, typeof(Obj_Machinery_Camera) )) {
					C = _a;
					

					if ( !C.can_use() ) {
						continue;
					}

					if ( ( C.network & this.networks ) != null ) {
						camera_location = GlobalFuncs.get_turf( C );
						break;
					}
				}

				if ( Lang13.Bool( camera_location ) ) {
					this.eyeobj.initialized = true;
					this.give_eye_control( L );
					this.eyeobj.setLoc( camera_location );
				} else {
					((Mob)a).unset_machine();
				}
			} else {
				this.give_eye_control( L );
				this.eyeobj.setLoc( this.eyeobj.loc );
			}
			return null;
		}

		// Function from file: camera_advanced.dm
		public override void on_unset_machine( Mob user = null ) {
			
			if ( user == this.current_user ) {
				this.off_action.Activate();
			}
			return;
		}

		// Function from file: camera_advanced.dm
		public override dynamic Destroy(  ) {
			
			if ( Lang13.Bool( this.current_user ) ) {
				((Mob)this.current_user).unset_machine();
			}

			if ( this.eyeobj != null ) {
				GlobalFuncs.qdel( this.eyeobj );
			}
			return base.Destroy();
		}

		// Function from file: camera_advanced.dm
		public override dynamic check_eye( Mob user = null ) {
			
			if ( ( this.stat & 3 ) != 0 || !this.Adjacent( user ) || user.eye_blind != 0 || user.incapacitated() ) {
				user.unset_machine();
			}
			return null;
		}

		// Function from file: camera_advanced.dm
		public void give_eye_control( dynamic user = null ) {
			this.GrantActions( user );
			this.current_user = user;
			this.eyeobj.eye_user = user;
			this.eyeobj.name = "Camera Eye (" + user.name + ")";
			user.remote_control = this.eyeobj;
			((Mob)user).reset_perspective( this.eyeobj );
			return;
		}

		// Function from file: camera_advanced.dm
		public virtual void GrantActions( dynamic user = null ) {
			this.off_action.target = user;
			this.off_action.Grant( user );
			this.jump_action.target = user;
			this.jump_action.Grant( user );
			return;
		}

		// Function from file: camera_advanced.dm
		public virtual void CreateEye(  ) {
			this.eyeobj = new Mob_Camera_AiEye_Remote();
			this.eyeobj.origin = this;
			return;
		}

	}

}