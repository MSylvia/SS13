// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_ProcHolder_Changeling_StrainedMuscles : Obj_Effect_ProcHolder_Changeling {

		public int stacks = 0;
		public bool active = false;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.helptext = "The strain will make us tired, and we will rapidly become fatigued. Standard weight restrictions, like hardsuits, still apply. Cannot be used in lesser form.";
			this.dna_cost = 1;
			this.req_human = true;
		}

		public Obj_Effect_ProcHolder_Changeling_StrainedMuscles ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: strained_muscles.dm
		public override dynamic sting_action( Mob user = null, Ent_Static target = null ) {
			this.active = !this.active;

			if ( this.active ) {
				user.WriteMsg( "<span class='notice'>Our muscles tense and strengthen.</span>" );
			} else {
				user.status_flags -= 32;
				user.WriteMsg( "<span class='notice'>Our muscles relax.</span>" );

				if ( this.stacks >= 10 ) {
					user.WriteMsg( "<span class='danger'>We collapse in exhaustion.</span>" );
					user.Weaken( 3 );
					user.emote( "gasp" );
				}
			}

			while (this.active) {
				user.status_flags |= 32;

				if ( user.stat != 0 || Convert.ToDouble( ((dynamic)user).staminaloss ) >= 90 ) {
					this.active = !this.active;
					user.WriteMsg( "<span class='notice'>Our muscles relax without the energy to strengthen them.</span>" );
					user.Weaken( 2 );
					user.status_flags -= 32;
					break;
				}
				this.stacks++;
				((dynamic)user).staminaloss += this.stacks * 121;

				if ( this.stacks == 11 ) {
					user.WriteMsg( "<span class='warning'>Our legs are really starting to hurt...</span>" );
				}
				Task13.Sleep( 40 );
			}

			while (!this.active) {
				
				if ( this.stacks >= 1 ) {
					this.stacks--;
				}
				Task13.Sleep( 20 );
			}
			GlobalFuncs.feedback_add_details( "changeling_powers", "SANIC" );
			return 1;
		}

	}

}