// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Toy_Crossbow : Obj_Item_Toy {

		public int bullets = 5;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.item_state = "crossbow";
			this.w_class = 2;
			this.attack_verb = new ByTable(new object [] { "attacked", "struck", "hit" });
			this.icon = "icons/obj/gun.dmi";
			this.icon_state = "crossbow";
		}

		public Obj_Item_Toy_Crossbow ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: toys.dm
		public override bool? attack( dynamic M = null, dynamic user = null, string def_zone = null, bool? eat_override = null ) {
			dynamic O = null;
			dynamic O2 = null;

			this.add_fingerprint( user );

			if ( this.bullets > 0 && M.lying == true ) {
				
				foreach (dynamic _a in Lang13.Enumerate( Map13.FetchViewers( null, M ) )) {
					O = _a;
					

					if ( Lang13.Bool( O.client ) ) {
						O.show_message( "<span class = 'danger'><B>" + user + " casually lines up a shot with " + M + "'s head and pulls the trigger!</B></span>", 1, "<span class = 'danger'>You hear the sound of foam against skull.</span>", 2 );
						O.show_message( "<span class = 'danger'>" + M + " was hit in the head by the foam dart!</span>", 1 );
					}
				}
				GlobalFuncs.playsound( user.loc, "sound/items/syringeproj.ogg", 50, 1 );
				new Obj_Item_Toy_Ammo_Crossbow( M.loc );
				this.bullets--;
			} else if ( M.lying == true && this.bullets == 0 ) {
				
				foreach (dynamic _b in Lang13.Enumerate( Map13.FetchViewers( null, M ) )) {
					O2 = _b;
					

					if ( Lang13.Bool( O2.client ) ) {
						O2.show_message( "<span class = 'danger'><B>" + user + " casually lines up a shot with " + M + "'s head, pulls the trigger, then realizes they are out of ammo and drops to the floor in search of some!</B></span>", 1, "<span class = 'danger'>You hear someone fall</span>", 2 );
					}
				}
				((Mob)user).Weaken( 5 );
			}
			return null;
		}

		// Function from file: toys.dm
		public override bool afterattack( dynamic A = null, dynamic user = null, bool? flag = null, dynamic _params = null, bool? struggle = null ) {
			dynamic trg = null;
			Obj_Effect_FoamDartDummy D = null;
			int? i = null;
			Mob_Living M = null;
			dynamic O = null;
			Ent_Static A2 = null;
			dynamic O2 = null;

			
			if ( !( A.loc is Tile ) || A == user ) {
				return false;
			}

			if ( flag == true ) {
				return false;
			}

			if ( Lang13.Bool( Lang13.FindIn( typeof(Obj_Structure_Table), this.loc ) ) ) {
				return false;
			} else if ( this.bullets != 0 ) {
				trg = GlobalFuncs.get_turf( A );
				D = new Obj_Effect_FoamDartDummy( GlobalFuncs.get_turf( this ) );
				this.bullets--;
				D.icon_state = "foamdart";
				D.name = "foam dart";
				GlobalFuncs.playsound( user.loc, "sound/items/syringeproj.ogg", 50, 1 );
				i = null;
				i = 0;

				while (( i ??0) < 6) {
					
					if ( D != null ) {
						
						if ( D.loc == trg ) {
							break;
						}
						Map13.StepTowardsSimple( D, trg );

						foreach (dynamic _b in Lang13.Enumerate( D.loc, typeof(Mob_Living) )) {
							M = _b;
							

							if ( !( M is Mob_Living ) ) {
								continue;
							}

							if ( M == user ) {
								continue;
							}

							foreach (dynamic _a in Lang13.Enumerate( Map13.FetchViewers( D, Game13.view ) )) {
								O = _a;
								
								O.show_message( "<span class = 'danger'>" + M + " was hit by the foam dart!</span>", 1 );
							}
							new Obj_Item_Toy_Ammo_Crossbow( M.loc );
							GlobalFuncs.qdel( D );
							D = null;
							return false;
						}

						foreach (dynamic _c in Lang13.Enumerate( D.loc, typeof(Ent_Static) )) {
							A2 = _c;
							

							if ( A2 == user ) {
								continue;
							}

							if ( A2.density ) {
								new Obj_Item_Toy_Ammo_Crossbow( A2.loc );
								GlobalFuncs.qdel( D );
								D = null;
							}
						}
					}
					Task13.Sleep( 1 );
					i++;
				}
				Task13.Schedule( 10, (Task13.Closure)(() => {
					
					if ( D != null ) {
						new Obj_Item_Toy_Ammo_Crossbow( D.loc );
						GlobalFuncs.qdel( D );
						D = null;
					}
					return;
				}));
				return false;
			} else if ( this.bullets == 0 ) {
				((Mob)user).Weaken( 5 );

				foreach (dynamic _d in Lang13.Enumerate( Map13.FetchViewers( user, Game13.view ) )) {
					O2 = _d;
					
					O2.show_message( "<span class = 'danger'>" + user + " realized they were out of ammo and starting scrounging for some!<span>", 1 );
				}
			}
			return false;
		}

		// Function from file: toys.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			
			if ( a is Obj_Item_Toy_Ammo_Crossbow ) {
				
				if ( this.bullets <= 4 ) {
					
					if ( Lang13.Bool( b.drop_item( a ) ) ) {
						GlobalFuncs.qdel( a );
						a = null;
						this.bullets++;
						GlobalFuncs.to_chat( b, "<span class = 'info'>You load the foam dart into the crossbow.</span>" );
					}
				} else {
					GlobalFuncs.to_chat( Task13.User, "<span class = 'warning'>It's already fully loaded.</span>" );
				}
			}
			return null;
		}

		// Function from file: toys.dm
		public override dynamic examine( dynamic user = null, string size = null ) {
			base.examine( (object)(user), size );

			if ( this.bullets != 0 ) {
				GlobalFuncs.to_chat( user, new Txt( "<span class = 'info'>It is loaded with " ).item( this.bullets ).str( " foam dart" ).s().str( "!</span>" ).ToString() );
			}
			return null;
		}

	}

}