// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_Gibspawner : Obj_Effect {

		public bool sparks = false;
		public int virusProb = 20;
		public ByTable gibtypes = new ByTable();
		public ByTable gibamounts = new ByTable();
		public ByTable gibdirections = new ByTable();

		// Function from file: gibs.dm
		public Obj_Effect_Gibspawner ( dynamic location = null, ByTable viruses = null, Dna MobDNA = null ) : base( (object)(location) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.Gib( this.loc, viruses, MobDNA );
			return;
		}

		// Function from file: gibs.dm
		public void Gib( Ent_Static location = null, ByTable viruses = null, Dna MobDNA = null ) {
			viruses = viruses ?? new ByTable();

			dynamic gib = null;
			EffectSystem_SparkSpread s = null;
			int? i = null;
			int? j = null;
			dynamic gibType = null;
			Ent_Static digester = null;
			Disease D = null;
			dynamic viruus = null;
			ByTable directions = null;

			
			if ( this.gibtypes.len != this.gibamounts.len || this.gibamounts.len != this.gibdirections.len ) {
				Game13.WriteMsg( "<span class='danger'>Gib list length mismatch!</span>" );
				return;
			}
			gib = null;

			if ( this.sparks ) {
				s = new EffectSystem_SparkSpread();
				s.set_up( 2, 1, location );
				s.start();
			}
			i = null;
			i = 1;

			while (( i ??0) <= this.gibtypes.len) {
				
				if ( Lang13.Bool( this.gibamounts[i] ) ) {
					j = null;
					j = 1;

					while (( j ??0) <= Convert.ToDouble( this.gibamounts[i] )) {
						gibType = this.gibtypes[i];
						gib = Lang13.Call( gibType, location );

						if ( location is Mob_Living_Carbon ) {
							digester = location;
							((dynamic)digester).stomach_contents += gib;
						}

						if ( viruses.len > 0 ) {
							
							foreach (dynamic _a in Lang13.Enumerate( viruses, typeof(Disease) )) {
								D = _a;
								

								if ( Rand13.PercentChance( this.virusProb ) ) {
									viruus = D.Copy( true );
									gib.viruses += viruus;
									viruus.holder = gib;
								}
							}
						}

						if ( MobDNA != null ) {
							gib.blood_DNA[MobDNA.unique_enzymes] = MobDNA.blood_type;
						} else if ( this is Obj_Effect_Gibspawner_Generic ) {
							gib.blood_DNA["Non-human DNA"] = "A+";
						}
						directions = this.gibdirections[i];

						if ( this.loc is Tile ) {
							
							if ( directions.len != 0 ) {
								gib.streak( directions );
							}
						}
						j++;
					}
				}
				i++;
			}
			GlobalFuncs.qdel( this );
			return;
		}

	}

}