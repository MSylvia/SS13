// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Device_FuseBomb : Obj_Item_Device {

		public bool fuse_lit = false;
		public int seconds_left = 5;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.item_state = "fuse_bomb";
			this.icon_state = "fuse_bomb_5";
		}

		public Obj_Item_Device_FuseBomb ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: fuse_bomb.dm
		public override dynamic cultify(  ) {
			return null;
		}

		// Function from file: fuse_bomb.dm
		public override bool ex_act( double? severity = null, dynamic child = null ) {
			this.detonation();
			return false;
		}

		// Function from file: fuse_bomb.dm
		public override bool? update_icon( dynamic location = null, dynamic target = null ) {
			this.icon_state = "fuse_bomb_" + this.seconds_left + ( this.fuse_lit ? "-lit" : "" );
			return null;
		}

		// Function from file: fuse_bomb.dm
		public override void extinguish(  ) {
			base.extinguish();
			this.fuse_lit = false;
			this.update_icon();
			return;
		}

		// Function from file: fuse_bomb.dm
		public virtual void admin_warn( dynamic user = null ) {
			dynamic bombturf = null;
			dynamic A = null;
			string demoman_name = null;
			string log_str = null;

			bombturf = GlobalFuncs.get_turf( this );
			A = GlobalFuncs.get_area( bombturf );
			demoman_name = "";

			if ( !Lang13.Bool( user ) ) {
				demoman_name = "Unknown";
			} else {
				demoman_name = "" + user.name + "(" + user.ckey + ")";
			}
			log_str = "Bomb fuse lit in <A HREF='?_src_=holder;adminplayerobservecoodjump=1;X=" + bombturf.x + ";Y=" + bombturf.y + ";Z=" + bombturf.z + "'>" + A.name + "</a> by " + demoman_name;

			if ( Lang13.Bool( user ) ) {
				log_str += new Txt( "(<A HREF='?_src_=holder;adminmoreinfo=" ).Ref( user ).str( "'>?</A>)" ).ToString();
			}
			GlobalVars.bombers.Add( log_str );
			GlobalFuncs.message_admins( log_str );
			GlobalVars.diary.WriteMsg( String13.HtmlDecode( "[" + GlobalFuncs.time_stamp() + "]GAME: " + log_str ) );
			return;
		}

		// Function from file: fuse_bomb.dm
		public void detonation(  ) {
			GlobalFuncs.explosion( GlobalFuncs.get_turf( this ), -1, 1, 3 );
			GlobalFuncs.qdel( this );
			return;
		}

		// Function from file: fuse_bomb.dm
		public void fuse_burn(  ) {
			
			if ( this != null && this.fuse_lit ) {
				
				if ( this.seconds_left != 0 ) {
					Task13.Sleep( 10 );
					this.seconds_left--;
					this.update_icon();
					this.fuse_burn();
				} else {
					this.detonation();
				}
			}
			return;
		}

		// Function from file: fuse_bomb.dm
		public void lit( dynamic user = null, dynamic O = null ) {
			dynamic C = null;

			this.fuse_lit = true;
			GlobalFuncs.to_chat( user, "<span class='warning'>You lit the fuse" + ( Lang13.Bool( O ) ? " with " + O : "" ) + "! " + this.seconds_left + " seconds till detonation!</span>" );
			this.admin_warn( user );
			this.add_fingerprint( user );

			if ( user is Mob_Living_Carbon ) {
				C = user;
				((Mob_Living_Carbon)C).throw_mode_on();
			}
			this.update_icon();
			this.fuse_burn();
			return;
		}

		// Function from file: fuse_bomb.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			dynamic WT = null;
			dynamic L = null;
			dynamic M = null;
			dynamic C = null;

			base.attackby( (object)(a), (object)(b), (object)(c) );

			if ( !this.fuse_lit ) {
				
				if ( a is Obj_Item_Weapon_Weldingtool ) {
					WT = a;

					if ( ((Obj_Item_Weapon_Weldingtool)WT).isOn() ) {
						this.lit( b, a );
					}
				} else if ( a is Obj_Item_Weapon_Lighter ) {
					L = a;

					if ( Lang13.Bool( L.lit ) ) {
						this.lit( b, a );
					}
				} else if ( a is Obj_Item_Weapon_Match ) {
					M = a;

					if ( Lang13.Bool( M.lit ) ) {
						this.lit( b, a );
					}
				} else if ( a is Obj_Item_Candle ) {
					C = a;

					if ( Lang13.Bool( C.lit ) ) {
						this.lit( b, a );
					}
				}
			} else if ( a is Obj_Item_Weapon_Wirecutters ) {
				this.fuse_lit = false;
				this.update_icon();
				GlobalFuncs.to_chat( b, "<span class='warning'>You extinguish the fuse with " + this.seconds_left + " seconds left!</span>" );
			}
			return null;
		}

		// Function from file: fuse_bomb.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			
			if ( !this.fuse_lit ) {
				this.lit( user );
			} else {
				this.fuse_lit = false;
				this.update_icon();
				GlobalFuncs.to_chat( user, "<span class='warning'>You extinguish the fuse with " + this.seconds_left + " seconds left!</span>" );
			}
			return null;
		}

	}

}