// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_Storage_Briefcase_FalseBottomed : Obj_Item_Weapon_Storage_Briefcase {

		public bool busy_hunting = false;
		public bool bottom_open = false;
		public dynamic stored_item = null;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.throw_range = 3;
			this.max_combined_w_class = 10;
		}

		public Obj_Item_Weapon_Storage_Briefcase_FalseBottomed ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: briefcase.dm
		public override dynamic attack_hand( dynamic a = null, dynamic b = null, dynamic c = null ) {
			
			if ( this.bottom_open && Lang13.Bool( this.stored_item ) ) {
				((Mob)a).put_in_hands( this.stored_item );
				GlobalFuncs.to_chat( a, new Txt( "You pull out " ).the( this.stored_item ).item().str( " from " ).the( this ).item().str( "'s false bottom." ).ToString() );
				this.stored_item = null;
				this.max_w_class = Lang13.Initial( this, "max_w_class" );
			} else {
				return base.attack_hand( (object)(a), (object)(b), (object)(c) );
			}
			return null;
		}

		// Function from file: briefcase.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			
			if ( a is Obj_Item_Weapon_Screwdriver ) {
				
				if ( !this.bottom_open && !this.busy_hunting ) {
					GlobalFuncs.to_chat( b, new Txt( "You begin to hunt around the rim of " ).the( this ).item().str( "..." ).ToString() );
					this.busy_hunting = true;

					if ( GlobalFuncs.do_after( b, this, 20 ) ) {
						
						if ( Lang13.Bool( b ) ) {
							GlobalFuncs.to_chat( b, "You pry open the false bottom!" );
						}
						this.bottom_open = true;
					}
					this.busy_hunting = false;
				} else if ( this.bottom_open ) {
					GlobalFuncs.to_chat( b, "You push the false bottom down and close it with a click" + ( Lang13.Bool( this.stored_item ) ? new Txt( ", with " ).the( this.stored_item ).item().str( " snugly inside." ).ToString() : "." ) );
					this.bottom_open = false;
				}
			} else if ( this.bottom_open ) {
				
				if ( Lang13.Bool( this.stored_item ) ) {
					GlobalFuncs.to_chat( b, "<span class='warning'>There's already something in the false bottom!</span>" );
					return null;
				}

				if ( Convert.ToDouble( a.w_class ) > 3 ) {
					GlobalFuncs.to_chat( b, new Txt( "<span class='warning'>" ).The( a ).item().str( " is too big to fit in the false bottom!</span>" ).ToString() );
					return null;
				}

				if ( !Lang13.Bool( b.drop_item( a ) ) ) {
					b.WriteMsg( new Txt( "<span class='warning'>" ).The( a ).item().str( " is stuck to your hands!</span>" ).ToString() );
					return null;
				}
				this.stored_item = a;
				this.max_w_class = 3 - Convert.ToDouble( this.stored_item.w_class );
				a.loc = null;
				GlobalFuncs.to_chat( b, new Txt( "You place " ).the( a ).item().str( " into the false bottom of the briefcase." ).ToString() );
			} else {
				return base.attackby( (object)(a), (object)(b), (object)(c) );
			}
			return null;
		}

		// Function from file: briefcase.dm
		public override bool afterattack( dynamic A = null, dynamic user = null, bool? flag = null, dynamic _params = null, bool? struggle = null ) {
			dynamic stored_gun = null;

			base.afterattack( (object)(A), (object)(user), flag, (object)(_params), struggle );

			if ( Lang13.Bool( this.stored_item ) && this.stored_item is Obj_Item_Weapon_Gun && Map13.GetDistance( A, user ) > 1 ) {
				stored_gun = this.stored_item;
				((Obj_Item_Weapon_Gun)stored_gun).Fire( A, user );
			}
			return false;
		}

		// Function from file: briefcase.dm
		public override dynamic Destroy( dynamic brokenup = null ) {
			
			if ( Lang13.Bool( this.stored_item ) ) {
				GlobalFuncs.qdel( this.stored_item );
				this.stored_item = null;
			}
			base.Destroy( (object)(brokenup) );
			return null;
		}

	}

}