// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_ReagentContainers_Food_Snacks_BorerEgg : Obj_Item_Weapon_ReagentContainers_Food_Snacks {

		public bool grown = false;
		public bool hatching = false;
		public Recruiter recruiter = null;
		public ByTable required_mols = new ByTable().Set( "toxins", 061 ).Set( "oxygen", 5 );

		protected override void __FieldInit() {
			base.__FieldInit();

			this.bitesize = 12;
			this.origin_tech = "biotech=4";
			this.mech_flags = 1;
			this.icon = "icons/mob/mob.dmi";
			this.icon_state = "borer egg-growing";
		}

		// Function from file: egg.dm
		public Obj_Item_Weapon_ReagentContainers_Food_Snacks_BorerEgg ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			((Reagents)this.reagents).add_reagent( "nutriment", 4 );
			Task13.Schedule( Rand13.Int( 1200, 1500 ), (Task13.Closure)(() => {
				this.Grow();
				return;
			}));
			return;
		}

		// Function from file: egg.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			
			if ( a is Obj_Item_Toy_Crayon ) {
				return null;
			} else {
				base.attackby( (object)(a), (object)(b), (object)(c) );
			}
			return null;
		}

		// Function from file: egg.dm
		public override dynamic process(  ) {
			dynamic location = null;
			GasMixture environment = null;
			bool meets_conditions = false;
			dynamic gas_id = null;

			location = GlobalFuncs.get_turf( this );

			if ( !Lang13.Bool( location ) ) {
				return null;
			}
			environment = ((Ent_Static)location).return_air();
			meets_conditions = true;

			foreach (dynamic _a in Lang13.Enumerate( this.required_mols )) {
				gas_id = _a;
				

				if ( Convert.ToDouble( environment.vars[gas_id] ) <= Convert.ToDouble( this.required_mols[gas_id] ) ) {
					meets_conditions = false;
				}
			}

			if ( meets_conditions ) {
				this.Hatch();
			}
			return null;
		}

		// Function from file: egg.dm
		public void recruiter_recruited( dynamic args = null ) {
			dynamic O = null;
			dynamic T = null;
			Mob_Living_SimpleAnimal_Borer B = null;

			O = args["player"];

			if ( Lang13.Bool( O ) ) {
				T = GlobalFuncs.get_turf( this );
				this.visible_message( new Txt( "<span class='notice'>" ).The( this.name ).item().str( " bursts open!</span>" ).ToString() );
				B = new Mob_Living_SimpleAnimal_Borer( T );
				B.transfer_personality( O.client );
				GlobalFuncs.playsound( this.loc, "sound/items/borer_hatch.ogg", 50, 1 );
				GlobalFuncs.qdel( this );
			} else {
				this.visible_message( new Txt( "<span class='notice'>" ).The( this.name ).item().str( " calms down.</span>" ).ToString() );
				this.Grow();
			}
			return;
		}

		// Function from file: egg.dm
		public void recruiter_not_recruiting( dynamic args = null ) {
			dynamic O = null;
			dynamic controls = null;

			O = args["player"];
			controls = args["controls"];
			GlobalFuncs.to_chat( O, new Txt( "<span class='recruit'>" ).The( this ).item().str( " is starting to hatch. (" ).item( controls ).str( ")</span>" ).ToString() );
			return;
		}

		// Function from file: egg.dm
		public void recruiter_recruiting( dynamic args = null ) {
			dynamic O = null;
			dynamic controls = null;

			O = args["player"];
			controls = args["controls"];
			GlobalFuncs.to_chat( O, new Txt( "<span class='recruit'>" ).The( this ).item().str( " is starting to hatch. You have been added to the list of potential ghosts. (" ).item( controls ).str( ")</span>" ).ToString() );
			return;
		}

		// Function from file: egg.dm
		public void Hatch(  ) {
			
			if ( this.hatching ) {
				return;
			}
			GlobalVars.processing_objects.Remove( this );
			this.icon_state = "borer egg-triggered";
			this.hatching = true;
			this.visible_message( "<span class='notice'>The " + this.name + " pulsates and quivers!</span>" );
			this.recruiter.request_player();
			return;
		}

		// Function from file: egg.dm
		public void Grow(  ) {
			this.grown = true;
			this.icon_state = "borer egg-grown";
			GlobalVars.processing_objects.Add( this );

			if ( !( this.recruiter != null ) ) {
				this.recruiter = new Recruiter( this );
				this.recruiter.display_name = "borer";
				this.recruiter.role = "borer";
				this.recruiter.jobban_roles = new ByTable(new object [] { "pAI" });
				this.recruiter.player_volunteering.Add( this, "recruiter_recruiting" );
				this.recruiter.player_not_volunteering.Add( this, "recruiter_not_recruiting" );
				this.recruiter.recruited.Add( this, "recruiter_recruited" );
			}
			return;
		}

	}

}