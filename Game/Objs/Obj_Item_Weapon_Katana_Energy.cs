// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_Katana_Energy : Obj_Item_Weapon_Katana {

		public EffectSystem_SparkSpread spark_system = null;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.item_state = "energy_katana";
			this.throwforce = 20;
			this.armour_penetration = 15;
			this.icon_state = "energy_katana";
		}

		// Function from file: energy_katana.dm
		public Obj_Item_Weapon_Katana_Energy ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.spark_system = new EffectSystem_SparkSpread();
			this.spark_system.set_up( 5, 0, this );
			this.spark_system.attach( this );
			return;
		}

		// Function from file: energy_katana.dm
		public override dynamic Destroy(  ) {
			GlobalFuncs.qdel( this.spark_system );
			this.spark_system = null;
			return base.Destroy();
		}

		// Function from file: energy_katana.dm
		public void returnToOwner( dynamic user = null, bool? doSpark = null, bool? caught = null ) {
			doSpark = doSpark ?? true;
			caught = caught ?? false;

			string msg = null;

			
			if ( !( user is Mob_Living_Carbon_Human ) ) {
				return;
			}
			this.loc = GlobalFuncs.get_turf( this );

			if ( doSpark == true ) {
				this.spark_system.start();
				GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sparks", 50, 1 );
			}
			msg = "";

			if ( ((Mob)user).put_in_hands( this ) ) {
				msg = "Your Energy Katana teleports into your hand!";
			} else if ( ((Mob)user).equip_to_slot_if_possible( this, 6, false, true, true ) ) {
				msg = "Your Energy Katana teleports back to you, sheathing itself as it does so!</span>";
			} else {
				this.loc = GlobalFuncs.get_turf( user );
				msg = "Your Energy Katana teleports to your location!";
			}

			if ( caught == true ) {
				
				if ( this.loc == user ) {
					msg = "You catch your Energy Katana!";
				} else {
					msg = "Your Energy Katana lands at your feet!";
				}
			}

			if ( Lang13.Bool( msg ) ) {
				user.WriteMsg( "<span class='notice'>" + msg + "</span>" );
			}
			return;
		}

		// Function from file: energy_katana.dm
		public override bool throw_impact( dynamic target = null, Mob_Living_Carbon thrower = null ) {
			dynamic H = null;
			dynamic SN = null;

			
			if ( target is Mob_Living_Carbon_Human ) {
				H = target;

				if ( H.wear_suit is Obj_Item_Clothing_Suit_Space_SpaceNinja ) {
					SN = H.wear_suit;

					if ( SN.energyKatana == this ) {
						this.returnToOwner( H, false, true );
						return false;
					}
				}
			}
			base.throw_impact( (object)(target), thrower );
			return false;
		}

		// Function from file: energy_katana.dm
		public override bool afterattack( dynamic target = null, dynamic user = null, bool? proximity_flag = null, string click_parameters = null ) {
			
			if ( !Lang13.Bool( user ) || !Lang13.Bool( target ) ) {
				return false;
			}

			if ( proximity_flag == true ) {
				
				if ( target is Obj || target is Mob_Living_Silicon ) {
					this.spark_system.start();
					GlobalFuncs.playsound( user, "sparks", 50, 1 );
					GlobalFuncs.playsound( user, "sound/weapons/blade1.ogg", 50, 1 );
					((Ent_Static)target).emag_act( user );
				}
			}
			return false;
		}

	}

}