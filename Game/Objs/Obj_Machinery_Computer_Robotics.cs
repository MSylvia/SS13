// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_Computer_Robotics : Obj_Machinery_Computer {

		public dynamic temp = null;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.icon_screen = "robot";
			this.icon_keyboard = "rd_key";
			this.req_access = new ByTable(new object [] { 29 });
			this.circuit = typeof(Obj_Item_Weapon_Circuitboard_Robotics);
		}

		public Obj_Machinery_Computer_Robotics ( dynamic location = null, dynamic C = null ) : base( (object)(location), (object)(C) ) {
			
		}

		// Function from file: robot.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hsrc = null ) {
			dynamic R = null;
			dynamic choice = null;
			dynamic R2 = null;
			dynamic choice2 = null;
			dynamic R3 = null;

			
			if ( Lang13.Bool( base.Topic( href, href_list, (object)(hsrc) ) ) ) {
				return null;
			}

			if ( Lang13.Bool( href_list["temp"] ) ) {
				this.temp = null;
			} else if ( Lang13.Bool( href_list["killbot"] ) ) {
				
				if ( this.allowed( Task13.User ) ) {
					R = Lang13.FindObj( href_list["killbot"] );

					if ( this.can_control( Task13.User, R ) ) {
						choice = Interface13.Input( "Are you certain you wish to detonate " + R.name + "?", null, null, null, new ByTable(new object [] { "Confirm", "Abort" }), InputType.Any );

						if ( choice == "Confirm" && this.can_control( Task13.User, R ) && !Lang13.Bool( base.Topic( href, href_list, (object)(hsrc) ) ) ) {
							
							if ( Lang13.Bool( R.mind ) && Lang13.Bool( R.mind.special_role ) && Lang13.Bool( R.emagged ) ) {
								R.WriteMsg( "Extreme danger.  Termination codes detected.  Scrambling security codes and automatic AI unlink triggered." );
								((Mob_Living_Silicon_Robot)R).ResetSecurityCodes();
							} else {
								GlobalFuncs.message_admins( new Txt( "<span class='notice'>" ).item( GlobalFuncs.key_name_admin( Task13.User ) ).str( " (<A HREF='?_src_=holder;adminplayerobservefollow=" ).Ref( Task13.User ).str( "'>FLW</A>) detonated " ).item( GlobalFuncs.key_name( R, R.client ) ).str( "(<A HREF='?_src_=holder;adminplayerobservecoodjump=1;X=" ).item( R.x ).str( ";Y=" ).item( R.y ).str( ";Z=" ).item( R.z ).str( "'>JMP</a>)!</span>" ).ToString() );
								GlobalFuncs.log_game( "&lt;span class='notice'>" + GlobalFuncs.key_name( Task13.User ) + " detonated " + GlobalFuncs.key_name( R ) + "!</span>" );

								if ( Lang13.Bool( R.connected_ai ) ) {
									R.connected_ai.WriteMsg( "<br><br><span class='alert'>ALERT - Cyborg detonation detected: " + R.name + "</span><br>" );
								}
								((Mob_Living_Silicon_Robot)R).self_destruct();
							}
						}
					}
				} else {
					Task13.User.WriteMsg( "<span class='danger'>Access Denied.</span>" );
				}
			} else if ( Lang13.Bool( href_list["stopbot"] ) ) {
				
				if ( this.allowed( Task13.User ) ) {
					R2 = Lang13.FindObj( href_list["stopbot"] );

					if ( this.can_control( Task13.User, R2 ) ) {
						choice2 = Interface13.Input( "Are you certain you wish to " + ( Lang13.Bool( R2.canmove ) ? "lock down" : "release" ) + " " + R2.name + "?", null, null, null, new ByTable(new object [] { "Confirm", "Abort" }), InputType.Any );

						if ( choice2 == "Confirm" && this.can_control( Task13.User, R2 ) && !Lang13.Bool( base.Topic( href, href_list, (object)(hsrc) ) ) ) {
							GlobalFuncs.message_admins( new Txt( "<span class='notice'>" ).item( GlobalFuncs.key_name_admin( Task13.User ) ).str( " (<A HREF='?_src_=holder;adminplayerobservefollow=" ).Ref( Task13.User ).str( "'>FLW</A>) " ).item( ( Lang13.Bool( R2.canmove ) ? "locked down" : "released" ) ).str( " " ).item( GlobalFuncs.key_name( R2, R2.client ) ).str( "(<A HREF='?_src_=holder;adminplayerobservefollow=" ).Ref( R2 ).str( "'>FLW</A>)!</span>" ).ToString() );
							GlobalFuncs.log_game( "" + GlobalFuncs.key_name( Task13.User ) + " " + ( Lang13.Bool( R2.canmove ) ? "locked down" : "released" ) + " " + GlobalFuncs.key_name( R2 ) + "!" );
							((Mob_Living_Silicon_Robot)R2).SetLockdown( !( R2.lockcharge == true ) );
							R2.WriteMsg( "" + ( !( R2.lockcharge == true ) ? "<span class='notice'>Your lockdown has been lifted!" : "<span class='alert'>You have been locked down!" ) + "</span>" );

							if ( Lang13.Bool( R2.connected_ai ) ) {
								R2.connected_ai.WriteMsg( new Txt().item( ( !( R2.lockcharge == true ) ? "<span class='notice'>NOTICE - Cyborg lockdown lifted" : "<span class='alert'>ALERT - Cyborg lockdown detected" ) ).str( ": <a href='?src=" ).Ref( R2.connected_ai ).str( ";track=" ).item( String13.HtmlEncode( R2.name ) ).str( "'>" ).item( R2.name ).str( "</a></span><br>" ).ToString() );
							}
						}
					}
				} else {
					Task13.User.WriteMsg( "<span class='danger'>Access Denied.</span>" );
				}
			} else if ( Lang13.Bool( href_list["magbot"] ) ) {
				
				if ( Task13.User is Mob_Living_Silicon && GlobalFuncs.is_special_character( Task13.User ) != 0 || Lang13.Bool( GlobalFuncs.IsAdminGhost( Task13.User ) ) ) {
					R3 = Lang13.FindObj( href_list["magbot"] );

					if ( R3 is Mob_Living_Silicon_Robot && !Lang13.Bool( R3.emagged ) && ( R3.connected_ai == Task13.User || Lang13.Bool( GlobalFuncs.IsAdminGhost( Task13.User ) ) ) && !R3.scrambledcodes && this.can_control( Task13.User, R3 ) ) {
						GlobalFuncs.log_game( "" + GlobalFuncs.key_name( Task13.User ) + " emagged " + R3.name + " using robotic console!" );
						((Mob_Living_Silicon_Robot)R3).SetEmagged( true );

						if ( Lang13.Bool( R3.mind.special_role ) ) {
							R3.verbs += typeof(Mob_Living_Silicon_Robot).GetMethod( "ResetSecurityCodes" );
						}
					}
				}
			}
			this.updateUsrDialog();
			return null;
		}

		// Function from file: robot.dm
		public override dynamic interact( dynamic user = null, bool? flag1 = null ) {
			dynamic dat = null;
			int robots = 0;
			Mob_Living_Silicon_Robot R = null;
			Browser popup = null;

			
			if ( this.z > 6 ) {
				user.WriteMsg( "<span class='boldannounce'>Unable to establish a connection</span>: Ã¿\"You're too far away from the station!" );
				return null;
			}
			((Mob)user).set_machine( this );
			robots = 0;

			foreach (dynamic _a in Lang13.Enumerate( GlobalVars.mob_list, typeof(Mob_Living_Silicon_Robot) )) {
				R = _a;
				

				if ( !this.can_control( user, R ) ) {
					continue;
				}
				robots++;
				dat += "" + R.name + " |";

				if ( R.stat != 0 ) {
					dat += " Not Responding |";
				} else if ( !R.canmove ) {
					dat += " Locked Down |";
				} else {
					dat += " Operating Normally |";
				}

				if ( !R.canmove ) {
					
				} else if ( Lang13.Bool( R.cell ) ) {
					dat += " Battery Installed (" + R.cell.charge + "/" + R.cell.maxcharge + ") |";
				} else {
					dat += " No Cell Installed |";
				}

				if ( R.module != null ) {
					dat += " Module Installed (" + R.module.name + ") |";
				} else {
					dat += " No Module Installed |";
				}

				if ( Lang13.Bool( R.connected_ai ) ) {
					dat += " Slaved to " + R.connected_ai.name + " |";
				} else {
					dat += " Independent from AI |";
				}

				if ( user is Mob_Living_Silicon || Lang13.Bool( GlobalFuncs.IsAdminGhost( Task13.User ) ) ) {
					
					if ( ( user is Mob_Living_Silicon && GlobalFuncs.is_special_character( user ) != 0 || Lang13.Bool( GlobalFuncs.IsAdminGhost( Task13.User ) ) ) && !R.emagged ) {
						dat += new Txt( "<A href='?src=" ).Ref( this ).str( ";magbot=" ).Ref( R ).str( "'>(<font color=blue><i>Hack</i></font>)</A> " ).ToString();
					}
				}
				dat += new Txt( "<A href='?src=" ).Ref( this ).str( ";stopbot=" ).Ref( R ).str( "'>(<font color=green><i>" ).item( ( R.canmove ? "Lockdown" : "Release" ) ).str( "</i></font>)</A> " ).ToString();
				dat += new Txt( "<A href='?src=" ).Ref( this ).str( ";killbot=" ).Ref( R ).str( "'>(<font color=red><i>Destroy</i></font>)</A>" ).ToString();
				dat += "<BR>";
			}

			if ( !( robots != 0 ) ) {
				dat += "No Cyborg Units detected within access parameters.";
			}
			popup = new Browser( user, "computer", "Cyborg Control Console", 400, 500 );
			popup.set_content( dat );
			popup.set_title_image( ((Mob)user).browse_rsc_icon( this.icon, this.icon_state ) );
			popup.open();
			return null;
		}

		// Function from file: robot.dm
		public override dynamic attack_hand( dynamic a = null, bool? b = null, bool? c = null ) {
			
			if ( Lang13.Bool( base.attack_hand( (object)(a), b, c ) ) ) {
				return null;
			}
			this.interact( a );
			return null;
		}

		// Function from file: robot.dm
		public bool can_control( dynamic user = null, dynamic R = null ) {
			
			if ( !( R is Mob_Living_Silicon_Robot ) ) {
				return false;
			}

			if ( user is Mob_Living_Silicon_Ai ) {
				
				if ( R.connected_ai != user ) {
					return false;
				}
			}

			if ( user is Mob_Living_Silicon_Robot ) {
				
				if ( R != user ) {
					return false;
				}
			}

			if ( R.scrambledcodes ) {
				return false;
			}
			return true;
		}

	}

}