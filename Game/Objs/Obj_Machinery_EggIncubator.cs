// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_EggIncubator : Obj_Machinery {

		public ByTable egg_storage = new ByTable();
		public int limit = 1;
		public double speed_bonus = 0;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.anchored = 1;
			this.idle_power_usage = 10;
			this.active_power_usage = 500;
			this.machine_flags = 46;
			this.flags = 20480;
			this.pass_flags = 1;
			this.icon = "icons/obj/virology.dmi";
			this.icon_state = "incubator";
		}

		// Function from file: eggincubator.dm
		public Obj_Machinery_EggIncubator ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.component_parts = new ByTable(new object [] { 
				new Obj_Item_Weapon_Circuitboard_EggIncubator(), 
				new Obj_Item_Weapon_StockParts_Capacitor(), 
				new Obj_Item_Weapon_StockParts_Capacitor(), 
				new Obj_Item_Weapon_StockParts_MatterBin()
			 });
			this.RefreshParts();
			return;
		}

		// Function from file: eggincubator.dm
		public void eject( dynamic E = null ) {
			
			if ( E.loc != this ) {
				return;
			}
			((Ent_Dynamic)E).forceMove( GlobalFuncs.get_turf( this ) );
			this.updateUsrDialog();
			this.visible_message( new Txt( "<span class='info'>An egg was ejected from " ).the( this ).item().str( ".</span>" ).ToString() );
			return;
		}

		// Function from file: eggincubator.dm
		public override dynamic process(  ) {
			Obj_Item_Weapon_ReagentContainers_Food_Snacks_Egg E = null;

			base.process();

			if ( !( this.contents.len != 0 ) ) {
				this.use_power = 1;
				this.update_icon();
				return null;
			}
			this.use_power = 2;
			this.update_icon();

			foreach (dynamic _a in Lang13.Enumerate( this.contents, typeof(Obj_Item_Weapon_ReagentContainers_Food_Snacks_Egg) )) {
				E = _a;
				
				E.amount_grown += Rand13.Int( 2, 3 ) + this.speed_bonus;

				if ( E.amount_grown >= 100 ) {
					this.eject( E );
					E.hatch();
					GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/machines/ding.ogg", 50, 1 );
				}
			}
			this.updateUsrDialog();
			return null;
		}

		// Function from file: eggincubator.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hclient = null, HtmlInterface currui = null ) {
			dynamic E = null;

			
			if ( Lang13.Bool( base.Topic( href, href_list, (object)(hclient) ) ) ) {
				return 1;
			}
			E = Lang13.FindObj( href_list["egg"] );

			if ( !( E is Obj_Item_Weapon_ReagentContainers_Food_Snacks_Egg ) ) {
				return null;
			}
			this.eject( E );
			return null;
		}

		// Function from file: eggincubator.dm
		public override dynamic interact( dynamic user = null, bool? flag1 = null ) {
			string dat = null;
			int counter = 0;
			Obj_Item_Weapon_ReagentContainers_Food_Snacks_Egg E = null;

			dat = "";
			counter = 0;

			if ( !( this.contents.len != 0 ) ) {
				dat += new Txt().The( this ).item().str( " is empty." ).ToString();
			}

			foreach (dynamic _a in Lang13.Enumerate( this.contents, typeof(Obj_Item_Weapon_ReagentContainers_Food_Snacks_Egg) )) {
				E = _a;
				
				counter++;
				dat += new Txt( "Egg " ).item( counter ).str( ": " ).item( E.amount_grown ).str( "% grown. <A href='?src=" ).Ref( this ).str( ";egg=" ).Ref( E ).str( "'>(Eject)</A><BR>" ).ToString();
			}
			Interface13.Browse( user, "<HEAD><TITLE>Egg Incubator</TITLE></HEAD><TT>" + dat + "</TT>", "window=egg_incubator" );
			GlobalFuncs.onclose( user, "egg_incubator" );
			return null;
		}

		// Function from file: eggincubator.dm
		public override dynamic attack_hand( dynamic a = null, dynamic b = null, dynamic c = null ) {
			
			if ( Lang13.Bool( base.attack_hand( (object)(a), (object)(b), (object)(c) ) ) ) {
				return 1;
			}
			((Mob)a).set_machine( this );
			this.interact( a );
			return null;
		}

		// Function from file: eggincubator.dm
		public override dynamic attack_ai( dynamic user = null ) {
			return this.attack_hand( user );
		}

		// Function from file: eggincubator.dm
		public override dynamic attack_paw( Mob a = null, dynamic b = null, dynamic c = null ) {
			return this.attack_hand( a );
		}

		// Function from file: eggincubator.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			
			if ( Lang13.Bool( base.attackby( (object)(a), (object)(b), (object)(c) ) ) ) {
				return 1;
			}

			if ( this.contents.len >= this.limit ) {
				GlobalFuncs.to_chat( b, new Txt().The( this ).item().str( " has no more space for eggs!" ).ToString() );
				return 1;
			}

			if ( a is Obj_Item_Weapon_ReagentContainers_Food_Snacks_Egg ) {
				
				if ( Convert.ToDouble( GlobalVars.animal_count[typeof(Mob_Living_SimpleAnimal_Chicken)] ) >= GlobalVars.ANIMAL_CHILD_CAP ) {
					GlobalFuncs.to_chat( b, "<span class='warning'>You get the feeling there are enough chickens already.</span>" );
					return 1;
				}

				if ( Lang13.Bool( b.drop_item( a, this ) ) ) {
					((Ent_Static)b).visible_message( new Txt( "<span class='notice'>" ).The( b ).item().str( " has added " ).the( a ).item().str( " to " ).the( this ).item().str( ".</span>" ).ToString(), new Txt( "<span class='notice'>You add " ).the( a ).item().str( " to " ).the( this ).item().str( ".</span>" ).ToString() );
				}
			}
			this.updateUsrDialog();
			return null;
		}

		// Function from file: eggincubator.dm
		public override bool? update_icon( dynamic location = null, dynamic target = null ) {
			
			if ( this.use_power == 2 ) {
				this.icon_state = "incubator_on";
			} else {
				this.icon_state = "incubator";
			}
			return null;
		}

		// Function from file: eggincubator.dm
		public override dynamic RefreshParts(  ) {
			int bincount = 0;
			int capcount = 0;
			Obj_Item_Weapon_StockParts SP = null;

			bincount = 0;
			capcount = 0;

			foreach (dynamic _a in Lang13.Enumerate( this.component_parts, typeof(Obj_Item_Weapon_StockParts) )) {
				SP = _a;
				

				if ( SP is Obj_Item_Weapon_StockParts_Capacitor ) {
					capcount += SP.rating - 1;
				}

				if ( SP is Obj_Item_Weapon_StockParts_MatterBin ) {
					bincount += SP.rating;
				}
			}
			this.limit = bincount;
			this.speed_bonus = Num13.Round( capcount / 2, 1 );
			return null;
		}

	}

}