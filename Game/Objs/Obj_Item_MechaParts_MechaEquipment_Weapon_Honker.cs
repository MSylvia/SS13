// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_MechaParts_MechaEquipment_Weapon_Honker : Obj_Item_MechaParts_MechaEquipment_Weapon {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.energy_drain = 200;
			this.equip_cooldown = 150;
			this.range = 3;
			this.icon_state = "mecha_honker";
		}

		public Obj_Item_MechaParts_MechaEquipment_Weapon_Honker ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: weapons.dm
		public override bool action( dynamic target = null ) {
			Mob_Living_Carbon M = null;
			Mob_Living_Carbon H = null;
			dynamic T = null;

			
			if ( !( this.chassis != null ) ) {
				return false;
			}

			if ( this.energy_drain != 0 && Convert.ToDouble( this.chassis.get_charge() ) < this.energy_drain ) {
				return false;
			}

			if ( !this.equip_ready ) {
				return false;
			}
			GlobalFuncs.playsound( this.chassis, "sound/items/AirHorn.ogg", 100, 1 );
			this.chassis.occupant_message( "<font color='red' size='5'>HONK</font>" );

			foreach (dynamic _a in Lang13.Enumerate( Map13.FetchHearersExcludeThis( this.chassis, 6 ), typeof(Mob_Living_Carbon) )) {
				M = _a;
				

				if ( M is Mob_Living_Carbon_Human ) {
					H = M;

					if ( Lang13.Bool( ((dynamic)H).earprot() ) ) {
						continue;
					}
				}
				GlobalFuncs.to_chat( M, "<font color='red' size='7'>HONK</font>" );
				M.sleeping = 0;
				M.stuttering += 20;
				M.ear_deaf += 30;
				M.Weaken( 3 );

				if ( Rand13.PercentChance( 30 ) ) {
					M.Stun( 10 );
					M.Paralyse( 4 );
				} else {
					M.Jitter( 500 );
				}
			}
			this.chassis.use_power( this.energy_drain );
			this.log_message( "Honked from " + this.name + ". HONK!" );
			T = GlobalFuncs.get_turf( this );
			GlobalFuncs.message_admins( new Txt().item( GlobalFuncs.key_name( this.chassis.occupant, ((dynamic)this.chassis.occupant).client ) ).str( "(<A HREF='?_src_=holder;adminmoreinfo=" ).Ref( this.chassis.occupant ).str( "'>?</A>) used a Mecha Honker in (" ).item( T.x ).str( "," ).item( T.y ).str( "," ).item( T.z ).str( " - <A HREF='?_src_=holder;adminplayerobservecoodjump=1;X=" ).item( T.x ).str( ";Y=" ).item( T.y ).str( ";Z=" ).item( T.z ).str( "'>JMP</a>)" ).ToString() );
			GlobalVars.diary.WriteMsg( String13.HtmlDecode( "[" + GlobalFuncs.time_stamp() + "]GAME: " + ( "" + ((dynamic)this.chassis.occupant).ckey + "(" + this.chassis.occupant + ") used a Mecha Honker in (" + T.x + "," + T.y + "," + T.z + ")" ) ) );
			this.do_after_cooldown();
			return false;
		}

		// Function from file: weapons.dm
		public override bool can_attach( Obj_Mecha M = null ) {
			
			if ( base.can_attach( M ) ) {
				
				if ( M is Obj_Mecha_Combat_Honker ) {
					return true;
				}
			}
			return false;
		}

	}

}