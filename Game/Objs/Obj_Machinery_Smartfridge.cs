// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_Smartfridge : Obj_Machinery {

		public string icon_on = "smartfridge";
		public string icon_off = "smartfridge-off";
		public dynamic item_quants = new ByTable();
		public bool opened = false;
		public ByTable accepted_types = new ByTable(new object [] { 
											typeof(Obj_Item_Weapon_ReagentContainers_Food_Snacks_Grown), 
											typeof(Obj_Item_Weapon_Grown), 
											typeof(Obj_Item_Seeds), 
											typeof(Obj_Item_Weapon_ReagentContainers_Food_Snacks_Meat), 
											typeof(Obj_Item_Weapon_ReagentContainers_Food_Snacks_Egg)
										 });

		protected override void __FieldInit() {
			base.__FieldInit();

			this.anchored = 1;
			this.idle_power_usage = 5;
			this.active_power_usage = 100;
			this.flags = 16384;
			this.machine_flags = 38;
			this.light_color = "#7DE1E1";
			this.icon = "icons/obj/vending.dmi";
			this.icon_state = "smartfridge";
			this.layer = 2.9;
		}

		// Function from file: smartfridge.dm
		public Obj_Machinery_Smartfridge ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.component_parts = new ByTable(new object [] { 
				new Obj_Item_Weapon_Circuitboard_Smartfridge(), 
				new Obj_Item_Weapon_StockParts_Manipulator(), 
				new Obj_Item_Weapon_StockParts_Manipulator(), 
				new Obj_Item_Weapon_StockParts_MatterBin(), 
				new Obj_Item_Weapon_StockParts_MatterBin(), 
				new Obj_Item_Weapon_StockParts_MatterBin(), 
				new Obj_Item_Weapon_StockParts_MatterBin(), 
				new Obj_Item_Weapon_StockParts_ScanningModule(), 
				new Obj_Item_Weapon_StockParts_ConsoleScreen(), 
				new Obj_Item_Weapon_StockParts_ConsoleScreen()
			 });
			this.RefreshParts();
			return;
		}

		// Function from file: smartfridge.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hclient = null, HtmlInterface currui = null ) {
			string N = null;
			double? amount = null;
			double? i = null;
			Obj O = null;

			
			if ( Lang13.Bool( base.Topic( href, href_list, (object)(hclient) ) ) ) {
				return null;
			}
			Task13.User.set_machine( this );
			N = href_list["vend"];
			amount = String13.ParseNumber( href_list["amount"] );

			if ( Convert.ToDouble( this.item_quants[N] ) <= 0 ) {
				return null;
			}
			this.item_quants[N] = Num13.MaxInt( Convert.ToInt32( this.item_quants[N] - amount ), 0 );
			i = amount;

			foreach (dynamic _a in Lang13.Enumerate( this.contents, typeof(Obj) )) {
				O = _a;
				

				if ( O.name == N ) {
					O.loc = this.loc;
					i--;

					if ( ( i ??0) <= 0 ) {
						break;
					}
				}
			}
			this.updateUsrDialog();
			return null;
		}

		// Function from file: smartfridge.dm
		public override dynamic interact( dynamic user = null, bool? flag1 = null ) {
			string dat = null;
			dynamic O = null;
			int N = 0;

			
			if ( ( this.stat & 2 ) != 0 ) {
				return null;
			}
			dat = "<TT><b>Select an item:</b><br>";

			if ( this.contents.len == 0 ) {
				dat += "<font color = 'red'>No product loaded!</font>";
			} else {
				
				foreach (dynamic _a in Lang13.Enumerate( this.item_quants )) {
					O = _a;
					

					if ( Convert.ToDouble( this.item_quants[O] ) > 0 ) {
						N = Convert.ToInt32( this.item_quants[O] );
						dat += new Txt( "<FONT color = 'blue'><B>" ).item( GlobalFuncs.capitalize( O ) ).str( "</B>:\n					" ).item( N ).str( " </font>\n					<a href='byond://?src=" ).Ref( this ).str( ";vend=" ).item( O ).str( ";amount=1'>Vend</A> " ).ToString();

						if ( N > 5 ) {
							dat += new Txt( "(<a href='byond://?src=" ).Ref( this ).str( ";vend=" ).item( O ).str( ";amount=5'>x5</A>)" ).ToString();

							if ( N > 10 ) {
								dat += new Txt( "(<a href='byond://?src=" ).Ref( this ).str( ";vend=" ).item( O ).str( ";amount=10'>x10</A>)" ).ToString();

								if ( N > 25 ) {
									dat += new Txt( "(<a href='byond://?src=" ).Ref( this ).str( ";vend=" ).item( O ).str( ";amount=25'>x25</A>)" ).ToString();
								}
							}
						}

						if ( N > 1 ) {
							dat += new Txt( "(<a href='?src=" ).Ref( this ).str( ";vend=" ).item( O ).str( ";amount=" ).item( N ).str( "'>All</A>)" ).ToString();
						}
						dat += "<br>";
					}
				}
				dat += "</TT>";
			}
			Interface13.Browse( user, "<HEAD><TITLE>" + this + " Supplies</TITLE></HEAD><TT>" + dat + "</TT>", "window=smartfridge" );
			GlobalFuncs.onclose( user, "smartfridge" );
			return null;
		}

		// Function from file: smartfridge.dm
		public override dynamic attack_hand( dynamic a = null, dynamic b = null, dynamic c = null ) {
			((Mob)a).set_machine( this );
			this.interact( a );
			return null;
		}

		// Function from file: smartfridge.dm
		public override dynamic attack_ai( dynamic user = null ) {
			return this.attack_hand( user );
		}

		// Function from file: smartfridge.dm
		public override dynamic attack_paw( Mob a = null, dynamic b = null, dynamic c = null ) {
			return this.attack_hand( a );
		}

		// Function from file: smartfridge.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			string sanitized_name = null;
			dynamic bag = null;
			int objects_loaded = 0;
			Obj G = null;
			string sanitized_name2 = null;
			ByTable params_list = null;
			double clamp_x = 0;
			double clamp_y = 0;

			
			if ( ( this.stat & 2 ) != 0 ) {
				GlobalFuncs.to_chat( b, new Txt( "<span class='notice'>" ).The( this ).item().str( " is unpowered and useless.</span>" ).ToString() );
				return 1;
			}

			if ( Lang13.Bool( base.attackby( (object)(a), (object)(b), (object)(c) ) ) ) {
				return 1;
			}

			if ( this.accept_check( a ) ) {
				
				if ( this.contents.len >= 999 ) {
					GlobalFuncs.to_chat( b, new Txt( "<span class='notice'>" ).The( this ).item().str( " is full.</span>" ).ToString() );
					return 1;
				} else {
					
					if ( !Lang13.Bool( b.drop_item( a, this ) ) ) {
						return 1;
					}
					sanitized_name = GlobalFuncs.sanitize( a.name, new ByTable().Set( "\"", "" ).Set( "'", "" ).Set( "+", "plus" ).Set( ";", "" ).Set( "^", "" ).Set( "&", "" ).Set( "<", "" ).Set( ">", "" ) );
					a.name = sanitized_name;

					if ( Lang13.Bool( this.item_quants[sanitized_name] ) ) {
						this.item_quants[sanitized_name]++;
					} else {
						this.item_quants[sanitized_name] = 1;
					}
					((Ent_Static)b).visible_message( new Txt( "<span class='notice'>" ).item( b ).str( " has added " ).the( a ).item().str( " to " ).the( this ).item().str( "." ).ToString(), new Txt( "<span class='notice'>You add " ).the( a ).item().str( " to " ).the( this ).item().str( "." ).ToString() );
				}
			} else if ( a is Obj_Item_Weapon_Storage_Bag ) {
				bag = a;
				objects_loaded = 0;

				foreach (dynamic _a in Lang13.Enumerate( bag.contents, typeof(Obj) )) {
					G = _a;
					

					if ( this.accept_check( G ) ) {
						
						if ( this.contents.len >= 999 ) {
							GlobalFuncs.to_chat( b, new Txt( "<span class='notice'>" ).The( this ).item().str( " is full.</span>" ).ToString() );
							return 1;
						} else {
							((Obj_Item_Weapon_Storage)bag).remove_from_storage( G, this );
							sanitized_name2 = GlobalFuncs.sanitize( G.name, new ByTable().Set( "\"", "" ).Set( "'", "" ).Set( "+", "plus" ).Set( ";", "" ).Set( "^", "" ).Set( "&", "" ).Set( "<", "" ).Set( ">", "" ) );
							G.name = sanitized_name2;

							if ( Lang13.Bool( this.item_quants[sanitized_name2] ) ) {
								this.item_quants[sanitized_name2]++;
							} else {
								this.item_quants[sanitized_name2] = 1;
							}
							objects_loaded++;
						}
					}
				}

				if ( objects_loaded != 0 ) {
					((Ent_Static)b).visible_message( new Txt( "<span class='notice'>" ).item( b ).str( " loads " ).the( this ).item().str( " with " ).the( bag ).item().str( ".</span>" ).ToString(), new Txt( "<span class='notice'>You load " ).the( this ).item().str( " with " ).the( bag ).item().str( ".</span>" ).ToString() );

					if ( bag.contents.len > 0 ) {
						GlobalFuncs.to_chat( b, "<span class='notice'>Some items are refused.</span>" );
					}
				}
			} else if ( a is Obj_Item_Weapon_Paper && Lang13.Bool( b.drop_item( a, this.loc ) ) ) {
				params_list = String13.ParseUrlParams( c );

				if ( a.loc == this.loc && params_list.len != 0 ) {
					clamp_x = 16;
					clamp_y = 16;
					a.pixel_x = ( ( String13.ParseNumber( params_list["icon-x"] ) ??0) - clamp_x <= -clamp_x ? -clamp_x : ( ( String13.ParseNumber( params_list["icon-x"] ) ??0) - clamp_x >= clamp_x ? clamp_x : ( String13.ParseNumber( params_list["icon-x"] ) ??0) - clamp_x ) );
					a.pixel_y = ( ( String13.ParseNumber( params_list["icon-y"] ) ??0) - clamp_y <= -clamp_y ? -clamp_y : ( ( String13.ParseNumber( params_list["icon-y"] ) ??0) - clamp_y >= clamp_y ? clamp_y : ( String13.ParseNumber( params_list["icon-y"] ) ??0) - clamp_y ) );
					GlobalFuncs.to_chat( b, new Txt( "<span class='notice'>You hang " ).the( a.name ).item().str( " on the fridge.</span>" ).ToString() );
				}
			} else {
				GlobalFuncs.to_chat( b, new Txt( "<span class='notice'>" ).The( this ).item().str( " smartly refuses " ).item( a ).str( ".</span>" ).ToString() );
				return 1;
			}
			this.item_quants = GlobalFuncs.sortList( this.item_quants );
			this.updateUsrDialog();
			return 1;
		}

		// Function from file: smartfridge.dm
		public override dynamic power_change(  ) {
			base.power_change();

			if ( !( ( this.stat & 3 ) != 0 ) ) {
				this.set_light( 2 );
			} else {
				this.set_light( 0 );
			}
			return null;
		}

		// Function from file: smartfridge.dm
		public bool accept_check( dynamic O = null, dynamic user = null ) {
			dynamic ac_type = null;

			
			foreach (dynamic _a in Lang13.Enumerate( this.accepted_types )) {
				ac_type = _a;
				

				if ( Lang13.Bool( ac_type.IsInstanceOfType( O ) ) ) {
					return true;
				}
			}
			return false;
		}

	}

}