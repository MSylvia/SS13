// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_MechaParts_MechaEquipment : Obj_Item_MechaParts {

		public double equip_cooldown = 0;
		public bool equip_ready = true;
		public int energy_drain = 0;
		public Obj_Mecha chassis = null;
		public int range = 1;
		public bool salvageable = true;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.force = 5;
			this.origin_tech = "materials=2";
			this.reliability = 1000;
			this.icon = "icons/mecha/mecha_equipment.dmi";
			this.icon_state = "mecha_equip";
		}

		// Function from file: mecha_equipment.dm
		public Obj_Item_MechaParts_MechaEquipment ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			return;
		}

		// Function from file: mecha_equipment.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hclient = null, HtmlInterface currui = null ) {
			Game13.log.WriteMsg( "## TESTING: " + ( "" + this + " topic" ) );

			if ( Lang13.Bool( href_list["detach"] ) ) {
				this.detach();
			}
			return null;
		}

		// Function from file: mecha_equipment.dm
		public void log_message( string message = null ) {
			
			if ( this.chassis != null ) {
				this.chassis.log_message( "<i>" + this + ":</i> " + message );
			}
			return;
		}

		// Function from file: mecha_equipment.dm
		public void occupant_message( string message = null ) {
			
			if ( this.chassis != null ) {
				this.chassis.occupant_message( new Txt().icon( this ).str( " " ).item( message ).ToString() );
			}
			return;
		}

		// Function from file: mecha_equipment.dm
		public void set_ready_state( bool state = false ) {
			this.equip_ready = state;

			if ( this.chassis != null ) {
				GlobalFuncs.send_byjax( this.chassis.occupant, "exosuit.browser", new Txt().Ref( this ).ToString(), this.get_equip_info() );
			}
			return;
		}

		// Function from file: mecha_equipment.dm
		public virtual void detach( dynamic moveto = null ) {
			
			if ( !Lang13.Bool( moveto ) ) {
				moveto = GlobalFuncs.get_turf( this.chassis );
			}
			this.loc = moveto;
			this.chassis.equipment.Remove( this );

			if ( this.chassis.selected == this ) {
				this.chassis.selected = null;
			}
			this.update_chassis_page();
			this.chassis.log_message( "" + this + " removed from equipment." );
			this.chassis = null;
			this.set_ready_state( true );
			return;
		}

		// Function from file: mecha_equipment.dm
		public virtual void attach( Obj_Mecha M = null ) {
			M.equipment.Add( this );
			this.chassis = M;
			this.loc = M;
			M.log_message( "" + this + " initialized." );

			if ( !Lang13.Bool( M.selected ) ) {
				M.selected = this;
			}
			this.update_chassis_page();
			return;
		}

		// Function from file: mecha_equipment.dm
		public virtual bool can_attach( Obj_Mecha M = null ) {
			
			if ( M is Obj_Mecha ) {
				
				if ( M.equipment.len < M.max_equip ) {
					return true;
				}
			}
			return false;
		}

		// Function from file: mecha_equipment.dm
		public virtual bool action( dynamic target = null ) {
			return false;
		}

		// Function from file: mecha_equipment.dm
		public virtual bool action_checks( dynamic target = null ) {
			
			if ( !Lang13.Bool( target ) ) {
				return false;
			}

			if ( !( this.chassis != null ) ) {
				return false;
			}

			if ( !this.equip_ready ) {
				return false;
			}

			if ( this.crit_fail ) {
				return false;
			}

			if ( this.energy_drain != 0 && !this.chassis.has_charge( this.energy_drain ) ) {
				return false;
			}
			return true;
		}

		// Function from file: mecha_equipment.dm
		public int is_melee(  ) {
			return this.range & 1;
		}

		// Function from file: mecha_equipment.dm
		public int is_ranged(  ) {
			return this.range & 2;
		}

		// Function from file: mecha_equipment.dm
		public virtual string get_equip_info(  ) {
			
			if ( !( this.chassis != null ) ) {
				return null;
			}
			return "<span style=\"color:" + ( this.equip_ready ? "#0f0" : "#f00" ) + ";\">*</span>&nbsp;" + ( this.chassis.selected == this ? "<b>" : new Txt( "<a href='?src=" ).Ref( this.chassis ).str( ";select_equip=" ).Ref( this ).str( "'>" ).ToString() ) + this.name + ( this.chassis.selected == this ? "</b>" : "</a>" );
		}

		// Function from file: mecha_equipment.dm
		public virtual void critfail(  ) {
			
			if ( this.chassis != null ) {
				this.log_message( "Critical failure" );
			}
			return;
		}

		// Function from file: mecha_equipment.dm
		public virtual void destroy(  ) {
			
			if ( this.chassis != null ) {
				this.chassis.equipment.Remove( this );
				GlobalFuncs.listclearnulls( this.chassis.equipment );

				if ( this.chassis.selected == this ) {
					this.chassis.selected = null;
				}
				this.update_chassis_page();
				this.chassis.occupant_message( "<font color='red'>The " + this + " is destroyed!</font>" );
				this.chassis.log_append_to_last( "" + this + " is destroyed.", true );

				if ( this is Obj_Item_MechaParts_MechaEquipment_Weapon ) {
					GlobalFuncs.to_chat( this.chassis.occupant, new Sound( "sound/mecha/weapdestr.ogg", null, null, null, 50 ) );
				} else {
					GlobalFuncs.to_chat( this.chassis.occupant, new Sound( "sound/mecha/critdestr.ogg", null, null, null, 50 ) );
				}
			}
			Task13.Schedule( 0, (Task13.Closure)(() => {
				GlobalFuncs.qdel( this );
				return;
			}));
			return;
		}

		// Function from file: mecha_equipment.dm
		public virtual bool update_equip_info(  ) {
			
			if ( this.chassis != null ) {
				GlobalFuncs.send_byjax( this.chassis.occupant, "exosuit.browser", new Txt().Ref( this ).ToString(), this.get_equip_info() );
				return true;
			}
			return false;
		}

		// Function from file: mecha_equipment.dm
		public bool update_chassis_page(  ) {
			
			if ( this.chassis != null ) {
				GlobalFuncs.send_byjax( this.chassis.occupant, "exosuit.browser", "eq_list", this.chassis.get_equipment_list() );
				GlobalFuncs.send_byjax( this.chassis.occupant, "exosuit.browser", "equipment_menu", this.chassis.get_equipment_menu(), "dropdowns" );
				return true;
			}
			return false;
		}

		// Function from file: mecha_equipment.dm
		public virtual bool do_after_cooldown( dynamic target = null, double? delay_mult = null ) {
			target = target ?? 1;
			delay_mult = delay_mult ?? 1;

			Task13.Sleep( ((int)( this.equip_cooldown * ( delay_mult ??0) )) );
			this.set_ready_state( true );

			if ( Lang13.Bool( target ) && this.chassis != null ) {
				return true;
			}
			return false;
		}

	}

}