// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_Circuitboard_Airlock : Obj_Item_Weapon_Circuitboard {

		public dynamic conf_access = null;
		public bool one_access = false;
		public string last_configurator = null;
		public bool locked = true;
		public bool installed = false;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.board_type = "other";
			this.starting_materials = new ByTable().Set( "$iron", 50 ).Set( "$glass", 50 );
			this.melt_temperature = 1687;
			this.req_access = new ByTable(new object [] { 11 });
			this.icon = "icons/obj/doors/door_assembly.dmi";
			this.icon_state = "door_electronics";
		}

		public Obj_Item_Weapon_Circuitboard_Airlock ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: airlock_electronics.dm
		public void toggle_access( string acc = null ) {
			double? req = null;

			
			if ( acc == "all" ) {
				this.conf_access = null;
			} else {
				req = String13.ParseNumber( acc );

				if ( this.conf_access == null ) {
					this.conf_access = new ByTable();
				}

				if ( !Lang13.Bool( this.conf_access.Contains( req ) ) ) {
					this.conf_access += req;
				} else {
					this.conf_access -= req;

					if ( !( this.conf_access.len != 0 ) ) {
						this.conf_access = null;
					}
				}
			}
			return;
		}

		// Function from file: airlock_electronics.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hclient = null, HtmlInterface currui = null ) {
			Mob H = null;
			dynamic I = null;
			dynamic pda = null;

			
			if ( Lang13.Bool( base.Topic( href, href_list, (object)(hclient) ) ) ) {
				return 1;
			}

			if ( !this.Adjacent( Task13.User ) || Lang13.Bool( Task13.User.stat ) || Task13.User.restrained() || !( Task13.User is Mob_Living_Carbon_Human ) && !( Task13.User is Mob_Living_Silicon_Robot ) || this.icon_state == "door_electronics_smoked" || this.installed ) {
				return null;
			}

			if ( Lang13.Bool( href_list["close"] ) ) {
				Interface13.Browse( Task13.User, null, "window=airlock" );
				return null;
			}

			if ( Lang13.Bool( href_list["login"] ) ) {
				
				if ( Task13.User is Mob_Living_Carbon_Human ) {
					H = Task13.User;
					I = Task13.User.get_active_hand();

					if ( !( I is Obj_Item_Weapon_Card ) || !( I is Obj_Item_Device_Pda ) ) {
						I = ((dynamic)H).wear_id;
					}

					if ( !Lang13.Bool( I ) && ( ((dynamic)H).wear_id is Obj_Item_Weapon_Card || ((dynamic)H).wear_id is Obj_Item_Device_Pda ) ) {
						I = ((dynamic)H).wear_id;
					}

					if ( I is Obj_Item_Device_Pda ) {
						pda = I;
						I = pda.id;
					}

					if ( Lang13.Bool( I ) && this.check_access( I ) ) {
						this.locked = false;
						this.last_configurator = I.registered_name;
					}
				}

				if ( Task13.User is Mob_Living_Silicon_Robot ) {
					this.locked = false;
					this.last_configurator = Task13.User.name;
				}
			}

			if ( this.locked ) {
				return null;
			}

			if ( Lang13.Bool( href_list["logout"] ) ) {
				this.locked = true;
			}

			if ( Lang13.Bool( href_list["one_access"] ) ) {
				this.one_access = !this.one_access;
			}

			if ( Lang13.Bool( href_list["access"] ) ) {
				this.toggle_access( href_list["access"] );
			}
			this.interact( Task13.User );
			return null;
		}

		// Function from file: airlock_electronics.dm
		public override dynamic interact( dynamic user = null, bool? flag1 = null ) {
			string t1 = null;
			ByTable accesses = null;
			dynamic acc = null;
			string aname = null;

			t1 = "<B>Access control</B><br>\n";

			if ( Lang13.Bool( this.last_configurator ) ) {
				t1 += "Operator: " + this.last_configurator + "<br>";
			}

			if ( this.locked ) {
				
				if ( user is Mob_Living_Silicon_Robot ) {
					t1 += new Txt( "<a href='?src=" ).Ref( this ).str( ";login=1'>Log In</a><hr>" ).ToString();
				} else {
					t1 += new Txt( "<a href='?src=" ).Ref( this ).str( ";login=1'>Swipe ID</a><hr>" ).ToString();
				}
			} else {
				t1 += new Txt( "<a href='?src=" ).Ref( this ).str( ";logout=1'>Block</a><hr>" ).ToString();
				t1 += "Access requirement is set to ";
				t1 += ( this.one_access ? new Txt( "<a style='color: green' href='?src=" ).Ref( this ).str( ";one_access=1'>ONE</a><hr>" ).ToString() : new Txt( "<a style='color: red' href='?src=" ).Ref( this ).str( ";one_access=1'>ALL</a><hr>" ).ToString() );
				t1 += ( this.conf_access == null ? "<font color=red>All</font><br>" : new Txt( "<a href='?src=" ).Ref( this ).str( ";access=all'>All</a><br>" ).ToString() );
				t1 += "<br>";
				accesses = GlobalFuncs.get_all_accesses();

				foreach (dynamic _a in Lang13.Enumerate( accesses )) {
					acc = _a;
					
					aname = GlobalFuncs.get_access_desc( acc );

					if ( !Lang13.Bool( this.conf_access ) || !( this.conf_access.len != 0 ) || !Lang13.Bool( this.conf_access.Contains( acc ) ) ) {
						t1 += new Txt( "<a href='?src=" ).Ref( this ).str( ";access=" ).item( acc ).str( "'>" ).item( aname ).str( "</a><br>" ).ToString();
					} else if ( this.one_access ) {
						t1 += new Txt( "<a style='color: green' href='?src=" ).Ref( this ).str( ";access=" ).item( acc ).str( "'>" ).item( aname ).str( "</a><br>" ).ToString();
					} else {
						t1 += new Txt( "<a style='color: red' href='?src=" ).Ref( this ).str( ";access=" ).item( acc ).str( "'>" ).item( aname ).str( "</a><br>" ).ToString();
					}
				}
			}
			t1 += new Txt( "<p><a href='?src=" ).Ref( this ).str( ";close=1'>Close</a></p>\n" ).ToString();
			Interface13.Browse( user, t1, "window=airlock_electronics" );
			GlobalFuncs.onclose( user, "airlock" );
			return null;
		}

		// Function from file: airlock_electronics.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			dynamic H = null;

			
			if ( !( user is Mob_Living_Carbon_Human ) && !( user is Mob_Living_Silicon_Robot ) ) {
				return base.attack_self( (object)(user), (object)(flag), emp );
			}

			if ( this.icon_state == "door_electronics_smoked" ) {
				return null;
			}

			if ( user is Mob_Living_Carbon_Human ) {
				H = user;

				if ( ((Mob_Living)H).getBrainLoss() >= 60 ) {
					return null;
				}
			}
			this.interact( user );
			return null;
		}

		// Function from file: airlock_electronics.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			dynamic S = null;

			
			if ( a is Obj_Item_Weapon_Solder ) {
				S = a;

				if ( this.icon_state == "door_electronics_smoked" ) {
					
					if ( !Lang13.Bool( S.remove_fuel( 4, b ) ) ) {
						return null;
					}
					GlobalFuncs.playsound( this.loc, "sound/items/welder.ogg", 100, 1 );

					if ( GlobalFuncs.do_after( b, this, 40 ) ) {
						GlobalFuncs.playsound( this.loc, "sound/items/welder.ogg", 100, 1 );
						this.icon_state = "door_electronics";
						GlobalFuncs.to_chat( b, "<span class='notice'>You repair the blown fuses on the circuitboard.</span>" );
					}
				}
			}
			return null;
		}

		// Function from file: airlock_electronics.dm
		public override dynamic attack_robot( Mob_Living_Silicon_Robot user = null ) {
			
			if ( user is Mob_Living_Silicon_Robot_Mommi ) {
				return base.attack_robot( user );
			}
			this.attack_self( user );
			return 1;
		}

	}

}