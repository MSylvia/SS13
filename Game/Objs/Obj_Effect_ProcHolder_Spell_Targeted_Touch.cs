// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_ProcHolder_Spell_Targeted_Touch : Obj_Effect_ProcHolder_Spell_Targeted {

		public string hand_path = "/obj/item/weapon/melee/touch_attack";
		public dynamic attached_hand = null;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.include_user = true;
			this.range = -1;
		}

		public Obj_Effect_ProcHolder_Spell_Targeted_Touch ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: touch_attacks.dm
		public bool ChargeHand( Mob_Living_Carbon user = null ) {
			bool hand_handled = false;

			hand_handled = true;
			this.attached_hand = Lang13.Call( this.hand_path, this );

			if ( user.hand ) {
				
				if ( !user.equip_to_slot_if_possible( this.attached_hand, 4, false, true, true ) ) {
					
					if ( !user.equip_to_slot_if_possible( this.attached_hand, 5, false, true, true ) ) {
						hand_handled = false;
					}
				}
			} else if ( !user.equip_to_slot_if_possible( this.attached_hand, 5, false, true, true ) ) {
				
				if ( !user.equip_to_slot_if_possible( this.attached_hand, 4, false, true, true ) ) {
					hand_handled = false;
				}
			}

			if ( !hand_handled ) {
				GlobalFuncs.qdel( this.attached_hand );
				this.charge_counter = this.charge_max;
				this.attached_hand = null;
				user.WriteMsg( "<span class='warning'>Your hands are full!</span>" );
				return false;
			}
			user.WriteMsg( "<span class='notice'>You channel the power of the spell to your hand.</span>" );
			return true;
		}

		// Function from file: touch_attacks.dm
		public override bool cast( dynamic targets = null, dynamic thearea = null, dynamic user = null ) {
			thearea = thearea ?? Task13.User;

			Mob_Living_Carbon C = null;

			
			foreach (dynamic _a in Lang13.Enumerate( targets, typeof(Mob_Living_Carbon) )) {
				C = _a;
				

				if ( !Lang13.Bool( this.attached_hand ) ) {
					
					if ( !this.ChargeHand( C ) ) {
						return false;
					}
				}
			}

			while (Lang13.Bool( this.attached_hand )) {
				this.charge_counter = 0;
				Task13.Sleep( 1 );
			}
			return false;
		}

		// Function from file: touch_attacks.dm
		public override bool Click( dynamic loc = null, string control = null, string _params = null ) {
			loc = loc ?? Task13.User;

			
			if ( Lang13.Bool( this.attached_hand ) ) {
				GlobalFuncs.qdel( this.attached_hand );
				this.charge_counter = this.charge_max;
				this.attached_hand = null;
				loc.WriteMsg( "<span class='notice'>You draw the power out of your hand.</span>" );
				return false;
			}
			base.Click( (object)(loc), control, _params );
			return false;
		}

	}

}