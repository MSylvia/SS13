// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_Gun_Projectile_Revolver_Detective : Obj_Item_Weapon_Gun_Projectile_Revolver {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.mag_type = typeof(Obj_Item_AmmoBox_Magazine_Internal_Cylinder_Rev38);
			this.unique_rename = true;
			this.unique_reskin = true;
		}

		// Function from file: revolver.dm
		public Obj_Item_Weapon_Gun_Projectile_Revolver_Detective ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.options["Default"] = "detective";
			this.options["Leopard Spots"] = "detective_leopard";
			this.options["Black Panther"] = "detective_panther";
			this.options["Gold Trim"] = "detective_gold";
			this.options["The Peacemaker"] = "detective_peacemaker";
			this.options["Cancel"] = null;
			return;
		}

		// Function from file: revolver.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			base.attackby( (object)(A), (object)(user), _params, silent, replace_spent );

			if ( A is Obj_Item_Weapon_Screwdriver ) {
				
				if ( this.magazine.caliber == "38" ) {
					user.WriteMsg( "<span class='notice'>You begin to reinforce the barrel of " + this + "...</span>" );

					if ( ((Obj_Item_AmmoBox_Magazine)this.magazine).ammo_count() != 0 ) {
						this.afterattack( user, user );
						((Ent_Static)user).visible_message( "<span class='danger'>" + this + " goes off!</span>", "<span class='userdanger'>" + this + " goes off in your face!</span>" );
						return null;
					}

					if ( GlobalFuncs.do_after( user, 30 / A.toolspeed, null, this ) ) {
						
						if ( ((Obj_Item_AmmoBox_Magazine)this.magazine).ammo_count() != 0 ) {
							user.WriteMsg( "<span class='warning'>You can't modify it!</span>" );
							return null;
						}
						this.magazine.caliber = "357";
						this.desc = "The barrel and chamber assembly seems to have been modified.";
						user.WriteMsg( "<span class='notice'>You reinforce the barrel of " + this + ". Now it will fire .357 rounds.</span>" );
					}
				} else {
					user.WriteMsg( "<span class='notice'>You begin to revert the modifications to " + this + "...</span>" );

					if ( ((Obj_Item_AmmoBox_Magazine)this.magazine).ammo_count() != 0 ) {
						this.afterattack( user, user );
						((Ent_Static)user).visible_message( "<span class='danger'>" + this + " goes off!</span>", "<span class='userdanger'>" + this + " goes off in your face!</span>" );
						return null;
					}

					if ( GlobalFuncs.do_after( user, 30 / A.toolspeed, null, this ) ) {
						
						if ( ((Obj_Item_AmmoBox_Magazine)this.magazine).ammo_count() != 0 ) {
							user.WriteMsg( "<span class='warning'>You can't modify it!</span>" );
							return null;
						}
						this.magazine.caliber = "38";
						this.desc = Lang13.Initial( this, "desc" );
						user.WriteMsg( "<span class='notice'>You remove the modifications on " + this + ". Now it will fire .38 rounds.</span>" );
					}
				}
			}
			return null;
		}

		// Function from file: revolver.dm
		public override bool process_fire( dynamic target = null, dynamic user = null, bool? message = null, string _params = null, string zone_override = null ) {
			message = message ?? true;
			zone_override = zone_override ?? "";

			
			if ( this.magazine.caliber != Lang13.Initial( this.magazine, "caliber" ) ) {
				
				if ( Rand13.PercentChance( 70 - ((Obj_Item_AmmoBox_Magazine)this.magazine).ammo_count() * 10 ) ) {
					GlobalFuncs.playsound( user, this.fire_sound, 50, 1 );
					user.WriteMsg( "<span class='userdanger'>" + this + " blows up in your face!</span>" );
					((Mob_Living)user).take_organ_damage( 0, 20 );
					((Mob)user).unEquip( this );
					return false;
				}
			}
			base.process_fire( (object)(target), (object)(user), message, _params, zone_override );
			return false;
		}

	}

}