// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_AutoCloner : Obj_Machinery {

		public dynamic spawn_type = null;
		public int current_ticks_spawning = 0;
		public int ticks_required_to_spawn = 0;
		public bool previous_power_state = false;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.active_power_usage = 2000;
			this.idle_power_usage = 1000;
			this.machine_flags = 8;
			this.icon = "icons/obj/cryogenics.dmi";
			this.icon_state = "cellold0";
		}

		// Function from file: artifact_autocloner.dm
		public Obj_Machinery_AutoCloner ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.ticks_required_to_spawn = Rand13.Int( 60, 360 );

			if ( Rand13.PercentChance( 33 ) ) {
				this.spawn_type = Rand13.Pick(new object [] { typeof(Mob_Living_SimpleAnimal_Hostile_GiantSpider_Nurse), typeof(Mob_Living_SimpleAnimal_Hostile_Alien), typeof(Mob_Living_SimpleAnimal_Hostile_Bear), typeof(Mob_Living_SimpleAnimal_Hostile_Creature) });
			} else {
				this.spawn_type = Rand13.Pick(new object [] { typeof(Mob_Living_SimpleAnimal_Cat), typeof(Mob_Living_SimpleAnimal_Corgi), typeof(Mob_Living_SimpleAnimal_Corgi_Puppy), typeof(Mob_Living_SimpleAnimal_Chicken), typeof(Mob_Living_SimpleAnimal_Cow), typeof(Mob_Living_SimpleAnimal_Parrot), typeof(Mob_Living_SimpleAnimal_Slime), typeof(Mob_Living_SimpleAnimal_Crab), typeof(Mob_Living_SimpleAnimal_Mouse), typeof(Mob_Living_SimpleAnimal_Hostile_Retaliate_Goat), typeof(Mob_Living_Carbon_Monkey) });
			}
			return;
		}

		// Function from file: artifact_autocloner.dm
		public override dynamic attackby( dynamic a = null, dynamic b = null, dynamic c = null ) {
			
			if ( a is Obj_Item_Weapon_Wrench ) {
				return base.attackby( (object)(a), (object)(b), (object)(c) );
			} else if ( Convert.ToDouble( a.force ) > 10 ) {
				GlobalVars.diaryofmeanpeople.WriteMsg( String13.HtmlDecode( "[" + GlobalFuncs.time_stamp() + "]ATTACK: " + ( "<font color='red'>" + b + " damaged " + this + "/(" + GlobalFuncs.formatJumpTo( this ) + ") with " + a + "</font>" ) ) );
				this.visible_message( new Txt( "<span class='warning'>" ).The( b ).item().str( " damages " ).the( this ).item().str( " with " ).the( a ).item().str( ".</span>" ).ToString() );

				if ( Rand13.PercentChance( Convert.ToInt32( a.force / 2 ) ) ) {
					GlobalFuncs.msg_admin_attack( "" + b + " blew up " + this + "/(" + GlobalFuncs.formatJumpTo( this ) + ") with " + a + " (<A HREF='?_src_=holder;adminplayerobservecoodjump=1;X=" + b.x + ";Y=" + b.y + ";Z=" + b.z + "'>JMP</a>)" );
					GlobalFuncs.explosion( GlobalFuncs.get_turf( this ), 1, 2, 3, 3 );
					GlobalFuncs.qdel( this );
				}
			} else {
				this.visible_message( new Txt( "<span class='warning'>" ).The( b ).item().str( " taps " ).the( this ).item().str( " with " ).the( a ).item().str( ".</span>" ).ToString() );
			}
			return null;
		}

		// Function from file: artifact_autocloner.dm
		public override int? bullet_act( dynamic Proj = null, dynamic def_zone = null ) {
			
			if ( Proj is Obj_Item_Projectile_Beam || Proj is Obj_Item_Projectile_Bullet || Proj is Obj_Item_Projectile_Ricochet ) {
				GlobalVars.diaryofmeanpeople.WriteMsg( String13.HtmlDecode( "[" + GlobalFuncs.time_stamp() + "]ATTACK: " + ( "<font color='red'>" + ( Lang13.Bool( Proj.firer ) ? "" + GlobalFuncs.key_name( Proj.firer ) : "Something" ) + " shot " + this + "/(" + GlobalFuncs.formatJumpTo( this ) + ") with a " + Proj.type + "</font>" ) ) );
				this.visible_message( new Txt( "<span class='notice'>" ).The( Proj ).item().str( " " ).item( ( Lang13.Bool( Proj.damage ) ? "hits" : "glances off" ) ).str( " " ).the( this ).item().str( "!</span>" ).ToString() );

				if ( Rand13.PercentChance( Convert.ToInt32( Proj.damage / 2 ) ) ) {
					
					if ( Lang13.Bool( Proj.firer ) ) {
						GlobalFuncs.msg_admin_attack( "" + GlobalFuncs.key_name( Proj.firer ) + " blew up " + this + "/(" + GlobalFuncs.formatJumpTo( this ) + ") with a " + Proj.type + " (<A HREF='?_src_=holder;adminplayerobservecoodjump=1;X=" + Proj.firer.x + ";Y=" + Proj.firer.y + ";Z=" + Proj.firer.z + "'>JMP</a>)" );
					}
					GlobalFuncs.explosion( GlobalFuncs.get_turf( this ), 1, 2, 3, 3 );
					GlobalFuncs.qdel( this );
				}
			}
			return null;
		}

		// Function from file: artifact_autocloner.dm
		public override dynamic process(  ) {
			
			if ( Lang13.Bool( this.powered( this.power_channel ) ) ) {
				
				if ( !this.previous_power_state ) {
					this.previous_power_state = true;
					this.icon_state = "cellold1";
					this.visible_message( new Txt( "<span class='notice'>" ).icon( this ).str( " " ).item( this ).str( " suddenly comes to life!</span>" ).ToString() );
				}
				this.current_ticks_spawning++;

				if ( Rand13.PercentChance( 5 ) ) {
					this.visible_message( new Txt( "<span class='notice'>" ).icon( this ).str( " " ).item( this ).str( " " ).item( Rand13.Pick(new object [] { "gloops", "glugs", "whirrs", "whooshes", "hisses", "purrs", "hums", "gushes" }) ).str( ".</span>" ).ToString() );
				}

				if ( this.current_ticks_spawning >= this.ticks_required_to_spawn ) {
					this.current_ticks_spawning = 0;
					this.use_power = 1;
					this.visible_message( new Txt( "<span class='notice'>" ).icon( this ).str( " " ).item( this ).str( " pings!</span>" ).ToString() );
					this.icon_state = "cellold1";
					this.desc = "It's full of a bubbling viscous liquid, and is lit by a mysterious glow.";

					if ( Lang13.Bool( this.spawn_type ) ) {
						Lang13.Call( this.spawn_type, this.loc );
						GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/machines/heps.ogg", 50, 0 );
					}
				}

				if ( this.current_ticks_spawning / this.ticks_required_to_spawn > 0.75 ) {
					this.use_power = 2;
					this.icon_state = "cellold2";
					this.desc = "It's full of a bubbling viscous liquid, and is lit by a mysterious glow. A dark shape appears to be forming inside...";
				} else {
					this.use_power = 1;
					this.icon_state = "cellold1";
					this.desc = "It's full of a bubbling viscous liquid, and is lit by a mysterious glow.";
				}
			} else {
				
				if ( this.previous_power_state ) {
					this.previous_power_state = false;
					this.icon_state = "cellold0";
					this.visible_message( new Txt( "<span class='notice'>" ).icon( this ).str( " " ).item( this ).str( " suddenly shuts down.</span>" ).ToString() );
				}

				if ( this.current_ticks_spawning > 0 ) {
					this.current_ticks_spawning--;
				}
			}
			return null;
		}

	}

}