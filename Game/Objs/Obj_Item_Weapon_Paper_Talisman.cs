// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_Paper_Talisman : Obj_Item_Weapon_Paper {

		public dynamic imbue = null;
		public int uses = 0;
		public bool nullblock = false;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.icon_state = "paper_talisman";
		}

		// Function from file: talisman.dm
		public Obj_Item_Weapon_Paper_Talisman ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.pixel_x = 0;
			this.pixel_y = 0;
			return;
		}

		// Function from file: talisman.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hclient = null, HtmlInterface currui = null ) {
			Obj_Item_Weapon_Paper_Talisman T = null;
			Obj_Item_Weapon_Paper_Talisman T2 = null;
			ByTable words = null;
			Obj_Item_Weapon_Paper_Talisman T3 = null;
			Obj_Item_Weapon_Paper_Talisman T4 = null;
			Obj_Item_Weapon_Paper_Talisman T5 = null;
			Obj_Item_Weapon_Paper_Talisman T6 = null;

			
			if ( !( this != null ) ) {
				return null;
			}

			if ( Lang13.Bool( Task13.User.stat ) || Task13.User.restrained() || !GlobalFuncs.in_range( this, Task13.User ) ) {
				return null;
			}

			if ( Lang13.Bool( href_list["rune"] ) ) {
				
				dynamic _a = href_list["rune"]; // Was a switch-case, sorry for the mess.
				if ( _a=="newtome" ) {
					T = new Obj_Item_Weapon_Paper_Talisman( GlobalFuncs.get_turf( Task13.User ) );
					T.imbue = "newtome";
				} else if ( _a=="teleport" ) {
					T2 = new Obj_Item_Weapon_Paper_Talisman( GlobalFuncs.get_turf( Task13.User ) );
					words = new ByTable()
						.Set( "ire", "ire" )
						.Set( "ego", "ego" )
						.Set( "nahlizet", "nahlizet" )
						.Set( "certum", "certum" )
						.Set( "veri", "veri" )
						.Set( "jatkaa", "jatkaa" )
						.Set( "balaq", "balaq" )
						.Set( "mgar", "mgar" )
						.Set( "karazet", "karazet" )
						.Set( "geeri", "geeri" )
					;
					T2.imbue = Interface13.Input( "Write your teleport destination rune:", "Rune Scribing", null, null, words, InputType.Any );
				} else if ( _a=="emp" ) {
					T3 = new Obj_Item_Weapon_Paper_Talisman( GlobalFuncs.get_turf( Task13.User ) );
					T3.imbue = "emp";
				} else if ( _a=="conceal" ) {
					T4 = new Obj_Item_Weapon_Paper_Talisman( GlobalFuncs.get_turf( Task13.User ) );
					T4.imbue = "conceal";
				} else if ( _a=="communicate" ) {
					T5 = new Obj_Item_Weapon_Paper_Talisman( GlobalFuncs.get_turf( Task13.User ) );
					T5.imbue = "communicate";
				} else if ( _a=="runestun" ) {
					T6 = new Obj_Item_Weapon_Paper_Talisman( GlobalFuncs.get_turf( Task13.User ) );
					T6.imbue = "runestun";
				} else if ( _a=="soulstone" ) {
					new Obj_Item_Device_Soulstone( GlobalFuncs.get_turf( Task13.User ) );
				} else if ( _a=="construct" ) {
					new Obj_Structure_Constructshell_Cult( GlobalFuncs.get_turf( Task13.User ) );
				}
				this.uses--;
				this.supply();
			}
			return null;
		}

		// Function from file: talisman.dm
		public override dynamic attack_animal( Mob_Living user = null ) {
			
			if ( user is Mob_Living_SimpleAnimal_Construct_Harvester ) {
				this.attack_self( user );
			}
			return null;
		}

		// Function from file: talisman.dm
		public override bool? attack( dynamic M = null, dynamic user = null, string def_zone = null, bool? eat_override = null ) {
			
			if ( GlobalFuncs.iscultist( user ) ) {
				
				if ( this.imbue == "runestun" ) {
					((Mob_Living)user).take_organ_damage( 5, 0 );
					this.runestun( M );
					GlobalFuncs.qdel( this );
				} else {
					base.attack( (object)(M), (object)(user), def_zone, eat_override );
				}
			} else {
				base.attack( (object)(M), (object)(user), def_zone, eat_override );
			}
			return null;
		}

		// Function from file: talisman.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			bool delete = false;
			dynamic T1 = null;
			dynamic T2 = null;

			
			if ( GlobalFuncs.iscultist( user ) ) {
				delete = true;

				dynamic _a = this.imbue; // Was a switch-case, sorry for the mess.
				if ( _a=="newtome" ) {
					Lang13.Call( typeof(Obj_Effect_Rune).GetMethod( "tomesummon" ) );
				} else if ( _a=="armor" ) {
					Lang13.Call( typeof(Obj_Effect_Rune).GetMethod( "armor" ) );
				} else if ( _a=="emp" ) {
					Lang13.Call( typeof(Obj_Effect_Rune).GetMethod( "emp" ), Task13.User.loc, 3 );
				} else if ( _a=="conceal" ) {
					Lang13.Call( typeof(Obj_Effect_Rune).GetMethod( "obscure" ), 2 );
				} else if ( _a=="revealrunes" ) {
					Lang13.Call( typeof(Obj_Effect_Rune).GetMethod( "revealrunes" ), this );
				} else if ( _a=="ire" || _a=="ego" || _a=="nahlizet" || _a=="certum" || _a=="veri" || _a=="jatkaa" || _a=="balaq" || _a=="mgar" || _a=="karazet" || _a=="geeri" ) {
					T1 = GlobalFuncs.get_turf( user );
					Lang13.Call( typeof(Obj_Effect_Rune).GetMethod( "teleport" ), this.imbue );
					T2 = GlobalFuncs.get_turf( user );

					if ( T1 != T2 ) {
						((Tile)T1).turf_animation( "icons/effects/effects.dmi", "rune_teleport" );
					}
				} else if ( _a=="communicate" ) {
					delete = Lang13.Bool( Lang13.Call( typeof(Obj_Effect_Rune).GetMethod( "communicate" ) ) );
				} else if ( _a=="deafen" ) {
					this.deafen();
					GlobalFuncs.qdel( this );
				} else if ( _a=="blind" ) {
					this.blind();
					GlobalFuncs.qdel( this );
				} else if ( _a=="runestun" ) {
					GlobalFuncs.to_chat( user, "<span class='warning'>To use this talisman, attack your target directly.</span>" );
					return null;
				} else if ( _a=="supply" ) {
					this.supply();
				}
				((Mob_Living)user).take_organ_damage( 5, 0 );

				if ( this != null && this.imbue != "supply" && this.imbue != "runestun" ) {
					
					if ( delete ) {
						GlobalFuncs.qdel( this );
					}
				}
				return null;
			} else {
				GlobalFuncs.to_chat( user, "You see strange symbols on the paper. Are they supposed to mean something?" );
				return null;
			}
		}

		// Function from file: talisman.dm
		public void deafen(  ) {
			int affected = 0;
			Mob_Living_Carbon C = null;
			dynamic T = null;
			dynamic V = null;

			affected = 0;

			foreach (dynamic _b in Lang13.Enumerate( Map13.FetchInRange( Task13.User, 7 ), typeof(Mob_Living_Carbon) )) {
				C = _b;
				

				if ( GlobalFuncs.iscultist( C ) ) {
					continue;
				}
				this.nullblock = false;

				foreach (dynamic _a in Lang13.Enumerate( Map13.FetchInRange( 1, C ) )) {
					T = _a;
					
					this.findNullRod( T );
				}

				if ( this.nullblock ) {
					continue;
				}
				C.ear_deaf += 30;
				C.show_message( "&lt;span class='warning'>The world around you suddenly becomes quiet.</span>" );
				affected++;
			}

			if ( affected != 0 ) {
				Task13.User.__CallVerb("Whisper", "Sti" + Rand13.Pick(new object [] { "'", "`" }) + " kaliedir!" );
				GlobalFuncs.to_chat( Task13.User, "<span class='warning'>Your talisman turns into gray dust, deafening everyone around.</span>" );

				foreach (dynamic _c in Lang13.Enumerate( Map13.FetchInRangeExcludeThis( this, 1 ) )) {
					V = _c;
					

					if ( !GlobalFuncs.iscultist( V ) ) {
						V.show_message( "<span class='warning'>Dust flows from " + Task13.User + "'s hands for a moment, and the world suddenly becomes quiet..</span>" );
					}
				}
			}
			return;
		}

		// Function from file: talisman.dm
		public void blind(  ) {
			int affected = 0;
			Mob_Living_Carbon C = null;
			dynamic T = null;

			affected = 0;

			foreach (dynamic _b in Lang13.Enumerate( Map13.FetchInView( Task13.User, 2 ), typeof(Mob_Living_Carbon) )) {
				C = _b;
				

				if ( GlobalFuncs.iscultist( C ) ) {
					continue;
				}
				this.nullblock = false;

				foreach (dynamic _a in Lang13.Enumerate( Map13.FetchInRange( 1, C ) )) {
					T = _a;
					
					this.findNullRod( T );
				}

				if ( this.nullblock ) {
					continue;
				}
				C.eye_blurry += 30;
				C.eye_blind += 10;
				affected++;
				GlobalFuncs.to_chat( C, "<span class='warning'>You feel a sharp pain in your eyes, and the world disappears into darkness..</span>" );
			}

			if ( affected != 0 ) {
				Task13.User.__CallVerb("Whisper", "Sti" + Rand13.Pick(new object [] { "'", "`" }) + " kaliesin!" );
				GlobalFuncs.to_chat( Task13.User, "<span class='warning'>Your talisman turns into gray dust, blinding those who not follow the Nar-Sie.</span>" );
			}
			return;
		}

		// Function from file: talisman.dm
		public void runestun( dynamic T = null ) {
			dynamic TU = null;
			dynamic C = null;

			Task13.User.say( "Dream sign ''Evil sealing talisman'" + Rand13.Pick(new object [] { "'", "`" }) + "!" );
			this.nullblock = false;

			foreach (dynamic _a in Lang13.Enumerate( Map13.FetchInRange( 1, T ) )) {
				TU = _a;
				
				this.findNullRod( TU );
			}

			if ( this.nullblock ) {
				Task13.User.visible_message( "<span class='danger'>" + Task13.User + " invokes a talisman at " + T + ", but they are unaffected!</span>" );
			} else {
				Task13.User.visible_message( "<span class='danger'>" + Task13.User + " invokes a talisman at " + T + "</span>" );

				if ( T is Mob_Living_Silicon ) {
					((Mob)T).Weaken( 15 );
				} else if ( T is Mob_Living_Carbon ) {
					C = T;
					Icon13.Flick( "e_flash", C.flash );

					if ( !Lang13.Bool( C.mutations.Contains( 4 ) ) ) {
						C.silent += 15;
					}
					((Mob)C).Weaken( 25 );
					((Mob)C).Stun( 25 );
				}
			}
			return;
		}

		// Function from file: talisman.dm
		public void supply( dynamic key = null ) {
			string dat = null;

			
			if ( !( this.uses != 0 ) ) {
				GlobalFuncs.qdel( this );
				return;
			}
			dat = new Txt( "<B>There are " ).item( this.uses ).str( " bloody runes on the parchment.</B>\n<BR>Please choose the chant to be imbued into the fabric of reality.<BR>\n<HR>\n<A href='?src=" ).Ref( this ).str( ";rune=newtome'>N'ath reth sh'yro eth d'raggathnor!</A> - Allows you to summon a new arcane tome.<BR>\n<A href='?src=" ).Ref( this ).str( ";rune=teleport'>Sas'so c'arta forbici!</A> - Allows you to move to a rune with the same last word.<BR>\n<A href='?src=" ).Ref( this ).str( ";rune=emp'>Ta'gh fara'qha fel d'amar det!</A> - Allows you to destroy technology in a short range.<BR>\n<A href='?src=" ).Ref( this ).str( ";rune=conceal'>Kla'atu barada nikt'o!</A> - Allows you to conceal the runes you placed on the floor.<BR>\n<A href='?src=" ).Ref( this ).str( ";rune=communicate'>O bidai nabora se'sma!</A> - Allows you to coordinate with others of your cult.<BR>\n<A href='?src=" ).Ref( this ).str( ";rune=runestun'>Fuu ma'jin</A> - Allows you to stun a person by attacking them with the talisman.<BR>\n<A href='?src=" ).Ref( this ).str( ";rune=soulstone'>Kal om neth</A> - Summons a soul stone<BR>\n<A href='?src=" ).Ref( this ).str( ";rune=construct'>Da A'ig Osk</A> - Summons a construct shell for use with captured souls. It is too large to carry on your person.<BR>" ).ToString();
			Interface13.Browse( Task13.User, dat, "window=id_com;size=350x200" );
			return;
		}

		// Function from file: talisman.dm
		public bool findNullRod( dynamic target = null ) {
			dynamic T = null;
			Ent_Static A = null;

			
			if ( target is Obj_Item_Weapon_Nullrod ) {
				T = GlobalFuncs.get_turf( target );
				this.nullblock = true;
				((Tile)T).turf_animation( "icons/effects/96x96.dmi", "nullding", -32, -32, 5, "sound/piano/Ab7.ogg" );
				return true;
			} else if ( Lang13.Bool( target.contents ) ) {
				
				foreach (dynamic _a in Lang13.Enumerate( target.contents, typeof(Ent_Static) )) {
					A = _a;
					
					this.findNullRod( A );
				}
			}
			return false;
		}

		// Function from file: talisman.dm
		public override dynamic examine( dynamic user = null, string size = null ) {
			base.examine( (object)(user), size );

			if ( GlobalFuncs.iscultist( user ) || user is Mob_Dead_Observer ) {
				
				dynamic _a = this.imbue; // Was a switch-case, sorry for the mess.
				if ( _a=="newtome" ) {
					GlobalFuncs.to_chat( user, "This talisman has been imbued with the power of spawning a new Arcane Tome." );
				} else if ( _a=="armor" ) {
					GlobalFuncs.to_chat( user, "This talisman has been imbued with the power of clothing yourself in cult fighting gear." );
				} else if ( _a=="emp" ) {
					GlobalFuncs.to_chat( user, "This talisman has been imbued with the power of disabling technology in a small radius around you." );
				} else if ( _a=="conceal" ) {
					GlobalFuncs.to_chat( user, "This talisman has been imbued with the power of concealing nearby runes." );
				} else if ( _a=="revealrunes" ) {
					GlobalFuncs.to_chat( user, "This talisman has been imbued with the power of revealing hidden nearby runes." );
				} else if ( _a=="ire" || _a=="ego" || _a=="nahlizet" || _a=="certum" || _a=="veri" || _a=="jatkaa" || _a=="balaq" || _a=="mgar" || _a=="karazet" || _a=="geeri" ) {
					GlobalFuncs.to_chat( user, "This talisman has been imbued with the power of taking you to someplace else. You can read <i>" + this.imbue + "</i> on it." );
				} else if ( _a=="communicate" ) {
					GlobalFuncs.to_chat( user, "This talisman has been imbued with the power of communicating your whispers to your allies." );
				} else if ( _a=="deafen" ) {
					GlobalFuncs.to_chat( user, "This talisman has been imbued with the power of deafening visible enemies." );
				} else if ( _a=="blind" ) {
					GlobalFuncs.to_chat( user, "This talisman has been imbued with the power of blinding visible enemies." );
				} else if ( _a=="runestun" ) {
					GlobalFuncs.to_chat( user, "This talisman has been imbued with the power of paralyzing the beings you touch with it. The effect works on silicons as well, but humans will also be muted for a short time." );
				} else if ( _a=="supply" ) {
					GlobalFuncs.to_chat( user, "This talisman has been imbued with the power of providing you and your allies with some supplies to start your cult." );
				} else {
					GlobalFuncs.to_chat( user, "This talisman.....has no particular power. Is this some kind of joke?" );
				}
			} else {
				GlobalFuncs.to_chat( user, "Something about the blood stains on this paper fills you with uneasiness." );
			}
			return null;
		}

	}

}