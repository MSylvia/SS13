// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_Computer_Merch : Obj_Machinery_Computer {

		public HtmlInterface_Nanotrasen v_interface = null;
		public bool next_process = false;
		public string machine_id = "";
		public ByTable categories = new ByTable()
											.Set( "Food", new ByTable(new object [] { typeof(Storeitem_Menu1), typeof(Storeitem_Menu2) }) )
											.Set( "Tools", new ByTable(new object [] { typeof(Storeitem_Pen), typeof(Storeitem_WrappingPaper) }) )
											.Set( "Electronics", new ByTable(new object [] { typeof(Storeitem_Boombox) }) )
											.Set( "Toys", new ByTable(new object [] { typeof(Storeitem_Beachball), typeof(Storeitem_SnapPops), typeof(Storeitem_Crayons) }) )
											.Set( "Clothing", new ByTable(new object [] { typeof(Storeitem_RobotnikLabcoat), typeof(Storeitem_RobotnikJumpsuit) }) )
											.Set( "Luxury", new ByTable(new object [] { typeof(Storeitem_Wallet), typeof(Storeitem_PhotoAlbum), typeof(Storeitem_Painting) }) )
										;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.circuit = "/obj/item/weapon/circuitboard/merch";
			this.light_color = "#FA9632";
			this.machine_flags = 411;
			this.icon_state = "store";
		}

		// Function from file: store.dm
		public Obj_Machinery_Computer_Merch ( dynamic loc = null ) : base( (object)(loc) ) {
			string head = null;

			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.machine_id = "" + GlobalFuncs.station_name() + " Merch Computer #" + GlobalFuncs.multinum_display( GlobalVars.num_merch_computers, 4 );
			GlobalVars.num_merch_computers++;
			head = @"
		<style type=""text/css"">
			span.area
			{
				display: block;
				white-space: nowrap;
				text-overflow: ellipsis;
				overflow: hidden;
				width: auto;
			}
		</style>
	";
			this.v_interface = new HtmlInterface_Nanotrasen( this, this.name, 800, 700, head );
			GlobalVars.html_machines.Add( this );
			this.init_ui();
			return;
		}

		// Function from file: store.dm
		public override bool? update_icon( dynamic location = null, dynamic target = null ) {
			
			if ( ( this.stat & 1 ) != 0 ) {
				this.icon_state = "comm_logsb";
			} else if ( ( this.stat & 2 ) != 0 ) {
				this.icon_state = "comm_logs0";
			} else {
				this.icon_state = Lang13.Initial( this, "icon_state" );
			}
			return null;
		}

		// Function from file: store.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hclient = null, HtmlInterface currui = null ) {
			dynamic itemID = null;

			
			if ( Lang13.Bool( base.Topic( href, href_list, (object)(hclient) ) ) ) {
				return null;
			}
			this.add_fingerprint( Task13.User );

			dynamic _a = href_list["choice"]; // Was a switch-case, sorry for the mess.
			if ( _a=="buy" ) {
				itemID = href_list["chosen_item"];

				if ( !GlobalVars.centcomm_store.PlaceOrder( Task13.User, itemID, this ) ) {
					GlobalFuncs.to_chat( Task13.User, new Txt().icon( this ).str( "<span class='warning'>Unable to charge your account.</span>" ).ToString() );
				} else {
					GlobalFuncs.to_chat( Task13.User, new Txt().icon( this ).str( "<span class='notice'>Transaction complete! Enjoy your product.</span>" ).ToString() );
				}
			}
			this.updateUsrDialog();
			return null;
		}

		// Function from file: store.dm
		public override dynamic interact( dynamic user = null, bool? flag1 = null ) {
			
			if ( ( this.stat & 3 ) != 0 ) {
				return null;
			}

			if ( Lang13.Bool( user.stat ) || ((Mob)user).restrained() || !this.allowed( user ) ) {
				return null;
			}
			this.v_interface.show( user );
			return null;
		}

		// Function from file: store.dm
		public override dynamic attack_hand( dynamic a = null, dynamic b = null, dynamic c = null ) {
			dynamic _default = null;

			_default = base.attack_hand( (object)(a), (object)(b), (object)(c) );

			if ( Lang13.Bool( _default ) ) {
				this.v_interface.hide( a );
				return _default;
			}
			this.interact( a );
			return _default;
		}

		// Function from file: store.dm
		public override dynamic attack_ai( dynamic user = null ) {
			this.add_hiddenprint( user );
			return this.attack_hand( user );
		}

		// Function from file: store.dm
		public override dynamic attack_paw( Mob a = null, dynamic b = null, dynamic c = null ) {
			return this.attack_hand( a );
		}

		// Function from file: store.dm
		public override dynamic Destroy( dynamic brokenup = null ) {
			base.Destroy( (object)(brokenup) );
			GlobalVars.html_machines.Remove( this );
			GlobalFuncs.qdel( this.v_interface );
			this.v_interface = null;
			return null;
		}

		// Function from file: store.dm
		public string get_display_name( dynamic storeitem = null ) {
			return "" + storeitem.name + " (" + ( !Lang13.Bool( storeitem.cost ) ? "free" : "" + storeitem.cost + "$" ) + ")";
		}

		// Function from file: store.dm
		public void init_ui(  ) {
			string dat = null;
			dynamic category_name = null;
			dynamic category_items = null;
			dynamic store_item = null;
			dynamic SI = null;

			dat = "<tbody id=\"StoreTable\">";

			foreach (dynamic _b in Lang13.Enumerate( this.categories )) {
				category_name = _b;
				
				category_items = this.categories[category_name];
				dat += "\n			<table>\n			<th><h2>" + category_name + "</h2></th>\n			";

				foreach (dynamic _a in Lang13.Enumerate( category_items )) {
					store_item = _a;
					
					SI = Lang13.Call( store_item );
					dat += new Txt( "\n				<tr><td><A href='?src=" ).Ref( this ).str( ";choice=buy;chosen_item=" ).item( store_item ).str( "'>" ).item( this.get_display_name( SI ) ).str( "</A></td></tr>\n				<tr><td><i>" ).item( SI.desc ).str( "</i></td></tr>\n				" ).ToString();
				}
				dat += "</table>";
			}
			dat += "</tbody>";
			this.v_interface.updateLayout( dat );
			return;
		}

	}

}