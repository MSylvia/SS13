// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Device_Aicard : Obj_Item_Device {

		public int? flush = 0;
		public Ent_Static AI = null;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.item_state = "electronic";
			this.w_class = 2;
			this.slot_flags = 512;
			this.flags = 4;
			this.origin_tech = "programming=4;materials=4";
			this.icon = "icons/obj/aicards.dmi";
			this.icon_state = "aicard";
		}

		public Obj_Item_Device_Aicard ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: aicard.dm
		public override int? ui_act( string action = null, ByTable _params = null, Tgui ui = null, UiState state = null ) {
			int? _default = null;

			string confirm = null;

			
			if ( Lang13.Bool( base.ui_act( action, _params, ui, state ) ) ) {
				return _default;
			}

			switch ((string)( action )) {
				case "wipe":
					confirm = Interface13.Alert( "Are you sure you want to wipe this card's memory? This cannot be undone once started.", this.name, "Yes", "No" );

					if ( confirm == "Yes" && !Lang13.Bool( base.ui_act( action, _params, ui, state ) ) ) {
						this.flush = GlobalVars.TRUE;

						if ( this.AI != null && this.AI.loc == this ) {
							((dynamic)this.AI).suiciding = GlobalVars.TRUE;
							((dynamic)this.AI).WriteMsg( "Your core files are being wiped!" );

							while (Convert.ToInt32( ((dynamic)this.AI).stat ) != 2) {
								((dynamic)this.AI).adjustOxyLoss( 2 );
								((dynamic)this.AI).updatehealth();
								Task13.Sleep( 10 );
							}
							this.flush = GlobalVars.FALSE;
						}
					}
					_default = GlobalVars.TRUE;
					break;
				case "wireless":
					((dynamic)this.AI).control_disabled = !Lang13.Bool( ((dynamic)this.AI).control_disabled );
					((dynamic)this.AI).WriteMsg( "" + this + "'s wireless port has been " + ( Lang13.Bool( ((dynamic)this.AI).control_disabled ) ? "disabled" : "enabled" ) + "!" );
					_default = GlobalVars.TRUE;
					break;
				case "radio":
					((dynamic)this.AI).radio_enabled = !Lang13.Bool( ((dynamic)this.AI).radio_enabled );
					((dynamic)this.AI).WriteMsg( "Your Subspace Transceiver has been " + ( Lang13.Bool( ((dynamic)this.AI).radio_enabled ) ? "enabled" : "disabled" ) + "!" );
					_default = GlobalVars.TRUE;
					break;
			}
			this.update_icon();
			return _default;
		}

		// Function from file: aicard.dm
		public override ByTable ui_data( dynamic user = null ) {
			ByTable data = null;

			data = new ByTable();

			if ( this.AI != null ) {
				data["name"] = this.AI.name;
				data["laws"] = ((AiLaws)((dynamic)this.AI).laws).get_law_list( true );
				data["health"] = ( ((dynamic)this.AI).health + 100 ) / 2;
				data["wireless"] = !Lang13.Bool( ((dynamic)this.AI).control_disabled );
				data["radio"] = ((dynamic)this.AI).radio_enabled;
				data["isDead"] = Convert.ToInt32( ((dynamic)this.AI).stat ) == 2;
				data["isBraindead"] = ( Lang13.Bool( ((dynamic)this.AI).client ) ? GlobalVars.TRUE : GlobalVars.FALSE );
			}
			data["wiping"] = this.flush;
			return data;
		}

		// Function from file: aicard.dm
		public override int ui_interact( dynamic user = null, string ui_key = null, Tgui ui = null, bool? force_open = null, Tgui master_ui = null, UiState state = null ) {
			ui_key = ui_key ?? "main";
			force_open = force_open ?? false;
			state = state ?? GlobalVars.hands_state;

			ui = GlobalVars.SStgui.try_update_ui( user, this, ui_key, ui, force_open );

			if ( !( ui != null ) ) {
				ui = new Tgui( user, this, ui_key, "intellicard", this.name, 500, 500, master_ui, state );
				ui.open();
			}
			return 0;
		}

		// Function from file: aicard.dm
		public override bool update_icon( dynamic new_state = null, dynamic new_icon = null, int? new_px = null, int? new_py = null ) {
			
			if ( this.AI != null ) {
				this.name = "" + Lang13.Initial( this, "name" ) + "- " + this.AI.name;

				if ( Convert.ToInt32( ((dynamic)this.AI).stat ) == 2 ) {
					this.icon_state = "aicard-404";
				} else {
					this.icon_state = "aicard-full";
				}

				if ( !Lang13.Bool( ((dynamic)this.AI).control_disabled ) ) {
					this.overlays.Add( new Image( "icons/obj/aicards.dmi", "aicard-on" ) );
				}
				this.AI.__CallVerb("Cancel Camera View" );
			} else {
				this.name = Lang13.Initial( this, "name" );
				this.icon_state = Lang13.Initial( this, "icon_state" );
				this.overlays.Cut();
			}
			return false;
		}

		// Function from file: aicard.dm
		public override bool afterattack( dynamic target = null, dynamic user = null, bool? proximity_flag = null, string click_parameters = null ) {
			base.afterattack( (object)(target), (object)(user), proximity_flag, click_parameters );

			if ( !( proximity_flag == true ) || !Lang13.Bool( target ) ) {
				return false;
			}

			if ( this.AI != null ) {
				((Ent_Static)target).transfer_ai( 2, user, this.AI, this );
				GlobalFuncs.add_logs( user, this.AI, "carded", this );
			} else {
				((Ent_Static)target).transfer_ai( 1, user, null, this );
			}
			this.update_icon();
			return false;
		}

	}

}