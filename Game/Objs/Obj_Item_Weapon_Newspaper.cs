// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_Newspaper : Obj_Item_Weapon {

		public int screen = 0;
		public int pages = 0;
		public int curr_page = 0;
		public ByTable news_content = new ByTable();
		public string scribble = "";
		public int scribble_page = 0;
		public string wantedAuthor = null;
		public dynamic wantedCriminal = null;
		public string wantedBody = null;
		public Icon wantedPhoto = null;
		public double creationTime = 0;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.w_class = 2;
			this.attack_verb = new ByTable(new object [] { "bapped" });
			this.icon = "icons/obj/bureaucracy.dmi";
			this.icon_state = "newspaper";
		}

		public Obj_Item_Weapon_Newspaper ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: newscaster.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			string s = null;

			
			if ( A is Obj_Item_Weapon_Pen ) {
				
				if ( this.scribble_page == this.curr_page ) {
					user.WriteMsg( "<span class='notice'>There's already a scribble in this page... You wouldn't want to make things too cluttered, would you?</span>" );
				} else {
					s = GlobalFuncs.stripped_input( user, "Write something", "Newspaper" );

					if ( !Lang13.Bool( s ) ) {
						return null;
					}

					if ( !( Map13.GetDistance( this, Task13.User ) <= 1 ) && this.loc != Task13.User ) {
						return null;
					}
					this.scribble_page = this.curr_page;
					this.scribble = s;
					this.attack_self( user );
				}
			}
			return null;
		}

		// Function from file: newscaster.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hsrc = null ) {
			Mob U = null;

			U = Task13.User;
			base.Topic( href, href_list, (object)(hsrc) );

			if ( U.contents.Contains( this ) || this.loc is Tile && Map13.GetDistance( this, U ) <= 1 ) {
				U.set_machine( this );

				if ( Lang13.Bool( href_list["next_page"] ) ) {
					
					if ( this.curr_page == this.pages + 1 ) {
						return null;
					}

					if ( this.curr_page == this.pages ) {
						this.screen = 2;
					} else if ( this.curr_page == 0 ) {
						this.screen = 1;
					}
					this.curr_page++;
					GlobalFuncs.playsound( this.loc, "pageturn", 50, 1 );
				} else if ( Lang13.Bool( href_list["prev_page"] ) ) {
					
					if ( this.curr_page == 0 ) {
						return null;
					}

					if ( this.curr_page == 1 ) {
						this.screen = 0;
					} else if ( this.curr_page == this.pages + 1 ) {
						this.screen = 1;
					}
					this.curr_page--;
					GlobalFuncs.playsound( this.loc, "pageturn", 50, 1 );
				}

				if ( this.loc is Mob ) {
					this.attack_self( this.loc );
				}
			}
			return null;
		}

		// Function from file: newscaster.dm
		public bool notContent( ByTable L = null ) {
			int? i = null;
			double num = 0;

			
			if ( !( L.len != 0 ) ) {
				return false;
			}
			i = null;
			i = L.len;

			while (( i ??0) > 0) {
				num = Math.Abs( Convert.ToDouble( L[i] ) );

				if ( this.creationTime <= num ) {
					i--;
					continue;
				} else if ( Convert.ToDouble( L[i] ) > 0 ) {
					return true;
				} else {
					return false;
				}
				i--;
			}
			return false;
		}

		// Function from file: newscaster.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			dynamic human_user = null;
			dynamic dat = null;
			Newscaster_FeedChannel NP = null;
			int temp_page = 0;
			Newscaster_FeedChannel NP2 = null;
			Newscaster_FeedChannel NP3 = null;
			Newscaster_FeedChannel C = null;
			int i = 0;
			Newscaster_FeedMessage MESSAGE = null;
			Newscaster_FeedChannel NP4 = null;

			
			if ( user is Mob_Living_Carbon_Human ) {
				human_user = user;
				this.pages = 0;

				switch ((int)( this.screen )) {
					case 0:
						dat += "<DIV ALIGN='center'><B><FONT SIZE=6>The Griffon</FONT></B></div>";
						dat += "<DIV ALIGN='center'><FONT SIZE=2>Nanotrasen-standard newspaper, for use on NanotrasenÂ© Space Facilities</FONT></div><HR>";

						if ( GlobalFuncs.isemptylist( this.news_content ) ) {
							
							if ( Lang13.Bool( this.wantedAuthor ) ) {
								dat += "Contents:<BR><ul><B><FONT COLOR='red'>**</FONT>Important Security Announcement<FONT COLOR='red'>**</FONT></B> <FONT SIZE=2>[page " + ( this.pages + 2 ) + "]</FONT><BR></ul>";
							} else {
								dat += "<I>Other than the title, the rest of the newspaper is unprinted...</I>";
							}
						} else {
							dat += "Contents:<BR><ul>";

							foreach (dynamic _a in Lang13.Enumerate( this.news_content, typeof(Newscaster_FeedChannel) )) {
								NP = _a;
								
								this.pages++;
							}

							if ( Lang13.Bool( this.wantedAuthor ) ) {
								dat += "<B><FONT COLOR='red'>**</FONT>Important Security Announcement<FONT COLOR='red'>**</FONT></B> <FONT SIZE=2>[page " + ( this.pages + 2 ) + "]</FONT><BR>";
							}
							temp_page = 0;

							foreach (dynamic _b in Lang13.Enumerate( this.news_content, typeof(Newscaster_FeedChannel) )) {
								NP2 = _b;
								
								temp_page++;
								dat += "<B>" + NP2.channel_name + "</B> <FONT SIZE=2>[page " + ( temp_page + 1 ) + "]</FONT><BR>";
							}
							dat += "</ul>";
						}

						if ( this.scribble_page == this.curr_page ) {
							dat += "<BR><I>There is a small scribble near the end of this page... It reads: \"" + this.scribble + "\"</I>";
						}
						dat += new Txt( "<HR><DIV STYLE='float:right;'><A href='?src=" ).Ref( this ).str( ";next_page=1'>Next Page</A></DIV> <div style='float:left;'><A href='?src=" ).Ref( human_user ).str( ";mach_close=newspaper_main'>Done reading</A></DIV>" ).ToString();
						break;
					case 1:
						
						foreach (dynamic _c in Lang13.Enumerate( this.news_content, typeof(Newscaster_FeedChannel) )) {
							NP3 = _c;
							
							this.pages++;
						}
						C = this.news_content[this.curr_page];
						dat += "<FONT SIZE=4><B>" + C.channel_name + "</B></FONT><FONT SIZE=1> [created by: <FONT COLOR='maroon'>" + C.returnAuthor( this.notContent( C.authorCensorTime ) ?1:0 ) + "</FONT>]</FONT><BR><BR>";

						if ( this.notContent( C.DclassCensorTime ) ) {
							dat += "This channel was deemed dangerous to the general welfare of the station and therefore marked with a <B><FONT COLOR='red'>D-Notice</B></FONT>. Its contents were not transferred to the newspaper at the time of printing.";
						} else if ( GlobalFuncs.isemptylist( C.messages ) ) {
							dat += "No Feed stories stem from this channel...";
						} else {
							i = 0;

							foreach (dynamic _d in Lang13.Enumerate( C.messages, typeof(Newscaster_FeedMessage) )) {
								MESSAGE = _d;
								

								if ( MESSAGE.creationTime > this.creationTime ) {
									
									if ( i == 0 ) {
										dat += "No Feed stories stem from this channel...";
									}
									break;
								}

								if ( i == 0 ) {
									dat += "<ul>";
								}
								i++;
								dat += "-" + MESSAGE.returnBody( this.notContent( MESSAGE.bodyCensorTime ) ?1:0 ) + " <BR>";

								if ( MESSAGE.img != null ) {
									Interface13.CacheBrowseResource( user, MESSAGE.img, "tmp_photo" + i + ".png" );
									dat += "<img src='tmp_photo" + i + ".png' width = '180'><BR>";
								}
								dat += "<FONT SIZE=1>[Story by <FONT COLOR='maroon'>" + MESSAGE.returnAuthor( this.notContent( MESSAGE.authorCensorTime ) ?1:0 ) + "</FONT>]</FONT><BR><BR>";
							}
							dat += "</ul>";
						}

						if ( this.scribble_page == this.curr_page ) {
							dat += "<BR><I>There is a small scribble near the end of this page... It reads: \"" + this.scribble + "\"</I>";
						}
						dat += new Txt( "<BR><HR><DIV STYLE='float:left;'><A href='?src=" ).Ref( this ).str( ";prev_page=1'>Previous Page</A></DIV> <DIV STYLE='float:right;'><A href='?src=" ).Ref( this ).str( ";next_page=1'>Next Page</A></DIV>" ).ToString();
						break;
					case 2:
						
						foreach (dynamic _e in Lang13.Enumerate( this.news_content, typeof(Newscaster_FeedChannel) )) {
							NP4 = _e;
							
							this.pages++;
						}

						if ( this.wantedAuthor != null ) {
							dat += "<DIV STYLE='float:center;'><FONT SIZE=4><B>Wanted Issue:</B></FONT SIZE></DIV><BR><BR>";
							dat += "<B>Criminal name</B>: <FONT COLOR='maroon'>" + this.wantedCriminal + "</FONT><BR>";
							dat += "<B>Description</B>: " + this.wantedBody + "<BR>";
							dat += "<B>Photo:</B>: ";

							if ( this.wantedPhoto != null ) {
								Interface13.CacheBrowseResource( user, this.wantedPhoto, "tmp_photow.png" );
								dat += "<BR><img src='tmp_photow.png' width = '180'>";
							} else {
								dat += "None";
							}
						} else {
							dat += "<I>Apart from some uninteresting Classified ads, there's nothing on this page...</I>";
						}

						if ( this.scribble_page == this.curr_page ) {
							dat += "<BR><I>There is a small scribble near the end of this page... It reads: \"" + this.scribble + "\"</I>";
						}
						dat += new Txt( "<HR><DIV STYLE='float:left;'><A href='?src=" ).Ref( this ).str( ";prev_page=1'>Previous Page</A></DIV>" ).ToString();
						break;
				}
				dat += "<BR><HR><div align='center'>" + ( this.curr_page + 1 ) + "</div>";
				Interface13.Browse( human_user, dat, "window=newspaper_main;size=300x400" );
				GlobalFuncs.onclose( human_user, "newspaper_main" );
			} else {
				user.WriteMsg( "The paper is full of intelligible symbols!" );
			}
			return null;
		}

		// Function from file: newscaster.dm
		public override int suicide_act( Mob_Living_Carbon_Human user = null ) {
			Mob_Living_Carbon_Human H = null;
			Obj_Item_Weapon_ReagentContainers_Food_Drinks_Bottle_Whiskey W = null;

			user.visible_message( "<span class='suicide'>" + user + " is focusing intently on " + this + "! It looks like they're trying to commit sudoku... until their eyes light up with realization!</span>" );
			user.say( ";JOURNALISM IS MY CALLING! EVERYBODY APPRECIATES UNBIASED REPORTI-GLORF" );
			H = user;
			W = new Obj_Item_Weapon_ReagentContainers_Food_Drinks_Bottle_Whiskey( H.loc );
			GlobalFuncs.playsound( H.loc, "sound/items/drink.ogg", Rand13.Int( 10, 50 ), 1 );
			W.reagents.trans_to( H, W.reagents.total_volume );
			user.visible_message( "<span class='suicide'>" + user + " downs the contents of " + W.name + " in one gulp! Shoulda stuck to sudoku!</span>" );
			return 4;
		}

	}

}