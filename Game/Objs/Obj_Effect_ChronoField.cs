// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_ChronoField : Obj_Effect {

		public Ent_Static captured = null;
		public Obj_Item_Weapon_Gun_Energy_ChronoGun gun = null;
		public int tickstokill = 15;
		public Image mob_underlay = null;
		public bool preloaded = false;
		public double RPpos = 0;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.blend_mode = 4;
			this.anchored = 1;
			this.unacidable = true;
			this.icon = "icons/effects/effects.dmi";
			this.icon_state = "chronofield";
		}

		// Function from file: chrono_eraser.dm
		public Obj_Effect_ChronoField ( dynamic loc = null, Ent_Static target = null, dynamic G = null ) : base( (object)(loc) ) {
			Icon mob_snapshot = null;
			Icon cached_icon = null;
			int? i = null;
			Icon removing_frame = null;
			Icon mob_icon = null;

			
			if ( target != null && target is Mob_Living && Lang13.Bool( G ) ) {
				target.loc = this;
				this.captured = target;
				mob_snapshot = GlobalFuncs.getFlatIcon( target );
				cached_icon = new Icon();
				i = null;
				i = 1;

				while (( i ??0) <= 22) {
					removing_frame = new Icon( "icons/obj/chronos.dmi", "erasing", GlobalVars.SOUTH, i );
					mob_icon = new Icon( mob_snapshot );
					mob_icon.Blend( removing_frame, 2 );
					cached_icon.Insert( mob_icon, "frame" + i );
					i++;
				}
				this.mob_underlay = new Image( cached_icon, "frame1" );
				this.update_icon();
				this.desc = Lang13.Initial( this, "desc" ) + ( "<br><span class='info'>It appears to contain " + target.name + ".</span>" );
			}
			GlobalVars.SSobj.processing.Or( this );
			return;
		}

		// Function from file: chrono_eraser.dm
		public override bool blob_act( dynamic severity = null ) {
			return false;
		}

		// Function from file: chrono_eraser.dm
		public override bool ex_act( double? severity = null, dynamic target = null ) {
			return false;
		}

		// Function from file: chrono_eraser.dm
		public override double singularity_act( int? current_size = null, Obj_Singularity S = null ) {
			return 0;
		}

		// Function from file: chrono_eraser.dm
		public override bool Move( dynamic NewLoc = null, int? Dir = null, int step_x = 0, int step_y = 0 ) {
			return false;
		}

		// Function from file: chrono_eraser.dm
		public override GasMixture return_air(  ) {
			GasMixture GM = null;

			GM = new GasMixture();
			GM.assert_gases( "o2", "n2" );
			GM.gases["o2"][1] = 21.83659553527832;
			GM.gases["n2"][1] = 82.14720153808594;
			GM.temperature = 293.41;
			return GM;
		}

		// Function from file: chrono_eraser.dm
		public override bool? assume_air( dynamic giver = null ) {
			return false;
		}

		// Function from file: chrono_eraser.dm
		public override dynamic bullet_act( dynamic P = null, dynamic def_zone = null ) {
			dynamic beam = null;
			Obj_Item_Weapon_Gun_Energy_ChronoGun Pgun = null;

			
			if ( P is Obj_Item_Projectile_Energy_ChronoBeam ) {
				beam = P;
				Pgun = beam.gun;

				if ( Pgun != null && Pgun is Obj_Item_Weapon_Gun_Energy_ChronoGun ) {
					Pgun.field_connect( this );
				}
			} else {
				return 0;
			}
			return null;
		}

		// Function from file: chrono_eraser.dm
		public override int? process( dynamic seconds = null ) {
			Ent_Dynamic AM = null;
			dynamic ghost = null;

			
			if ( this.captured != null ) {
				
				if ( this.tickstokill > Convert.ToDouble( Lang13.Initial( this, "tickstokill" ) ) ) {
					
					foreach (dynamic _a in Lang13.Enumerate( this.contents, typeof(Ent_Dynamic) )) {
						AM = _a;
						
						AM.loc = this.loc;
					}
					GlobalFuncs.qdel( this );
				} else if ( this.tickstokill <= 0 ) {
					((dynamic)this.captured).WriteMsg( "<span class='boldnotice'>As the last essence of your being is erased from time, you begin to re-experience your most enjoyable memory. You feel happy...</span>" );
					ghost = ((dynamic)this.captured).ghostize( 1 );

					if ( Lang13.Bool( ((dynamic)this.captured).mind ) ) {
						
						if ( Lang13.Bool( ghost ) ) {
							ghost.mind = null;
						}

						if ( this.gun != null ) {
							this.gun.pass_mind( ((dynamic)this.captured).mind );
						}
					}
					GlobalFuncs.qdel( this.captured );
					GlobalFuncs.qdel( this );
				} else {
					((dynamic)this.captured).Paralyse( 4 );

					if ( this.captured.loc != this ) {
						this.captured.loc = this;
					}
					this.update_icon();

					if ( this.gun != null ) {
						
						if ( this.gun.field_check( this ) ) {
							this.tickstokill--;
						} else {
							this.gun = null;
							return this.process();
						}
					} else {
						this.tickstokill++;
					}
				}
			} else {
				GlobalFuncs.qdel( this );
			}
			return null;
		}

		// Function from file: chrono_eraser.dm
		public override bool update_icon( dynamic new_state = null, dynamic new_icon = null, int? new_px = null, int? new_py = null ) {
			double ttk_frame = 0;

			ttk_frame = 1 - this.tickstokill / Convert.ToDouble( Lang13.Initial( this, "tickstokill" ) );
			ttk_frame = Num13.MaxInt( 1, Num13.MinInt( GlobalFuncs.Ceiling( ttk_frame * 22 ), 22 ) );

			if ( ttk_frame != this.RPpos ) {
				this.RPpos = ttk_frame;
				this.mob_underlay.icon_state = "frame" + this.RPpos;
				this.underlays = new ByTable();
				this.underlays.Add( this.mob_underlay );
			}
			return false;
		}

		// Function from file: chrono_eraser.dm
		public override dynamic Destroy(  ) {
			
			if ( this.gun != null && this.gun.field_check( this ) ) {
				this.gun.field_disconnect( this );
			}
			return base.Destroy();
		}

	}

}