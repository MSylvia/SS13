// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_Caution_ProximitySign : Obj_Item_Weapon_Caution {

		public bool timing = false;
		public bool armed = false;
		public int timepassed = 0;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.flags = 257;
		}

		public Obj_Item_Weapon_Caution_ProximitySign ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: weapon.dm
		public void dead_legs( dynamic H = null ) {
			dynamic l = null;
			dynamic r = null;

			l = H.organs_by_name["l_leg"];
			r = H.organs_by_name["r_leg"];

			if ( Lang13.Bool( l ) && !Lang13.Bool( l.status & 64 ) ) {
				l.status |= 64;
			}

			if ( Lang13.Bool( r ) && !Lang13.Bool( r.status & 64 ) ) {
				r.status |= 64;
			}
			return;
		}

		// Function from file: weapon.dm
		public override bool HasProximity( dynamic AM = null ) {
			dynamic C = null;

			
			if ( this.armed ) {
				
				if ( AM is Mob_Living_Carbon && !( AM is Mob_Living_Carbon_Brain ) ) {
					C = AM;

					if ( C.m_intent != "walk" ) {
						this.visible_message( "The " + this.name + " beeps, \"Running on wet floors is hazardous to your health.\"" );
						GlobalFuncs.explosion( this.loc, -1, 2, 0 );

						if ( C is Mob_Living_Carbon_Human ) {
							this.dead_legs( C );
						}

						if ( this != null ) {
							GlobalFuncs.qdel( this );
						}
					}
				}
			}
			return false;
		}

		// Function from file: weapon.dm
		public override dynamic process(  ) {
			
			if ( !this.timing ) {
				GlobalVars.processing_objects.Remove( this );
			}
			this.timepassed++;

			if ( this.timepassed >= 15 && !this.armed ) {
				this.armed = true;
				this.timing = false;
			}
			return null;
		}

		// Function from file: weapon.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			dynamic H = null;

			
			if ( user is Mob_Living_Carbon_Human ) {
				H = user;

				if ( H.mind.assigned_role != "Janitor" ) {
					return null;
				}

				if ( this.armed ) {
					this.armed = false;
					GlobalFuncs.to_chat( user, new Txt( "<span class='notice'>You disarm " ).the( this ).item().str( ".</span>" ).ToString() );
					return null;
				}
				this.timing = !this.timing;

				if ( this.timing ) {
					GlobalVars.processing_objects.Add( this );
				} else {
					this.armed = false;
					this.timepassed = 0;
				}
				GlobalFuncs.to_chat( H, "<span class='notice'>You " + ( this.timing ? new Txt( "activate " ).the( this ).item().str( "'s timer, you have 15 seconds." ).ToString() : new Txt( "de-activate " ).the( this ).item().str( "'s timer." ).ToString() ) + "</span>" );
			}
			return null;
		}

	}

}