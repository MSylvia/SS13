// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class GameMode_Shadowling : GameMode {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.name = "shadowling";
			this.config_tag = "shadowling";
			this.antag_flag = "shadowling";
			this.required_players = 30;
			this.required_enemies = 2;
			this.recommended_enemies = 2;
			this.restricted_jobs = new ByTable(new object [] { "AI", "Cyborg" });
			this.protected_jobs = new ByTable(new object [] { "Security Officer", "Warden", "Detective", "Head of Security", "Captain" });
		}

		// Function from file: shadowling.dm
		public override bool declare_completion(  ) {
			
			if ( this.check_shadow_victory() && GlobalVars.SSshuttle.emergency.mode >= 5 ) {
				Game13.WriteMsg( "<span class='greentext'>The shadowlings have ascended and taken over the station!</span>" );
			} else if ( this.shadowling_dead && !this.check_shadow_victory() ) {
				Game13.WriteMsg( "<span class='redtext'>The shadowlings have been killed by the crew!</span>" );
			} else if ( !this.check_shadow_victory() && GlobalVars.SSshuttle.emergency.mode >= 5 ) {
				Game13.WriteMsg( "<span class='redtext'>The crew escaped the station before the shadowlings could ascend!</span>" );
			} else {
				Game13.WriteMsg( "<span class='redtext'>The shadowlings have failed!</span>" );
			}
			base.declare_completion();
			return true;
		}

		// Function from file: shadowling.dm
		public bool check_shadow_victory(  ) {
			bool success = false;

			success = false;

			if ( this.shadow_objectives.Find( "enthrall" ) != 0 ) {
				success = this.shadowling_ascended;
			}
			return success;
		}

		// Function from file: shadowling.dm
		public override bool post_setup( bool? report = null ) {
			Mind shadow = null;

			
			foreach (dynamic _a in Lang13.Enumerate( this.shadows, typeof(Mind) )) {
				shadow = _a;
				
				GlobalFuncs.log_game( "" + shadow.key + " (ckey) has been selected as a Shadowling." );
				Task13.Sleep( 10 );
				shadow.current.WriteMsg( "<br>" );
				shadow.current.WriteMsg( "<span class='shadowling'><b><font size=3>You are a shadowling!</font></b></span>" );
				this.greet_shadow( shadow );
				this.finalize_shadowling( shadow );
				this.process_shadow_objectives( shadow );
			}
			base.post_setup( report );
			return false;
		}

		// Function from file: shadowling.dm
		public override bool pre_setup(  ) {
			int shadowlings = 0;
			dynamic shadow = null;

			
			if ( GlobalVars.config.protect_roles_from_antagonist ) {
				this.restricted_jobs.Add( this.protected_jobs );
			}

			if ( GlobalVars.config.protect_assistant_from_antagonist ) {
				this.restricted_jobs.Add( "Assistant" );
			}
			shadowlings = Num13.MaxInt( 3, Num13.Floor( this.num_players() / 14 ) );

			while (shadowlings != 0) {
				shadow = Rand13.PickFromTable( this.antag_candidates );
				this.shadows.Add( shadow );
				this.antag_candidates.Remove( shadow );
				this.modePlayer.Add( shadow );
				shadow.special_role = "Shadowling";
				shadow.restricted_roles = this.restricted_jobs;
				shadowlings--;
			}
			return true;
		}

		// Function from file: shadowling.dm
		public override void announce(  ) {
			Game13.WriteMsg( "<b>The current game mode is - Shadowling!</b>" );
			Game13.WriteMsg( "<b>There are alien <span class='shadowling'>shadowlings</span> on the station. Crew: Kill the shadowlings before they can enthrall the crew. Shadowlings: Enthrall the crew while remaining in hiding.</b>" );
			return;
		}

	}

}