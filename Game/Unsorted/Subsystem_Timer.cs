// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Subsystem_Timer : Subsystem {

		public ByTable processing = null;
		public ByTable hashes = null;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.name = "Timer";
			this.wait = 5;
			this.priority = 1;
			this.display = 3;
		}

		// Function from file: timer.dm
		public Subsystem_Timer (  ) {
			
			if ( GlobalVars.SStimer != this ) {
				
				if ( GlobalVars.SStimer is Subsystem_Timer ) {
					this.Recover();
					GlobalFuncs.qdel( GlobalVars.SStimer );
				}
				GlobalVars.SStimer = this;
			}
			this.processing = new ByTable();
			this.hashes = new ByTable();
			return;
		}

		// Function from file: timer.dm
		public void runevent( Timedevent _event = null ) {
			_event.argList.Apply( Lang13.BindFunc( _event.thingToCall, _event.procToCall ) );
			return;
		}

		// Function from file: timer.dm
		public override void fire(  ) {
			Timedevent _event = null;

			
			if ( !( this.processing.len != 0 ) ) {
				this.can_fire = false;
				return;
			}

			foreach (dynamic _a in Lang13.Enumerate( this.processing, typeof(Timedevent) )) {
				_event = _a;
				

				if ( !Lang13.Bool( _event.thingToCall ) || Lang13.Bool( GlobalFuncs.qdeleted( _event.thingToCall ) ) ) {
					GlobalFuncs.qdel( _event );
				}

				if ( _event.timeToRun <= Game13.time ) {
					this.runevent( _event );
					GlobalFuncs.qdel( _event );
				}
			}
			return;
		}

		// Function from file: timer.dm
		public override void stat_entry( string msg = null ) {
			base.stat_entry( "P:" + this.processing.len );
			return;
		}

	}

}