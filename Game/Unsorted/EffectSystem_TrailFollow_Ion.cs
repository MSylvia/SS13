// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class EffectSystem_TrailFollow_Ion : EffectSystem_TrailFollow {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.effect_type = typeof(Obj_Effect_ParticleEffect_IonTrails);
		}

		// Function from file: effects_other.dm
		public override void start(  ) {
			dynamic T = null;
			dynamic I = null;

			
			if ( !this.on ) {
				this.on = true;
				this.processing = true;

				if ( !Lang13.Bool( this.oldposition ) ) {
					this.oldposition = GlobalFuncs.get_turf( this.holder );
				}
			}

			if ( this.processing ) {
				this.processing = false;
				T = GlobalFuncs.get_turf( this.holder );

				if ( T != this.oldposition ) {
					
					if ( !GlobalFuncs.has_gravity( T ) ) {
						I = GlobalFuncs.PoolOrNew( this.effect_type, this.oldposition );
						I.dir = this.holder.dir;
						Icon13.Flick( "ion_fade", I );
						I.icon_state = "";
						Task13.Schedule( 20, (Task13.Closure)(() => {
							GlobalFuncs.qdel( I );
							return;
						}));
					}
					this.oldposition = T;
				}
				Task13.Schedule( 2, (Task13.Closure)(() => {
					
					if ( this.on ) {
						this.processing = true;
						this.start();
					}
					return;
				}));
			}
			return;
		}

	}

}