// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Subsystem_ServerMaint : Subsystem {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.name = "Server Tasks";
			this.wait = 6000;
			this.priority = 19;
		}

		// Function from file: server_maintenance.dm
		public Subsystem_ServerMaint (  ) {
			
			if ( GlobalVars.SSserver != this ) {
				
				if ( GlobalVars.SSserver is Subsystem_ServerMaint ) {
					this.Recover();
					GlobalFuncs.qdel( GlobalVars.SSserver );
				}
				GlobalVars.SSserver = this;
			}
			return;
		}

		// Function from file: server_maintenance.dm
		public override void fire(  ) {
			dynamic C = null;

			
			if ( Convert.ToDouble( GlobalVars.config.kick_inactive ) > 0 ) {
				
				foreach (dynamic _a in Lang13.Enumerate( GlobalVars.clients )) {
					C = _a;
					

					if ( !Lang13.Bool( ((dynamic)typeof(Client)).IsInstanceOfType( C ) ) ) {
						continue;
					}

					if ( ((Client)C).is_afk( 6000 ) != 0 ) {
						
						if ( !( C.mob is Mob_Dead ) ) {
							GlobalFuncs.log_access( "AFK: " + GlobalFuncs.key_name( C ) );
							C.WriteMsg( "<span class='danger'>You have been inactive for more than 10 minutes and have been disconnected.</span>" );
							Lang13.Delete( C );
							C = null;
						}
					}
				}
			}

			if ( GlobalVars.config.sql_enabled ) {
				GlobalFuncs.sql_poll_players();
				GlobalFuncs.sql_poll_admins();
			}
			return;
		}

	}

}