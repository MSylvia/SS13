// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class EffectSystem : Game_Data {

		public dynamic number = 3;
		public dynamic cardinals = 0;
		public dynamic location = null;
		public dynamic holder = null;
		public Type effect_type = null;
		public int total_effects = 0;

		// Function from file: effect_system.dm
		public virtual void start(  ) {
			double i = 0;
			dynamic E = null;
			dynamic direction = null;
			dynamic steps_amt = null;
			double j = 0;

			
			foreach (dynamic _b in Lang13.IterateRange( 1, this.number )) {
				i = _b;
				

				if ( this.total_effects > 20 ) {
					return;
				}
				Task13.Schedule( 0, (Task13.Closure)(() => {
					
					if ( Lang13.Bool( this.holder ) ) {
						this.location = GlobalFuncs.get_turf( this.holder );
					}
					E = GlobalFuncs.PoolOrNew( this.effect_type, this.location );
					this.total_effects++;
					direction = null;

					if ( Lang13.Bool( this.cardinals ) ) {
						direction = Rand13.PickFromTable( GlobalVars.cardinal );
					} else {
						direction = Rand13.PickFromTable( GlobalVars.alldirs );
					}
					steps_amt = Rand13.Pick(new object [] { 1, 2, 3 });

					foreach (dynamic _a in Lang13.IterateRange( 1, steps_amt )) {
						j = _a;
						
						Task13.Sleep( 5 );
						Map13.Step( E, Convert.ToInt32( direction ) );
					}
					Task13.Schedule( 20, (Task13.Closure)(() => {
						this.total_effects--;
						return;
					}));
					return;
				}));
			}
			return;
		}

		// Function from file: effect_system.dm
		public void attach( dynamic atom = null ) {
			this.holder = atom;
			return;
		}

		// Function from file: effect_system.dm
		public virtual void set_up( dynamic amt = null, dynamic loca = null, dynamic flash = null, dynamic flash_fact = null, bool? message = null ) {
			amt = amt ?? 3;
			loca = loca ?? 0;

			
			if ( Convert.ToDouble( amt ) > 10 ) {
				amt = 10;
			}
			this.number = amt;
			this.cardinals = loca;

			if ( flash is Tile ) {
				this.location = flash;
			} else {
				this.location = GlobalFuncs.get_turf( flash );
			}
			return;
		}

		// Function from file: effect_system.dm
		public override dynamic Destroy(  ) {
			this.holder = null;
			this.location = null;
			return base.Destroy();
		}

	}

}