// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class RoundEvent_Wizard_CursedItems : RoundEvent_Wizard {

		// Function from file: curseditems.dm
		public override bool start(  ) {
			string item_set = null;
			ByTable wearslots = null;
			ByTable loadout = null;
			bool? ruins_spaceworthiness = null;
			bool? ruins_wizard_loadout = null;
			Mob_Living_Carbon_Human H = null;
			ByTable slots = null;
			int? i = null;
			dynamic J = null;
			dynamic I = null;
			Mob_Living_Carbon_Human H2 = null;
			EffectSystem_SmokeSpread smoke = null;

			item_set = Rand13.Pick(new object [] { "wizardmimic", "swords", "bigfatdoobie", "boxing", "voicemodulators", "catgirls2015" });
			wearslots = new ByTable(new object [] { 13, 12, 11, 2, 5, 10, 8 });
			loadout = new ByTable();
			ruins_spaceworthiness = null;
			ruins_wizard_loadout = null;
			loadout.len = 7;

			switch ((string)( item_set )) {
				case "wizardmimic":
					loadout = new ByTable(new object [] { typeof(Obj_Item_Clothing_Suit_Wizrobe), typeof(Obj_Item_Clothing_Shoes_Sandal), typeof(Obj_Item_Clothing_Head_Wizard) });
					ruins_spaceworthiness = true;
					break;
				case "swords":
					loadout[5] = typeof(Obj_Item_Weapon_Katana_Cursed);
					break;
				case "bigfatdoobie":
					loadout[4] = typeof(Obj_Item_Clothing_Mask_Cigarette_Rollie_Trippy);
					ruins_spaceworthiness = true;
					break;
				case "boxing":
					loadout[4] = typeof(Obj_Item_Clothing_Mask_Luchador);
					loadout[6] = typeof(Obj_Item_Clothing_Gloves_Boxing);
					ruins_spaceworthiness = true;
					break;
				case "voicemodulators":
					loadout[4] = typeof(Obj_Item_Clothing_Mask_Gas_Voice);
					break;
				case "catgirls2015":
					loadout[3] = typeof(Obj_Item_Clothing_Head_Kitty);
					ruins_spaceworthiness = true;
					ruins_wizard_loadout = true;
					break;
			}

			foreach (dynamic _b in Lang13.Enumerate( GlobalVars.living_mob_list, typeof(Mob_Living_Carbon_Human) )) {
				H = _b;
				

				if ( ruins_spaceworthiness == true && ( H.z != 1 || H.loc is Tile_Space ) ) {
					continue;
				}

				if ( ruins_wizard_loadout == true && H.mind != null && ( GlobalVars.ticker.mode.wizards.Contains( H.mind ) || GlobalVars.ticker.mode.apprentices.Contains( H.mind ) ) ) {
					continue;
				}

				if ( item_set == "catgirls2015" ) {
					H.gender = GlobalVars.FEMALE;
				}
				slots = new ByTable(new object [] { H.wear_suit, H.shoes, H.head, H.wear_mask, H.r_hand, H.gloves, H.ears });
				i = null;
				i = 1;

				while (( i ??0) <= loadout.len) {
					
					if ( Lang13.Bool( loadout[i] ) ) {
						J = loadout[i];
						I = Lang13.Call( J );
						H.unEquip( slots[i] );
						H.equip_to_slot_or_del( I, Convert.ToInt32( wearslots[i] ) );
						I.flags |= 2;
						I.name = "cursed " + I.name;
					}
					i++;
				}
			}

			foreach (dynamic _c in Lang13.Enumerate( GlobalVars.living_mob_list, typeof(Mob_Living_Carbon_Human) )) {
				H2 = _c;
				
				smoke = new EffectSystem_SmokeSpread();
				smoke.set_up( 0, H2.loc );
				smoke.start();
			}
			return false;
		}

	}

}