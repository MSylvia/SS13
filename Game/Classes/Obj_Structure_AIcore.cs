// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Structure_AIcore : Obj_Structure {

		public int state = 0;
		public AiLaws laws = new AiLaws();
		public dynamic circuit = null;
		public dynamic brain = null;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.icon = "icons/mob/AI.dmi";
			this.icon_state = "0";
		}

		public Obj_Structure_AIcore ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: ai_core.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			dynamic WT = null;
			dynamic C = null;
			Obj_Item_Stack_CableCoil A2 = null;
			dynamic G = null;
			dynamic M = null;
			dynamic templaw = null;
			dynamic M2 = null;
			dynamic M3 = null;

			
			switch ((int)( this.state )) {
				case 0:
					
					if ( A is Obj_Item_Weapon_Wrench ) {
						GlobalFuncs.playsound( this.loc, "sound/items/ratchet.ogg", 50, 1 );
						user.WriteMsg( "<span class='notice'>You start wrenching the frame into place...</span>" );

						if ( GlobalFuncs.do_after( user, 20 / A.toolspeed, null, this ) ) {
							user.WriteMsg( "<span class='notice'>You wrench the frame into place.</span>" );
							this.anchored = 1;
							this.state = 1;
						}
					}

					if ( A is Obj_Item_Weapon_Weldingtool ) {
						WT = A;

						if ( !((Obj_Item_Weapon_Weldingtool)WT).isOn() ) {
							user.WriteMsg( "<span class='warning'>The welder must be on for this task!</span>" );
							return null;
						}
						GlobalFuncs.playsound( this.loc, "sound/items/welder.ogg", 50, 1 );
						user.WriteMsg( "<span class='notice'>You start to deconstruct the frame...</span>" );

						if ( GlobalFuncs.do_after( user, 20 / A.toolspeed, null, this ) ) {
							
							if ( !( this != null ) || !((Obj_Item_Weapon_Weldingtool)WT).remove_fuel( 0, user ) ) {
								return null;
							}
							user.WriteMsg( "<span class='notice'>You deconstruct the frame.</span>" );
							new Obj_Item_Stack_Sheet_Plasteel( this.loc, 4 );
							GlobalFuncs.qdel( this );
						}
					}
					break;
				case 1:
					
					if ( A is Obj_Item_Weapon_Wrench ) {
						GlobalFuncs.playsound( this.loc, "sound/items/ratchet.ogg", 50, 1 );
						user.WriteMsg( "<span class='notice'>You start to unfasten the frame...</span>" );

						if ( GlobalFuncs.do_after( user, 20 / A.toolspeed, null, this ) ) {
							user.WriteMsg( "<span class='notice'>You unfasten the frame.</span>" );
							this.anchored = 0;
							this.state = 0;
						}
					}

					if ( A is Obj_Item_Weapon_Circuitboard_Aicore && !Lang13.Bool( this.circuit ) ) {
						
						if ( !Lang13.Bool( user.drop_item() ) ) {
							return null;
						}
						GlobalFuncs.playsound( this.loc, "sound/items/Deconstruct.ogg", 50, 1 );
						user.WriteMsg( "<span class='notice'>You place the circuit board inside the frame.</span>" );
						this.icon_state = "1";
						this.circuit = A;
						A.loc = this;
					}

					if ( A is Obj_Item_Weapon_Screwdriver && Lang13.Bool( this.circuit ) ) {
						GlobalFuncs.playsound( this.loc, "sound/items/Screwdriver.ogg", 50, 1 );
						user.WriteMsg( "<span class='notice'>You screw the circuit board into place.</span>" );
						this.state = 2;
						this.icon_state = "2";
					}

					if ( A is Obj_Item_Weapon_Crowbar && Lang13.Bool( this.circuit ) ) {
						GlobalFuncs.playsound( this.loc, "sound/items/Crowbar.ogg", 50, 1 );
						user.WriteMsg( "<span class='notice'>You remove the circuit board.</span>" );
						this.state = 1;
						this.icon_state = "0";
						this.circuit.loc = this.loc;
						this.circuit = null;
					}
					break;
				case 2:
					
					if ( A is Obj_Item_Weapon_Screwdriver && Lang13.Bool( this.circuit ) ) {
						GlobalFuncs.playsound( this.loc, "sound/items/Screwdriver.ogg", 50, 1 );
						user.WriteMsg( "<span class='notice'>You unfasten the circuit board.</span>" );
						this.state = 1;
						this.icon_state = "1";
					}

					if ( A is Obj_Item_Stack_CableCoil ) {
						C = A;

						if ( ( ((Obj_Item_Stack)C).get_amount() ??0) >= 5 ) {
							GlobalFuncs.playsound( this.loc, "sound/items/Deconstruct.ogg", 50, 1 );
							user.WriteMsg( "<span class='notice'>You start to add cables to the frame...</span>" );

							if ( GlobalFuncs.do_after( user, 20, null, this ) ) {
								
								if ( ( ((Obj_Item_Stack)C).get_amount() ??0) >= 5 && this.state == 2 ) {
									((Obj_Item_Stack)C).use( 5 );
									user.WriteMsg( "<span class='notice'>You add cables to the frame.</span>" );
									this.state = 3;
									this.icon_state = "3";
								}
							}
						} else {
							user.WriteMsg( "<span class='warning'>You need five lengths of cable to wire the AI core!</span>" );
							return null;
						}
					}
					break;
				case 3:
					
					if ( A is Obj_Item_Weapon_Wirecutters ) {
						
						if ( Lang13.Bool( this.brain ) ) {
							user.WriteMsg( "<span class='warning'>Get that brain out of there first!</span>" );
						} else {
							GlobalFuncs.playsound( this.loc, "sound/items/Wirecutter.ogg", 50, 1 );
							user.WriteMsg( "<span class='notice'>You remove the cables.</span>" );
							this.state = 2;
							this.icon_state = "2";
							A2 = new Obj_Item_Stack_CableCoil( this.loc );
							A2.amount = 5;
						}
					}

					if ( A is Obj_Item_Stack_Sheet_Rglass ) {
						G = A;

						if ( ( ((Obj_Item_Stack)G).get_amount() ??0) >= 2 ) {
							GlobalFuncs.playsound( this.loc, "sound/items/Deconstruct.ogg", 50, 1 );
							user.WriteMsg( "<span class='notice'>You start to put in the glass panel...</span>" );

							if ( GlobalFuncs.do_after( user, 20, null, this ) ) {
								
								if ( ( ((Obj_Item_Stack)G).get_amount() ??0) >= 2 && this.state == 3 ) {
									((Obj_Item_Stack)G).use( 2 );
									user.WriteMsg( "<span class='notice'>You put in the glass panel.</span>" );
									this.state = 4;
									this.icon_state = "4";
								}
							}
						} else {
							user.WriteMsg( "<span class='warning'>You need two sheets of reinforced glass to insert them into AI core!</span>" );
							return null;
						}
					}

					if ( A is Obj_Item_Weapon_AiModule_Core_Full ) {
						M = A;
						this.laws.clear_inherent_laws();
						this.laws.clear_zeroth_law( false );

						foreach (dynamic _a in Lang13.Enumerate( M.laws )) {
							templaw = _a;
							
							this.laws.add_inherent_law( templaw );
						}
						user.WriteMsg( "<span class='notice'>Law module applied.</span>" );
					}

					if ( A is Obj_Item_Weapon_AiModule_Reset_Purge ) {
						this.laws.clear_inherent_laws();
						this.laws.clear_zeroth_law( false );
						user.WriteMsg( "<span class='notice'>Laws cleared applied.</span>" );
					}

					if ( A is Obj_Item_Weapon_AiModule_Supplied_Freeform || A is Obj_Item_Weapon_AiModule_Core_Freeformcore ) {
						M2 = A;

						if ( M2.laws[1] == "" ) {
							return null;
						}
						this.laws.add_inherent_law( M2.laws[1] );
						user.WriteMsg( "<span class='notice'>Added a freeform law.</span>" );
					}

					if ( A is Obj_Item_Device_Mmi ) {
						M3 = A;

						if ( !Lang13.Bool( M3.brainmob ) ) {
							user.WriteMsg( "<span class='warning'>Sticking an empty MMI into the frame would sort of defeat the purpose!</span>" );
							return null;
						}

						if ( Convert.ToInt32( M3.brainmob.stat ) == 2 ) {
							user.WriteMsg( "<span class='warning'>Sticking a dead brain into the frame would sort of defeat the purpose!</span>" );
							return null;
						}

						if ( !Lang13.Bool( M3.brainmob.client ) ) {
							user.WriteMsg( "<span class='warning'>Sticking an inactive brain into the frame would sort of defeat the purpose.</span>" );
							return null;
						}

						if ( GlobalVars.config != null && !GlobalVars.config.allow_ai ) {
							user.WriteMsg( "<span class='warning'>This MMI does not seem to fit!</span>" );
							return null;
						}

						if ( GlobalFuncs.jobban_isbanned( M3.brainmob, "AI" ) ) {
							user.WriteMsg( "<span class='warning'>This MMI does not seem to fit!</span>" );
							return null;
						}

						if ( M3.syndiemmi ) {
							user.WriteMsg( "<span class='warning'>This MMI does not seem to fit!</span>" );
							return null;
						}

						if ( !Lang13.Bool( M3.brainmob.mind ) ) {
							user.WriteMsg( "<span class='warning'>This MMI is mindless!</span>" );
							return null;
						}

						if ( !Lang13.Bool( user.drop_item() ) ) {
							return null;
						}
						((GameMode)GlobalVars.ticker.mode).remove_antag_for_borging( M3.brainmob.mind );
						M3.loc = this;
						this.brain = M3;
						user.WriteMsg( "<span class='notice'>Added a brain.</span>" );
						this.icon_state = "3b";
					}

					if ( A is Obj_Item_Weapon_Crowbar && Lang13.Bool( this.brain ) ) {
						GlobalFuncs.playsound( this.loc, "sound/items/Crowbar.ogg", 50, 1 );
						user.WriteMsg( "<span class='notice'>You remove the brain.</span>" );
						this.brain.loc = this.loc;
						this.brain = null;
						this.icon_state = "3";
					}
					break;
				case 4:
					
					if ( A is Obj_Item_Weapon_Crowbar ) {
						GlobalFuncs.playsound( this.loc, "sound/items/Crowbar.ogg", 50, 1 );
						user.WriteMsg( "<span class='notice'>You remove the glass panel.</span>" );
						this.state = 3;

						if ( Lang13.Bool( this.brain ) ) {
							this.icon_state = "3b";
						} else {
							this.icon_state = "3";
						}
						new Obj_Item_Stack_Sheet_Rglass( this.loc, 2 );
						return null;
					}

					if ( A is Obj_Item_Weapon_Screwdriver ) {
						GlobalFuncs.playsound( this.loc, "sound/items/Screwdriver.ogg", 50, 1 );
						user.WriteMsg( "<span class='notice'>You connect the monitor.</span>" );

						if ( !( this.laws.inherent.len != 0 ) ) {
							this.laws = null;
						}
						new Mob_Living_Silicon_Ai( this.loc, this.laws, this.brain );
						GlobalFuncs.feedback_inc( "cyborg_ais_created", 1 );
						GlobalFuncs.qdel( this );
					}
					break;
			}
			return null;
		}

	}

}