// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_ProcHolder_Spell_Targeted_Glare : Obj_Effect_ProcHolder_Spell_Targeted {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.panel = "Shadowling Abilities";
			this.charge_max = 300;
			this.human_req = 1;
			this.clothes_req = 0;
			this.action_icon_state = "glare";
		}

		public Obj_Effect_ProcHolder_Spell_Targeted_Glare ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: shadowling_abilities.dm
		public override bool cast( dynamic targets = null, dynamic thearea = null, dynamic user = null ) {
			thearea = thearea ?? Task13.User;

			Mob_Living target = null;
			Mob_Living M = null;

			
			foreach (dynamic _a in Lang13.Enumerate( targets, typeof(Mob_Living) )) {
				target = _a;
				

				if ( !( target is Mob_Living_Carbon_Human ) ) {
					thearea.WriteMsg( "<span class='warning'>You may only glare at humans!</span>" );
					this.revert_cast();
					return false;
				}

				if ( !this.shadowling_check( thearea ) ) {
					this.revert_cast();
					return false;
				}

				if ( target.stat != 0 ) {
					thearea.WriteMsg( "<span class='warning'>" + target + " must be conscious!</span>" );
					this.revert_cast();
					return false;
				}

				if ( GlobalFuncs.is_shadow_or_thrall( target ) ) {
					thearea.WriteMsg( "<span class='warning'>You cannot glare at allies!</span>" );
					this.revert_cast();
					return false;
				}
				M = target;
				((Ent_Static)thearea).visible_message( "<span class='warning'><b>" + thearea + "'s eyes flash a blinding red!</b></span>" );
				target.visible_message( "<span class='danger'>" + target + " freezes in place, their eyes glazing over...</span>" );

				if ( Map13.GetDistance( target, thearea ) <= 1 ) {
					target.WriteMsg( "<span class='userdanger'>Your gaze is forcibly drawn into " + thearea + "'s eyes, and you are mesmerized by the heavenly lights...</span>" );
				} else {
					target.WriteMsg( "<span class='userdanger'>Red lights suddenly dance in your vision, and you are mesmerized by their heavenly beauty...</span>" );
				}
				target.Stun( 10 );
				((dynamic)M).silent += 10;
			}
			return false;
		}

	}

}