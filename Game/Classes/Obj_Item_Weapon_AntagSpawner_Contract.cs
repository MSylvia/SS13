// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_AntagSpawner_Contract : Obj_Item_Weapon_AntagSpawner {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.icon = "icons/obj/wizard.dmi";
			this.icon_state = "scroll2";
		}

		public Obj_Item_Weapon_AntagSpawner_Contract ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: antag_spawner.dm
		public override void equip_antag( Mob_Living_Carbon_Human target = null ) {
			target.equip_to_slot_or_del( new Obj_Item_Device_Radio_Headset( target ), 8 );
			target.equip_to_slot_or_del( new Obj_Item_Clothing_Under_Color_Lightpurple( target ), 14 );
			target.equip_to_slot_or_del( new Obj_Item_Clothing_Shoes_Sandal( target ), 12 );
			target.equip_to_slot_or_del( new Obj_Item_Clothing_Suit_Wizrobe( target ), 13 );
			target.equip_to_slot_or_del( new Obj_Item_Clothing_Head_Wizard( target ), 11 );
			target.equip_to_slot_or_del( new Obj_Item_Weapon_Storage_Backpack( target ), 1 );
			target.equip_to_slot_or_del( new Obj_Item_Weapon_Storage_Box( target ), 18 );
			target.equip_to_slot_or_del( new Obj_Item_Weapon_TeleportationScroll_Apprentice( target ), 16 );
			return;
		}

		// Function from file: antag_spawner.dm
		public override void spawn_antag( dynamic C = null, dynamic T = null, string type = null ) {
			type = type ?? "";

			Mob_Living_Carbon_Human M = null;
			Mob H = null;
			dynamic wizard_name_first = null;
			dynamic wizard_name_second = null;
			string randomname = null;
			dynamic new_objective = null;
			string newname = null;

			GlobalFuncs.PoolOrNew( typeof(Obj_Effect_ParticleEffect_Smoke), T );
			M = new Mob_Living_Carbon_Human( T );
			C.prefs.copy_to( M );
			M.key = C.key;
			M.WriteMsg( "<B>You are the " + Task13.User.real_name + "'s apprentice! You are bound by magic contract to follow their orders and help them in accomplishing their goals." );

			switch ((string)( type )) {
				case "destruction":
					M.mind.AddSpell( new Obj_Effect_ProcHolder_Spell_Targeted_Projectile_MagicMissile( null ) );
					M.mind.AddSpell( new Obj_Effect_ProcHolder_Spell_Dumbfire_Fireball( null ) );
					M.WriteMsg( "<B>Your service has not gone unrewarded, however. Studying under " + Task13.User.real_name + ", you have learned powerful, destructive spells. You are able to cast magic missile and fireball." );
					break;
				case "bluespace":
					M.mind.AddSpell( new Obj_Effect_ProcHolder_Spell_Targeted_AreaTeleport_Teleport( null ) );
					M.mind.AddSpell( new Obj_Effect_ProcHolder_Spell_Targeted_EtherealJaunt( null ) );
					M.WriteMsg( "<B>Your service has not gone unrewarded, however. Studying under " + Task13.User.real_name + ", you have learned reality bending mobility spells. You are able to cast teleport and ethereal jaunt." );
					break;
				case "healing":
					M.mind.AddSpell( new Obj_Effect_ProcHolder_Spell_Targeted_Charge( null ) );
					M.mind.AddSpell( new Obj_Effect_ProcHolder_Spell_AoeTurf_Conjure_Forcewall( null ) );
					M.equip_to_slot_or_del( new Obj_Item_Weapon_Gun_Magic_Staff_Healing( M ), 5 );
					M.WriteMsg( "<B>Your service has not gone unrewarded, however. Studying under " + Task13.User.real_name + ", you have learned livesaving survival spells. You are able to cast charge and forcewall." );
					break;
				case "robeless":
					M.mind.AddSpell( new Obj_Effect_ProcHolder_Spell_AoeTurf_Knock( null ) );
					M.mind.AddSpell( new Obj_Effect_ProcHolder_Spell_Targeted_MindTransfer( null ) );
					M.WriteMsg( "<B>Your service has not gone unrewarded, however. Studying under " + Task13.User.real_name + ", you have learned stealthy, robeless spells. You are able to cast knock and mindswap." );
					break;
			}
			this.equip_antag( M );
			H = Task13.User;
			wizard_name_first = Rand13.PickFromTable( GlobalVars.wizard_first );
			wizard_name_second = Rand13.PickFromTable( GlobalVars.wizard_second );
			randomname = "" + wizard_name_first + " " + wizard_name_second;
			new_objective = GlobalFuncs.add_objective( M.mind, typeof(Objective_Default_Protect) );
			new_objective.target = H.mind;
			new_objective.explanation_text = "Protect " + H.real_name + ", the wizard.";
			GlobalVars.ticker.mode.apprentices.Add( M.mind );
			M.mind.special_role = "apprentice";
			((GameMode)GlobalVars.ticker.mode).update_wiz_icons_added( M.mind );
			M.WriteMsg( new Sound( "sound/effects/magic.ogg" ) );
			newname = String13.SubStr( GlobalFuncs.sanitize( Interface13.Input( M, "You are the wizard's apprentice. Would you like to change your name to something else?", "Name change", randomname, null, InputType.Str | InputType.Null ) ), 1, 26 );

			if ( !Lang13.Bool( newname ) ) {
				newname = randomname;
			}
			M.mind.name = newname;
			M.real_name = newname;
			M.name = newname;
			M.dna.update_dna_identity();
			return;
		}

		// Function from file: antag_spawner.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hsrc = null ) {
			Mob H = null;
			ByTable candidates = null;
			dynamic C = null;

			base.Topic( href, href_list, (object)(hsrc) );
			H = Task13.User;

			if ( H.stat != 0 || H.restrained() ) {
				return null;
			}

			if ( !( H is Mob_Living_Carbon_Human ) ) {
				return 1;
			}

			if ( this.loc == H || Map13.GetDistance( this, H ) <= 1 && this.loc is Tile ) {
				H.set_machine( this );

				if ( Lang13.Bool( href_list["school"] ) ) {
					
					if ( this.used ) {
						H.WriteMsg( "You already used this contract!" );
						return null;
					}
					candidates = GlobalFuncs.get_candidates( "wizard" );

					if ( candidates.len != 0 ) {
						this.used = true;
						C = Rand13.PickFromTable( candidates );
						this.spawn_antag( C, GlobalFuncs.get_turf( H.loc ), href_list["school"] );

						if ( H.mind != null ) {
							((GameMode)GlobalVars.ticker.mode).update_wiz_icons_added( H.mind );
						}
					} else {
						H.WriteMsg( "Unable to reach your apprentice! You can either attack the spellbook with the contract to refund your points, or wait and try again later." );
					}
				}
			}
			return null;
		}

		// Function from file: antag_spawner.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			string dat = null;

			((Mob)user).set_machine( this );

			if ( this.used ) {
				dat = "<B>You have already summoned your apprentice.</B><BR>";
			} else {
				dat = "<B>Contract of Apprenticeship:</B><BR>";
				dat += "<I>Using this contract, you may summon an apprentice to aid you on your mission.</I><BR>";
				dat += "<I>If you are unable to establish contact with your apprentice, you can feed the contract back to the spellbook to refund your points.</I><BR>";
				dat += "<B>Which school of magic is your apprentice studying?:</B><BR>";
				dat += new Txt( "<A href='byond://?src=" ).Ref( this ).str( ";school=destruction'>Destruction</A><BR>" ).ToString();
				dat += "<I>Your apprentice is skilled in offensive magic. They know Magic Missile and Fireball.</I><BR>";
				dat += new Txt( "<A href='byond://?src=" ).Ref( this ).str( ";school=bluespace'>Bluespace Manipulation</A><BR>" ).ToString();
				dat += "<I>Your apprentice is able to defy physics, melting through solid objects and travelling great distances in the blink of an eye. They know Teleport and Ethereal Jaunt.</I><BR>";
				dat += new Txt( "<A href='byond://?src=" ).Ref( this ).str( ";school=healing'>Healing</A><BR>" ).ToString();
				dat += "<I>Your apprentice is training to cast spells that will aid your survival. They know Forcewall and Charge and come with a Staff of Healing.</I><BR>";
				dat += new Txt( "<A href='byond://?src=" ).Ref( this ).str( ";school=robeless'>Robeless</A><BR>" ).ToString();
				dat += "<I>Your apprentice is training to cast spells without their robes. They know Knock and Mindswap.</I><BR>";
			}
			Interface13.Browse( user, dat, "window=radio" );
			GlobalFuncs.onclose( user, "radio" );
			return null;
		}

	}

}