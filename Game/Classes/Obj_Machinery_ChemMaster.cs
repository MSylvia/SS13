// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_ChemMaster : Obj_Machinery {

		public dynamic beaker = null;
		public dynamic bottle = null;
		public bool mode = false;
		public bool condi = false;
		public dynamic useramount = 30;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.anchored = 1;
			this.idle_power_usage = 20;
			this.icon = "icons/obj/chemical.dmi";
			this.icon_state = "mixer0";
		}

		// Function from file: chem_master.dm
		public Obj_Machinery_ChemMaster ( dynamic loc = null ) : base( (object)(loc) ) {
			this.create_reagents( 100 );
			this.overlays.Add( "waitlight" );
			return;
		}

		// Function from file: chem_master.dm
		public dynamic isgoodnumber( dynamic num = null ) {
			
			if ( Lang13.Bool( Lang13.IsNumber( num ) ) ) {
				
				if ( Convert.ToDouble( num ) > 200 ) {
					num = 200;
				} else if ( Convert.ToDouble( num ) < 0 ) {
					num = 0;
				} else {
					num = Num13.Floor( Convert.ToDouble( num ) );
				}
				return num;
			} else {
				return 0;
			}
		}

		// Function from file: chem_master.dm
		public override dynamic attack_hand( dynamic a = null, bool? b = null, bool? c = null ) {
			string dat = null;
			Reagent G = null;
			Reagent N = null;
			Browser popup = null;

			
			if ( ( this.stat & 1 ) != 0 ) {
				return null;
			}
			((Mob)a).set_machine( this );
			dat = "";

			if ( Lang13.Bool( this.beaker ) ) {
				dat += new Txt( "Beaker [" ).item( this.beaker.reagents.total_volume ).str( "/" ).item( this.beaker.volume ).str( "] <A href='?src=" ).Ref( this ).str( ";eject=1'>Eject and Clear Buffer</A><BR>" ).ToString();
			} else {
				dat = "Please insert beaker.<BR>";
			}
			dat += "<HR><B>Add to buffer:</B><UL>";

			if ( Lang13.Bool( this.beaker ) ) {
				
				if ( Lang13.Bool( this.beaker.reagents.total_volume ) ) {
					
					foreach (dynamic _a in Lang13.Enumerate( this.beaker.reagents.reagent_list, typeof(Reagent) )) {
						G = _a;
						
						dat += "<LI>" + G.name + ", " + G.volume + " Units - ";
						dat += new Txt( "<A href='?src=" ).Ref( this ).str( ";analyze=1;reagent=" ).Ref( G ).str( "'>Analyze</A> " ).ToString();
						dat += new Txt( "<A href='?src=" ).Ref( this ).str( ";add=" ).item( G.id ).str( ";amount=1'>1</A> " ).ToString();
						dat += new Txt( "<A href='?src=" ).Ref( this ).str( ";add=" ).item( G.id ).str( ";amount=5'>5</A> " ).ToString();
						dat += new Txt( "<A href='?src=" ).Ref( this ).str( ";add=" ).item( G.id ).str( ";amount=10'>10</A> " ).ToString();
						dat += new Txt( "<A href='?src=" ).Ref( this ).str( ";add=" ).item( G.id ).str( ";amount=" ).item( G.volume ).str( "'>All</A> " ).ToString();
						dat += new Txt( "<A href='?src=" ).Ref( this ).str( ";addcustom=" ).item( G.id ).str( "'>Custom</A>" ).ToString();
					}
				} else {
					dat += "<LI>Beaker is empty.";
				}
			} else {
				dat += "<LI>No beaker.";
			}
			dat += new Txt( "</UL><HR><B>Transfer to <A href='?src=" ).Ref( this ).str( ";toggle=1'>" ).item( ( !this.mode ? "disposal" : "beaker" ) ).str( "</A>:</B><UL>" ).ToString();

			if ( Lang13.Bool( this.reagents.total_volume ) ) {
				
				foreach (dynamic _b in Lang13.Enumerate( this.reagents.reagent_list, typeof(Reagent) )) {
					N = _b;
					
					dat += "<LI>" + N.name + ", " + N.volume + " Units - ";
					dat += new Txt( "<A href='?src=" ).Ref( this ).str( ";analyze=1;reagent=" ).Ref( N ).str( "'>Analyze</A> " ).ToString();
					dat += new Txt( "<A href='?src=" ).Ref( this ).str( ";remove=" ).item( N.id ).str( ";amount=1'>1</A> " ).ToString();
					dat += new Txt( "<A href='?src=" ).Ref( this ).str( ";remove=" ).item( N.id ).str( ";amount=5'>5</A> " ).ToString();
					dat += new Txt( "<A href='?src=" ).Ref( this ).str( ";remove=" ).item( N.id ).str( ";amount=10'>10</A> " ).ToString();
					dat += new Txt( "<A href='?src=" ).Ref( this ).str( ";remove=" ).item( N.id ).str( ";amount=" ).item( N.volume ).str( "'>All</A> " ).ToString();
					dat += new Txt( "<A href='?src=" ).Ref( this ).str( ";removecustom=" ).item( N.id ).str( "'>Custom</A>" ).ToString();
				}
			} else {
				dat += "<LI>Buffer is empty.";
			}
			dat += "</UL><HR>";

			if ( !this.condi ) {
				
				if ( Lang13.Bool( this.bottle ) ) {
					dat += new Txt( "Pill Bottle [" ).item( this.bottle.contents.len ).str( "/" ).item( this.bottle.storage_slots ).str( "] <A href='?src=" ).Ref( this ).str( ";ejectp=1'>Eject</A>" ).ToString();
				} else {
					dat += "No pill bottle inserted.";
				}
			} else {
				dat += "<BR>";
			}
			dat += "<UL>";

			if ( !this.condi ) {
				
				if ( Lang13.Bool( this.beaker ) && Lang13.Bool( this.reagents.total_volume ) ) {
					dat += new Txt( "<LI><A href='?src=" ).Ref( this ).str( ";createpill=1;many=0'>Create pill</A> (50 units max)" ).ToString();
					dat += new Txt( "<LI><A href='?src=" ).Ref( this ).str( ";createpill=1;many=1'>Create multiple pills</A><BR>" ).ToString();
					dat += new Txt( "<LI><A href='?src=" ).Ref( this ).str( ";createpatch=1;many=0'>Create patch</A> (50 units max)" ).ToString();
					dat += new Txt( "<LI><A href='?src=" ).Ref( this ).str( ";createpatch=1;many=1'>Create multiple patches</A><BR>" ).ToString();
				} else {
					dat += "<LI><span class='linkOff'>Create pill</span> (50 units max)";
					dat += "<LI><span class='linkOff'>Create multiple pills</span><BR>";
					dat += "<LI><span class='linkOff'>Create patch</span> (50 units max)";
					dat += "<LI><span class='linkOff'>Create multiple patches</span><BR>";
				}
			} else if ( Lang13.Bool( this.beaker ) && Lang13.Bool( this.reagents.total_volume ) ) {
				dat += new Txt( "<LI><A href='?src=" ).Ref( this ).str( ";createpill=1'>Create pack</A> (10 units max)<BR>" ).ToString();
			} else {
				dat += "<LI><span class='linkOff'>Create pack</span> (10 units max)<BR>";
			}
			dat += new Txt( "<LI><A href='?src=" ).Ref( this ).str( ";createbottle=1'>Create bottle</A> (" ).item( ( this.condi ? "50" : "30" ) ).str( " units max)" ).ToString();
			dat += "</UL>";
			dat += new Txt( "<BR><A href='?src=" ).Ref( this ).str( ";close=1'>Close</A>" ).ToString();
			popup = new Browser( a, "chem_master", this.name, 470, 500 );
			popup.set_content( dat );
			popup.set_title_image( ((Mob)a).browse_rsc_icon( this.icon, this.icon_state ) );
			popup.open( true );
			return null;
		}

		// Function from file: chem_master.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hsrc = null ) {
			string name = null;
			Obj_Item_Weapon_ReagentContainers P = null;
			dynamic R = null;
			string dat = null;
			dynamic T = null;
			Browser popup = null;
			string id = null;
			double? amount = null;
			dynamic id2 = null;
			dynamic amt_temp = null;
			string id3 = null;
			double? amount2 = null;
			dynamic id4 = null;
			dynamic amt_temp2 = null;
			int? amount3 = null;
			int vol_each = 0;
			string name2 = null;
			Obj_Item_Weapon_ReagentContainers_Pill P2 = null;
			int? i = null;
			string name3 = null;
			Obj_Item_Weapon_ReagentContainers_Food_Condiment_Pack P3 = null;
			int? amount4 = null;
			int vol_each2 = 0;
			string name4 = null;
			Obj_Item_Weapon_ReagentContainers_Pill_Patch P4 = null;
			int? i2 = null;

			
			if ( Lang13.Bool( base.Topic( href, href_list, (object)(hsrc) ) ) ) {
				return null;
			}
			Task13.User.set_machine( this );

			if ( Lang13.Bool( href_list["ejectp"] ) ) {
				
				if ( Lang13.Bool( this.bottle ) ) {
					this.bottle.loc = this.loc;
					this.bottle = null;
				}
			} else if ( Lang13.Bool( href_list["close"] ) ) {
				Interface13.Browse( Task13.User, null, "window=chem_master" );
				Task13.User.unset_machine();
				return null;
			} else if ( Lang13.Bool( href_list["toggle"] ) ) {
				this.mode = !this.mode;
			} else if ( Lang13.Bool( href_list["createbottle"] ) ) {
				name = GlobalFuncs.stripped_input( Task13.User, "Name:", "Name your bottle!", ( Lang13.Bool( this.reagents.total_volume ) ? this.reagents.get_master_reagent_name() : " " ), 26 );

				if ( !Lang13.Bool( name ) ) {
					return null;
				}

				if ( this.condi ) {
					P = new Obj_Item_Weapon_ReagentContainers_Food_Condiment( this.loc );
				} else {
					P = new Obj_Item_Weapon_ReagentContainers_Glass_Bottle( this.loc );
					P.pixel_x = Rand13.Int( -7, 7 );
					P.pixel_y = Rand13.Int( -7, 7 );
				}
				P.name = GlobalFuncs.trim( "" + name + " bottle" );
				this.reagents.trans_to( P, P.volume );
			}

			if ( Lang13.Bool( this.beaker ) ) {
				
				if ( Lang13.Bool( href_list["analyze"] ) ) {
					
					if ( Lang13.Bool( Lang13.FindObj( href_list["reagent"] ) ) ) {
						R = Lang13.FindObj( href_list["reagent"] );

						if ( Lang13.Bool( R ) ) {
							dat = "";
							dat += "<H1>" + ( this.condi ? "Condiment" : "Chemical" ) + " information:</H1>";
							dat += "<B>Name:</B> " + Lang13.Initial( R, "name" ) + "<BR><BR>";
							dat += "<B>State:</B> ";

							if ( Lang13.Initial( R, "reagent_state" ) == 1 ) {
								dat += "Solid";
							} else if ( Lang13.Initial( R, "reagent_state" ) == 2 ) {
								dat += "Liquid";
							} else if ( Lang13.Initial( R, "reagent_state" ) == 3 ) {
								dat += "Gas";
							} else {
								dat += "Unknown";
							}
							dat += "<BR>";
							dat += "<B>Color:</B> <span style='color:" + Lang13.Initial( R, "color" ) + ";background-color:" + Lang13.Initial( R, "color" ) + ";font:Lucida Console'>" + Lang13.Initial( R, "color" ) + "</span><BR><BR>";
							dat += "<B>Description:</B> " + Lang13.Initial( R, "description" ) + "<BR><BR>";
							T = Lang13.Initial( R, "metabolization_rate" ) * 20;
							dat += "<B>Metabolization Rate:</B> " + T + "u/minute<BR>";
							dat += "<B>Overdose Threshold:</B> " + ( Lang13.Bool( Lang13.Initial( R, "overdose_threshold" ) ) ? "" + Lang13.Initial( R, "overdose_threshold" ) + "u" : "none" ) + "<BR>";
							dat += "<B>Addiction Threshold:</B> " + ( Lang13.Bool( Lang13.Initial( R, "addiction_threshold" ) ) ? "" + Lang13.Initial( R, "addiction_threshold" ) + "u" : "none" ) + "<BR><BR>";
							dat += new Txt( "<BR><A href='?src=" ).Ref( this ).str( ";main=1'>Back</A>" ).ToString();
							popup = new Browser( Task13.User, "chem_master", this.name );
							popup.set_content( dat );
							popup.set_title_image( Task13.User.browse_rsc_icon( this.icon, this.icon_state ) );
							popup.open( true );
							return null;
						}
					}
				} else if ( Lang13.Bool( href_list["main"] ) ) {
					this.attack_hand( Task13.User );
					return null;
				} else if ( Lang13.Bool( href_list["add"] ) ) {
					
					if ( Lang13.Bool( href_list["amount"] ) ) {
						id = href_list["add"];
						amount = String13.ParseNumber( href_list["amount"] );

						if ( ( amount ??0) > 0 ) {
							((Reagents)this.beaker.reagents).trans_id_to( this, id, amount );
						}
					}
				} else if ( Lang13.Bool( href_list["addcustom"] ) ) {
					id2 = href_list["addcustom"];
					amt_temp = this.isgoodnumber( Interface13.Input( Task13.User, "Select the amount to transfer.", "Transfer how much?", this.useramount, null, InputType.Num | InputType.Null ) );

					if ( !Lang13.Bool( amt_temp ) ) {
						return null;
					}
					this.useramount = amt_temp;
					this.Topic( null, new ByTable().Set( "amount", "" + this.useramount ).Set( "add", "" + id2 ) );
				} else if ( Lang13.Bool( href_list["remove"] ) ) {
					
					if ( Lang13.Bool( href_list["amount"] ) ) {
						id3 = href_list["remove"];
						amount2 = String13.ParseNumber( href_list["amount"] );

						if ( ( amount2 ??0) > 0 ) {
							
							if ( this.mode ) {
								this.reagents.trans_id_to( this.beaker, id3, amount2 );
							} else {
								this.reagents.remove_reagent( id3, amount2 );
							}
						}
					}
				} else if ( Lang13.Bool( href_list["removecustom"] ) ) {
					id4 = href_list["removecustom"];
					amt_temp2 = this.isgoodnumber( Interface13.Input( Task13.User, "Select the amount to transfer.", "Transfer how much?", this.useramount, null, InputType.Num | InputType.Null ) );

					if ( !Lang13.Bool( amt_temp2 ) ) {
						return null;
					}
					this.useramount = amt_temp2;
					this.Topic( null, new ByTable().Set( "amount", "" + this.useramount ).Set( "remove", "" + id4 ) );
				} else if ( Lang13.Bool( href_list["eject"] ) ) {
					
					if ( Lang13.Bool( this.beaker ) ) {
						this.beaker.loc = this.loc;
						this.beaker = null;
						this.reagents.clear_reagents();
						this.icon_state = "mixer0";
					}
				} else if ( Lang13.Bool( href_list["createpill"] ) ) {
					
					if ( this.reagents.total_volume == 0 ) {
						return null;
					}

					if ( !this.condi ) {
						amount3 = 1;
						vol_each = Num13.MinInt( ((int)( this.reagents.total_volume ??0 )), 50 );

						if ( Lang13.Bool( String13.ParseNumber( href_list["many"] ) ) ) {
							amount3 = Num13.MinInt( Num13.MaxInt( Num13.Floor( Convert.ToDouble( Interface13.Input( Task13.User, "Max 10. Buffer content will be split evenly.", "How many pills?", amount3, null, InputType.Num | InputType.Null ) ) ), 0 ), 10 );

							if ( !Lang13.Bool( amount3 ) ) {
								return null;
							}
							vol_each = Num13.MinInt( ((int)( ( this.reagents.total_volume ??0) / ( amount3 ??0) )), 50 );
						}
						name2 = GlobalFuncs.stripped_input( Task13.User, "Name:", "Name your pill!", "" + this.reagents.get_master_reagent_name() + " (" + vol_each + "u)", 26 );

						if ( !Lang13.Bool( name2 ) || !Lang13.Bool( this.reagents.total_volume ) ) {
							return null;
						}
						i = null;
						i = 0;

						while (( i ??0) < ( amount3 ??0)) {
							
							if ( Lang13.Bool( this.bottle ) && this.bottle.contents.len < ( this.bottle.storage_slots ??0) ) {
								P2 = new Obj_Item_Weapon_ReagentContainers_Pill( this.bottle );
							} else {
								P2 = new Obj_Item_Weapon_ReagentContainers_Pill( this.loc );
							}
							P2.name = GlobalFuncs.trim( "" + name2 + " pill" );
							P2.pixel_x = Rand13.Int( -7, 7 );
							P2.pixel_y = Rand13.Int( -7, 7 );
							this.reagents.trans_to( P2, vol_each );
							i++;
						}
					} else {
						name3 = GlobalFuncs.stripped_input( Task13.User, "Name:", "Name your pack!", this.reagents.get_master_reagent_name(), 26 );

						if ( !Lang13.Bool( name3 ) || !Lang13.Bool( this.reagents.total_volume ) ) {
							return null;
						}
						P3 = new Obj_Item_Weapon_ReagentContainers_Food_Condiment_Pack( this.loc );
						P3.originalname = name3;
						P3.name = GlobalFuncs.trim( "" + name3 + " pack" );
						P3.desc = "A small condiment pack. The label says it contains " + name3 + ".";
						this.reagents.trans_to( P3, 10 );
					}
				} else if ( Lang13.Bool( href_list["createpatch"] ) ) {
					
					if ( this.reagents.total_volume == 0 ) {
						return null;
					}
					amount4 = 1;
					vol_each2 = Num13.MinInt( ((int)( this.reagents.total_volume ??0 )), 50 );

					if ( Lang13.Bool( String13.ParseNumber( href_list["many"] ) ) ) {
						amount4 = Num13.MinInt( Num13.MaxInt( Num13.Floor( Convert.ToDouble( Interface13.Input( Task13.User, "Max 10. Buffer content will be split evenly.", "How many patches?", amount4, null, InputType.Num | InputType.Null ) ) ), 0 ), 10 );

						if ( !Lang13.Bool( amount4 ) ) {
							return null;
						}
						vol_each2 = Num13.MinInt( ((int)( ( this.reagents.total_volume ??0) / ( amount4 ??0) )), 50 );
					}
					name4 = GlobalFuncs.stripped_input( Task13.User, "Name:", "Name your patch!", "" + this.reagents.get_master_reagent_name() + " (" + vol_each2 + "u)", 26 );

					if ( !Lang13.Bool( name4 ) || !Lang13.Bool( this.reagents.total_volume ) ) {
						return null;
					}
					P4 = null;
					i2 = null;
					i2 = 0;

					while (( i2 ??0) < ( amount4 ??0)) {
						P4 = new Obj_Item_Weapon_ReagentContainers_Pill_Patch( this.loc );
						P4.name = GlobalFuncs.trim( "" + name4 + " patch" );
						P4.pixel_x = Rand13.Int( -7, 7 );
						P4.pixel_y = Rand13.Int( -7, 7 );
						this.reagents.trans_to( P4, vol_each2 );
						i2++;
					}
				}
			}
			this.updateUsrDialog();
			return null;
		}

		// Function from file: chem_master.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			
			if ( this.default_unfasten_wrench( user, A ) ) {
				return null;
			}

			if ( A is Obj_Item_Weapon_ReagentContainers_Glass ) {
				
				if ( user is Mob_Living_Silicon_Robot ) {
					return null;
				}

				if ( Lang13.Bool( this.beaker ) ) {
					user.WriteMsg( "<span class='warning'>A beaker is already loaded into the machine!</span>" );
					return null;
				}

				if ( !Lang13.Bool( user.drop_item() ) ) {
					return null;
				}
				this.beaker = A;
				this.beaker.loc = this;
				user.WriteMsg( "<span class='notice'>You add the beaker to the machine.</span>" );
				this.updateUsrDialog();
				this.icon_state = "mixer1";
			} else if ( !this.condi && A is Obj_Item_Weapon_Storage_PillBottle ) {
				
				if ( Lang13.Bool( this.bottle ) ) {
					user.WriteMsg( "<span class='warning'>A pill bottle is already loaded into the machine!</span>" );
					return null;
				}

				if ( !Lang13.Bool( user.drop_item() ) ) {
					return null;
				}
				this.bottle = A;
				this.bottle.loc = this;
				user.WriteMsg( "<span class='notice'>You add the pill bottle into the dispenser slot.</span>" );
				this.updateUsrDialog();
			}
			return null;
		}

		// Function from file: chem_master.dm
		public override void power_change(  ) {
			
			if ( Lang13.Bool( this.powered() ) ) {
				this.stat &= 65533;
			} else {
				Task13.Schedule( Rand13.Int( 0, 15 ), (Task13.Closure)(() => {
					this.stat |= 2;
					return;
				}));
			}
			return;
		}

		// Function from file: chem_master.dm
		public override bool blob_act( dynamic severity = null ) {
			
			if ( Rand13.PercentChance( 50 ) ) {
				GlobalFuncs.qdel( this );
			}
			return false;
		}

		// Function from file: chem_master.dm
		public override bool ex_act( double? severity = null, dynamic target = null ) {
			
			if ( ( severity ??0) < 3 ) {
				base.ex_act( severity, (object)(target) );
			}
			return false;
		}

	}

}