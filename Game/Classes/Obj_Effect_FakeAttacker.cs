// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_FakeAttacker : Obj_Effect {

		public Ent_Static my_target = null;
		public string weapon_name = null;
		public dynamic weap = null;
		public dynamic stand_icon = null;
		public Image currentimage = null;
		public dynamic v_base = null;
		public dynamic skin_tone = null;
		public dynamic clone = null;
		public Image left = null;
		public Image right = null;
		public Image up = null;
		public bool collapse = false;
		public Image down = null;
		public double health = 100;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.anchored = 1;
		}

		// Function from file: Hallucination.dm
		public Obj_Effect_FakeAttacker ( dynamic loc = null, Ent_Static T = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.my_target = T;
			Task13.Schedule( 300, (Task13.Closure)(() => {
				GlobalFuncs.qdel( this );
				return;
			}));
			Map13.StepAway( this, this.my_target, 2 );
			Task13.Schedule( 0, (Task13.Closure)(() => {
				this.attack_loop();
				return;
			}));
			return;
		}

		// Function from file: Hallucination.dm
		public void fake_blood( Ent_Static target = null ) {
			Obj_Effect_Overlay O = null;
			Image I = null;

			O = new Obj_Effect_Overlay( target.loc );
			O.name = "blood";
			I = new Image( "icons/effects/blood.dmi", O, "floor" + Rand13.Int( 1, 7 ), O.dir, 1 );
			((dynamic)target).WriteMsg( I );
			Task13.Schedule( 300, (Task13.Closure)(() => {
				GlobalFuncs.qdel( O );
				return;
			}));
			return;
		}

		// Function from file: Hallucination.dm
		[VerbInfo( name: "collapse" )]
		public void f_collapse(  ) {
			this.collapse = true;
			this.updateimage();
			return;
		}

		// Function from file: Hallucination.dm
		public void attack_loop(  ) {
			
			while (true) {
				Task13.Sleep( Rand13.Int( 5, 10 ) );

				if ( this.health < 0 ) {
					this.f_collapse();
					continue;
				}

				if ( Map13.GetDistance( this, this.my_target ) > 1 ) {
					this.dir = Map13.GetDistance( this, this.my_target );
					Map13.StepTowardsSimple( this, this.my_target );
					this.updateimage();
				} else if ( Rand13.PercentChance( 15 ) ) {
					this.do_attack_animation( this.my_target );

					if ( Lang13.Bool( this.weapon_name ) ) {
						((dynamic)this.my_target).WriteMsg( new Sound( Rand13.Pick(new object [] { "sound/weapons/genhit1.ogg", "sound/weapons/genhit2.ogg", "sound/weapons/genhit3.ogg" }) ) );
						((dynamic)this.my_target).show_message( "<span class='danger'>" + this.name + " has attacked " + this.my_target + " with " + this.weapon_name + "!</span>", 1 );
						((dynamic)this.my_target).staminaloss += 30;

						if ( Rand13.PercentChance( 20 ) ) {
							((dynamic)this.my_target).eye_blurry += 3;
						}

						if ( Rand13.PercentChance( 33 ) ) {
							
							if ( !Lang13.Bool( Lang13.FindIn( typeof(Obj_Effect_Overlay), this.my_target.loc ) ) ) {
								this.fake_blood( this.my_target );
							}
						}
					} else {
						((dynamic)this.my_target).WriteMsg( new Sound( Rand13.Pick(new object [] { "sound/weapons/punch1.ogg", "sound/weapons/punch2.ogg", "sound/weapons/punch3.ogg", "sound/weapons/punch4.ogg" }) ) );
						((dynamic)this.my_target).show_message( "<span class='userdanger'>" + this.name + " has punched " + this.my_target + "!</span>", 1 );
						((dynamic)this.my_target).staminaloss += 30;

						if ( Rand13.PercentChance( 33 ) ) {
							
							if ( !Lang13.Bool( Lang13.FindIn( typeof(Obj_Effect_Overlay), this.my_target.loc ) ) ) {
								this.fake_blood( this.my_target );
							}
						}
					}
				}

				if ( Rand13.PercentChance( 15 ) ) {
					Map13.StepAway( this, this.my_target, 2 );
				}
			}
			return;
		}

		// Function from file: Hallucination.dm
		public void updateimage(  ) {
			
			if ( this.dir == GlobalVars.NORTH ) {
				Lang13.Delete( this.currentimage );
				this.currentimage = null;
				this.currentimage = new Image( this.up, this );
			} else if ( this.dir == GlobalVars.SOUTH ) {
				Lang13.Delete( this.currentimage );
				this.currentimage = null;
				this.currentimage = new Image( this.down, this );
			} else if ( this.dir == GlobalVars.EAST ) {
				Lang13.Delete( this.currentimage );
				this.currentimage = null;
				this.currentimage = new Image( this.right, this );
			} else if ( this.dir == GlobalVars.WEST ) {
				Lang13.Delete( this.currentimage );
				this.currentimage = null;
				this.currentimage = new Image( this.left, this );
			}
			((dynamic)this.my_target).WriteMsg( this.currentimage );
			return;
		}

		// Function from file: Hallucination.dm
		public override dynamic Crossed( Ent_Dynamic O = null, dynamic X = null ) {
			dynamic O2 = null;

			
			if ( O == this.my_target ) {
				Map13.StepAway( this, this.my_target, 2 );

				if ( Rand13.PercentChance( 30 ) ) {
					
					foreach (dynamic _a in Lang13.Enumerate( Map13.FetchViewersExcludeThis( this.my_target, Game13.view ) )) {
						O2 = _a;
						
						O2.WriteMsg( "<span class='danger'>" + this.my_target + " stumbles around.</span>" );
					}
				}
			}
			return null;
		}

		// Function from file: Hallucination.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			Map13.StepAway( this, this.my_target, 2 );
			((Mob)user).changeNext_move( 8 );
			((Ent_Dynamic)user).do_attack_animation( this );
			((dynamic)this.my_target).WriteMsg( new Sound( Rand13.Pick(new object [] { "sound/weapons/genhit1.ogg", "sound/weapons/genhit2.ogg", "sound/weapons/genhit3.ogg" }) ) );
			this.my_target.visible_message( "<span class='danger'>" + this.my_target + " flails around wildly.</span>", "<span class='danger'>" + this.my_target + " has attacked " + this + "!</span>" );
			this.health -= Convert.ToDouble( A.force );
			return null;
		}

	}

}