// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_ChemHeater : Obj_Machinery {

		public dynamic beaker = null;
		public double? desired_temp = 300;
		public double heater_coefficient = 0.1;
		public bool? on = false;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.anchored = 1;
			this.idle_power_usage = 40;
			this.icon = "icons/obj/chemical.dmi";
			this.icon_state = "mixer0b";
		}

		// Function from file: chem_heater.dm
		public Obj_Machinery_ChemHeater ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.component_parts = new ByTable();
			this.component_parts.Add( new Obj_Item_Weapon_Circuitboard_ChemHeater( null ) );
			this.component_parts.Add( new Obj_Item_Weapon_StockParts_MicroLaser( null ) );
			this.component_parts.Add( new Obj_Item_Weapon_StockParts_ConsoleScreen( null ) );
			this.RefreshParts();
			return;
		}

		// Function from file: chem_heater.dm
		public void eject_beaker(  ) {
			
			if ( Lang13.Bool( this.beaker ) ) {
				this.beaker.loc = GlobalFuncs.get_turf( this );
				((Reagents)this.beaker.reagents).handle_reactions();
				this.beaker = null;
				this.icon_state = "mixer0b";
			}
			return;
		}

		// Function from file: chem_heater.dm
		public override ByTable get_ui_data( dynamic user = null ) {
			ByTable data = null;
			ByTable beakerContents = null;
			Reagent R = null;

			data = new ByTable();
			data["targetTemp"] = this.desired_temp;
			data["isActive"] = this.on;
			data["isBeakerLoaded"] = ( Lang13.Bool( this.beaker ) ? true : false );
			data["currentTemp"] = ( Lang13.Bool( this.beaker ) ? this.beaker.reagents.chem_temp : null );
			data["beakerCurrentVolume"] = ( Lang13.Bool( this.beaker ) ? this.beaker.reagents.total_volume : null );
			data["beakerMaxVolume"] = ( Lang13.Bool( this.beaker ) ? this.beaker.volume : null );
			beakerContents = new ByTable( 0 );

			if ( Lang13.Bool( this.beaker ) ) {
				
				foreach (dynamic _a in Lang13.Enumerate( this.beaker.reagents.reagent_list, typeof(Reagent) )) {
					R = _a;
					
					beakerContents.Add( new ByTable(new object [] { new ByTable().Set( "name", R.name ).Set( "volume", R.volume ) }) );
				}
			}
			data["beakerContents"] = beakerContents;
			return data;
		}

		// Function from file: chem_heater.dm
		public override int ui_interact( dynamic user = null, string ui_key = null, Tgui ui = null, bool? force_open = null, Tgui master_ui = null, UiState state = null ) {
			ui_key = ui_key ?? "main";
			force_open = force_open ?? false;
			state = state ?? GlobalVars.default_state;

			ui = GlobalVars.SStgui.try_update_ui( user, this, ui_key, ui, force_open );

			if ( !( ui != null ) ) {
				ui = new Tgui( user, this, ui_key, "chem_heater", this.name, 275, 400, master_ui, state );
				ui.open();
			}
			return 0;
		}

		// Function from file: chem_heater.dm
		public override dynamic interact( dynamic user = null, bool? flag1 = null ) {
			
			if ( ( this.stat & 1 ) != 0 ) {
				return null;
			}
			this.ui_interact( user );
			return null;
		}

		// Function from file: chem_heater.dm
		public override bool ui_act( dynamic action = null, ByTable _params = null ) {
			
			if ( base.ui_act( (object)(action), _params ) ) {
				return false;
			}

			dynamic _a = action; // Was a switch-case, sorry for the mess.
			if ( _a=="power" ) {
				this.on = !( this.on == true );
			} else if ( _a=="temperature" ) {
				this.desired_temp = Num13.MaxInt( 0, Num13.MinInt( Convert.ToInt32( Interface13.Input( "Please input the target temperature", this.name, null, null, null, InputType.Num ) ), 1000 ) );
			} else if ( _a=="eject" ) {
				this.on = GlobalVars.FALSE;
				this.eject_beaker();
			}
			return true;
		}

		// Function from file: chem_heater.dm
		public override dynamic attack_hand( dynamic a = null, bool? b = null, bool? c = null ) {
			
			if ( !Lang13.Bool( a ) ) {
				return null;
			}
			this.interact( a );
			return null;
		}

		// Function from file: chem_heater.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			
			if ( user is Mob_Living_Silicon_Robot ) {
				return null;
			}

			if ( A is Obj_Item_Weapon_ReagentContainers_Glass ) {
				
				if ( Lang13.Bool( this.beaker ) ) {
					user.WriteMsg( "<span class='warning'>A beaker is already loaded into the machine!</span>" );
					return null;
				}

				if ( Lang13.Bool( user.drop_item() ) ) {
					this.beaker = A;
					A.loc = this;
					user.WriteMsg( "<span class='notice'>You add the beaker to the machine.</span>" );
					this.icon_state = "mixer1b";
				}
			}

			if ( this.default_deconstruction_screwdriver( user, "mixer0b", "mixer0b", A ) ) {
				return null;
			}

			if ( this.exchange_parts( user, A ) ) {
				return null;
			}

			if ( this.panel_open == true ) {
				
				if ( A is Obj_Item_Weapon_Crowbar ) {
					this.eject_beaker();
					this.default_deconstruction_crowbar( A );
					return 1;
				}
			}
			return null;
		}

		// Function from file: chem_heater.dm
		public override void power_change(  ) {
			
			if ( Lang13.Bool( this.powered() ) ) {
				this.stat &= 65533;
			} else {
				Task13.Schedule( Rand13.Int( 0, 15 ), (Task13.Closure)(() => {
					this.stat |= 2;
					return;
				}));
			}
			return;
		}

		// Function from file: chem_heater.dm
		public override int? process( dynamic seconds = null ) {
			base.process( (object)(seconds) );

			if ( ( this.stat & 2 ) != 0 ) {
				return null;
			}

			if ( this.on == true ) {
				
				if ( Lang13.Bool( this.beaker ) ) {
					
					if ( Convert.ToDouble( this.beaker.reagents.chem_temp ) > ( this.desired_temp ??0) ) {
						this.beaker.reagents.chem_temp += Num13.MinInt( -1, ((int)( ( ( this.desired_temp ??0) - Convert.ToDouble( this.beaker.reagents.chem_temp ) ) * this.heater_coefficient )) );
					}

					if ( Convert.ToDouble( this.beaker.reagents.chem_temp ) < ( this.desired_temp ??0) ) {
						this.beaker.reagents.chem_temp += Num13.MaxInt( 1, ((int)( ( ( this.desired_temp ??0) - Convert.ToDouble( this.beaker.reagents.chem_temp ) ) * this.heater_coefficient )) );
					}
					this.beaker.reagents.chem_temp = Num13.Floor( Convert.ToDouble( this.beaker.reagents.chem_temp ) );
					((Reagents)this.beaker.reagents).handle_reactions();
				}
			}
			return null;
		}

		// Function from file: chem_heater.dm
		public override void RefreshParts(  ) {
			Obj_Item_Weapon_StockParts_MicroLaser M = null;

			this.heater_coefficient = 0.1;

			foreach (dynamic _a in Lang13.Enumerate( this.component_parts, typeof(Obj_Item_Weapon_StockParts_MicroLaser) )) {
				M = _a;
				
				this.heater_coefficient *= Convert.ToDouble( M.rating );
			}
			return;
		}

	}

}