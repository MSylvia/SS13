// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_Portal : Obj_Effect {

		public dynamic target = null;
		public Obj_Item_Weapon creator = null;
		public double? precision = 1;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.unacidable = true;
			this.anchored = 1;
			this.icon = "icons/obj/stationobjs.dmi";
			this.icon_state = "portal";
		}

		// Function from file: portals.dm
		public Obj_Effect_Portal ( dynamic loc = null, dynamic target = null, Obj_Item_Weapon creator = null, int? lifespan = null ) : base( (object)(loc) ) {
			lifespan = lifespan ?? 300;

			dynamic M = null;

			GlobalVars.portals.Add( this );
			this.loc = loc;
			this.target = target;
			this.creator = creator;

			foreach (dynamic _a in Lang13.Enumerate( this.loc )) {
				M = _a;
				
				this.teleport( M );
			}

			if ( ( lifespan ??0) > 0 ) {
				Task13.Schedule( lifespan ??0, (Task13.Closure)(() => {
					GlobalFuncs.qdel( this );
					return;
				}));
			}
			return;
		}

		// Function from file: portals.dm
		public virtual void teleport( dynamic M = null ) {
			
			if ( M is Obj_Effect ) {
				return;
			}

			if ( Lang13.Bool( M.anchored ) && M is Obj_Mecha ) {
				return;
			}

			if ( !Lang13.Bool( this.target ) ) {
				GlobalFuncs.qdel( this );
				return;
			}

			if ( M is Ent_Dynamic ) {
				GlobalFuncs.do_teleport( M, this.target, this.precision );
			}
			return;
		}

		// Function from file: portals.dm
		public override dynamic Destroy(  ) {
			Obj_Item_Weapon O = null;
			Obj_Item_Weapon P = null;

			GlobalVars.portals.Remove( this );

			if ( this.creator is Obj_Item_Weapon_HandTele ) {
				O = this.creator;
				((dynamic)O).active_portals--;
			} else if ( this.creator is Obj_Item_Weapon_Gun_Energy_WormholeProjector ) {
				P = this.creator;
				((dynamic)P).portal_destroyed( this );
			}
			this.creator = null;
			return base.Destroy();
		}

		// Function from file: portals.dm
		public override bool Bumped( dynamic AM = null ) {
			this.teleport( AM );
			return false;
		}

		// Function from file: observer.dm
		public override void attack_ghost( Mob user = null ) {
			
			if ( Lang13.Bool( this.target ) ) {
				user.loc = GlobalFuncs.get_turf( this.target );
			}
			return;
		}

	}

}