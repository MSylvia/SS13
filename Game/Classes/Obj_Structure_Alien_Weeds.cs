// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Structure_Alien_Weeds : Obj_Structure_Alien {

		public double health = 15;
		public Obj_Structure_Alien_Weeds_Node linked_node = null;
		public dynamic weedImageCache = null;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.anchored = 1;
			this.icon_state = "weeds";
		}

		// Function from file: aliens.dm
		public Obj_Structure_Alien_Weeds ( dynamic pos = null, Obj_Structure_Alien_Weeds_Node node = null ) : base( (object)(pos) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.linked_node = node;

			if ( this.loc is Tile_Space ) {
				GlobalFuncs.qdel( this );
				return;
			}

			if ( this.icon_state == "weeds" ) {
				this.icon_state = Rand13.Pick(new object [] { "weeds", "weeds1", "weeds2" });
			}
			this.fullUpdateWeedOverlays();
			Task13.Schedule( Rand13.Int( 150, 200 ), (Task13.Closure)(() => {
				
				if ( this != null ) {
					this.Life();
				}
				return;
			}));
			return;
		}

		// Function from file: aliens.dm
		public override dynamic temperature_expose( GasMixture air = null, dynamic exposed_temperature = null, int? exposed_volume = null ) {
			
			if ( Convert.ToDouble( exposed_temperature ) > 300 ) {
				this.health -= 5;
				this.healthcheck();
			}
			return null;
		}

		// Function from file: aliens.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			dynamic damage = null;
			dynamic WT = null;

			((Mob)user).changeNext_move( 8 );

			if ( Lang13.Bool( A.attack_verb.len ) ) {
				this.visible_message( "<span class='danger'>" + user + " has " + Rand13.PickFromTable( A.attack_verb ) + " " + this + " with " + A + "!</span>" );
			} else {
				this.visible_message( "<span class='danger'>" + user + " has attacked " + this + " with " + A + "!</span>" );
			}
			damage = A.force / 4;

			if ( A is Obj_Item_Weapon_Weldingtool ) {
				WT = A;

				if ( ((Obj_Item_Weapon_Weldingtool)WT).remove_fuel( 0, user ) ) {
					damage = 15;
					GlobalFuncs.playsound( this.loc, "sound/items/welder.ogg", 100, 1 );
				}
			}
			this.health -= Convert.ToDouble( damage );
			this.healthcheck();
			return null;
		}

		// Function from file: aliens.dm
		public override bool ex_act( double? severity = null, dynamic target = null ) {
			GlobalFuncs.qdel( this );
			return false;
		}

		// Function from file: aliens.dm
		public void fullUpdateWeedOverlays(  ) {
			Obj_Structure_Alien_Weeds W = null;

			
			foreach (dynamic _a in Lang13.Enumerate( Map13.FetchInRange( this, 1 ), typeof(Obj_Structure_Alien_Weeds) )) {
				W = _a;
				
				W.updateWeedOverlays();
			}
			return;
		}

		// Function from file: aliens.dm
		public void updateWeedOverlays(  ) {
			Tile N = null;
			Tile S = null;
			Tile E = null;
			Tile W = null;

			this.overlays.Cut();

			if ( !( GlobalVars.weedImageCache != null ) || !( GlobalVars.weedImageCache.len != 0 ) ) {
				GlobalVars.weedImageCache = new ByTable();
				GlobalVars.weedImageCache.len = 4;
				GlobalVars.weedImageCache["north"] = new Image( "icons/mob/alien.dmi", "weeds_side_n", null, 2.01, null, null, -32 );
				GlobalVars.weedImageCache["south"] = new Image( "icons/mob/alien.dmi", "weeds_side_s", null, 2.01, null, null, 32 );
				GlobalVars.weedImageCache["east"] = new Image( "icons/mob/alien.dmi", "weeds_side_e", null, 2.01, null, -32 );
				GlobalVars.weedImageCache["west"] = new Image( "icons/mob/alien.dmi", "weeds_side_w", null, 2.01, null, 32 );
			}
			N = Map13.GetStep( this, ((int)( GlobalVars.NORTH )) );
			S = Map13.GetStep( this, ((int)( GlobalVars.SOUTH )) );
			E = Map13.GetStep( this, ((int)( GlobalVars.EAST )) );
			W = Map13.GetStep( this, ((int)( GlobalVars.WEST )) );

			if ( !Lang13.Bool( Lang13.FindIn( typeof(Obj_Structure_Alien), N.contents ) ) ) {
				
				if ( N is Tile_Simulated_Floor ) {
					this.overlays.Add( GlobalVars.weedImageCache["south"] );
				}
			}

			if ( !Lang13.Bool( Lang13.FindIn( typeof(Obj_Structure_Alien), S.contents ) ) ) {
				
				if ( S is Tile_Simulated_Floor ) {
					this.overlays.Add( GlobalVars.weedImageCache["north"] );
				}
			}

			if ( !Lang13.Bool( Lang13.FindIn( typeof(Obj_Structure_Alien), E.contents ) ) ) {
				
				if ( E is Tile_Simulated_Floor ) {
					this.overlays.Add( GlobalVars.weedImageCache["west"] );
				}
			}

			if ( !Lang13.Bool( Lang13.FindIn( typeof(Obj_Structure_Alien), W.contents ) ) ) {
				
				if ( W is Tile_Simulated_Floor ) {
					this.overlays.Add( GlobalVars.weedImageCache["east"] );
				}
			}
			return;
		}

		// Function from file: aliens.dm
		public void healthcheck(  ) {
			
			if ( this.health <= 0 ) {
				GlobalFuncs.qdel( this );
			}
			return;
		}

		// Function from file: aliens.dm
		public void Life(  ) {
			dynamic U = null;
			dynamic T = null;

			U = GlobalFuncs.get_turf( this );

			if ( U is Tile_Space ) {
				GlobalFuncs.qdel( this );
				return;
			}

			if ( !( this.linked_node != null ) || Map13.GetDistance( this.linked_node, this ) > this.linked_node.node_range ) {
				return;
			}

			foreach (dynamic _a in Lang13.Enumerate( ((Tile)U).GetAtmosAdjacentTurfs() )) {
				T = _a;
				

				if ( Lang13.Bool( Lang13.FindIn( typeof(Obj_Structure_Alien_Weeds), Lang13.Bool( T ) || T is Tile_Space ) ) ) {
					continue;
				}
				new Obj_Structure_Alien_Weeds( T, this.linked_node );
			}
			return;
		}

		// Function from file: aliens.dm
		public override dynamic Destroy(  ) {
			Ent_Static T = null;
			Obj_Structure_Alien_Weeds W = null;

			T = this.loc;
			this.loc = null;

			foreach (dynamic _a in Lang13.Enumerate( Map13.FetchInRange( T, 1 ), typeof(Obj_Structure_Alien_Weeds) )) {
				W = _a;
				
				W.updateWeedOverlays();
			}
			this.linked_node = null;
			return base.Destroy();
		}

	}

}