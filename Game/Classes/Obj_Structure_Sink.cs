// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Structure_Sink : Obj_Structure {

		public bool busy = false;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.anchored = 1;
			this.icon = "icons/obj/watercloset.dmi";
			this.icon_state = "sink";
		}

		public Obj_Structure_Sink ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: watercloset.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			dynamic RG = null;
			dynamic B = null;
			int stunforce = 0;
			dynamic I = null;

			
			if ( this.busy ) {
				user.WriteMsg( "<span class='warning'>Someone's already washing here!</span>" );
				return null;
			}

			if ( A is Obj_Item_Weapon_ReagentContainers ) {
				RG = A;

				if ( Lang13.Bool( RG.flags & 4096 ) ) {
					RG.reagents.add_reagent( "water", Num13.MinInt( Convert.ToInt32( RG.volume - RG.reagents.total_volume ), Convert.ToInt32( RG.amount_per_transfer_from_this ) ) );
					user.WriteMsg( "<span class='notice'>You fill " + RG + " from " + this + ".</span>" );
					return null;
				}
			}

			if ( A is Obj_Item_Weapon_Melee_Baton ) {
				B = A;

				if ( Lang13.Bool( B.bcell ) ) {
					
					if ( Convert.ToDouble( B.bcell.charge ) > 0 && Lang13.Bool( B.status ) == true ) {
						Icon13.Flick( "baton_active", this );
						stunforce = B.stunforce;
						((Mob)user).Stun( stunforce );
						((Mob)user).Weaken( stunforce );
						user.stuttering = stunforce;
						B.deductcharge( B.hitcost );
						((Ent_Static)user).visible_message( "<span class='warning'>" + user + " shocks themself while attempting to wash the active " + B.name + "!</span>", "<span class='userdanger'>You unwisely attempt to wash " + B + " while it's still on.</span>" );
						GlobalFuncs.playsound( this, "sparks", 50, 1 );
						return null;
					}
				}
			}

			if ( A is Obj_Item_Weapon_Mop ) {
				A.reagents.add_reagent( "water", 5 );
				user.WriteMsg( "<span class='notice'>You wet " + A + " in " + this + ".</span>" );
				GlobalFuncs.playsound( this.loc, "sound/effects/slosh.ogg", 25, 1 );
			}
			I = A;

			if ( !Lang13.Bool( I ) || !( I is Obj_Item ) ) {
				return null;
			}

			if ( Lang13.Bool( I.flags & 128 ) ) {
				return null;
			}
			user.WriteMsg( "<span class='notice'>You start washing " + I + "...</span>" );
			this.busy = true;

			if ( !GlobalFuncs.do_after( user, 40, null, this ) ) {
				this.busy = false;
				return null;
			}
			this.busy = false;
			((Ent_Static)A).clean_blood();
			((Ent_Static)user).visible_message( "<span class='notice'>" + user + " washes " + I + " using " + this + ".</span>", "<span class='notice'>You wash " + I + " using " + this + ".</span>" );
			return null;
		}

		// Function from file: watercloset.dm
		public override dynamic attack_hand( dynamic a = null, bool? b = null, bool? c = null ) {
			dynamic selected_area = null;
			bool washing_face = false;
			dynamic H = null;

			
			if ( !Lang13.Bool( a ) || !( a is Mob_Living ) ) {
				return null;
			}

			if ( !( a is Mob_Living_Carbon ) ) {
				return null;
			}

			if ( !this.Adjacent( a ) ) {
				return null;
			}

			if ( this.busy ) {
				a.WriteMsg( "<span class='notice'>Someone's already washing here.</span>" );
				return null;
			}
			selected_area = GlobalFuncs.parse_zone( a.zone_sel.selecting );
			washing_face = false;

			if ( new ByTable(new object [] { "head", "mouth", "eyes" }).Contains( selected_area ) ) {
				washing_face = true;
			}
			((Ent_Static)a).visible_message( "<span class='notice'>" + a + " start washing their " + ( washing_face ? "face" : "hands" ) + "...</span>", "<span class='notice'>You start washing your " + ( washing_face ? "face" : "hands" ) + "...</span>" );
			this.busy = true;

			if ( !GlobalFuncs.do_after( a, 40, null, this ) ) {
				this.busy = false;
				return null;
			}
			this.busy = false;
			((Ent_Static)a).visible_message( "<span class='notice'>" + a + " washes their " + ( washing_face ? "face" : "hands" ) + " using " + this + ".</span>", "<span class='notice'>You wash your " + ( washing_face ? "face" : "hands" ) + " using " + this + ".</span>" );

			if ( washing_face ) {
				
				if ( a is Mob_Living_Carbon_Human ) {
					H = a;
					H.lip_style = null;
					H.lip_color = Lang13.Initial( H, "lip_color" );
					((Mob)H).regenerate_icons();
				}
				a.drowsyness -= Rand13.Int( 2, 3 );
				a.drowsyness = Num13.MaxInt( 0, Num13.MinInt( a.drowsyness, Int32.MaxValue ) );
			} else {
				((Ent_Static)a).clean_blood();
			}
			return null;
		}

	}

}