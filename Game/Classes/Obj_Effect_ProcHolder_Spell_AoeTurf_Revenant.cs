// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_ProcHolder_Spell_AoeTurf_Revenant : Obj_Effect_ProcHolder_Spell_AoeTurf {

		public int reveal = 80;
		public int stun = 20;
		public bool locked = true;
		public int unlock_amount = 100;
		public int cast_amount = 50;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.clothes_req = 0;
			this.action_background_icon_state = "bg_revenant";
			this.panel = "Revenant Abilities (Locked)";
		}

		// Function from file: revenant_abilities.dm
		public Obj_Effect_ProcHolder_Spell_AoeTurf_Revenant ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;

			if ( this.locked ) {
				this.name = "" + Lang13.Initial( this, "name" ) + " (" + this.unlock_amount + "E)";
			} else {
				this.name = "" + Lang13.Initial( this, "name" ) + " (" + this.cast_amount + "E)";
			}
			return;
		}

		// Function from file: revenant_abilities.dm
		public bool attempt_cast( dynamic user = null ) {
			user = user ?? Task13.User;

			
			if ( !( user is Mob_Living_SimpleAnimal_Revenant ) ) {
				this.name = "" + Lang13.Initial( this, "name" );

				if ( this.locked ) {
					this.panel = "Revenant Abilities";
					this.locked = false;
				}
				return true;
			}

			if ( this.locked ) {
				
				if ( !((Mob_Living_SimpleAnimal_Revenant)user).castcheck( -this.unlock_amount ) ) {
					this.charge_counter = this.charge_max;
					return false;
				}
				this.name = "" + Lang13.Initial( this, "name" ) + " (" + this.cast_amount + "E)";
				user.WriteMsg( "<span class='revennotice'>You have unlocked " + Lang13.Initial( this, "name" ) + "!</span>" );
				this.panel = "Revenant Abilities";
				this.locked = false;
				this.charge_counter = this.charge_max;
				return false;
			}

			if ( !((Mob_Living_SimpleAnimal_Revenant)user).castcheck( -this.cast_amount ) ) {
				this.charge_counter = this.charge_max;
				return false;
			}
			this.name = "" + Lang13.Initial( this, "name" ) + " (" + this.cast_amount + "E)";
			((Mob_Living_SimpleAnimal_Revenant)user).reveal( this.reveal );
			((Mob_Living_SimpleAnimal_Revenant)user).stun( this.stun );
			((Mob)user).update_action_buttons();
			return true;
		}

		// Function from file: revenant_abilities.dm
		public override bool can_cast( dynamic user = null ) {
			user = user ?? Task13.User;

			
			if ( !( user is Mob_Living_SimpleAnimal_Revenant ) ) {
				
				if ( this.charge_counter < this.charge_max ) {
					return false;
				}
				return true;
			}

			if ( user.inhibited ) {
				return false;
			}

			if ( this.charge_counter < this.charge_max ) {
				return false;
			}

			if ( this.locked ) {
				
				if ( user.essence <= this.unlock_amount ) {
					return false;
				}
			}

			if ( user.essence <= this.cast_amount ) {
				return false;
			}
			return true;
		}

	}

}