// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_Resonance : Obj_Effect {

		public int resonance_damage = 20;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.icon = "icons/effects/effects.dmi";
			this.icon_state = "shield1";
			this.layer = 4.1;
		}

		// Function from file: equipment_locker.dm
		public Obj_Effect_Resonance ( dynamic loc = null, dynamic creator = null, int timetoburst = 0 ) : base( (object)(loc) ) {
			dynamic proj_turf = null;
			dynamic M = null;
			GasMixture environment = null;
			double pressure = 0;
			Mob_Living L = null;
			Mob_Living L2 = null;

			proj_turf = GlobalFuncs.get_turf( this );

			if ( !( proj_turf is Tile ) ) {
				return;
			}

			if ( proj_turf is Tile_Simulated_Mineral ) {
				M = proj_turf;
				Task13.Schedule( timetoburst, (Task13.Closure)(() => {
					GlobalFuncs.playsound( this, "sound/weapons/resonator_blast.ogg", 50, 1 );
					((Tile_Simulated_Mineral)M).gets_drilled( creator );
					GlobalFuncs.qdel( this );
					return;
				}));
			} else {
				environment = ((Ent_Static)proj_turf).return_air();
				pressure = environment.return_pressure();

				if ( pressure < 50 ) {
					this.name = "strong resonance field";
					this.resonance_damage = 50;
				}
				Task13.Schedule( timetoburst, (Task13.Closure)(() => {
					GlobalFuncs.playsound( this, "sound/weapons/resonator_blast.ogg", 50, 1 );

					if ( Lang13.Bool( creator ) ) {
						
						foreach (dynamic _a in Lang13.Enumerate( this.loc, typeof(Mob_Living) )) {
							L = _a;
							
							GlobalFuncs.add_logs( creator, L, "used a resonator field on", "resonator" );
							L.WriteMsg( "<span class='danger'>The " + this.name + " ruptured with you in it!</span>" );
							L.adjustBruteLoss( this.resonance_damage );
						}
					} else {
						
						foreach (dynamic _b in Lang13.Enumerate( this.loc, typeof(Mob_Living) )) {
							L2 = _b;
							
							L2.WriteMsg( "<span class='danger'>The " + this.name + " ruptured with you in it!</span>" );
							L2.adjustBruteLoss( this.resonance_damage );
						}
					}
					GlobalFuncs.qdel( this );
					return;
				}));
			}
			return;
		}

	}

}