// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Mecha_Working_Ripley : Obj_Mecha_Working {

		public ByTable cargo = new ByTable();
		public int cargo_capacity = 15;
		public int? hides = 0;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.step_in = 5;
			this.max_temperature = 20000;
			this.health = 200;
			this.lights_power = 7;
			this.deflect_chance = 15;
			this.damage_absorption = new ByTable().Set( "brute", 0.6 ).Set( "fire", 1 ).Set( "bullet", 0.8 ).Set( "laser", 081 ).Set( "energy", 1 ).Set( "bomb", 0.6 );
			this.max_equip = 6;
			this.wreckage = typeof(Obj_Structure_MechaWreckage_Ripley);
			this.icon_state = "ripley";
		}

		public Obj_Mecha_Working_Ripley ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: ripley.dm
		public void update_pressure(  ) {
			dynamic T = null;
			GasMixture environment = null;
			double pressure = 0;
			Obj_Item_MechaParts_MechaEquipment_Drill drill = null;
			Obj_Item_MechaParts_MechaEquipment_Drill drill2 = null;

			T = GlobalFuncs.get_turf( this.loc );
			environment = ((Ent_Static)T).return_air();
			pressure = environment.return_pressure();

			if ( pressure < 20 ) {
				this.step_in = 3;

				foreach (dynamic _a in Lang13.Enumerate( this.equipment, typeof(Obj_Item_MechaParts_MechaEquipment_Drill) )) {
					drill = _a;
					
					drill.equip_cooldown = Lang13.Initial( drill, "equip_cooldown" ) / 2;
				}
			} else {
				this.step_in = 5;

				foreach (dynamic _b in Lang13.Enumerate( this.equipment, typeof(Obj_Item_MechaParts_MechaEquipment_Drill) )) {
					drill2 = _b;
					
					drill2.equip_cooldown = Lang13.Initial( drill2, "equip_cooldown" );
				}
			}
			return;
		}

		// Function from file: ripley.dm
		public override string get_stats_part(  ) {
			string output = null;
			Obj O = null;

			output = base.get_stats_part();
			output += "<b>Cargo Compartment Contents:</b><div style=\"margin-left: 15px;\">";

			if ( this.cargo.len != 0 ) {
				
				foreach (dynamic _a in Lang13.Enumerate( this.cargo, typeof(Obj) )) {
					O = _a;
					
					output += new Txt( "<a href='?src=" ).Ref( this ).str( ";drop_from_cargo=" ).Ref( O ).str( "'>Unload</a> : " ).item( O ).str( "<br>" ).ToString();
				}
			} else {
				output += "Nothing";
			}
			output += "</div>";
			return output;
		}

		// Function from file: ripley.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hsrc = null ) {
			dynamic O = null;

			base.Topic( href, href_list, (object)(hsrc) );

			if ( Lang13.Bool( href_list["drop_from_cargo"] ) ) {
				O = Lang13.FindObj( href_list["drop_from_cargo"] );

				if ( this.cargo.Contains( Lang13.Bool( O ) && Lang13.Bool( O ) ) ) {
					this.occupant_message( "<span class='notice'>You unload " + O + ".</span>" );
					O.loc = this.loc;
					this.cargo.Remove( O );
					this.log_message( "Unloaded " + O + ". Cargo compartment capacity: " + ( this.cargo_capacity - this.cargo.len ) );
				}
			}
			return null;
		}

		// Function from file: ripley.dm
		public override bool Exit( Ent_Dynamic O = null, Ent_Static newloc = null ) {
			
			if ( this.cargo.Contains( O ) ) {
				return false;
			}
			return base.Exit( O, newloc );
		}

		// Function from file: ripley.dm
		public override bool? update_icon( dynamic new_state = null, dynamic new_icon = null, int? new_px = null, int? new_py = null ) {
			base.update_icon( (object)(new_state), (object)(new_icon), new_px, new_py );

			if ( Lang13.Bool( this.hides ) ) {
				this.overlays = null;

				if ( ( this.hides ??0) < 3 ) {
					this.overlays.Add( new Image( "mecha.dmi", null, ( Lang13.Bool( this.occupant ) ? "ripley-g" : "ripley-g-open" ) ) );
				} else {
					this.overlays.Add( new Image( "mecha.dmi", null, ( Lang13.Bool( this.occupant ) ? "ripley-g-full" : "ripley-g-full-open" ) ) );
				}
			}
			return null;
		}

		// Function from file: ripley.dm
		public override bool mmi_moved_inside( dynamic mmi_as_oc = null, dynamic user = null ) {
			base.mmi_moved_inside( (object)(mmi_as_oc), (object)(user) );
			this.update_icon();
			return false;
		}

		// Function from file: ripley.dm
		public override bool moved_inside( dynamic H = null ) {
			base.moved_inside( (object)(H) );
			this.update_icon();
			return false;
		}

		// Function from file: ripley.dm
		public override void go_out( bool? forced = null, Ent_Static newloc = null ) {
			base.go_out( forced, newloc );
			this.update_icon();
			return;
		}

		// Function from file: ripley.dm
		public override dynamic Destroy(  ) {
			int? i = null;
			Ent_Dynamic A = null;

			i = null;
			i = 1;

			while (( i ??0) <= ( this.hides ??0)) {
				new Obj_Item_Asteroid_GoliathHide( this.loc );
				i++;
			}
			this.damage_absorption["brute"] = Lang13.InitialBroken( this.damage_absorption["brute"] );

			foreach (dynamic _a in Lang13.Enumerate( this.cargo, typeof(Ent_Dynamic) )) {
				A = _a;
				
				A.loc = this.loc;
				Map13.StepRandom( A );
			}
			this.cargo.Cut();
			return base.Destroy();
		}

		// Function from file: ripley.dm
		public override bool Move( dynamic NewLoc = null, int? Dir = null, int step_x = 0, int step_y = 0 ) {
			bool _default = false;

			dynamic ore_box = null;
			Obj_Item_Weapon_Ore ore = null;

			_default = base.Move( (object)(NewLoc), Dir, step_x, step_y );

			if ( _default && Lang13.Bool( Lang13.FindIn( typeof(Obj_Item_MechaParts_MechaEquipment_HydraulicClamp), this.equipment ) ) ) {
				ore_box = Lang13.FindIn( typeof(Obj_Structure_OreBox), this.cargo );

				if ( Lang13.Bool( ore_box ) ) {
					
					foreach (dynamic _a in Lang13.Enumerate( GlobalFuncs.get_turf( this ), typeof(Obj_Item_Weapon_Ore) )) {
						ore = _a;
						
						ore.Move( ore_box );
					}
				}
			}
			this.update_pressure();
			return _default;
		}

	}

}