// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_ProcHolder_Changeling_Sting_FalseArmblade : Obj_Effect_ProcHolder_Changeling_Sting {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.helptext = "The victim will form an armblade much like a changeling would, except the armblade is dull and useless.";
			this.sting_icon = "sting_armblade";
			this.chemical_cost = 20;
			this.dna_cost = 1;
			this.genetic_damage = 20;
			this.max_genetic_damage = 10;
		}

		public Obj_Effect_ProcHolder_Changeling_Sting_FalseArmblade ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: tiny_prick.dm
		public override dynamic sting_action( Mob user = null, dynamic target = null ) {
			Obj_Item_Weapon_Melee_ArmBlade_False blade = null;

			GlobalFuncs.add_logs( user, target, "stung", "falso armblade sting" );

			if ( !((Mob)target).drop_item() ) {
				user.WriteMsg( "<span class='warning'>The " + ((Mob)target).get_active_hand() + " is stuck to their hand, you cannot grow a false armblade over it!</span>" );
				return null;
			}

			if ( target is Mob_Living_Carbon_Monkey ) {
				user.WriteMsg( "<span class='notice'>Our genes cry out as we sting " + target.name + "!</span>" );
			}
			blade = new Obj_Item_Weapon_Melee_ArmBlade_False( target, true );
			((Mob)target).put_in_hands( blade );
			((Ent_Static)target).visible_message( "<span class='warning'>A grotesque blade forms around " + target.name + "'s arm!</span>", "<span class='userdanger'>Your arm twists and mutates, transforming into a horrific monstrosity!</span>", "<span class='italics'>You hear organic matter ripping and tearing!</span>" );
			GlobalFuncs.playsound( target, "sound/effects/blobattack.ogg", 30, 1 );
			Task13.Schedule( 600, (Task13.Closure)(() => {
				GlobalFuncs.playsound( target, "sound/effects/blobattack.ogg", 30, 1 );
				((Ent_Static)target).visible_message( "<span class='warning'>With a sickening crunch, " + target + " reforms their " + blade.name + " into an arm!</span>", "<span class='warning'>" + blade + " reforms back to normal.</span>", "<span class='italics>You hear organic matter ripping and tearing!</span>" );
				GlobalFuncs.qdel( blade );
				user.update_inv_l_hand();
				user.update_inv_r_hand();
				return;
			}));
			GlobalFuncs.feedback_add_details( "changeling_powers", "AS" );
			return 1;
		}

		// Function from file: tiny_prick.dm
		public override bool can_sting( Mob user = null, dynamic target = null ) {
			
			if ( !base.can_sting( user, (object)(target) ) ) {
				return false;
			}

			if ( Lang13.Bool( target.disabilities & 64 ) || !Lang13.Bool( target.has_dna() ) ) {
				user.WriteMsg( "<span class='warning'>Our sting appears ineffective against its DNA.</span>" );
				return false;
			}
			return true;
		}

	}

}