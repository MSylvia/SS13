// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_Smartfridge : Obj_Machinery {

		public dynamic max_n_of_items = 1500;
		public string icon_on = "smartfridge";
		public string icon_off = "smartfridge-off";

		protected override void __FieldInit() {
			base.__FieldInit();

			this.anchored = 1;
			this.idle_power_usage = 5;
			this.active_power_usage = 100;
			this.flags = 16384;
			this.icon = "icons/obj/vending.dmi";
			this.icon_state = "smartfridge";
			this.layer = 2.9;
		}

		// Function from file: smartfridge.dm
		public Obj_Machinery_Smartfridge ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.component_parts = new ByTable();
			this.component_parts.Add( new Obj_Item_Weapon_Circuitboard_Smartfridge( null, this.type ) );
			this.component_parts.Add( new Obj_Item_Weapon_StockParts_MatterBin( null ) );
			this.RefreshParts();
			return;
		}

		// Function from file: smartfridge.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hsrc = null ) {
			string N = null;
			double? amount = null;
			double? i = null;
			Obj O = null;

			
			if ( Lang13.Bool( base.Topic( href, href_list, (object)(hsrc) ) ) ) {
				return null;
			}
			Task13.User.set_machine( this );
			N = href_list["vend"];
			amount = String13.ParseNumber( href_list["amount"] );
			i = amount;

			foreach (dynamic _a in Lang13.Enumerate( this.contents, typeof(Obj) )) {
				O = _a;
				

				if ( ( i ??0) <= 0 ) {
					break;
				}

				if ( O.name == N ) {
					O.loc = this.loc;
					i--;
				}
			}
			this.updateUsrDialog();
			return null;
		}

		// Function from file: smartfridge.dm
		public override dynamic interact( dynamic user = null, bool? flag1 = null ) {
			string dat = null;
			ByTable listofitems = null;
			Ent_Dynamic O = null;
			dynamic O2 = null;
			int N = 0;
			string itemName = null;

			
			if ( this.stat != 0 ) {
				return 0;
			}
			dat = "<TT><b>Select an item:</b><br>";

			if ( this.contents.len == 0 ) {
				dat += "<font color = 'red'>No product loaded!</font>";
			} else {
				listofitems = new ByTable();

				foreach (dynamic _a in Lang13.Enumerate( this.contents, typeof(Ent_Dynamic) )) {
					O = _a;
					

					if ( Lang13.Bool( listofitems[O.name] ) ) {
						listofitems[O.name]++;
					} else {
						listofitems[O.name] = 1;
					}
				}
				GlobalFuncs.sortList( listofitems );

				foreach (dynamic _b in Lang13.Enumerate( listofitems )) {
					O2 = _b;
					

					if ( Convert.ToDouble( listofitems[O2] ) <= 0 ) {
						continue;
					}
					N = Convert.ToInt32( listofitems[O2] );
					itemName = String13.UrlEncode( O2, false );
					dat += "<FONT color = 'blue'><B>" + GlobalFuncs.capitalize( O2 ) + "</B>:";
					dat += " " + N + " </font>";
					dat += new Txt( "<a href='byond://?src=" ).Ref( this ).str( ";vend=" ).item( itemName ).str( ";amount=1'>Vend</A> " ).ToString();

					if ( N > 5 ) {
						dat += new Txt( "(<a href='byond://?src=" ).Ref( this ).str( ";vend=" ).item( itemName ).str( ";amount=5'>x5</A>)" ).ToString();

						if ( N > 10 ) {
							dat += new Txt( "(<a href='byond://?src=" ).Ref( this ).str( ";vend=" ).item( itemName ).str( ";amount=10'>x10</A>)" ).ToString();

							if ( N > 25 ) {
								dat += new Txt( "(<a href='byond://?src=" ).Ref( this ).str( ";vend=" ).item( itemName ).str( ";amount=25'>x25</A>)" ).ToString();
							}
						}
					}

					if ( N > 1 ) {
						dat += new Txt( "(<a href='?src=" ).Ref( this ).str( ";vend=" ).item( itemName ).str( ";amount=" ).item( N ).str( "'>All</A>)" ).ToString();
					}
					dat += "<br>";
				}
				dat += "</TT>";
			}
			Interface13.Browse( user, "<HEAD><TITLE>" + this + " supplies</TITLE></HEAD><TT>" + dat + "</TT>", "window=smartfridge" );
			GlobalFuncs.onclose( user, "smartfridge" );
			return dat;
		}

		// Function from file: smartfridge.dm
		public override dynamic attack_hand( dynamic a = null, bool? b = null, bool? c = null ) {
			((Mob)a).set_machine( this );
			this.interact( a );
			return null;
		}

		// Function from file: smartfridge.dm
		public override dynamic attack_ai( dynamic user = null ) {
			return 0;
		}

		// Function from file: smartfridge.dm
		public override dynamic attack_paw( dynamic a = null, dynamic b = null, dynamic c = null ) {
			return this.attack_hand( a );
		}

		// Function from file: smartfridge.dm
		public virtual void load( dynamic O = null ) {
			Ent_Static M = null;
			Ent_Static S = null;

			
			if ( O.loc is Mob ) {
				M = O.loc;

				if ( !((Mob)M).unEquip( O ) ) {
					Task13.User.WriteMsg( new Txt( "<span class='warning'>" ).the( O ).item().str( " is stuck to your hand, you cannot put it in " ).the( this ).item().str( "!</span>" ).ToString() );
					return;
				}
			} else if ( O.loc is Obj_Item_Weapon_Storage ) {
				S = O.loc;
				((dynamic)S).remove_from_storage( O, this );
			}
			O.loc = this;
			return;
		}

		// Function from file: smartfridge.dm
		public virtual bool accept_check( dynamic O = null ) {
			
			if ( O is Obj_Item_Weapon_ReagentContainers_Food_Snacks_Grown || O is Obj_Item_Seeds ) {
				return true;
			}
			return false;
		}

		// Function from file: smartfridge.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			int loaded = 0;
			dynamic P = null;
			Obj G = null;

			
			if ( this.default_deconstruction_screwdriver( user, "smartfridge_open", "smartfridge", A ) ) {
				return null;
			}

			if ( this.exchange_parts( user, A ) ) {
				return null;
			}

			if ( this.default_pry_open( A ) ) {
				return null;
			}

			if ( this.default_unfasten_wrench( user, A ) ) {
				this.power_change();
				return null;
			}
			this.default_deconstruction_crowbar( A );

			if ( this.stat != 0 ) {
				return 0;
			}

			if ( this.contents.len >= Convert.ToDouble( this.max_n_of_items ) ) {
				user.WriteMsg( new Txt( "<span class='warning'>" ).The( this ).item().str( " is full!</span>" ).ToString() );
				return 0;
			}

			if ( this.accept_check( A ) ) {
				this.load( A );
				((Ent_Static)user).visible_message( new Txt().item( user ).str( " has added " ).the( A ).item().str( " to " ).the( this ).item().str( "." ).ToString(), new Txt( "<span class='notice'>You add " ).the( A ).item().str( " to " ).the( this ).item().str( ".</span>" ).ToString() );
				this.updateUsrDialog();
				return 1;
			}
			loaded = 0;

			if ( A is Obj_Item_Weapon_Storage_Bag ) {
				P = A;

				foreach (dynamic _a in Lang13.Enumerate( P.contents, typeof(Obj) )) {
					G = _a;
					

					if ( this.contents.len >= Convert.ToDouble( this.max_n_of_items ) ) {
						break;
					}

					if ( this.accept_check( G ) ) {
						this.load( G );
						loaded++;
					}
				}
			} else {
				user.WriteMsg( new Txt( "<span class='warning'>" ).The( this ).item().str( " smartly refuses " ).item( A ).str( ".</span>" ).ToString() );
				this.updateUsrDialog();
				return 0;
			}

			if ( loaded != 0 ) {
				
				if ( this.contents.len >= Convert.ToDouble( this.max_n_of_items ) ) {
					((Ent_Static)user).visible_message( new Txt().item( user ).str( " loads " ).the( this ).item().str( " with " ).the( A ).item().str( "." ).ToString(), new Txt( "<span class='notice'>You fill " ).the( this ).item().str( " with " ).the( A ).item().str( ".</span>" ).ToString() );
				} else {
					((Ent_Static)user).visible_message( new Txt().item( user ).str( " loads " ).the( this ).item().str( " with " ).the( A ).item().str( "." ).ToString(), new Txt( "<span class='notice'>You load " ).the( this ).item().str( " with " ).the( A ).item().str( ".</span>" ).ToString() );
				}

				if ( A.contents.len > 0 ) {
					user.WriteMsg( "<span class='warning'>Some items are refused.</span>" );
				}
			} else {
				user.WriteMsg( "<span class='warning'>There is nothing in " + A + " to put in " + this + "!</span>" );
				return 0;
			}
			this.updateUsrDialog();
			return 1;
		}

		// Function from file: smartfridge.dm
		public override bool? update_icon( dynamic new_state = null, dynamic new_icon = null, int? new_px = null, int? new_py = null ) {
			
			if ( !( this.stat != 0 ) ) {
				this.icon_state = this.icon_on;
			} else {
				this.icon_state = this.icon_off;
			}
			return null;
		}

		// Function from file: smartfridge.dm
		public override void power_change(  ) {
			base.power_change();
			this.update_icon();
			return;
		}

		// Function from file: smartfridge.dm
		public override void RefreshParts(  ) {
			Obj_Item_Weapon_StockParts_MatterBin B = null;

			
			foreach (dynamic _a in Lang13.Enumerate( this.component_parts, typeof(Obj_Item_Weapon_StockParts_MatterBin) )) {
				B = _a;
				
				this.max_n_of_items = B.rating * 1500;
			}
			return;
		}

		// Function from file: smartfridge.dm
		public override void deconstruction(  ) {
			Ent_Dynamic A = null;

			
			foreach (dynamic _a in Lang13.Enumerate( this.contents, typeof(Ent_Dynamic) )) {
				A = _a;
				
				A.loc = this.loc;
			}
			return;
		}

		// Function from file: smartfridge.dm
		public override void construction( dynamic pipe_type = null, dynamic obj_color = null ) {
			Game_Data A = null;

			
			foreach (dynamic _a in Lang13.Enumerate( this.contents, typeof(Game_Data) )) {
				A = _a;
				
				GlobalFuncs.qdel( A );
			}
			return;
		}

	}

}