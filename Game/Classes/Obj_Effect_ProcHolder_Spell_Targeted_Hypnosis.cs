// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_ProcHolder_Spell_Targeted_Hypnosis : Obj_Effect_ProcHolder_Spell_Targeted {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.panel = "Ascendant";
			this.charge_max = 0;
			this.clothes_req = 0;
			this.action_icon_state = "enthrall";
		}

		public Obj_Effect_ProcHolder_Spell_Targeted_Hypnosis ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: shadowling_abilities.dm
		public override bool cast( dynamic targets = null, dynamic thearea = null, dynamic user = null ) {
			thearea = thearea ?? Task13.User;

			Mob_Living_Carbon_Human target = null;

			
			if ( Lang13.Bool( thearea.phasing ) ) {
				this.revert_cast();
				thearea.WriteMsg( "<span class='warning'>You are not in the same plane of existence. Unphase first.</span>" );
				return false;
			}

			foreach (dynamic _a in Lang13.Enumerate( targets, typeof(Mob_Living_Carbon_Human) )) {
				target = _a;
				

				if ( GlobalFuncs.is_shadow_or_thrall( target ) ) {
					thearea.WriteMsg( "<span class='warning'>You cannot enthrall an ally.<span>" );
					this.revert_cast();
					return false;
				}

				if ( !Lang13.Bool( target.ckey ) || !( target.mind != null ) ) {
					thearea.WriteMsg( "<span class='warning'>The target has no mind.</span>" );
					this.revert_cast();
					return false;
				}

				if ( target.stat != 0 ) {
					thearea.WriteMsg( "<span class='warning'>The target must be conscious.</span>" );
					this.revert_cast();
					return false;
				}

				if ( !( target is Mob_Living_Carbon_Human ) ) {
					thearea.WriteMsg( "<span class='warning'>You can only enthrall humans.</span>" );
					this.revert_cast();
					return false;
				}
				thearea.WriteMsg( "<span class='shadowling'>You instantly rearrange <b>" + target + "</b>'s memories, hyptonitizing them into a thrall.</span>" );
				target.WriteMsg( "<span class='userdanger'><font size=3>An agonizing spike of pain drives into your mind, and--</font></span>" );
				target.mind.special_role = "thrall";
				((GameMode)GlobalVars.ticker.mode).add_thrall( target.mind );
			}
			return false;
		}

	}

}