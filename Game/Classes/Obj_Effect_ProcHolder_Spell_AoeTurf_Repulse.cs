// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_ProcHolder_Spell_AoeTurf_Repulse : Obj_Effect_ProcHolder_Spell_AoeTurf {

		public int maxthrow = 5;
		public string animation = "shieldsparkles";

		protected override void __FieldInit() {
			base.__FieldInit();

			this.charge_max = 400;
			this.invocation = "GITTAH WEIGH";
			this.invocation_type = "shout";
			this.range = 5;
			this.cooldown_min = 150;
			this.sound = "sound/magic/Repulse.ogg";
			this.action_icon_state = "repulse";
		}

		public Obj_Effect_ProcHolder_Spell_AoeTurf_Repulse ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: wizard.dm
		public override bool cast( dynamic targets = null, dynamic thearea = null, dynamic user = null ) {
			thearea = thearea ?? Task13.User;

			ByTable thrownatoms = null;
			dynamic throwtarget = null;
			int distfromcaster = 0;
			dynamic T = null;
			Ent_Dynamic AM = null;
			Ent_Dynamic AM2 = null;
			Obj_Effect_Overlay targeteffect = null;
			Ent_Dynamic M = null;
			Ent_Dynamic M2 = null;

			thrownatoms = new ByTable();
			this.playMagSound();

			foreach (dynamic _b in Lang13.Enumerate( targets )) {
				T = _b;
				

				foreach (dynamic _a in Lang13.Enumerate( T, typeof(Ent_Dynamic) )) {
					AM = _a;
					
					thrownatoms.Add( AM );
				}
			}

			foreach (dynamic _c in Lang13.Enumerate( thrownatoms, typeof(Ent_Dynamic) )) {
				AM2 = _c;
				

				if ( AM2 == thearea || Lang13.Bool( AM2.anchored ) ) {
					continue;
				}
				targeteffect = new Obj_Effect_Overlay() {
					icon = "icons/effects/effects.dmi",
					icon_state = "shieldsparkles",
					mouse_opacity = 0,
					density = false
					
				};
				targeteffect.icon_state = this.animation;
				AM2.overlays.Add( targeteffect );
				throwtarget = GlobalFuncs.get_edge_target_turf( thearea, Map13.GetDistance( thearea, Map13.GetStepAway( AM2, thearea, null ) ) );
				distfromcaster = Map13.GetDistance( thearea, AM2 );
				Task13.Schedule( 10, (Task13.Closure)(() => {
					AM2.overlays.Remove( targeteffect );
					GlobalFuncs.qdel( targeteffect );
					return;
				}));

				if ( distfromcaster == 0 ) {
					
					if ( AM2 is Mob_Living ) {
						M = AM2;
						((dynamic)M).Weaken( 5 );
						((dynamic)M).adjustBruteLoss( 5 );
						((dynamic)M).WriteMsg( "<span class='userdanger'>You're slammed into the floor by " + thearea + "!</span>" );
					}
				} else {
					
					if ( AM2 is Mob_Living ) {
						M2 = AM2;
						((dynamic)M2).Weaken( 2 );
						((dynamic)M2).WriteMsg( "<span class='userdanger'>You're thrown back by " + thearea + "!</span>" );
					}
					AM2.throw_at_fast( throwtarget, Num13.MaxInt( 3, Num13.MinInt( this.maxthrow - Num13.MaxInt( 0, Num13.MinInt( distfromcaster - 2, distfromcaster ) ), this.maxthrow ) ), 1, thearea );
				}
			}
			return false;
		}

	}

}