// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Pizzabox : Obj_Item {

		public bool open = false;
		public bool ismessy = false;
		public dynamic pizza = null;
		public ByTable boxes = new ByTable();
		public string boxtag = "";

		protected override void __FieldInit() {
			base.__FieldInit();

			this.item_state = "pizzabox";
			this.icon = "icons/obj/food/containers.dmi";
			this.icon_state = "pizzabox1";
		}

		public Obj_Item_Pizzabox ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: snacks_pizza.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			dynamic box = null;
			ByTable boxestoadd = null;
			Obj_Item_Pizzabox i = null;
			string t = null;
			Obj_Item_Pizzabox boxtotagto = null;

			
			if ( A is Obj_Item_Pizzabox ) {
				box = A;

				if ( !Lang13.Bool( box.open ) && !this.open ) {
					boxestoadd = new ByTable();
					boxestoadd.Add( box );

					foreach (dynamic _a in Lang13.Enumerate( box.boxes, typeof(Obj_Item_Pizzabox) )) {
						i = _a;
						
						boxestoadd.Add( i );
					}

					if ( this.boxes.len + boxestoadd.len + 1 <= 5 ) {
						user.drop_item();
						box.loc = this;
						box.boxes = new ByTable();
						this.boxes.Add( boxestoadd );
						box.update_icon();
						this.update_icon();
						user.WriteMsg( "<span class='notice'>You put " + box + " on top of " + this + "!</span>" );
					} else {
						user.WriteMsg( "<span class='notice'>The stack is dangerously high!</span>" );
					}
				} else {
					user.WriteMsg( "<span class='notice'>Close " + box + " first!</span>" );
				}
				return null;
			}

			if ( A is Obj_Item_Weapon_ReagentContainers_Food_Snacks_Pizza ) {
				
				if ( this.open ) {
					user.drop_item();
					A.loc = this;
					this.pizza = A;
					this.update_icon();
					user.WriteMsg( "<span class='notice'>You put " + A + " in " + this + ".</span>" );
				} else {
					user.WriteMsg( "<span class='notice'>You try to push " + A + " through the lid but it doesn't work!</span>" );
				}
				return null;
			}

			if ( A is Obj_Item_Weapon_Pen ) {
				
				if ( this.open ) {
					return null;
				}
				t = GlobalFuncs.stripped_input( user, "Enter what you want to add to the tag:", "Write", "", 30 );
				boxtotagto = this;

				if ( this.boxes.len > 0 ) {
					boxtotagto = this.boxes[this.boxes.len];
				}
				boxtotagto.boxtag = "" + boxtotagto.boxtag + t;
				this.update_icon();
				return null;
			}
			base.attackby( (object)(A), (object)(user), _params, silent, replace_spent );
			return null;
		}

		// Function from file: snacks_pizza.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			
			if ( this.boxes.len > 0 ) {
				return null;
			}
			this.open = !this.open;

			if ( this.open && Lang13.Bool( this.pizza ) ) {
				this.ismessy = true;
			}
			this.update_icon();
			return null;
		}

		// Function from file: snacks_pizza.dm
		public override dynamic attack_hand( dynamic a = null, bool? b = null, bool? c = null ) {
			dynamic box = null;

			
			if ( this.open && Lang13.Bool( this.pizza ) ) {
				((Mob)a).put_in_hands( this.pizza );
				a.WriteMsg( "<span class='notice'>You take the " + this.pizza + " out of " + this + ".</span>" );
				this.pizza = null;
				this.update_icon();
				return null;
			}

			if ( this.boxes.len > 0 ) {
				
				if ( ((Mob)a).get_inactive_hand() != this ) {
					base.attack_hand( (object)(a), b, c );
					return null;
				}
				box = this.boxes[this.boxes.len];
				this.boxes.Remove( box );
				((Mob)a).put_in_hands( box );
				a.WriteMsg( "<span class='notice'>You remove the topmost " + this.name + " from your hand.</span>" );
				box.update_icon();
				this.update_icon();
				return null;
			}
			base.attack_hand( (object)(a), b, c );
			return null;
		}

		// Function from file: snacks_pizza.dm
		public override bool? update_icon( dynamic new_state = null, dynamic new_icon = null, int? new_px = null, int? new_py = null ) {
			Obj_Item_Pizzabox topbox = null;
			string toptag = null;
			Image pizzaimg = null;
			bool doimgtag = false;
			Obj_Item_Pizzabox topbox2 = null;
			Image tagimg = null;

			this.overlays = new ByTable();

			if ( this.open && Lang13.Bool( this.pizza ) ) {
				this.desc = "A box suited for pizzas. It appears to have " + this.pizza + " inside.";
			} else if ( this.boxes.len > 0 ) {
				this.desc = "A pile of boxes suited for pizzas. There appears to be " + ( this.boxes.len + 1 ) + " boxes in the pile.";
				topbox = this.boxes[this.boxes.len];
				toptag = topbox.boxtag;

				if ( toptag != "" ) {
					this.desc = "" + this.desc + " The box on top has a tag, it reads: '" + toptag + "'.";
				}
			} else {
				this.desc = "A box suited for pizzas.";

				if ( this.boxtag != "" ) {
					this.desc = "" + this.desc + " The box has a tag, it reads: '" + this.boxtag + "'.";
				}
			}

			if ( this.open ) {
				
				if ( this.ismessy ) {
					this.icon_state = "pizzabox_messy";
				} else {
					this.icon_state = "pizzabox_open";
				}

				if ( Lang13.Bool( this.pizza ) ) {
					pizzaimg = new Image( "icons/obj/food/pizzaspaghetti.dmi", null, this.pizza.icon_state );
					pizzaimg.pixel_y = -3;
					this.overlays.Add( pizzaimg );
				}
				return null;
			} else {
				doimgtag = false;

				if ( this.boxes.len > 0 ) {
					topbox2 = this.boxes[this.boxes.len];

					if ( topbox2.boxtag != "" ) {
						doimgtag = true;
					}
				} else if ( this.boxtag != "" ) {
					doimgtag = true;
				}

				if ( doimgtag ) {
					tagimg = new Image( "icons/obj/food/containers.dmi", null, "pizzabox_tag" );
					tagimg.pixel_y = this.boxes.len * 3;
					this.overlays.Add( tagimg );
				}
			}
			this.icon_state = "pizzabox" + ( this.boxes.len + 1 );
			return null;
		}

	}

}