// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Objective_Default_Absorb : Objective_Default {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.dangerrating = 10;
			this.required_role = "changeling";
		}

		public Objective_Default_Absorb ( string text = null ) : base( text ) {
			
		}

		// Function from file: objective.dm
		public override int check_completion(  ) {
			
			if ( Lang13.Bool( this.owner ) && this.owner.changeling != null && this.owner.changeling.stored_profiles != null && ( this.owner.changeling.absorbedcount ??0) >= ( this.target_amount ??0) ) {
				return 1;
			} else {
				return 0;
			}
		}

		// Function from file: objective.dm
		public double? gen_amount_goal( int? lowbound = null, int? highbound = null ) {
			lowbound = lowbound ?? 4;
			highbound = highbound ?? 6;

			int n_p = 0;
			Mob_NewPlayer P = null;
			Mob_Living_Carbon_Human P2 = null;

			this.target_amount = Rand13.Int( lowbound ??0, highbound ??0 );

			if ( GlobalVars.ticker != null ) {
				n_p = 1;

				if ( GlobalVars.ticker.current_state == 2 ) {
					
					foreach (dynamic _a in Lang13.Enumerate( GlobalVars.player_list, typeof(Mob_NewPlayer) )) {
						P = _a;
						

						if ( P.client != null && Lang13.Bool( P.ready ) && P.mind != this.owner ) {
							n_p++;
						}
					}
				} else if ( GlobalVars.ticker.current_state == 3 ) {
					
					foreach (dynamic _b in Lang13.Enumerate( GlobalVars.player_list, typeof(Mob_Living_Carbon_Human) )) {
						P2 = _b;
						

						if ( P2.client != null && !GlobalVars.ticker.mode.changelings.Contains( P2.mind ) && P2.mind != this.owner ) {
							n_p++;
						}
					}
				}
				this.target_amount = Num13.MinInt( ((int)( this.target_amount ??0 )), n_p );
			}
			this.explanation_text = new Txt( "Extract " ).item( this.target_amount ).str( " compatible genome" ).s().str( "." ).ToString();
			return this.target_amount;
		}

	}

}