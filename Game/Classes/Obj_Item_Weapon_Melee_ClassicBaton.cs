// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_Melee_ClassicBaton : Obj_Item_Weapon_Melee {

		public bool cooldown = false;
		public bool on = true;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.item_state = "classic_baton";
			this.slot_flags = 512;
			this.force = 12;
			this.icon_state = "baton";
		}

		public Obj_Item_Weapon_Melee_ClassicBaton ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: misc.dm
		public override bool attack( dynamic M = null, dynamic user = null, bool? def_zone = null ) {
			dynamic H = null;

			
			if ( this.on ) {
				this.add_fingerprint( user );

				if ( Lang13.Bool( user.disabilities.Contains( 256 ) ) && Rand13.PercentChance( 50 ) ) {
					user.WriteMsg( "<span class ='danger'>You club yourself over the head.</span>" );
					((Mob)user).Weaken( this.force * 3 );

					if ( user is Mob_Living_Carbon_Human ) {
						H = user;
						H.apply_damage( this.force * 2, "brute", "head" );
					} else {
						((Mob_Living)user).take_organ_damage( this.force * 2 );
					}
					return false;
				}

				if ( M is Mob_Living_Silicon_Robot ) {
					base.attack( (object)(M), (object)(user), def_zone );
					return false;
				}

				if ( !( M is Mob_Living ) ) {
					return false;
				}

				if ( user.a_intent == "harm" ) {
					
					if ( !base.attack( (object)(M), (object)(user), def_zone ) ) {
						return false;
					}

					if ( !( M is Mob_Living_Silicon_Robot ) ) {
						return false;
					}
				} else if ( ( this.cooldown ?1:0) <= 0 ) {
					GlobalFuncs.playsound( GlobalFuncs.get_turf( this ), "sound/effects/woodhit.ogg", 75, 1, -1 );
					((Mob)M).Weaken( 3 );
					GlobalFuncs.add_logs( user, M, "stunned", this );
					this.add_fingerprint( user );
					((Ent_Static)M).visible_message( new Txt( "<span class ='danger'>" ).item( user ).str( " has knocked down " ).item( M ).str( " with " ).the( this ).item().str( "!</span>" ).ToString(), new Txt( "<span class ='userdanger'>" ).item( user ).str( " has knocked down " ).item( M ).str( " with " ).the( this ).item().str( "!</span>" ).ToString() );

					if ( !( user is Mob_Living_Carbon ) ) {
						M.LAssailant = null;
					} else {
						M.LAssailant = user;
					}
					this.cooldown = true;
					Task13.Schedule( 40, (Task13.Closure)(() => {
						this.cooldown = false;
						return;
					}));
				}
				return false;
			} else {
				return base.attack( (object)(M), (object)(user), def_zone );
			}
		}

	}

}