// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_Rune_Summon : Obj_Effect_Rune {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.color = "#00ff00";
			this.cultist_name = "Summon Cultist";
			this.cultist_desc = "Summons a single cultist to the rune.";
			this.invocation = "N'ath reth sh'yro eth d'rekkathnor!";
			this.icon_state = "5";
		}

		public Obj_Effect_Rune_Summon ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: runes.dm
		public override void invoke( dynamic user = null ) {
			ByTable cultists = null;
			Mind M = null;
			dynamic cultist_to_summon = null;

			cultists = new ByTable();

			foreach (dynamic _a in Lang13.Enumerate( GlobalVars.ticker.mode.cult, typeof(Mind) )) {
				M = _a;
				
				cultists.Add( M.current );
			}
			cultist_to_summon = Interface13.Input( "Who do you wish to call to " + this + "?", "Followers of the Geometer", null, null, cultists - user, InputType.Null | InputType.Any );

			if ( !this.Adjacent( user ) || !( this != null ) || GlobalFuncs.qdeleted( this ) || ((Mob)user).incapacitated() ) {
				return;
			}

			if ( !Lang13.Bool( cultist_to_summon ) ) {
				user.WriteMsg( "<span class='cultitalic'>You require a summoning target!</span>" );
				this.fail_invoke();
				GlobalFuncs.log_game( "Summon Cultist rune failed - no target" );
				return;
			}

			if ( !GlobalFuncs.iscultist( cultist_to_summon ) ) {
				user.WriteMsg( "<span class='cultitalic'>" + cultist_to_summon + " is not a follower of the Geometer!</span>" );
				this.fail_invoke();
				GlobalFuncs.log_game( "Summon Cultist rune failed - no target" );
				return;
			}

			if ( Convert.ToDouble( cultist_to_summon.z ) > 7 ) {
				user.WriteMsg( "<span class='cultitalic'>" + cultist_to_summon + " is not in our dimension!</span>" );
				this.fail_invoke();
				GlobalFuncs.log_game( "Summon Cultist rune failed - target in away mission" );
				return;
			}

			if ( cultist_to_summon.buckled != null ) {
				cultist_to_summon.buckled.unbuckle_mob();
			}
			((Ent_Static)cultist_to_summon).visible_message( "<span class='warning'>" + cultist_to_summon + " suddenly disappears in a flash of red light!</span>", "<span class='cultitalic'><b>Overwhelming vertigo consumes you as you are hurled through the air!</b></span>" );
			this.visible_message( "<span class='warning'>A foggy shape materializes atop " + this + " and solidifes into " + cultist_to_summon + "!</span>" );
			user.apply_damage( 10, "brute", "head" );
			cultist_to_summon.loc = GlobalFuncs.get_turf( this );
			GlobalFuncs.qdel( this );
			return;
		}

	}

}