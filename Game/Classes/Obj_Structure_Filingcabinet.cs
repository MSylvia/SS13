// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Structure_Filingcabinet : Obj_Structure {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.anchored = 1;
			this.icon = "icons/obj/bureaucracy.dmi";
			this.icon_state = "filingcabinet";
		}

		public Obj_Structure_Filingcabinet ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: filingcabinet.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hsrc = null ) {
			dynamic P = null;

			
			if ( Lang13.Bool( href_list["retrieve"] ) ) {
				Interface13.Browse( Task13.User, "", "window=filingcabinet" );
				P = Lang13.FindObj( href_list["retrieve"] );

				if ( P is Obj_Item && P.loc == this && Map13.GetDistance( this, Task13.User ) <= 1 ) {
					Task13.User.put_in_hands( P );
					this.updateUsrDialog();
					this.icon_state = "" + Lang13.Initial( this, "icon_state" ) + "-open";
					Task13.Sleep( 5 );
					this.icon_state = Lang13.Initial( this, "icon_state" );
				}
			}
			return null;
		}

		// Function from file: filingcabinet.dm
		public override dynamic attack_self_tk( dynamic user = null ) {
			dynamic I = null;

			
			if ( this.contents.len != 0 ) {
				
				if ( Rand13.PercentChance( this.contents.len * 5 + 40 ) ) {
					I = Rand13.PickFromTable( this.contents );
					I.loc = this.loc;

					if ( Rand13.PercentChance( 25 ) ) {
						Map13.StepRandom( I );
					}
					user.WriteMsg( new Txt( "<span class='notice'>You pull " ).a( I ).item().str( " out of " ).item( this ).str( " at random.</span>" ).ToString() );
					return null;
				}
			}
			user.WriteMsg( "<span class='notice'>You find nothing in " + this + ".</span>" );
			return null;
		}

		// Function from file: filingcabinet.dm
		public override void attack_tk( Mob_Living_Carbon_Human user = null ) {
			
			if ( Lang13.Bool( this.anchored ) ) {
				this.attack_self_tk( user );
			} else {
				base.attack_tk( user );
			}
			return;
		}

		// Function from file: filingcabinet.dm
		public override dynamic attack_hand( dynamic a = null, bool? b = null, bool? c = null ) {
			string dat = null;
			int i = 0;
			dynamic P = null;

			
			if ( this.contents.len <= 0 ) {
				a.WriteMsg( "<span class='notice'>" + this + " is empty.</span>" );
				return null;
			}
			((Mob)a).set_machine( this );
			dat = "<center><table>";
			i = this.contents.len;

			while (i >= 1) {
				P = this.contents[i];
				dat += new Txt( "<tr><td><a href='?src=" ).Ref( this ).str( ";retrieve=" ).Ref( P ).str( "'>" ).item( P.name ).str( "</a></td></tr>" ).ToString();
				i--;
			}
			dat += "</table></center>";
			Interface13.Browse( a, "<html><head><title>" + this.name + "</title></head><body>" + dat + "</body></html>", "window=filingcabinet;size=350x300" );
			return null;
		}

		// Function from file: filingcabinet.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			
			if ( A is Obj_Item_Weapon_Paper || A is Obj_Item_Weapon_Folder || A is Obj_Item_Weapon_Photo || A is Obj_Item_Documents ) {
				
				if ( !Lang13.Bool( user.drop_item() ) ) {
					return null;
				}
				user.WriteMsg( "<span class='notice'>You put " + A + " in " + this + ".</span>" );
				A.loc = this;
				this.icon_state = "" + Lang13.Initial( this, "icon_state" ) + "-open";
				Task13.Sleep( 5 );
				this.icon_state = Lang13.Initial( this, "icon_state" );
				this.updateUsrDialog();
			} else if ( A is Obj_Item_Weapon_Wrench ) {
				GlobalFuncs.playsound( this.loc, "sound/items/ratchet.ogg", 50, 1 );
				this.anchored = !Lang13.Bool( this.anchored );
				user.WriteMsg( "<span class='notice'>You " + ( Lang13.Bool( this.anchored ) ? "wrench" : "unwrench" ) + " " + this + ".</span>" );
			} else {
				user.WriteMsg( "<span class='warning'>You can't put " + A + " in " + this + "!</span>" );
			}
			return null;
		}

		// Function from file: filingcabinet.dm
		public override bool ex_act( double? severity = null, dynamic target = null ) {
			Obj_Item I = null;

			
			foreach (dynamic _a in Lang13.Enumerate( this, typeof(Obj_Item) )) {
				I = _a;
				
				I.loc = this.loc;
			}
			GlobalFuncs.qdel( this );
			base.ex_act( severity, (object)(target) );
			return false;
		}

		// Function from file: filingcabinet.dm
		public override void initialize(  ) {
			Obj_Item I = null;

			
			foreach (dynamic _a in Lang13.Enumerate( this.loc, typeof(Obj_Item) )) {
				I = _a;
				

				if ( I is Obj_Item_Weapon_Paper || I is Obj_Item_Weapon_Folder || I is Obj_Item_Weapon_Photo ) {
					I.loc = this;
				}
			}
			return;
		}

	}

}