// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Structure_Girder : Obj_Structure {

		public int state = 0;
		public int girderpasschance = 20;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.anchored = 1;
			this.icon_state = "girder";
			this.layer = 2.9;
		}

		public Obj_Structure_Girder ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: girders.dm
		public override bool ex_act( double? severity = null, dynamic target = null ) {
			dynamic remains = null;
			dynamic remains2 = null;

			
			switch ((double?)( severity )) {
				case 1:
					GlobalFuncs.qdel( this );
					break;
				case 2:
					
					if ( Rand13.PercentChance( 70 ) ) {
						remains = Rand13.Pick(new object [] { typeof(Obj_Item_Stack_Rods), typeof(Obj_Item_Stack_Sheet_Metal) });
						Lang13.Call( remains, this.loc );
						GlobalFuncs.qdel( this );
					}
					break;
				case 3:
					
					if ( Rand13.PercentChance( 40 ) ) {
						remains2 = Rand13.Pick(new object [] { typeof(Obj_Item_Stack_Rods), typeof(Obj_Item_Stack_Sheet_Metal) });
						Lang13.Call( remains2, this.loc );
						GlobalFuncs.qdel( this );
					}
					break;
			}
			return false;
		}

		// Function from file: girders.dm
		public override bool blob_act( dynamic severity = null ) {
			
			if ( Rand13.PercentChance( 40 ) ) {
				GlobalFuncs.qdel( this );
			}
			return false;
		}

		// Function from file: girders.dm
		public override bool CanPass( dynamic mover = null, dynamic target = null, double? height = null, bool? air_group = null ) {
			height = height ?? 0;

			
			if ( height == 0 ) {
				return true;
			}

			if ( mover is Ent_Dynamic && ((Ent_Dynamic)mover).checkpass( 4 ) != 0 ) {
				return Rand13.PercentChance( this.girderpasschance );
			} else if ( mover is Obj_Item_Projectile ) {
				return Rand13.PercentChance( this.girderpasschance );
			} else {
				return false;
			}
			return false;
		}

		// Function from file: girders.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			Obj_Item_Stack_Sheet_Metal M = null;
			Obj_Structure_Girder G = null;
			Obj_Structure_Girder_Displaced D = null;
			Obj_Item_Stack_Sheet_Metal M2 = null;
			dynamic D2 = null;
			Obj_Structure_Girder G2 = null;
			dynamic S = null;
			Obj_Structure_Falsewall_Iron FW = null;
			dynamic T = null;
			dynamic S2 = null;
			Obj_Structure_Falsewall F = null;
			dynamic T2 = null;
			Obj_Structure_Falsewall_Reinforced FW2 = null;
			dynamic T3 = null;
			Obj_Structure_Girder_Reinforced R = null;
			string M3 = null;
			Type F2 = null;
			dynamic FW3 = null;
			dynamic T4 = null;
			dynamic P = null;

			this.add_fingerprint( user );

			if ( A is Obj_Item_Weapon_Screwdriver ) {
				
				if ( this.state == 3 ) {
					GlobalFuncs.playsound( this.loc, "sound/items/Screwdriver.ogg", 100, 1 );
					((Ent_Static)user).visible_message( "<span class='warning'>" + user + " disassembles the girder.</span>", "<span class='notice'>You start to disassemble the girder...</span>", "You hear clanking and banging noises." );

					if ( GlobalFuncs.do_after( user, 40 / A.toolspeed, null, this ) ) {
						
						if ( this.state != 3 ) {
							return null;
						}
						this.state = 4;
						user.WriteMsg( "<span class='notice'>You disassemble the girder.</span>" );
						M = new Obj_Item_Stack_Sheet_Metal( this.loc, 2 );
						M.add_fingerprint( user );
						GlobalFuncs.qdel( this );
					}
				} else if ( this.state == 2 ) {
					GlobalFuncs.playsound( this.loc, "sound/items/Screwdriver.ogg", 100, 1 );
					user.WriteMsg( "<span class='notice'>You start unsecuring support struts...</span>" );

					if ( GlobalFuncs.do_after( user, 40 / A.toolspeed, null, this ) ) {
						
						if ( this.state != 2 ) {
							return null;
						}
						user.WriteMsg( "<span class='notice'>You unsecure the support struts.</span>" );
						this.state = 1;
					}
				}
			} else if ( A is Obj_Item_Weapon_Wrench ) {
				
				if ( this.state == 3 ) {
					
					if ( !( this.loc is Tile_Simulated_Floor ) ) {
						user.WriteMsg( "<span class='warning'>A floor must be present to secure the girder!</span>" );
						return null;
					}
					GlobalFuncs.playsound( this.loc, "sound/items/ratchet.ogg", 100, 1 );
					user.WriteMsg( "<span class='notice'>You start securing the girder...</span>" );

					if ( GlobalFuncs.do_after( user, 40 / A.toolspeed, null, this ) ) {
						user.WriteMsg( "<span class='notice'>You secure the girder.</span>" );
						G = new Obj_Structure_Girder( this.loc );
						this.transfer_fingerprints_to( G );
						GlobalFuncs.qdel( this );
					}
				} else if ( this.state == 0 ) {
					GlobalFuncs.playsound( this.loc, "sound/items/ratchet.ogg", 100, 1 );
					user.WriteMsg( "<span class='notice'>You start unsecuring the girder...</span>" );

					if ( GlobalFuncs.do_after( user, 40 / A.toolspeed, null, this ) ) {
						user.WriteMsg( "<span class='notice'>You unsecure the girder.</span>" );
						D = new Obj_Structure_Girder_Displaced( this.loc );
						this.transfer_fingerprints_to( D );
						GlobalFuncs.qdel( this );
					}
				}
			} else if ( A is Obj_Item_Weapon_Gun_Energy_Plasmacutter ) {
				user.WriteMsg( "<span class='notice'>You start slicing apart the girder...</span>" );
				GlobalFuncs.playsound( this, "sound/items/welder.ogg", 100, 1 );

				if ( GlobalFuncs.do_after( user, 30, null, this ) ) {
					user.WriteMsg( "<span class='notice'>You slice apart the girder.</span>" );
					M2 = new Obj_Item_Stack_Sheet_Metal( this.loc, 2 );
					M2.add_fingerprint( user );
					GlobalFuncs.qdel( this );
				}
			} else if ( A is Obj_Item_Weapon_Pickaxe_Drill_Jackhammer ) {
				D2 = A;
				user.WriteMsg( "<span class='notice'>You smash through the girder!</span>" );
				new Obj_Item_Stack_Sheet_Metal( GlobalFuncs.get_turf( this ) );
				((Obj_Item_Weapon_Pickaxe)D2).playDigSound();
				GlobalFuncs.qdel( this );
			} else if ( A is Obj_Item_Weapon_Wirecutters && this.state == 1 ) {
				GlobalFuncs.playsound( this.loc, "sound/items/Wirecutter.ogg", 100, 1 );
				user.WriteMsg( "<span class='notice'>You start removing support struts...</span>" );

				if ( GlobalFuncs.do_after( user, 40 / A.toolspeed, null, this ) ) {
					user.WriteMsg( "<span class='notice'>You remove the support struts.</span>" );
					new Obj_Item_Stack_Sheet_Plasteel( GlobalFuncs.get_turf( this ) );
					G2 = new Obj_Structure_Girder( this.loc );
					this.transfer_fingerprints_to( G2 );
					GlobalFuncs.qdel( this );
				}
			} else if ( A is Obj_Item_Stack ) {
				
				if ( this.loc is Tile_Simulated_Wall ) {
					user.WriteMsg( "<span class='warning'>There is already a wall present!</span>" );
					return null;
				}

				if ( !( this.loc is Tile_Simulated_Floor ) ) {
					user.WriteMsg( "<span class='warning'>A floor must be present to build a false wall!</span>" );
					return null;
				}

				if ( Lang13.Bool( Lang13.FindIn( typeof(Obj_Structure_Falsewall), this.loc.contents ) ) ) {
					user.WriteMsg( "<span class='warning'>There is already a false wall present!</span>" );
					return null;
				}

				if ( A is Obj_Item_Stack_Rods ) {
					S = A;

					if ( this.state == 3 ) {
						
						if ( Convert.ToDouble( S.amount ) < 2 ) {
							user.WriteMsg( "<span class='warning'>You need at least two rods to create a false wall!</span>" );
							return null;
						}
						user.WriteMsg( "<span class='notice'>You start building a reinforced false wall...</span>" );

						if ( GlobalFuncs.do_after( user, 20, null, this ) ) {
							
							if ( !( this.loc != null ) || !Lang13.Bool( S ) || Convert.ToDouble( S.amount ) < 2 ) {
								return null;
							}
							((Obj_Item_Stack)S).use( 2 );
							user.WriteMsg( "<span class='notice'>You create a false wall. Push on it to open or close the passage.</span>" );
							FW = new Obj_Structure_Falsewall_Iron( this.loc );
							this.transfer_fingerprints_to( FW );
							GlobalFuncs.qdel( this );
						}
					} else {
						
						if ( Convert.ToDouble( S.amount ) < 5 ) {
							user.WriteMsg( "<span class='warning'>You need at least five rods to add plating!</span>" );
							return null;
						}
						user.WriteMsg( "<span class='notice'>You start adding plating...</span>" );

						if ( GlobalFuncs.do_after( user, 40, null, this ) ) {
							
							if ( !( this.loc != null ) || !Lang13.Bool( S ) || Convert.ToDouble( S.amount ) < 5 ) {
								return null;
							}
							((Obj_Item_Stack)S).use( 5 );
							user.WriteMsg( "<span class='notice'>You add the plating.</span>" );
							T = GlobalFuncs.get_turf( this );
							((Tile)T).ChangeTurf( typeof(Tile_Simulated_Wall_Mineral_Iron) );
							this.transfer_fingerprints_to( T );
							GlobalFuncs.qdel( this );
						}
						return null;
					}
				}

				if ( !( A is Obj_Item_Stack_Sheet ) ) {
					return null;
				}
				S2 = A;

				switch ((Type)( S2.type )) {
					case typeof(Obj_Item_Stack_Sheet_Metal):
					case typeof(Obj_Item_Stack_Sheet_Metal_Cyborg):
						
						if ( this.state == 3 ) {
							
							if ( ( ((Obj_Item_Stack)S2).get_amount() ??0) < 2 ) {
								user.WriteMsg( "<span class='warning'>You need two sheets of metal to create a false wall!</span>" );
								return null;
							}
							user.WriteMsg( "<span class='notice'>You start building a false wall...</span>" );

							if ( GlobalFuncs.do_after( user, 20, null, this ) ) {
								
								if ( !( this.loc != null ) || !Lang13.Bool( S2 ) || ( ((Obj_Item_Stack)S2).get_amount() ??0) < 2 ) {
									return null;
								}
								((Obj_Item_Stack)S2).use( 2 );
								user.WriteMsg( "<span class='notice'>You create a false wall. Push on it to open or close the passage.</span>" );
								F = new Obj_Structure_Falsewall( this.loc );
								this.transfer_fingerprints_to( F );
								GlobalFuncs.qdel( this );
							}
						} else {
							
							if ( ( ((Obj_Item_Stack)S2).get_amount() ??0) < 2 ) {
								user.WriteMsg( "<span class='warning'>You need two sheets of metal to finish a wall!</span>" );
								return null;
							}
							user.WriteMsg( "<span class='notice'>You start adding plating...</span>" );

							if ( GlobalFuncs.do_after( user, 40, null, this ) ) {
								
								if ( this.loc == null || ( ((Obj_Item_Stack)S2).get_amount() ??0) < 2 ) {
									return null;
								}
								((Obj_Item_Stack)S2).use( 2 );
								user.WriteMsg( "<span class='notice'>You add the plating.</span>" );
								T2 = GlobalFuncs.get_turf( this );
								((Tile)T2).ChangeTurf( typeof(Tile_Simulated_Wall) );
								this.transfer_fingerprints_to( T2 );
								GlobalFuncs.qdel( this );
							}
							return null;
						}
						break;
					case typeof(Obj_Item_Stack_Sheet_Plasteel):
						
						if ( this.state == 3 ) {
							
							if ( Convert.ToDouble( S2.amount ) < 2 ) {
								user.WriteMsg( "<span class='warning'>You need at least two sheets to create a false wall!</span>" );
								return null;
							}
							user.WriteMsg( "<span class='notice'>You start building a reinforced false wall...</span>" );

							if ( GlobalFuncs.do_after( user, 20, null, this ) ) {
								
								if ( !( this.loc != null ) || !Lang13.Bool( S2 ) || Convert.ToDouble( S2.amount ) < 2 ) {
									return null;
								}
								((Obj_Item_Stack)S2).use( 2 );
								user.WriteMsg( "<span class='notice'>You create a reinforced false wall. Push on it to open or close the passage.</span>" );
								FW2 = new Obj_Structure_Falsewall_Reinforced( this.loc );
								this.transfer_fingerprints_to( FW2 );
								GlobalFuncs.qdel( this );
							}
						} else if ( this.state == 2 ) {
							
							if ( Convert.ToDouble( S2.amount ) < 1 ) {
								return null;
							}
							user.WriteMsg( "<span class='notice'>You start finalizing the reinforced wall...</span>" );

							if ( GlobalFuncs.do_after( user, 50, null, this ) ) {
								
								if ( !( this.loc != null ) || !Lang13.Bool( S2 ) || Convert.ToDouble( S2.amount ) < 1 ) {
									return null;
								}
								((Obj_Item_Stack)S2).use( 1 );
								user.WriteMsg( "<span class='notice'>You fully reinforce the wall.</span>" );
								T3 = GlobalFuncs.get_turf( this );
								((Tile)T3).ChangeTurf( typeof(Tile_Simulated_Wall_RWall) );
								this.transfer_fingerprints_to( T3 );
								GlobalFuncs.qdel( this );
							}
							return null;
						} else {
							
							if ( Convert.ToDouble( S2.amount ) < 1 ) {
								return null;
							}
							user.WriteMsg( "<span class='notice'>You start reinforcing the girder...</span>" );

							if ( GlobalFuncs.do_after( user, 60, null, this ) ) {
								
								if ( !( this.loc != null ) || !Lang13.Bool( S2 ) || Convert.ToDouble( S2.amount ) < 1 ) {
									return null;
								}
								((Obj_Item_Stack)S2).use( 1 );
								user.WriteMsg( "<span class='notice'>You reinforce the girder.</span>" );
								R = new Obj_Structure_Girder_Reinforced( this.loc );
								this.transfer_fingerprints_to( R );
								GlobalFuncs.qdel( this );
							}
							return null;
						}
						break;
				}

				if ( Lang13.Bool( S2.sheettype ) ) {
					M3 = S2.sheettype;

					if ( this.state == 3 ) {
						
						if ( Convert.ToDouble( S2.amount ) < 2 ) {
							user.WriteMsg( "<span class='warning'>You need at least two sheets to create a false wall!</span>" );
							return null;
						}
						((Obj_Item_Stack)S2).use( 2 );
						user.WriteMsg( "<span class='notice'>You create a false wall. Push on it to open or close the passage.</span>" );
						F2 = Lang13.FindClass( "/obj/structure/falsewall/" + M3 );
						FW3 = Lang13.Call( F2, this.loc );
						this.transfer_fingerprints_to( FW3 );
						GlobalFuncs.qdel( this );
					} else {
						
						if ( Convert.ToDouble( S2.amount ) < 2 ) {
							user.WriteMsg( "<span class='warning'>You need at least two sheets to add plating!</span>" );
							return null;
						}
						user.WriteMsg( "<span class='notice'>You start adding plating...</span>" );

						if ( GlobalFuncs.do_after( user, 40, null, this ) ) {
							
							if ( !( this.loc != null ) || !Lang13.Bool( S2 ) || Convert.ToDouble( S2.amount ) < 2 ) {
								return null;
							}
							((Obj_Item_Stack)S2).use( 2 );
							user.WriteMsg( "<span class='notice'>You add the plating.</span>" );
							T4 = GlobalFuncs.get_turf( this );
							((Tile)T4).ChangeTurf( Lang13.FindClass( "/turf/simulated/wall/mineral/" + M3 ) );
							this.transfer_fingerprints_to( T4 );
							GlobalFuncs.qdel( this );
						}
						return null;
					}
				}
				this.add_hiddenprint( user );
			} else if ( A is Obj_Item_Pipe ) {
				P = A;

				if ( new ByTable(new object [] { 0, 1, 5 }).Contains( P.pipe_type ) ) {
					
					if ( !Lang13.Bool( user.drop_item() ) ) {
						return null;
					}
					P.loc = this.loc;
					user.WriteMsg( new Txt( "<span class='notice'>You fit the pipe into " ).the( this ).item().str( ".</span>" ).ToString() );
				}
			} else {
				base.attackby( (object)(A), (object)(user), _params, silent, replace_spent );
			}
			return null;
		}

	}

}