// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Structure_Alien_Egg : Obj_Structure_Alien {

		public double health = 100;
		public int status = 2;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.anchored = 1;
			this.icon_state = "egg_growing";
			this.layer = 4;
		}

		// Function from file: aliens.dm
		public Obj_Structure_Alien_Egg ( dynamic loc = null ) : base( (object)(loc) ) {
			new Obj_Item_Clothing_Mask_Facehugger( this );
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			Task13.Schedule( Rand13.Int( 1800, 3000 ), (Task13.Closure)(() => {
				this.Grow();
				return;
			}));
			return;
		}

		// Function from file: aliens.dm
		public override bool HasProximity( dynamic AM = null ) {
			dynamic C = null;

			
			if ( this.status == 3 ) {
				
				if ( !GlobalFuncs.CanHug( AM ) ) {
					return false;
				}
				C = AM;

				if ( Lang13.Bool( C.stat ) == false && Lang13.Bool( ((Mob)C).getorgan( typeof(Obj_Item_Organ_Internal_BodyEgg_AlienEmbryo) ) ) ) {
					return false;
				}
				this.Burst( false );
			}
			return false;
		}

		// Function from file: aliens.dm
		public override dynamic temperature_expose( GasMixture air = null, dynamic exposed_temperature = null, int? exposed_volume = null ) {
			
			if ( Convert.ToDouble( exposed_temperature ) > 500 ) {
				this.health -= 5;
				this.healthcheck();
			}
			return null;
		}

		// Function from file: aliens.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			dynamic damage = null;
			dynamic WT = null;

			
			if ( Lang13.Bool( A.attack_verb.len ) ) {
				this.visible_message( "<span class='danger'>" + user + " has " + Rand13.PickFromTable( A.attack_verb ) + " " + this + " with " + A + "!</span>" );
			} else {
				this.visible_message( "<span class='danger'>" + user + " has attacked " + this + " with " + A + "!</span>" );
			}
			damage = A.force / 4;

			if ( A is Obj_Item_Weapon_Weldingtool ) {
				WT = A;

				if ( ((Obj_Item_Weapon_Weldingtool)WT).remove_fuel( 0, user ) ) {
					damage = 15;
					GlobalFuncs.playsound( this.loc, "sound/items/welder.ogg", 100, 1 );
				}
			}
			this.health -= Convert.ToDouble( damage );
			((Mob)user).changeNext_move( 8 );
			this.healthcheck();
			return null;
		}

		// Function from file: aliens.dm
		public override dynamic bullet_act( dynamic P = null, dynamic def_zone = null ) {
			this.health -= Convert.ToDouble( P.damage );
			base.bullet_act( (object)(P), (object)(def_zone) );
			this.healthcheck();
			return null;
		}

		// Function from file: aliens.dm
		public void healthcheck(  ) {
			
			if ( this.health <= 0 ) {
				
				if ( this.status != 0 && this.status != 1 ) {
					this.Burst();
				} else if ( this.status == 0 && Rand13.PercentChance( 50 ) ) {
					GlobalFuncs.qdel( this );
				}
			}
			return;
		}

		// Function from file: aliens.dm
		public void Burst( bool? kill = null ) {
			kill = kill ?? true;

			dynamic child = null;
			dynamic M = null;

			
			if ( this.status == 3 || this.status == 2 ) {
				this.icon_state = "egg_hatched";
				Icon13.Flick( "egg_opening", this );
				this.status = 1;
				Task13.Schedule( 15, (Task13.Closure)(() => {
					this.status = 0;
					child = this.GetFacehugger();

					if ( Lang13.Bool( child ) ) {
						child.loc = GlobalFuncs.get_turf( this );

						if ( kill == true && child is Obj_Item_Clothing_Mask_Facehugger ) {
							((Obj_Item_Clothing_Mask_Facehugger)child).Die();
						} else {
							
							foreach (dynamic _a in Lang13.Enumerate( Map13.FetchInRange( this, 1 ) )) {
								M = _a;
								

								if ( GlobalFuncs.CanHug( M ) ) {
									((Obj_Item_Clothing_Mask_Facehugger)child).Attach( M );
									break;
								}
							}
						}
					}
					return;
				}));
			}
			return;
		}

		// Function from file: aliens.dm
		public void Grow(  ) {
			this.icon_state = "egg";
			this.status = 3;
			return;
		}

		// Function from file: aliens.dm
		public dynamic GetFacehugger(  ) {
			return Lang13.FindIn( typeof(Obj_Item_Clothing_Mask_Facehugger), this.contents );
		}

		// Function from file: aliens.dm
		public override dynamic attack_hand( dynamic a = null, bool? b = null, bool? c = null ) {
			
			if ( Lang13.Bool( ((Mob)a).getorgan( typeof(Obj_Item_Organ_Internal_Alien_Plasmavessel) ) ) ) {
				
				switch ((int)( this.status )) {
					case 0:
						a.WriteMsg( "<span class='notice'>You clear the hatched egg.</span>" );
						GlobalFuncs.playsound( this.loc, "sound/effects/attackblob.ogg", 100, 1 );
						GlobalFuncs.qdel( this );
						return null;
						break;
					case 2:
						a.WriteMsg( "<span class='notice'>The child is not developed yet.</span>" );
						return null;
						break;
					case 3:
						a.WriteMsg( "<span class='notice'>You retrieve the child.</span>" );
						this.Burst( false );
						return null;
						break;
				}
			} else {
				a.WriteMsg( "<span class='notice'>It feels slimy.</span>" );
				((Mob)a).changeNext_move( 8 );
			}
			return null;
		}

		// Function from file: aliens.dm
		public override dynamic attack_paw( dynamic a = null, dynamic b = null, dynamic c = null ) {
			return this.attack_hand( a );
		}

	}

}