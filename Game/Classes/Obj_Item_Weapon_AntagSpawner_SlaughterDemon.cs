// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_AntagSpawner_SlaughterDemon : Obj_Item_Weapon_AntagSpawner {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.icon = "icons/obj/wizard.dmi";
			this.icon_state = "vial";
		}

		public Obj_Item_Weapon_AntagSpawner_SlaughterDemon ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: tgstation.dme
		public override void spawn_antag( dynamic C = null, dynamic T = null, string type = null ) {
			type = type ?? "";

			dynamic holder = null;
			Mob_Living_SimpleAnimal_Slaughter S = null;
			dynamic new_objective = null;
			Objective new_objective2 = null;

			holder = GlobalFuncs.PoolOrNew( typeof(Obj_Effect_Dummy_Slaughter), T );
			S = new Mob_Living_SimpleAnimal_Slaughter( holder );
			S.holder = holder;
			S.key = C.key;
			S.mind.assigned_role = "Slaughter Demon";
			S.mind.special_role = "Slaughter Demon";
			GlobalVars.ticker.mode.traitors.Add( S.mind );
			new_objective = GlobalFuncs.add_objective( S.mind, typeof(Objective_Default_Assassinate) );
			new_objective.target = Task13.User.mind;
			new_objective.explanation_text = "Kill " + Task13.User.real_name + ", the one who summoned you.";
			new_objective2 = new Objective();
			new_objective2.owner = S.mind;
			new_objective2.explanation_text = "Kill everyone else while you're at it.";
			S.mind.objectives.Add( new_objective2 );
			S.WriteMsg( S.playstyle_string );
			S.WriteMsg( "<B>You are currently not currently in the same plane of existence as the station. Ctrl+Click a blood pool to manifest.</B>" );
			S.WriteMsg( "<B>Objective #" + 1 + "</B>: " + new_objective.explanation_text );
			S.WriteMsg( "<B>Objective #" + 2 + "</B>: " + new_objective2.explanation_text );
			return;
		}

		// Function from file: antag_spawner.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			ByTable demon_candidates = null;
			dynamic C = null;

			demon_candidates = GlobalFuncs.get_candidates( "xenomorph" );

			if ( Lang13.Bool( user.z ) != true ) {
				user.WriteMsg( "<span class='notice'>You should probably wait until you reach the station.</span>" );
				return null;
			}

			if ( demon_candidates.len > 0 ) {
				this.used = true;
				C = Rand13.PickFromTable( demon_candidates );
				this.spawn_antag( C, GlobalFuncs.get_turf( this.loc ), "Slaughter Demon" );
				user.WriteMsg( "<span class='notice'>You shatter the bottle, no turning back now!</span>" );
				user.WriteMsg( "<span class='notice'>You sense a dark presence lurking just beyond the veil...</span>" );
				GlobalFuncs.playsound( user.loc, "sound/effects/Glassbr1.ogg", 100, 1 );
				GlobalFuncs.qdel( this );
			} else {
				user.WriteMsg( "<span class='notice'>You can't seem to work up the nerve to shatter the bottle. Perhaps you should try again later.</span>" );
			}
			return null;
		}

	}

}