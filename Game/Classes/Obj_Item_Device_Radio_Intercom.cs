// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Device_Radio_Intercom : Obj_Item_Device_Radio {

		public bool number = false;
		public bool anyai = true;
		public ByTable ai = new ByTable();
		public int last_tick = 0;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.anchored = 1;
			this.w_class = 4;
			this.canhear_range = 2;
			this.icon_state = "intercom";
		}

		// Function from file: intercom.dm
		public Obj_Item_Device_Radio_Intercom ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			GlobalVars.SSobj.processing.Add( this );
			return;
		}

		// Function from file: intercom.dm
		public override bool rejects_blood(  ) {
			return true;
		}

		// Function from file: intercom.dm
		public override int? process( dynamic seconds = null ) {
			Ent_Static A = null;

			
			if ( Game13.timeofday - this.last_tick > 30 || Game13.timeofday - this.last_tick < 0 ) {
				this.last_tick = Game13.timeofday;

				if ( !( this.loc != null ) ) {
					this.on = 0;
				} else {
					A = this.loc.loc;

					if ( !( A != null ) || !( A is Zone ) || !Lang13.Bool( ((dynamic)A).master ) || this.emped != 0 ) {
						this.on = 0;
					} else {
						this.on = ((dynamic)A).master.powered( 1 );
					}
				}

				if ( !Lang13.Bool( this.on ) ) {
					this.icon_state = "intercom-p";
				} else {
					this.icon_state = "intercom";
				}
			}
			return null;
		}

		// Function from file: intercom.dm
		public override string Hear( string message = null, dynamic speaker = null, int message_langs = 0, dynamic raw_message = null, dynamic radio_freq = null, ByTable spans = null ) {
			
			if ( !this.anyai && !this.ai.Contains( speaker ) ) {
				return null;
			}
			base.Hear( message, (object)(speaker), message_langs, (object)(raw_message), (object)(radio_freq), spans );
			return null;
		}

		// Function from file: intercom.dm
		public override int receive_range( dynamic freq = null, dynamic level = null, bool? AIuser = null ) {
			dynamic position = null;

			
			if ( !Lang13.Bool( this.on ) ) {
				return -1;
			}

			if ( this.isWireCut( GlobalVars.WIRE_RECEIVE ) != 0 ) {
				return -1;
			}

			if ( !Lang13.Bool( level.Contains( 0 ) ) ) {
				position = GlobalFuncs.get_turf( this );

				if ( position == null || !Lang13.Bool( level.Contains( position.z ) ) ) {
					return -1;
				}
			}

			if ( !Lang13.Bool( this.listening ) ) {
				return -1;
			}

			if ( freq == GlobalVars.SYND_FREQ ) {
				
				if ( !this.syndie ) {
					return -1;
				}
			}
			return this.canhear_range;
		}

		// Function from file: intercom.dm
		public override dynamic attack_hand( dynamic a = null, bool? b = null, bool? c = null ) {
			this.add_fingerprint( a );
			this.attack_self( a );
			return null;
		}

		// Function from file: intercom.dm
		public override dynamic attack_paw( dynamic a = null, dynamic b = null, dynamic c = null ) {
			return this.attack_hand( a );
		}

		// Function from file: intercom.dm
		public override dynamic attack_ai( dynamic user = null ) {
			this.add_fingerprint( user );
			this.attack_self( user );
			return null;
		}

		// Function from file: intercom.dm
		public override dynamic Destroy(  ) {
			GlobalVars.SSobj.processing.Remove( this );
			return base.Destroy();
		}

	}

}