// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_C4 : Obj_Item_Weapon {

		public Wires_Explosive_C4 wires = null;
		public dynamic timer = 10;
		public dynamic target = null;
		public bool open_panel = false;
		public Image image_overlay = null;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.item_state = "plasticx";
			this.flags = 4;
			this.w_class = 2;
			this.origin_tech = "syndicate=2";
			this.icon = "icons/obj/assemblies.dmi";
			this.icon_state = "plastic-explosive0";
		}

		// Function from file: explosives.dm
		public Obj_Item_Weapon_C4 ( dynamic loc = null ) : base( (object)(loc) ) {
			this.wires = new Wires_Explosive_C4( this );
			this.image_overlay = new Image( "icons/obj/assemblies.dmi", "plastic-explosive2" );
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			return;
		}

		// Function from file: explosives.dm
		public override bool attack( dynamic M = null, dynamic user = null, bool? def_zone = null ) {
			return false;
		}

		// Function from file: explosives.dm
		public void explode(  ) {
			dynamic location = null;

			
			if ( GlobalFuncs.qdeleted( this ) ) {
				return;
			}

			if ( Lang13.Bool( this.target ) ) {
				
				if ( !GlobalFuncs.qdeleted( this.target ) ) {
					location = GlobalFuncs.get_turf( this.target );
					this.target.overlays -= this.image_overlay;
				}
			} else {
				location = GlobalFuncs.get_turf( this );
			}

			if ( Lang13.Bool( location ) ) {
				((Ent_Static)location).ex_act( 2, this.target );
				GlobalFuncs.explosion( location, 0, 0, 3 );
			}
			GlobalFuncs.qdel( this );
			return;
		}

		// Function from file: explosives.dm
		public override bool afterattack( dynamic target = null, dynamic user = null, bool? proximity_flag = null, string click_parameters = null ) {
			
			if ( !( proximity_flag == true ) ) {
				return false;
			}

			if ( target is Mob || target is Obj_Item_Weapon_Storage ) {
				return false;
			}

			if ( this.loc == target ) {
				return false;
			}
			user.WriteMsg( "<span class='notice'>You start planting the bomb...</span>" );

			if ( GlobalFuncs.do_after( user, 50, null, target ) ) {
				
				if ( !((Mob)user).unEquip( this ) ) {
					return false;
				}
				this.target = target;
				this.loc = null;
				GlobalFuncs.message_admins( new Txt().item( GlobalFuncs.key_name_admin( user ) ).str( "(<A HREF='?_src_=holder;adminmoreinfo=" ).Ref( user ).str( "'>?</A>) (<A HREF='?_src_=holder;adminplayerobservefollow=" ).Ref( user ).str( "'>FLW</A>) planted " ).item( this.name ).str( " on " ).item( this.target.name ).str( " at (" ).item( this.target.x ).str( "," ).item( this.target.y ).str( "," ).item( this.target.z ).str( " - <A HREF='?_src_=holder;adminplayerobservecoodjump=1;X=" ).item( this.target.x ).str( ";Y=" ).item( this.target.y ).str( ";Z=" ).item( this.target.z ).str( "'>JMP</a>) with " ).item( this.timer ).str( " second fuse" ).ToString() );
				GlobalFuncs.log_game( "" + GlobalFuncs.key_name( user ) + " planted " + this.name + " on " + this.target.name + " at (" + this.target.x + "," + this.target.y + "," + this.target.z + ") with " + this.timer + " second fuse" );
				this.target.overlays += this.image_overlay;
				user.WriteMsg( "<span class='notice'>You plant the bomb. Timer counting down from " + this.timer + ".</span>" );
				Task13.Schedule( Convert.ToInt32( this.timer * 10 ), (Task13.Closure)(() => {
					this.explode();
					return;
				}));
			}
			return false;
		}

		// Function from file: explosives.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			dynamic newtime = null;

			newtime = Interface13.Input( Task13.User, "Please set the timer.", "Timer", 10, null, InputType.Num );

			if ( ((Mob)user).get_active_hand() == this ) {
				newtime = Num13.MaxInt( 10, Num13.MinInt( Convert.ToInt32( newtime ), 60000 ) );
				this.timer = newtime;
				user.WriteMsg( "Timer set for " + this.timer + " seconds." );
			}
			return null;
		}

		// Function from file: explosives.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			
			if ( A is Obj_Item_Weapon_Screwdriver ) {
				this.open_panel = !this.open_panel;
				user.WriteMsg( "<span class='notice'>You " + ( this.open_panel ? "open" : "close" ) + " the wire panel.</span>" );
			} else if ( this.wires.IsInteractionTool( A ) ) {
				this.wires.Interact( user );
			} else {
				base.attackby( (object)(A), (object)(user), _params, silent, replace_spent );
			}
			return null;
		}

		// Function from file: explosives.dm
		public override int suicide_act( Mob_Living_Carbon_Human user = null ) {
			string message_say = null;
			string role = null;

			user.visible_message( new Txt( "<span class='suicide'>" ).item( user ).str( " activates the " ).item( this.name ).str( " and holds it above " ).his_her_its_their().str( " head! It looks like " ).he_she_it_they().str( "'s going out with a bang!</span>" ).ToString() );
			message_say = "FOR NO RAISIN!";

			if ( user.mind != null ) {
				
				if ( Lang13.Bool( user.mind.special_role ) ) {
					role = String13.ToLower( user.mind.special_role );

					if ( role == "traitor" || role == "syndicate" ) {
						message_say = "FOR THE SYNDICATE!";
					} else if ( role == "changeling" ) {
						message_say = "FOR THE HIVE!";
					} else if ( role == "cultist" ) {
						message_say = "FOR NAR-SIE!";
					} else if ( role == "revolutionary" || role == "head revolutionary" ) {
						message_say = "VIVA LA REVOLUTION!";
					} else if ( Lang13.Bool( user.mind.gang_datum ) ) {
						message_say = "" + String13.ToUpper( user.mind.gang_datum.name ) + " RULES!";
					}
				}
			}
			user.say( message_say );
			this.target = user;
			GlobalFuncs.message_admins( new Txt().item( GlobalFuncs.key_name_admin( user ) ).str( "(<A HREF='?_src_=holder;adminmoreinfo=" ).Ref( user ).str( "'>?</A>) (<A HREF='?_src_=holder;adminplayerobservefollow=" ).Ref( user ).str( "'>FLW</A>) suicided with " ).item( this.name ).str( " at (" ).item( this.x ).str( "," ).item( this.y ).str( "," ).item( this.z ).str( " - <A HREF='?_src_=holder;adminplayerobservecoodjump=1;X=" ).item( this.x ).str( ";Y=" ).item( this.y ).str( ";Z=" ).item( this.z ).str( "'>JMP</a>)" ).ToString() );
			GlobalFuncs.message_admins( "" + GlobalFuncs.key_name( user ) + " suicided with " + this.name + " at (" + this.x + "," + this.y + "," + this.z + ")" );
			Task13.Sleep( 10 );
			this.explode(  );
			user.gib();
			return 0;
		}

		// Function from file: explosives.dm
		public override dynamic Destroy(  ) {
			GlobalFuncs.qdel( this.wires );
			this.wires = null;
			this.target = null;
			return base.Destroy();
		}

	}

}