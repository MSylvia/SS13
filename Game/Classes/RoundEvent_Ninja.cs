// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class RoundEvent_Ninja : RoundEvent {

		public bool success_spawn = false;
		public int helping_station = 0;
		public string key = null;
		public dynamic spawn_loc = null;
		public Mob_Living_Carbon_Human Ninja = null;

		// Function from file: ninja_event.dm
		public override bool start(  ) {
			ByTable spawn_locs = null;
			Obj_Effect_Landmark L = null;
			ByTable candidates = null;
			dynamic C = null;
			Mind Mind = null;
			ByTable possible_targets = null;
			Mind M = null;
			ByTable objectives = null;
			dynamic N = null;

			
			if ( !Lang13.Bool( this.spawn_loc ) ) {
				spawn_locs = new ByTable();

				foreach (dynamic _b in Lang13.Enumerate( GlobalVars.landmarks_list, typeof(Obj_Effect_Landmark) )) {
					L = _b;
					

					if ( L.loc is Tile ) {
						
						switch ((string)( L.name )) {
							case "ninjaspawn":
							case "carpspawn":
								spawn_locs.Add( L.loc );
								break;
						}
					}
				}

				if ( !( spawn_locs.len != 0 ) ) {
					this.kill(); return false;
				}
				this.spawn_loc = Rand13.PickFromTable( spawn_locs );
			}

			if ( !Lang13.Bool( this.spawn_loc ) ) {
				this.kill(); return false;
			}

			if ( !Lang13.Bool( this.key ) ) {
				candidates = GlobalFuncs.get_candidates( "space ninja" );

				if ( !( candidates.len != 0 ) ) {
					this.kill(); return false;
				}
				C = Rand13.PickFromTable( candidates );
				this.key = C.key;
			}

			if ( !Lang13.Bool( this.key ) ) {
				this.kill(); return false;
			}
			Mind = GlobalFuncs.create_ninja_mind( this.key );
			Mind.active = true;
			possible_targets = new ByTable();

			foreach (dynamic _c in Lang13.Enumerate( GlobalVars.ticker.minds, typeof(Mind) )) {
				M = _c;
				

				if ( Lang13.Bool( M.current ) && Convert.ToInt32( M.current.stat ) != 2 ) {
					
					if ( M.current is Mob_Living_Carbon_Human ) {
						
						if ( Lang13.Bool( M.special_role ) ) {
							possible_targets[M] = 0;
						} else if ( GlobalVars.command_positions.Contains( M.assigned_role ) ) {
							possible_targets[M] = 1;
						}
					}
				}
			}
			objectives = new ByTable(new object [] { 1, 2, 3, 4 });

			while (Mind.objectives.len < 6) {
				
				dynamic _d = GlobalFuncs.pick_n_take( objectives ); // Was a switch-case, sorry for the mess.
				if ( _d==1 ) {
					GlobalFuncs.add_objective( Mind, typeof(Objective_Download) );
				} else if ( _d==2 ) {
					GlobalFuncs.add_objective( Mind, typeof(Objective_Default_Steal_Special) );
				} else if ( _d==3 ) {
					
					if ( Rand13.PercentChance( 50 ) ) {
						GlobalFuncs.add_objective( Mind, typeof(Objective_Default_Assassinate) );
					} else {
						GlobalFuncs.add_objective( Mind, typeof(Objective_Default_Protect) );
					}
				} else if ( _d==4 ) {
					
					if ( Rand13.PercentChance( 50 ) ) {
						GlobalFuncs.add_objective( Mind, typeof(Objective_Default_Debrain) );
					} else {
						GlobalFuncs.add_objective( Mind, typeof(Objective_Capture) );
					}
				} else {
					break;
				}
			}
			GlobalFuncs.add_objective( Mind, typeof(Objective_EscapeObj_Survive) );
			Mind.store_memory( "I am an elite mercenary assassin of the mighty Spider Clan. A <font color='red'><B>SPACE NINJA</B></font>!" );
			Mind.store_memory( "Suprise is my weapon. Shadows are my armor. Without them, I am nothing. (//initialize your suit by right clicking on it, to use abilities like stealth)!" );
			Mind.store_memory( "Officially, " + ( this.helping_station != 0 ? "Nanotrasen" : "The Syndicate" ) + " are my employer." );
			this.Ninja = GlobalFuncs.create_space_ninja( this.spawn_loc );
			Mind.transfer_to( this.Ninja );

			if ( this.Ninja.wear_suit is Obj_Item_Clothing_Suit_Space_SpaceNinja ) {
				N = this.Ninja.wear_suit;
				((Obj_Item_Clothing_Suit_Space_SpaceNinja)N).randomize_param();
			}
			this.Ninja.v_internal = this.Ninja.s_store;

			if ( this.Ninja.internals != null ) {
				this.Ninja.internals.icon_state = "internal1";
			}

			if ( this.Ninja.mind != Mind ) {
				throw new Exception( "Ninja created with incorrect mind" );
				return false;
			}
			this.Ninja.WriteMsg( new Sound( "sound/effects/ninja_greeting.ogg" ) );
			this.success_spawn = true;
			return false;
		}

		// Function from file: ninja_event.dm
		public override void kill(  ) {
			
			if ( !this.success_spawn && this.control != null ) {
				this.control.occurrences--;
			}
			base.kill(); return;
		}

		// Function from file: ninja_event.dm
		public override void setup( int? loop = null ) {
			this.helping_station = Rand13.Int( 0, 1 );
			return;
		}

	}

}