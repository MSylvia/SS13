// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Effect_Golemrune : Obj_Effect {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.anchored = 1;
			this.unacidable = true;
			this.icon = "icons/obj/rune.dmi";
			this.icon_state = "golem";
		}

		// Function from file: xenobiology.dm
		public Obj_Effect_Golemrune ( dynamic loc = null ) : base( (object)(loc) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			GlobalVars.SSobj.processing.Or( this );
			return;
		}

		// Function from file: xenobiology.dm
		public override dynamic attack_hand( dynamic a = null, bool? b = null, bool? c = null ) {
			Mob_Dead_Observer ghost = null;
			Mob_Dead_Observer O = null;
			Mob_Living_Carbon_Human G = null;

			
			foreach (dynamic _a in Lang13.Enumerate( this.loc, typeof(Mob_Dead_Observer) )) {
				O = _a;
				

				if ( !( O.client != null ) ) {
					continue;
				}

				if ( O.mind != null && Lang13.Bool( O.mind.current ) && Convert.ToInt32( O.mind.current.stat ) != 2 ) {
					continue;
				}

				if ( Lang13.Bool( O.orbiting ) ) {
					continue;
				}
				ghost = O;
				break;
			}

			if ( !( ghost != null ) ) {
				a.WriteMsg( "<span class='warning'>The rune fizzles uselessly! There is no spirit nearby.</span>" );
				return null;
			}
			G = new Mob_Living_Carbon_Human();
			G.set_species( typeof(Species_Golem_Adamantine) );
			G.set_cloned_appearance();
			G.real_name = "Adamantine Golem (" + Rand13.Int( 1, 1000 ) + ")";
			G.name = G.real_name;
			G.dna.unique_enzymes = G.dna.generate_unique_enzymes();
			((Species)G.dna.species).auto_equip( G );
			G.loc = this.loc;
			G.key = ghost.key;
			G.WriteMsg( "You are an adamantine golem. You move slowly, but are highly resistant to heat and cold as well as blunt trauma. You are unable to wear clothes, but can still use most tools. Serve " + a + ", and assist them in completing their goals at any cost." );
			G.mind.store_memory( "<b>Serve " + a.real_name + ", your creator.</b>" );

			if ( Lang13.Bool( a.mind.special_role ) ) {
				GlobalFuncs.message_admins( new Txt().item( GlobalFuncs.key_name_admin( G ) ).str( "(<A HREF='?_src_=holder;adminmoreinfo=" ).Ref( G ).str( "'>?</A>) has been summoned by " ).item( GlobalFuncs.key_name_admin( a ) ).str( "(<A HREF='?_src_=holder;adminmoreinfo=" ).Ref( a ).str( "'>?</A>), an antagonist." ).ToString() );
			}
			GlobalFuncs.log_game( "" + GlobalFuncs.key_name( G ) + " was made a golem by " + GlobalFuncs.key_name( a ) + "." );
			GlobalFuncs.log_admin( "" + GlobalFuncs.key_name( G ) + " was made a golem by " + GlobalFuncs.key_name( a ) + "." );
			GlobalFuncs.qdel( this );
			return null;
		}

		// Function from file: xenobiology.dm
		public override int? process( dynamic seconds = null ) {
			Mob_Dead_Observer ghost = null;
			Mob_Dead_Observer O = null;

			
			foreach (dynamic _a in Lang13.Enumerate( this.loc, typeof(Mob_Dead_Observer) )) {
				O = _a;
				

				if ( !( O.client != null ) ) {
					continue;
				}

				if ( O.mind != null && Lang13.Bool( O.mind.current ) && Convert.ToInt32( O.mind.current.stat ) != 2 ) {
					continue;
				}

				if ( Lang13.Bool( O.orbiting ) ) {
					continue;
				}
				ghost = O;
				break;
			}

			if ( ghost != null ) {
				this.icon_state = "golem2";
			} else {
				this.icon_state = "golem";
			}
			return null;
		}

	}

}