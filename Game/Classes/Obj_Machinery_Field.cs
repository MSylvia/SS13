// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Machinery_Field : Obj_Machinery {

		public bool hasShocked = false;

		public Obj_Machinery_Field ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: containment_field.dm
		public virtual void bump_field( dynamic AM = null ) {
			EffectSystem_SparkSpread s = null;
			dynamic target = null;

			s = new EffectSystem_SparkSpread();
			s.set_up( 5, 1, AM.loc );
			s.start();
			target = GlobalFuncs.get_edge_target_turf( AM, Map13.GetDistance( this, Map13.GetStepAway( AM, this, null ) ) );
			((Ent_Dynamic)AM).throw_at( target, 200, 4 );
			return;
		}

		// Function from file: containment_field.dm
		public virtual bool shock( dynamic user = null ) {
			double shock_damage = 0;
			double stun = 0;

			
			if ( this.hasShocked ) {
				return false;
			}

			if ( user is Mob_Living ) {
				this.hasShocked = true;
				shock_damage = Num13.MinInt( Rand13.Int( 30, 40 ), Rand13.Int( 30, 40 ) );

				if ( user is Mob_Living_Carbon ) {
					stun = Num13.MinInt( ((int)( shock_damage )), 15 );
					((Mob)user).Stun( stun );
					((Mob)user).Weaken( 10 );
					((Mob_Living)user).electrocute_act( shock_damage, this, 1 );
					((Ent_Static)user).visible_message( "<span class='danger'>" + user.name + " was shocked by the " + this.name + "!</span>", "<span class='userdanger'>You feel a powerful shock course through your body, sending you flying!</span>", "<span class='italics'>You hear a heavy electrical crack.</span>" );
				} else if ( user is Mob_Living_Silicon ) {
					
					if ( Rand13.PercentChance( 20 ) ) {
						((Mob)user).Stun( 2 );
					}
					((Mob_Living)user).take_overall_damage( 0, shock_damage );
					((Ent_Static)user).visible_message( "<span class='danger'>" + user.name + " was shocked by the " + this.name + "!</span>", "<span class='userdanger'>Energy pulse detected, system damaged!</span>", "<span class='italics'>You hear an electrical crack.</span>" );
				}
				((Mob_Living)user).updatehealth();
				this.bump_field( user );
				Task13.Schedule( 5, (Task13.Closure)(() => {
					this.hasShocked = false;
					return;
				}));
			}
			return false;
		}

		// Function from file: containment_field.dm
		public override bool CanPass( dynamic mover = null, dynamic target = null, double? height = null, bool? air_group = null ) {
			height = height ?? 0;

			
			if ( mover is Mob_Living ) {
				this.shock( mover );
				return false;
			}
			return base.CanPass( (object)(mover), (object)(target), height, air_group );
		}

	}

}