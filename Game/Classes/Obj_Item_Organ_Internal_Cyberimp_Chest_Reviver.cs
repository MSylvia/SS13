// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Organ_Internal_Cyberimp_Chest_Reviver : Obj_Item_Organ_Internal_Cyberimp_Chest {

		public int revive_cost = 0;
		public bool reviving = false;
		public int cooldown = 0;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.implant_color = "#AD0000";
			this.origin_tech = "materials=6;programming=3;biotech=6;syndicate=4";
			this.slot = "heartdrive";
		}

		public Obj_Item_Organ_Internal_Cyberimp_Chest_Reviver ( dynamic M = null ) : base( (object)(M) ) {
			
		}

		// Function from file: augments_internal.dm
		public override double emp_act( int severity = 0 ) {
			dynamic H = null;

			
			if ( !Lang13.Bool( this.owner ) ) {
				return 0;
			}

			if ( this.reviving ) {
				this.revive_cost += 200;
			} else {
				this.cooldown += 200;
			}

			if ( this.owner is Mob_Living_Carbon_Human ) {
				H = this.owner;

				if ( Convert.ToInt32( H.stat ) != 2 && Rand13.PercentChance( ((int)( 50 / severity )) ) ) {
					H.heart_attack = true;
					Task13.Schedule( ((int)( 600 / severity )), (Task13.Closure)(() => {
						H.heart_attack = false;

						if ( Lang13.Bool( H.stat ) == false ) {
							H.WriteMsg( "<span class='notice'>You feel your heart beating again!</span>" );
						}
						return;
					}));
				}
			}
			return 0;
		}

		// Function from file: augments_internal.dm
		public override void on_life(  ) {
			
			if ( this.reviving ) {
				
				if ( Lang13.Bool( this.owner.stat ) == true ) {
					Task13.Schedule( 30, (Task13.Closure)(() => {
						
						if ( Rand13.PercentChance( 90 ) && Lang13.Bool( ((Mob_Living)this.owner).getOxyLoss() ) ) {
							((Mob_Living)this.owner).adjustOxyLoss( -3 );
							this.revive_cost += 5;
						}

						if ( Rand13.PercentChance( 75 ) && ((Mob_Living)this.owner).getBruteLoss() != 0 ) {
							((Mob_Living)this.owner).adjustBruteLoss( -1 );
							this.revive_cost += 20;
						}

						if ( Rand13.PercentChance( 75 ) && ((Mob_Living)this.owner).getFireLoss() != 0 ) {
							((Mob_Living)this.owner).adjustFireLoss( -1 );
							this.revive_cost += 20;
						}

						if ( Rand13.PercentChance( 40 ) && Lang13.Bool( ((Mob_Living)this.owner).getToxLoss() ) ) {
							((Mob_Living)this.owner).adjustToxLoss( -1 );
							this.revive_cost += 50;
						}
						return;
					}));
				} else {
					this.cooldown = this.revive_cost + Game13.time;
					this.reviving = false;
				}
				return;
			}

			if ( this.cooldown > Game13.time ) {
				return;
			}

			if ( Lang13.Bool( this.owner.stat ) != true ) {
				return;
			}

			if ( this.owner.suiciding ) {
				return;
			}
			this.revive_cost = 0;
			this.reviving = true;
			return;
		}

	}

}