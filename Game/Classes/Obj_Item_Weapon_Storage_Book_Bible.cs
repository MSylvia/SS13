// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Obj_Item_Weapon_Storage_Book_Bible : Obj_Item_Weapon_Storage_Book {

		public dynamic affecting = null;
		public string deity_name = "Christ";

		protected override void __FieldInit() {
			base.__FieldInit();

			this.icon_state = "bible";
		}

		public Obj_Item_Weapon_Storage_Book_Bible ( dynamic loc = null ) : base( (object)(loc) ) {
			
		}

		// Function from file: book.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			GlobalFuncs.playsound( this.loc, "rustle", 50, 1, -5 );
			base.attackby( (object)(A), (object)(user), _params, silent, replace_spent );
			return null;
		}

		// Function from file: book.dm
		public override bool afterattack( dynamic target = null, dynamic user = null, bool? proximity_flag = null, string click_parameters = null ) {
			Obj_Effect_Rune R = null;
			bool water2holy = false;
			bool unholy2clean = false;

			
			if ( !( proximity_flag == true ) ) {
				return false;
			}

			if ( target is Tile_Simulated_Floor ) {
				user.WriteMsg( "<span class='notice'>You hit the floor with the bible.</span>" );

				if ( Lang13.Bool( user.mind ) && user.mind.assigned_role == "Chaplain" ) {
					
					foreach (dynamic _a in Lang13.Enumerate( Map13.FetchInRangeExcludeThis( user, 2 ), typeof(Obj_Effect_Rune) )) {
						R = _a;
						
						R.invisibility = 0;
					}
				}
			}

			if ( Lang13.Bool( user.mind ) && user.mind.assigned_role == "Chaplain" ) {
				
				if ( Lang13.Bool( target.reagents ) && Lang13.Bool( ((Reagents)target.reagents).has_reagent( "water" ) ) ) {
					user.WriteMsg( "<span class='notice'>You bless " + target + ".</span>" );
					water2holy = ((Reagents)target.reagents).get_reagent_amount( "water" );
					((Reagents)target.reagents).del_reagent( "water" );
					target.reagents.add_reagent( "holywater", water2holy );
				}

				if ( Lang13.Bool( target.reagents ) && Lang13.Bool( ((Reagents)target.reagents).has_reagent( "unholywater" ) ) ) {
					user.WriteMsg( "<span class='notice'>You purify " + target + ".</span>" );
					unholy2clean = ((Reagents)target.reagents).get_reagent_amount( "unholywater" );
					((Reagents)target.reagents).del_reagent( "unholywater" );
					target.reagents.add_reagent( "holywater", unholy2clean );
				}
			}
			return false;
		}

		// Function from file: book.dm
		public override bool attack( dynamic M = null, dynamic user = null, bool? def_zone = null ) {
			bool chaplain = false;
			dynamic H = null;
			bool message_halt = false;
			Obj_Item_Organ_Limb affecting = null;

			chaplain = false;

			if ( Lang13.Bool( user.mind ) && user.mind.assigned_role == "Chaplain" ) {
				chaplain = true;
			}

			if ( !((Mob)user).IsAdvancedToolUser() ) {
				user.WriteMsg( "<span class='warning'>You don't have the dexterity to do this!</span>" );
				return false;
			}

			if ( !chaplain ) {
				user.WriteMsg( "<span class='danger'>The book sizzles in your hands.</span>" );
				((Mob_Living)user).take_organ_damage( 0, 10 );
				return false;
			}

			if ( Lang13.Bool( user.disabilities & 256 ) && Rand13.PercentChance( 50 ) ) {
				user.WriteMsg( "<span class='danger'>The " + this + " slips out of your hand and hits your head.</span>" );
				((Mob_Living)user).take_organ_damage( 10 );
				((Mob)user).Paralyse( 20 );
				return false;
			}

			if ( Convert.ToInt32( M.stat ) != 2 ) {
				
				if ( Lang13.Bool( M.mind ) && M.mind.assigned_role == "Chaplain" ) {
					user.WriteMsg( "<span class='warning'>You can't heal yourself!</span>" );
					return false;
				}

				if ( M is Mob_Living_Carbon_Human && Rand13.PercentChance( 60 ) ) {
					this.bless( M );

					if ( M is Mob_Living_Carbon_Human ) {
						H = M;
						message_halt = false;

						foreach (dynamic _a in Lang13.Enumerate( H.organs, typeof(Obj_Item_Organ_Limb) )) {
							affecting = _a;
							

							if ( affecting.status == 1 ) {
								
								if ( !message_halt ) {
									((Ent_Static)M).visible_message( "<span class='notice'>" + user + " heals " + M + " with the power of " + this.deity_name + "!</span>" );
									M.WriteMsg( "<span class='boldnotice'>May the power of " + this.deity_name + " compel you to be healed!</span>" );
									GlobalFuncs.playsound( this.loc, "punch", 25, 1, -1 );
									message_halt = true;
								}
							} else {
								user.WriteMsg( "<span class='warning'>" + this.deity_name + " refuses to heal this metallic taint!</span>" );
								return false;
							}
						}
					}
				} else {
					
					if ( M is Mob_Living_Carbon_Human && !( M.head is Obj_Item_Clothing_Head_Helmet ) ) {
						((Mob_Living)M).adjustBrainLoss( 10 );
						M.WriteMsg( "<span class='danger'>You feel dumber.</span>" );
					}
					((Ent_Static)M).visible_message( "<span class='danger'>" + user + " beats " + M + " over the head with " + this + "!</span>", "<span class='userdanger'>" + user + " beats " + M + " over the head with " + this + "!</span>" );
					GlobalFuncs.playsound( this.loc, "punch", 25, 1, -1 );
					GlobalFuncs.add_logs( user, M, "attacked", this );
				}
			} else if ( Convert.ToInt32( M.stat ) == 2 ) {
				((Ent_Static)M).visible_message( "<span class='danger'>" + user + " smacks " + M + "'s lifeless corpse with " + this + ".</span>" );
				GlobalFuncs.playsound( this.loc, "punch", 25, 1, -1 );
			}
			return false;
		}

		// Function from file: book.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hsrc = null ) {
			double? iconi = null;
			dynamic biblename = null;
			dynamic B = null;

			
			if ( Lang13.Bool( href_list["seticon"] ) ) {
				iconi = String13.ParseNumber( href_list["seticon"] );
				biblename = GlobalVars.biblenames[iconi];
				B = Lang13.FindObj( href_list["src"] );
				B.icon_state = GlobalVars.biblestates[iconi];
				B.item_state = GlobalVars.bibleitemstates[iconi];
				this.setupbiblespecifics( B, Task13.User );

				if ( GlobalVars.ticker != null ) {
					GlobalVars.ticker.Bible_icon_state = B.icon_state;
					GlobalVars.ticker.Bible_item_state = B.item_state;
				}
				GlobalFuncs.feedback_set_details( "religion_book", "" + biblename );
				Interface13.Browse( Task13.User, null, "window=editicon" );
			}
			return null;
		}

		// Function from file: book.dm
		public void bless( dynamic M = null ) {
			dynamic H = null;
			double heal_amt = 0;
			Obj_Item_Organ_Limb affecting = null;

			
			if ( M is Mob_Living_Carbon_Human ) {
				H = M;
				heal_amt = 10;

				foreach (dynamic _a in Lang13.Enumerate( H.organs, typeof(Obj_Item_Organ_Limb) )) {
					affecting = _a;
					

					if ( affecting.status == 1 ) {
						
						if ( affecting.heal_damage( heal_amt, heal_amt, false ) ) {
							((Mob_Living)H).update_damage_overlays(  );
						}
					}
				}
			}
			return;
		}

		// Function from file: book.dm
		public void setupbiblespecifics( dynamic B = null, Mob H = null ) {
			Zone_Chapel_Main A = null;
			dynamic T = null;
			Zone_Chapel_Main A2 = null;
			dynamic T2 = null;
			Zone_Chapel_Main A3 = null;
			dynamic T3 = null;
			Zone_Chapel_Main A4 = null;
			dynamic T4 = null;

			
			dynamic _i = B.icon_state; // Was a switch-case, sorry for the mess.
			if ( _i=="honk1" || _i=="honk2" ) {
				new Obj_Item_Weapon_Bikehorn( B );
				((Dna)((dynamic)H).dna).add_mutation( "Clumsiness" );
				H.equip_to_slot_or_del( new Obj_Item_Clothing_Mask_Gas_ClownHat( H ), 2 );
			} else if ( _i=="bible" ) {
				
				foreach (dynamic _b in Lang13.Enumerate( typeof(Game13), typeof(Zone_Chapel_Main) )) {
					A = _b;
					

					foreach (dynamic _a in Lang13.Enumerate( A.contents )) {
						T = _a;
						

						if ( T.icon_state == "carpetsymbol" ) {
							T.dir = 2;
						}
					}
				}
			} else if ( _i=="koran" ) {
				
				foreach (dynamic _d in Lang13.Enumerate( typeof(Game13), typeof(Zone_Chapel_Main) )) {
					A2 = _d;
					

					foreach (dynamic _c in Lang13.Enumerate( A2.contents )) {
						T2 = _c;
						

						if ( T2.icon_state == "carpetsymbol" ) {
							T2.dir = 4;
						}
					}
				}
			} else if ( _i=="scientology" ) {
				
				foreach (dynamic _f in Lang13.Enumerate( typeof(Game13), typeof(Zone_Chapel_Main) )) {
					A3 = _f;
					

					foreach (dynamic _e in Lang13.Enumerate( A3.contents )) {
						T3 = _e;
						

						if ( T3.icon_state == "carpetsymbol" ) {
							T3.dir = 8;
						}
					}
				}
			} else if ( _i=="athiest" ) {
				
				foreach (dynamic _h in Lang13.Enumerate( typeof(Game13), typeof(Zone_Chapel_Main) )) {
					A4 = _h;
					

					foreach (dynamic _g in Lang13.Enumerate( A4.contents )) {
						T4 = _g;
						

						if ( T4.icon_state == "carpetsymbol" ) {
							T4.dir = 10;
						}
					}
				}
			}
			return;
		}

		// Function from file: book.dm
		public override dynamic attack_self( dynamic user = null, dynamic flag = null, bool? emp = null ) {
			string dat = null;
			int i = 0;
			Icon bibleicon = null;
			dynamic nicename = null;

			
			if ( !( user is Mob_Living_Carbon_Human ) ) {
				return null;
			}

			if ( GlobalVars.ticker != null && !Lang13.Bool( GlobalVars.ticker.Bible_icon_state ) && user.job == "Chaplain" ) {
				dat = "<html><head><title>Pick Bible Style</title></head><body><center><h2>Pick a bible style</h2></center><table>";
				i = 1;

				while (i < GlobalVars.biblestates.len) {
					bibleicon = new Icon( "icons/obj/storage.dmi", GlobalVars.biblestates[i] );
					nicename = GlobalVars.biblenames[i];
					Interface13.CacheBrowseResource( user, bibleicon, nicename );
					dat += new Txt( "<tr><td><img src=\"" ).item( nicename ).str( "\"></td><td><a href=\"?src=" ).Ref( this ).str( ";seticon=" ).item( i ).str( "\">" ).item( nicename ).str( "</a></td></tr>" ).ToString();
					i++;
				}
				dat += "</table></body></html>";
				Interface13.Browse( user, dat, "window=editicon;can_close=0;can_minimize=0;size=250x650" );
			}
			return null;
		}

		// Function from file: book.dm
		public override int suicide_act( Mob_Living_Carbon_Human user = null ) {
			user.visible_message( new Txt( "<span class='suicide'>" ).item( user ).str( " is offering " ).himself_herself_itself_themself().str( " to " ).item( this.deity_name ).str( "! It looks like " ).he_she_it_they().str( "'s trying to commit suicide.</span>" ).ToString() );
			return 1;
		}

	}

}