// FILE AUTOGENERATED BY SOM13. DO NOT EDIT YET.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Subsystem_Machines : Subsystem {

		public ByTable processing = new ByTable();
		public ByTable powernets = new ByTable();

		protected override void __FieldInit() {
			base.__FieldInit();

			this.name = "Machines";
			this.priority = 9;
			this.display = 3;
		}

		// Function from file: machines.dm
		public Subsystem_Machines (  ) {
			
			if ( GlobalVars.SSmachine != this ) {
				
				if ( GlobalVars.SSmachine is Subsystem_Machines ) {
					this.Recover();
					GlobalFuncs.qdel( GlobalVars.SSmachine );
				}
				GlobalVars.SSmachine = this;
			}
			return;
		}

		// Function from file: machines.dm
		public override void fire(  ) {
			Powernet Powernet = null;
			double seconds = 0;
			dynamic thing = null;

			
			foreach (dynamic _a in Lang13.Enumerate( this.powernets, typeof(Powernet) )) {
				Powernet = _a;
				
				Powernet.reset();
			}
			seconds = this.wait * 0.1;

			foreach (dynamic _b in Lang13.Enumerate( this.processing )) {
				thing = _b;
				

				if ( Lang13.Bool( thing ) && ((Game_Data)thing).process( seconds ) != 26 ) {
					
					if ( thing.use_power != 0 ) {
						((Obj_Machinery)thing).auto_use_power();
					}
					continue;
				}
				this.processing.Remove( thing );
			}
			return;
		}

		// Function from file: machines.dm
		public override void stat_entry( string msg = null ) {
			base.stat_entry( "M:" + this.processing.len + "|PN:" + this.powernets.len );
			return;
		}

		// Function from file: machines.dm
		public void makepowernets( dynamic zlevel = null ) {
			Powernet PN = null;
			Obj_Structure_Cable PC = null;
			Powernet NewPN = null;

			
			foreach (dynamic _a in Lang13.Enumerate( this.powernets, typeof(Powernet) )) {
				PN = _a;
				
				GlobalFuncs.qdel( PN );
			}
			this.powernets.Cut();

			foreach (dynamic _b in Lang13.Enumerate( GlobalVars.cable_list, typeof(Obj_Structure_Cable) )) {
				PC = _b;
				

				if ( !( PC.powernet != null ) ) {
					NewPN = new Powernet();
					NewPN.add_cable( PC );
					GlobalFuncs.propagate_network( PC, PC.powernet );
				}
			}
			return;
		}

		// Function from file: machines.dm
		public override double Initialize( int start_timeofday = 0, double? zlevel = null ) {
			this.makepowernets();
			this.fire();
			base.Initialize( start_timeofday, zlevel );
			return 0;
		}

	}

}