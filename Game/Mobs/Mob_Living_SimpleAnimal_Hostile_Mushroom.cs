// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Mob_Living_SimpleAnimal_Hostile_Mushroom : Mob_Living_SimpleAnimal_Hostile {

		public double? powerlevel = 0;
		public bool bruised = false;
		public bool recovery_cooldown = false;
		public int faint_ticker = 0;
		public Image cap_living = null;
		public Image cap_dead = null;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.icon_living = "mushroom_color";
			this.icon_dead = "mushroom_dead";
			this.maxHealth = 10;
			this.health = 10;
			this.butcher_results = new ByTable().Set( typeof(Obj_Item_Weapon_ReagentContainers_Food_Snacks_Hugemushroomslice), 1 );
			this.response_help = "pets";
			this.response_disarm = "gently pushes aside";
			this.response_harm = "whacks";
			this.harm_intent_damage = 5;
			this.melee_damage_lower = 1;
			this.melee_damage_upper = 1;
			this.attack_same = 2;
			this.attacktext = "chomps";
			this.attack_sound = "sound/weapons/bite.ogg";
			this.faction = new ByTable(new object [] { "mushroom" });
			this.stat_attack = 2;
			this.ventcrawler = 2;
			this.robust_searching = true;
			this.unique_name = true;
			this.speak_emote = new ByTable(new object [] { "squeaks" });
			this.icon_state = "mushroom_color";
		}

		// Function from file: mushroom.dm
		public Mob_Living_SimpleAnimal_Hostile_Mushroom ( dynamic loc = null ) : base( (object)(loc) ) {
			string cap_color = null;

			this.melee_damage_lower += Rand13.Int( 3, 5 );
			this.melee_damage_upper += Rand13.Int( 10, 20 );
			this.maxHealth += Rand13.Int( 40, 60 );
			this.move_to_delay = Rand13.Int( 3, 11 );
			cap_color = String13.ColorCode( Rand13.Int( 0, 255 ), Rand13.Int( 0, 255 ), Rand13.Int( 0, 255 ) );
			this.cap_living = new Image( "icons/mob/animal.dmi", null, "mushroom_cap" );
			this.cap_dead = new Image( "icons/mob/animal.dmi", null, "mushroom_cap_dead" );
			this.cap_living.color = cap_color;
			this.cap_dead.color = cap_color;
			this.UpdateMushroomCap();
			this.health = this.maxHealth;
			this.deathmessage = "" + this + " fainted.";
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			return;
		}

		// Function from file: mushroom.dm
		public override void harvest( dynamic user = null ) {
			double? counter = null;
			Obj_Item_Weapon_ReagentContainers_Food_Snacks_Hugemushroomslice S = null;

			counter = 0;

			while (( counter ??0) <= ( this.powerlevel ??0)) {
				S = new Obj_Item_Weapon_ReagentContainers_Food_Snacks_Hugemushroomslice( this.loc );
				S.reagents.add_reagent( "mushroomhallucinogen", this.powerlevel );
				S.reagents.add_reagent( "omnizine", this.powerlevel );
				S.reagents.add_reagent( "synaptizine", this.powerlevel );
				counter++;
			}
			GlobalFuncs.qdel( this );
			return;
		}

		// Function from file: mushroom.dm
		public override dynamic bullet_act( dynamic P = null, dynamic def_zone = null ) {
			base.bullet_act( (object)(P), (object)(def_zone) );
			this.Bruise();
			return null;
		}

		// Function from file: mushroom.dm
		public override bool hitby( Ent_Dynamic AM = null, bool? skipcatch = null, bool? hitpush = null, bool? blocked = null ) {
			Ent_Dynamic T = null;

			base.hitby( AM, skipcatch, hitpush, blocked );

			if ( AM is Obj_Item ) {
				T = AM;

				if ( Lang13.Bool( ((dynamic)T).throwforce ) ) {
					this.Bruise();
				}
			}
			return false;
		}

		// Function from file: mushroom.dm
		public override dynamic attack_hand( dynamic a = null, bool? b = null, bool? c = null ) {
			base.attack_hand( (object)(a), b, c );

			if ( a.a_intent == "harm" ) {
				this.Bruise();
			}
			return null;
		}

		// Function from file: mushroom.dm
		public override dynamic attackby( dynamic A = null, dynamic user = null, string _params = null, bool? silent = null, bool? replace_spent = null ) {
			
			if ( A is Obj_Item_Weapon_ReagentContainers_Food_Snacks_Grown_Mushroom ) {
				
				if ( this.stat == 2 && !this.recovery_cooldown ) {
					this.Recover();
					GlobalFuncs.qdel( A );
				} else {
					user.WriteMsg( "<span class='warning'>" + this + " won't eat it!</span>" );
				}
				return null;
			}

			if ( Lang13.Bool( A.force ) ) {
				this.Bruise();
			}
			base.attackby( (object)(A), (object)(user), _params, silent, replace_spent );
			return null;
		}

		// Function from file: mushroom.dm
		public void Bruise(  ) {
			
			if ( !this.bruised && !( this.stat != 0 ) ) {
				this.visible_message( "The " + this.name + " was bruised!" );
				this.bruised = true;
			}
			return;
		}

		// Function from file: mushroom.dm
		public void LevelUp( double level_gain = 0 ) {
			
			if ( ( this.powerlevel ??0) <= 9 ) {
				this.powerlevel += level_gain;

				if ( Rand13.PercentChance( 25 ) ) {
					this.melee_damage_lower += level_gain * Rand13.Int( 1, 5 );
				} else {
					this.melee_damage_upper += level_gain * Rand13.Int( 1, 5 );
				}
				this.maxHealth += level_gain * Rand13.Int( 1, 5 );
			}
			this.adjustBruteLoss( -this.maxHealth );
			return;
		}

		// Function from file: mushroom.dm
		public void Recover(  ) {
			this.visible_message( "" + this + " slowly begins to recover." );
			this.faint_ticker = 0;
			this.revive();
			this.UpdateMushroomCap();
			this.recovery_cooldown = true;
			Task13.Schedule( 300, (Task13.Closure)(() => {
				this.recovery_cooldown = false;
				return;
			}));
			return;
		}

		// Function from file: mushroom.dm
		public void UpdateMushroomCap(  ) {
			this.overlays.Cut();

			if ( this.health == 0 ) {
				this.overlays.Add( this.cap_dead );
			} else {
				this.overlays.Add( this.cap_living );
			}
			return;
		}

		// Function from file: mushroom.dm
		public override bool death( bool? gibbed = null, bool? toast = null ) {
			base.death( gibbed, toast );
			this.UpdateMushroomCap();
			return false;
		}

		// Function from file: mushroom.dm
		public override void revive(  ) {
			base.revive();
			this.icon_state = "mushroom_color";
			this.UpdateMushroomCap();
			return;
		}

		// Function from file: mushroom.dm
		public override bool attack_animal( Mob_Living user = null ) {
			Mob_Living M = null;
			double level_gain = 0;

			
			if ( user is Mob_Living_SimpleAnimal_Hostile_Mushroom && this.stat == 2 ) {
				M = user;

				if ( this.faint_ticker < 2 ) {
					M.visible_message( "" + M + " chews a bit on " + this + "." );
					this.faint_ticker++;
					return false;
				}
				M.visible_message( "<span class='warning'>" + M + " devours " + this + "!</span>" );
				level_gain = ( this.powerlevel ??0) - Convert.ToDouble( ((dynamic)M).powerlevel );

				if ( level_gain >= -1 && !this.bruised && !Lang13.Bool( M.ckey ) ) {
					
					if ( level_gain < 1 ) {
						level_gain = 1;
					}
					((Mob_Living_SimpleAnimal_Hostile_Mushroom)M).LevelUp( level_gain );
				}
				M.adjustBruteLoss( -M.maxHealth );
				GlobalFuncs.qdel( this );
			}
			base.attack_animal( user );
			return false;
		}

		// Function from file: mushroom.dm
		public override dynamic adjustHealth( dynamic amount = null ) {
			dynamic _default = null;

			
			if ( !Lang13.Bool( this.retreat_distance ) && Rand13.PercentChance( 33 ) ) {
				this.retreat_distance = 5;
				Task13.Schedule( 30, (Task13.Closure)(() => {
					this.retreat_distance = null;
					return;
				}));
			}
			_default = base.adjustHealth( (object)(amount) );
			return _default;
		}

		// Function from file: mushroom.dm
		public override bool Life(  ) {
			base.Life();

			if ( !( this.stat != 0 ) ) {
				this.adjustBruteLoss( -2 );
			}
			return false;
		}

		// Function from file: mushroom.dm
		public override double examine( dynamic user = null ) {
			base.examine( (object)(user) );

			if ( Convert.ToDouble( this.health ) >= Convert.ToDouble( this.maxHealth ) ) {
				user.WriteMsg( "<span class='info'>It looks healthy.</span>" );
			} else {
				user.WriteMsg( "<span class='info'>It looks like it's been roughed up.</span>" );
			}
			return 0;
		}

	}

}