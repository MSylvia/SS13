// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class MiningSurprise_AlienNest : MiningSurprise {

		public int eggs_left = 10;
		public ByTable weeds = new ByTable( 0 );

		protected override void __FieldInit() {
			base.__FieldInit();

			this.name = "Hidden Nest";
			this.floortypes = new ByTable().Set( typeof(Tile_Unsimulated_Floor_Asteroid), 100 );
			this.walltypes = new ByTable().Set( typeof(Tile_Unsimulated_Mineral_Random_HighChance), 1 );
			this.spawntypes = new ByTable().Set( typeof(Obj_Item_Clothing_Mask_Facehugger), 4 ).Set( typeof(Obj_Mecha_Working_Ripley_Mining), 1 );
			this.fluffitems = new ByTable().Set( typeof(Obj_Effect_Decal_Remains_Human), 5 ).Set( typeof(Obj_Effect_Decal_Cleanable_Blood_Xeno), 5 ).Set( typeof(Obj_Effect_Decal_MechaWreckage_Ripley), 1 );
			this.complex_max_size = 6;
			this.room_size_max = 7;
		}

		// Function from file: vg.dm
		public override void postProcessComplex(  ) {
			ByTable all_floors = null;
			SurpriseRoom room = null;
			ByTable w_cand = null;
			bool egged = false;
			dynamic weed_turf = null;
			int? e = null;
			dynamic egg_turf = null;

			base.postProcessComplex();
			all_floors = new ByTable();

			foreach (dynamic _a in Lang13.Enumerate( this.rooms, typeof(SurpriseRoom) )) {
				room = _a;
				
				w_cand = room.GetTurfs( false );
				all_floors.Or( w_cand );
				egged = false;

				while (w_cand.len > 0) {
					weed_turf = Rand13.PickFromTable( w_cand );
					w_cand.Remove( weed_turf );

					if ( weed_turf.density ) {
						continue;
					}

					if ( Lang13.Bool( Lang13.FindIn( typeof(Obj_Effect_Alien), weed_turf ) ) ) {
						continue;
					}

					if ( Lang13.Bool( weed_turf ) && !egged ) {
						new Obj_Effect_Alien_Weeds_Node(  );
						this.weeds.Add( weed_turf );
						break;
					}
				}
			}
			e = null;
			e = 0;

			while (( e ??0) < GlobalVars.eggs_left) {
				egg_turf = Rand13.PickFromTable( all_floors );

				if ( Lang13.Bool( egg_turf ) && !Lang13.Bool( Lang13.FindIn( typeof(Obj_Effect_Alien), egg_turf ) ) ) {
					new Obj_Effect_Alien_Egg( egg_turf );
				}
				e++;
			}
			return;
		}

	}

}