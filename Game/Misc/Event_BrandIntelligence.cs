// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Event_BrandIntelligence : Event {

		public ByTable vendingMachines = new ByTable();
		public ByTable infectedVendingMachines = new ByTable();
		public dynamic originMachine = null;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.announceWhen = 30;
			this.endWhen = 900;
			this.oneShot = true;
		}

		public Event_BrandIntelligence ( Obj_Item_MechaParts_MechaEquipment_Tool_CableLayer tlistener = null, string tprocname = null ) : base( tlistener, tprocname ) {
			
		}

		// Function from file: brand_intelligence.dm
		public override void end(  ) {
			Obj_Machinery_Vending infectedMachine = null;

			
			foreach (dynamic _a in Lang13.Enumerate( this.infectedVendingMachines, typeof(Obj_Machinery_Vending) )) {
				infectedMachine = _a;
				

				if ( Rand13.PercentChance( 90 ) ) {
					infectedMachine.shut_up = true;
					infectedMachine.shoot_inventory = false;
				}
			}
			return;
		}

		// Function from file: brand_intelligence.dm
		public override void tick(  ) {
			dynamic infectedMachine = null;

			
			if ( !( this.vendingMachines.len != 0 ) || !Lang13.Bool( this.originMachine ) || Lang13.Bool( this.originMachine.shut_up ) ) {
				this.end();
				this.kill();
				return;
			}

			if ( GlobalFuncs.IsMultiple( this.activeFor, 5 ) ) {
				
				if ( Rand13.PercentChance( 25 ) ) {
					infectedMachine = Rand13.PickFromTable( this.vendingMachines );
					this.vendingMachines.Remove( infectedMachine );
					this.infectedVendingMachines.Add( infectedMachine );
					infectedMachine.shut_up = 0;
					infectedMachine.shoot_inventory = true;

					if ( GlobalFuncs.IsMultiple( this.activeFor, 12 ) ) {
						((Obj_Machinery_Vending)this.originMachine).speak( Rand13.Pick(new object [] { "Try our aggressive new marketing strategies!", "You should buy products to feed your lifestyle obession!", "Consume!", "Your money can buy happiness!", "Engage direct marketing!", "Advertising is legalized lying! But don't let that put you off our great deals!", "You don't want to buy anything? Yeah, well I didn't want to buy your mom either." }) );
					}
				}
			}
			return;
		}

		// Function from file: brand_intelligence.dm
		public override bool start(  ) {
			Obj_Machinery_Vending V = null;

			
			foreach (dynamic _a in Lang13.Enumerate( GlobalVars.machines, typeof(Obj_Machinery_Vending) )) {
				V = _a;
				

				if ( V.z != 1 ) {
					continue;
				}
				this.vendingMachines.Add( V );
			}

			if ( !( this.vendingMachines.len != 0 ) ) {
				this.kill();
				return false;
			}
			this.originMachine = Rand13.PickFromTable( this.vendingMachines );
			this.vendingMachines.Remove( this.originMachine );
			this.originMachine.shut_up = 0;
			this.originMachine.shoot_inventory = true;
			return false;
		}

		// Function from file: brand_intelligence.dm
		public override void announce(  ) {
			GlobalFuncs.command_alert( "Rampant brand intelligence has been detected aboard " + GlobalFuncs.station_name() + ", please stand-by.", "Machine Learning Alert" );
			return;
		}

	}

}