// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Event_RogueDrone : Event {

		public ByTable drones_list = new ByTable();

		protected override void __FieldInit() {
			base.__FieldInit();

			this.startWhen = 5;
			this.endWhen = 450;
		}

		public Event_RogueDrone ( Obj_Item_MechaParts_MechaEquipment_Tool_CableLayer tlistener = null, string tprocname = null ) : base( tlistener, tprocname ) {
			
		}

		// Function from file: rogue_drones.dm
		public override void end(  ) {
			double num_recovered = 0;
			Mob_Living_SimpleAnimal_Hostile_Retaliate_MalfDrone D = null;
			Effect_Effect_System_SparkSpread sparks = null;

			num_recovered = 0;

			foreach (dynamic _a in Lang13.Enumerate( this.drones_list, typeof(Mob_Living_SimpleAnimal_Hostile_Retaliate_MalfDrone) )) {
				D = _a;
				
				sparks = new Effect_Effect_System_SparkSpread();
				sparks.set_up( 3, 0, D.loc );
				sparks.start();
				D.z = 2;
				D.has_loot = false;
				GlobalFuncs.qdel( D );
				D = null;
				num_recovered++;
			}

			if ( num_recovered > this.drones_list.len * 0.75 ) {
				GlobalFuncs.command_alert( "Icarus drone control reports the malfunctioning wing has been recovered safely.", "Rogue drone alert" );
			} else {
				GlobalFuncs.command_alert( "Icarus drone control registers disappointment at the loss of the drones, but the survivors have been recovered.", "Rogue drone alert" );
			}
			return;
		}

		// Function from file: rogue_drones.dm
		public override void tick(  ) {
			return;
		}

		// Function from file: rogue_drones.dm
		public override void announce(  ) {
			string msg = null;

			
			if ( Rand13.PercentChance( 33 ) ) {
				msg = "A combat drone wing operating out of the NMV Icarus has failed to return from a sweep of this sector, if any are sighted approach with caution.";
			} else if ( Rand13.PercentChance( 50 ) ) {
				msg = "Contact has been lost with a combat drone wing operating out of the NMV Icarus. If any are sighted in the area, approach with caution.";
			} else {
				msg = "Unidentified hackers have targetted a combat drone wing deployed from the NMV Icarus. If any are sighted in the area, approach with caution.";
			}
			GlobalFuncs.command_alert( msg, "Rogue drone alert" );
			return;
		}

		// Function from file: rogue_drones.dm
		public override bool start(  ) {
			ByTable possible_spawns = null;
			Obj_Effect_Landmark C = null;
			int? num = null;
			int? i = null;
			Mob_Living_SimpleAnimal_Hostile_Retaliate_MalfDrone D = null;

			possible_spawns = new ByTable();

			foreach (dynamic _a in Lang13.Enumerate( GlobalVars.landmarks_list, typeof(Obj_Effect_Landmark) )) {
				C = _a;
				

				if ( C.name == "carpspawn" ) {
					possible_spawns.Add( C );
				}
			}
			num = null;

			if ( Rand13.PercentChance( 25 ) ) {
				num = 0;
			} else {
				num = Rand13.Int( 2, 6 );
			}
			i = null;
			i = 0;

			while (( i ??0) < ( num ??0)) {
				D = new Mob_Living_SimpleAnimal_Hostile_Retaliate_MalfDrone( GlobalFuncs.get_turf( Rand13.PickFromTable( possible_spawns ) ) );
				this.drones_list.Add( D );

				if ( Rand13.PercentChance( 25 ) ) {
					D.disabled = Rand13.Int( 15, 60 );
				}
				i++;
			}
			return false;
		}

	}

}