// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Event_MoneyLotto : Event {

		public string winner_name = "John Smith";
		public bool winner_sum = false;
		public bool deposit_success = false;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.endWhen = 301;
			this.announceWhen = 300;
		}

		public Event_MoneyLotto ( Obj_Item_MechaParts_MechaEquipment_Tool_CableLayer tlistener = null, string tprocname = null ) : base( tlistener, tprocname ) {
			
		}

		// Function from file: money_lotto.dm
		public override void announce(  ) {
			FeedMessage newMsg = null;
			FeedChannel FC = null;
			Obj_Machinery_Newscaster NEWSCASTER = null;

			newMsg = new FeedMessage();
			newMsg.author = "Nanotrasen Editor";
			newMsg.is_admin_message = true;
			newMsg.body = "TC Daily wishes to congratulate <b>" + this.winner_name + "</b> for recieving the Tau Ceti Stellar Slam Lottery, and receiving the out of this world sum of " + this.winner_sum + " credits!";

			if ( !this.deposit_success ) {
				newMsg.body += "<br>Unfortunately, we were unable to verify the account details provided, so we were unable to transfer the money. Send a cheque containing the sum of $500 to TCD 'Stellar Slam' office on Biesel Prime containing updated details, and it'll be resent within the month.";
			}

			foreach (dynamic _a in Lang13.Enumerate( GlobalVars.news_network.network_channels, typeof(FeedChannel) )) {
				FC = _a;
				

				if ( FC.channel_name == "Tau Ceti Daily" ) {
					FC.messages.Add( newMsg );
					break;
				}
			}

			foreach (dynamic _b in Lang13.Enumerate( GlobalVars.allCasters, typeof(Obj_Machinery_Newscaster) )) {
				NEWSCASTER = _b;
				
				NEWSCASTER.newsAlert( "Tau Ceti Daily" );
			}
			return;
		}

		// Function from file: money_lotto.dm
		public override bool start(  ) {
			dynamic D = null;
			Transaction T = null;

			this.winner_sum = Lang13.Bool( Rand13.Pick(new object [] { 5000, 10000, 50000, 100000, 500000, 1000000, 1500000 }) );

			if ( GlobalVars.all_money_accounts.len != 0 ) {
				D = Rand13.PickFromTable( GlobalVars.all_money_accounts );
				D.money += this.winner_sum ?1:0;
				T = new Transaction();
				T.target_name = "Tau Ceti Daily Grand Slam -Stellar- Lottery";
				T.purpose = "Winner!";
				T.amount = this.winner_sum;
				T.date = GlobalVars.current_date_string;
				T.time = GlobalFuncs.worldtime2text();
				T.source_terminal = "Biesel TCD Terminal #" + Rand13.Int( 111, 333 );
				D.transaction_log.Add( T );
			} else {
				this.kill();
			}
			return false;
		}

	}

}