// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class ArtifactEffect_Teleport : ArtifactEffect {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.effecttype = "teleport";
			this.effect_type = 6;
		}

		public ArtifactEffect_Teleport ( dynamic location = null ) : base( (object)(location) ) {
			
		}

		// Function from file: unknown_effect_teleport.dm
		public override bool DoEffectPulse( dynamic holder = null ) {
			Mob_Living M = null;
			double weakness = 0;
			ByTable randomturfs = null;
			Tile_Simulated_Floor T = null;
			Effect_Effect_System_SparkSpread sparks = null;

			
			if ( this.holder != null ) {
				
				foreach (dynamic _b in Lang13.Enumerate( Map13.FetchInRange( this.holder, this.effectrange ), typeof(Mob_Living) )) {
					M = _b;
					
					weakness = GlobalFuncs.GetAnomalySusceptibility( M );

					if ( Rand13.PercentChance( ((int)( weakness * 100 )) ) ) {
						randomturfs = new ByTable();

						foreach (dynamic _a in Lang13.Enumerate( Map13.FetchInRangeExcludeThis( 15, M ), typeof(Tile_Simulated_Floor) )) {
							T = _a;
							
							randomturfs.Add( T );
						}

						if ( randomturfs.len > 0 ) {
							GlobalFuncs.to_chat( M, "<span class='warning'>You are displaced by a strange force!</span>" );
							sparks = new Effect_Effect_System_SparkSpread();
							sparks.set_up( 3, 0, GlobalFuncs.get_turf( M ) );
							sparks.start();

							if ( Lang13.Bool( M.locked_to ) ) {
								((Ent_Dynamic)M.locked_to).unlock_atom( M );
							}
							M.loc = Rand13.PickFromTable( randomturfs );
							sparks = new Effect_Effect_System_SparkSpread();
							sparks.set_up( 3, 0, GlobalFuncs.get_turf( M ) );
							sparks.start();
						}
					}
				}
			}
			return false;
		}

		// Function from file: unknown_effect_teleport.dm
		public override bool DoEffectAura( dynamic holder = null ) {
			Mob_Living M = null;
			double weakness = 0;
			ByTable randomturfs = null;
			Tile_Simulated_Floor T = null;
			Effect_Effect_System_SparkSpread sparks = null;

			
			if ( this.holder != null ) {
				
				foreach (dynamic _b in Lang13.Enumerate( Map13.FetchInRange( this.holder, this.effectrange ), typeof(Mob_Living) )) {
					M = _b;
					
					weakness = GlobalFuncs.GetAnomalySusceptibility( M );

					if ( Rand13.PercentChance( ((int)( weakness * 100 )) ) ) {
						randomturfs = new ByTable();

						foreach (dynamic _a in Lang13.Enumerate( Map13.FetchInRangeExcludeThis( 30, M ), typeof(Tile_Simulated_Floor) )) {
							T = _a;
							
							randomturfs.Add( T );
						}

						if ( randomturfs.len > 0 ) {
							GlobalFuncs.to_chat( M, "<span class='warning'>You are displaced by a strange force!</span>" );

							if ( Lang13.Bool( M.locked_to ) ) {
								((Ent_Dynamic)M.locked_to).unlock_atom( M );
							}
							sparks = new Effect_Effect_System_SparkSpread();
							sparks.set_up( 3, 0, GlobalFuncs.get_turf( M ) );
							sparks.start();
							M.loc = Rand13.PickFromTable( randomturfs );
							sparks = new Effect_Effect_System_SparkSpread();
							sparks.set_up( 3, 0, GlobalFuncs.get_turf( M ) );
							sparks.start();
						}
					}
				}
			}
			return false;
		}

		// Function from file: unknown_effect_teleport.dm
		public override bool DoEffectTouch( dynamic user = null ) {
			double weakness = 0;
			ByTable randomturfs = null;
			Tile_Simulated_Floor T = null;
			Effect_Effect_System_SparkSpread sparks = null;

			weakness = GlobalFuncs.GetAnomalySusceptibility( user );

			if ( Rand13.PercentChance( ((int)( weakness * 100 )) ) ) {
				randomturfs = new ByTable();

				foreach (dynamic _a in Lang13.Enumerate( Map13.FetchInRangeExcludeThis( 50, user ), typeof(Tile_Simulated_Floor) )) {
					T = _a;
					
					randomturfs.Add( T );
				}

				if ( randomturfs.len > 0 ) {
					GlobalFuncs.to_chat( user, "<span class='warning'>You are suddenly zapped away elsewhere!</span>" );

					if ( Lang13.Bool( user.locked_to ) ) {
						((Ent_Dynamic)user.locked_to).unlock_atom( user );
					}
					sparks = new Effect_Effect_System_SparkSpread();
					sparks.set_up( 3, 0, GlobalFuncs.get_turf( user ) );
					sparks.start();
					((Ent_Dynamic)user).forceMove( Rand13.PickFromTable( randomturfs ) );
					sparks = new Effect_Effect_System_SparkSpread();
					sparks.set_up( 3, 0, GlobalFuncs.get_turf( user ) );
					sparks.start();
				}
			}
			return false;
		}

	}

}