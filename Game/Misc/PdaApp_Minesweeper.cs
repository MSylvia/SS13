// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class PdaApp_Minesweeper : PdaApp {

		public bool ingame = false;
		public MinesweeperGame minesweeper_game = null;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.name = "Minesweeper";
			this.desc = "A video game. This old classic from Earth made it all the way to the far reaches of space! Includes station leaderboard.";
			this.price = 35;
			this.menu = 106;
			this.icon = "pda_game";
		}

		// Function from file: apps.dm
		public void save_score(  ) {
			
			if ( this.minesweeper_game.current_difficulty == "custom" ) {
				return;
			}

			if ( this.minesweeper_game.end_timer < Convert.ToDouble( GlobalVars.minesweeper_station_highscores[this.minesweeper_game.current_difficulty] ) ) {
				GlobalVars.minesweeper_station_highscores[this.minesweeper_game.current_difficulty] = this.minesweeper_game.end_timer;
				GlobalVars.minesweeper_best_players[this.minesweeper_game.current_difficulty] = this.pda_device.owner;
			}
			return;
		}

		// Function from file: apps.dm
		public void game_update( Mob user = null ) {
			Mob C = null;
			dynamic pda_device = null;
			dynamic user_loc = null;
			dynamic pda_loc = null;

			
			if ( user is Mob_Living_Carbon ) {
				C = user;

				if ( Lang13.Bool( C.machine ) && C.machine is Obj_Item_Device_Pda ) {
					pda_device = C.machine;
					user_loc = GlobalFuncs.get_turf( user );
					pda_loc = GlobalFuncs.get_turf( pda_device );

					if ( Map13.GetDistance( user_loc, pda_loc ) <= 1 ) {
						
						if ( Convert.ToInt32( pda_device.mode ) == 106 ) {
							((Obj_Item)pda_device).attack_self( C );
						}
					} else {
						user.unset_machine();
						Interface13.Browse( user, null, "window=pda" );
					}
				}
			}
			return;
		}

		// Function from file: apps.dm
		public void game_tick( Mob user = null ) {
			Task13.Sleep( 1 );

			if ( this.minesweeper_game.gameover && this.minesweeper_game.face == "win" ) {
				this.save_score();
			}
			this.game_update( user );
			return;
		}

		// Function from file: apps.dm
		public override void onInstall( dynamic device = null ) {
			base.onInstall( (object)(device) );
			this.minesweeper_game = new MinesweeperGame();
			return;
		}

	}

}