// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Automation_SetRegisterData : Automation {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.name = "Register: Set Data";
			this.valid_child_returntypes = new ByTable(new object [] { 1 });
		}

		// Function from file: registers.dm
		public Automation_SetRegisterData ( Obj_Machinery_Computer_GeneralAirControl_AtmosAutomation aa = null ) : base( aa ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.children = new ByTable(new object [] { null, null });
			return;
		}

		// Function from file: registers.dm
		public override dynamic Topic( string href = null, ByTable href_list = null, dynamic hclient = null, HtmlInterface currui = null ) {
			dynamic _default = null;

			double? idx = null;
			bool new_child = false;

			_default = base.Topic( href, href_list, (object)(hclient) );

			if ( Lang13.Bool( _default ) ) {
				return _default;
			}

			if ( Lang13.Bool( href_list["setfield"] ) ) {
				idx = String13.ParseNumber( href_list["setfield"] );
				new_child = this.selectValidChildFor( Task13.User );

				if ( !new_child ) {
					return 1;
				}
				this.children[idx] = new_child;
				this.parent.updateUsrDialog();
				return 1;
			}
			return _default;
		}

		// Function from file: registers.dm
		public override string GetText(  ) {
			Automation idfield = null;
			Automation valuefield = null;
			string _out = null;

			idfield = this.children[1];
			valuefield = this.children[2];
			_out = new Txt( "Set register: <a href='?src=" ).Ref( this ).str( ";setfield=1'>(Set Field)</a> (" ).ToString();

			if ( idfield == null ) {
				_out += "-----";
			} else {
				_out += idfield.GetText();
			}
			_out += new Txt( ") to value: <a href='?src=" ).Ref( this ).str( ";setfield=2'>(Set Field)</a> (" ).ToString();

			if ( valuefield == null ) {
				_out += "-----";
			} else {
				_out += valuefield.GetText();
			}
			_out += ")";
			return _out;
		}

		// Function from file: registers.dm
		public override bool process(  ) {
			dynamic idfield = null;
			dynamic valuefield = null;
			dynamic registerid = null;

			
			if ( !Lang13.Bool( this.children[1] ) || !Lang13.Bool( this.children[2] ) ) {
				return false;
			}
			idfield = this.children[1];
			valuefield = this.children[2];
			registerid = idfield.Evaluate();
			registerid = ( Convert.ToDouble( registerid ) <= 1 ? ((dynamic)( 1 )) : ( Convert.ToDouble( registerid ) >= ( this.parent.register_amount ??0) ? ((dynamic)( this.parent.register_amount )) : registerid ) );
			this.parent.registers[registerid] = valuefield.Evaluate();
			return false;
		}

	}

}