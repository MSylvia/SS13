// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Spell_Targeted_Harvest : Spell_Targeted {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.name = "Harvest";
			this.desc = "Back to where I come from, and you're coming with me.";
			this.school = "transmutation";
			this.charge_max = 200;
			this.spell_flags = 328;
			this.invocation = "";
			this.range = 0;
			this.max_targets = 0;
			this.overlay = true;
			this.overlay_icon = "icons/effects/effects.dmi";
			this.overlay_icon_state = "rune_teleport";
			this.hud_state = "const_harvest";
		}

		// Function from file: harvest.dm
		public override bool cast( ByTable targets = null, Mob user = null ) {
			Ent_Static destination = null;
			Obj_Machinery_Singularity_Narsie_Large N = null;
			bool prey = false;
			Mob_Living M = null;

			base.cast( targets, user );
			destination = null;

			foreach (dynamic _a in Lang13.Enumerate( GlobalVars.narsie_list, typeof(Obj_Machinery_Singularity_Narsie_Large) )) {
				N = _a;
				
				destination = N.loc;
				break;
			}

			if ( destination != null ) {
				prey = false;

				foreach (dynamic _b in Lang13.Enumerate( targets, typeof(Mob_Living) )) {
					M = _b;
					

					if ( !GlobalFuncs.findNullRod( M ) ) {
						M.forceMove( destination );

						if ( M != user ) {
							prey = true;
						}
					}
				}
				GlobalFuncs.to_chat( user, "<span class='sinister'>You warp back to Nar-Sie" + ( prey ? " along with your prey" : "" ) + ".</span>" );
			} else {
				GlobalFuncs.to_chat( user, "<span class='danger'>...something's wrong!</span>" );
			}
			return false;
		}

	}

}