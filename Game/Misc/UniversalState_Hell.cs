// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class UniversalState_Hell : UniversalState {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.name = "Hell Rising";
			this.desc = "OH FUCK OH FUCK OH FUCK";
			this.decay_rate = 5;
		}

		// Function from file: hell_universe.dm
		public override void OverlayAndAmbientSet(  ) {
			int count = 0;
			dynamic T = null;
			Dynamic_LightingOverlay L = null;

			count = 0;

			foreach (dynamic _a in Lang13.Enumerate( GlobalVars.turfs )) {
				T = _a;
				
				count++;

				if ( !( count % 50000 != 0 ) ) {
					Task13.Sleep( ((int)( Game13.tick_lag )) );
				}

				if ( T is Tile_Space ) {
					T.overlays += "hell01";
				} else {
					
					if ( !T.holy && Rand13.PercentChance( 1 ) ) {
						new Obj_Effect_Gateway_Active_Cult( T );
					}
					T.underlays += "hell01";
				}

				if ( Game13.cpu > 85 ) {
					Task13.Sleep( ((int)( Game13.tick_lag )) );
				}
			}

			foreach (dynamic _b in Lang13.Enumerate( GlobalVars.all_lighting_overlays, typeof(Dynamic_LightingOverlay) )) {
				L = _b;
				
				count++;

				if ( !( count % 50000 != 0 ) ) {
					Task13.Sleep( ((int)( Game13.tick_lag )) );
				}
				L.update_lumcount( 0.5, 0, 0 );

				if ( Game13.cpu > 80 ) {
					Task13.Sleep( ((int)( Game13.tick_lag )) );
				}
			}
			return;
		}

		// Function from file: hell_universe.dm
		public void KillMobs(  ) {
			Mob_Living_SimpleAnimal M = null;

			
			foreach (dynamic _a in Lang13.Enumerate( GlobalVars.mob_list, typeof(Mob_Living_SimpleAnimal) )) {
				M = _a;
				

				if ( M != null && !( M.client != null ) ) {
					M.stat = 2;
				}

				if ( Game13.cpu > 80 ) {
					Task13.Sleep( ((int)( Game13.tick_lag )) );
				}
			}
			return;
		}

		// Function from file: hell_universe.dm
		public void APCSet(  ) {
			Obj_Machinery_Power_Apc APC = null;

			
			foreach (dynamic _a in Lang13.Enumerate( GlobalVars.power_machines, typeof(Obj_Machinery_Power_Apc) )) {
				APC = _a;
				

				if ( !( ( APC.stat & 1 ) != 0 ) && !( APC.areaMaster is Zone_TurretProtected_Ai ) ) {
					APC.chargemode = false;

					if ( Lang13.Bool( APC.cell ) ) {
						APC.cell.charge = 0;
					}
					APC.emagged = 1;
					APC.queue_icon_update();
				}

				if ( Game13.cpu > 85 ) {
					Task13.Sleep( ((int)( Game13.tick_lag )) );
				}
			}
			return;
		}

		// Function from file: hell_universe.dm
		public void MiscSet(  ) {
			Obj_Machinery_Firealarm alm = null;

			
			foreach (dynamic _a in Lang13.Enumerate( GlobalVars.machines, typeof(Obj_Machinery_Firealarm) )) {
				alm = _a;
				

				if ( !( ( alm.stat & 1 ) != 0 ) ) {
					alm.ex_act( 2 );
				}

				if ( Game13.cpu > 80 ) {
					Task13.Sleep( ((int)( Game13.tick_lag )) );
				}
			}
			return;
		}

		// Function from file: hell_universe.dm
		public void AreaSet(  ) {
			dynamic A = null;

			
			foreach (dynamic _a in Lang13.Enumerate( GlobalVars.areas )) {
				A = _a;
				

				if ( !( A is Zone ) || A.type == typeof(Zone) ) {
					continue;
				}
				A.jammed = 2;
				A.fire = null;
				A.atmos = true;
				A.atmosalm = 0;
				A.poweralm = true;
				A.party = null;
				A.radalert = false;
				((Zone)A).updateicon();

				if ( Game13.cpu > 80 ) {
					Task13.Sleep( ((int)( Game13.tick_lag )) );
				}
			}
			return;
		}

		// Function from file: hell_universe.dm
		public override void OnEnter(  ) {
			GlobalVars.escape_list = GlobalFuncs.get_area_turfs( Lang13.FindObj( typeof(Zone_Hallway_Secondary_Exit) ) );

			if ( Game13.cpu > 80 ) {
				Task13.Sleep( ((int)( Game13.tick_lag )) );
			}
			GlobalVars.suspend_alert = true;
			this.AreaSet();

			if ( Game13.cpu > 80 ) {
				Task13.Sleep( ((int)( Game13.tick_lag )) );
			}
			this.MiscSet();

			if ( Game13.cpu > 80 ) {
				Task13.Sleep( ((int)( Game13.tick_lag )) );
			}
			this.APCSet();

			if ( Game13.cpu > 80 ) {
				Task13.Sleep( ((int)( Game13.tick_lag )) );
			}
			this.KillMobs();

			if ( Game13.cpu > 80 ) {
				Task13.Sleep( ((int)( Game13.tick_lag )) );
			}
			this.OverlayAndAmbientSet();

			if ( Game13.cpu > 80 ) {
				Task13.Sleep( ((int)( Game13.tick_lag )) );
			}
			GlobalVars.runedec += 9000;
			GlobalVars.ticker.StartThematic( "endgame" );
			return;
		}

		// Function from file: hell_universe.dm
		public override void OnTurfChange( dynamic NT = null ) {
			
			if ( NT.name == "space" ) {
				NT.overlays += "hell01";
				NT.underlays -= "hell01";
			} else {
				NT.overlays -= "hell01";
			}
			return;
		}

		// Function from file: hell_universe.dm
		public override void DecayTurf( Ent_Static T = null ) {
			Obj_Machinery_Light L = null;

			
			if ( !Lang13.Bool( ((dynamic)T).holy ) ) {
				((dynamic)T).cultify();

				foreach (dynamic _a in Lang13.Enumerate( T.contents, typeof(Obj_Machinery_Light) )) {
					L = _a;
					
					new Obj_Structure_Cult_Pylon( L.loc );
					GlobalFuncs.qdel( L );
				}
			}
			return;
		}

		// Function from file: hell_universe.dm
		public override bool OnShuttleCall( Mob user = null ) {
			return true;
		}

	}

}