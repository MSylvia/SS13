// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Spell_Targeted_Melt : Spell_Targeted {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.name = "Dissolve";
			this.desc = "Transform yourself into a liquified state.";
			this.panel = "Mutant Powers";
			this.charge_type = "charges";
			this.charge_max = 1;
			this.spell_flags = 80;
			this.range = -1;
			this.selection_type = "range";
			this.override_base = "genetic";
			this.hud_state = "gen_dissolve";
		}

		// Function from file: goon_disabilities.dm
		public override bool cast( ByTable targets = null, Mob user = null ) {
			dynamic M = null;
			dynamic H = null;
			Mob_Living_Carbon_Human_Skellington nH = null;

			
			foreach (dynamic _a in Lang13.Enumerate( targets )) {
				M = _a;
				

				if ( M is Mob_Living_Carbon_Human ) {
					H = M;

					if ( Lang13.Bool( H.species ) && H.species.name == "Skellington" ) {
						GlobalFuncs.to_chat( H, "<span class='warning'>You have no flesh left to melt!</span>" );
						return false;
					}
					((Ent_Static)H).visible_message( "<span class='danger'>" + H.name + "'s flesh melts right off! Holy shit!</span>" );
					nH = new Mob_Living_Carbon_Human_Skellington( H.loc, true );
					nH.lying = H.lying;
					nH.real_name = H.real_name;
					nH.ckey = H.ckey;
					nH.name = "" + H.name + "'s skeleton";

					if ( Lang13.Bool( H.mind ) ) {
						((Mind)H.mind).transfer_to( nH );
					}
					((Mob)H).drop_all();
					((Mob)H).gib( true );
				} else {
					((Ent_Static)M).visible_message( "<span class='danger'>" + Task13.User.name + " melts into a pile of bloody viscera!</span>" );
					((Mob)M).drop_all();
					((Mob)M).gib( true );
				}
			}
			return false;
		}

	}

}