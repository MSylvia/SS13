// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Disease2_Effect_Necrosis : Disease2_Effect {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.name = "Necrosis";
		}

		// Function from file: effect.dm
		public override bool activate( Mob_Living mob = null, bool multiplier = false ) {
			Mob_Living H = null;
			dynamic inst = null;
			bool totalslabs = false;
			ByTable allmeat = null;
			dynamic sourcename = null;
			dynamic sourcejob = null;
			double sourcenutriment = 0;
			double? i = null;
			Obj_Item_Weapon_ReagentContainers_Food_Snacks_Meat_Human newmeat = null;
			Ent_Dynamic meatslab = null;
			Tile Tx = null;
			Game_Data D = null;
			Organ_External E = null;
			Organ_External E2 = null;

			
			if ( mob is Mob_Living_Carbon_Human ) {
				H = mob;
				inst = Rand13.Pick(new object [] { 1, 2, 3 });

				dynamic _d = inst; // Was a switch-case, sorry for the mess.
				if ( _d==1 ) {
					GlobalFuncs.to_chat( H, "<span class='warning'>A chunk of meat falls off of you!</span>" );
					totalslabs = true;
					allmeat = null;
					allmeat = new ByTable( totalslabs );
					sourcename = H.real_name;
					sourcejob = H.job;
					sourcenutriment = H.nutrition / 15;

					foreach (dynamic _a in Lang13.IterateRange( 1, totalslabs )) {
						i = _a;
						
						newmeat = new Obj_Item_Weapon_ReagentContainers_Food_Snacks_Meat_Human();
						newmeat.name = sourcename + newmeat.name;
						newmeat.subjectname = sourcename;
						newmeat.subjectjob = sourcejob;
						((Reagents)newmeat.reagents).add_reagent( "nutriment", sourcenutriment / ( totalslabs ?1:0) );
						allmeat[i] = newmeat;
						meatslab = allmeat[i];
						Tx = Map13.GetTile( mob.x, mob.y, mob.z );
						meatslab.loc = GlobalFuncs.get_turf( H );
						meatslab.throw_at( Tx, i, 3 );

						if ( !Tx.density ) {
							D = GlobalFuncs.getFromPool( typeof(Obj_Effect_Decal_Cleanable_Blood_Gibs), Tx );
							((dynamic)D).New( Tx, i );
						}
					}
				} else if ( _d==2 ) {
					
					foreach (dynamic _b in Lang13.Enumerate( ((dynamic)H).organs, typeof(Organ_External) )) {
						E = _b;
						

						if ( Lang13.Bool( Rand13.Pick(new object [] { 1, 0 }) ) ) {
							E.droplimb( 1 );
						}
					}
				} else if ( _d==3 ) {
					
					if ( ((dynamic)H).species.name != "Skellington" ) {
						GlobalFuncs.to_chat( H, "<span class='warning'>Your necrotic skin ruptures!</span>" );

						foreach (dynamic _c in Lang13.Enumerate( ((dynamic)H).organs, typeof(Organ_External) )) {
							E2 = _c;
							

							if ( Lang13.Bool( Rand13.Pick(new object [] { 1, 0 }) ) ) {
								E2.createwound( "cut", Lang13.DoubleNullable( Rand13.Pick(new object [] { 2, 4, 6, 8, 10 }) ) );
							}
						}

						if ( Rand13.PercentChance( 30 ) ) {
							
							if ( ((dynamic)H).species.name != "Skellington" ) {
								
								if ( ((Mob_Living_Carbon_Human)H).set_species( "Skellington" ) ) {
									GlobalFuncs.to_chat( mob, "<span class='warning'>A massive amount of flesh sloughs off your bones!</span>" );
									H.regenerate_icons();
								}
							}
						}
					} else {
						return false;
					}
				}
			}
			return false;
		}

	}

}