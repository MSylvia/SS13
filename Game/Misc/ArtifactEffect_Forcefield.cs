// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class ArtifactEffect_Forcefield : ArtifactEffect {

		public ByTable created_field = new ByTable();

		protected override void __FieldInit() {
			base.__FieldInit();

			this.effecttype = "forcefield";
			this.effect_type = 4;
		}

		// Function from file: unknown_effect_forcefield.dm
		public ArtifactEffect_Forcefield ( dynamic location = null ) : base( (object)(location) ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.trigger = 0;
			return;
		}

		// Function from file: unknown_effect_forcefield.dm
		public override void UpdateMove(  ) {
			dynamic T = null;
			Obj_Effect_EnergyField E = null;
			Ent_Static E2 = null;

			
			if ( this.created_field.len != 0 && this.holder != null ) {
				T = GlobalFuncs.get_turf( this.holder );

				while (this.created_field.len < 16) {
					E = new Obj_Effect_EnergyField( Map13.GetTile( Convert.ToInt32( T.x ), Convert.ToInt32( T.y ), Convert.ToInt32( T ) ) );
					this.created_field.Add( E );
					E.anchored = 1;
					E.density = true;
					E.invisibility = 0;
				}
				E2 = this.created_field[1];
				E2.loc = Map13.GetTile( Convert.ToInt32( T.x + 2 ), Convert.ToInt32( T.y + 2 ), Convert.ToInt32( T.z ) );
				E2 = this.created_field[2];
				E2.loc = Map13.GetTile( Convert.ToInt32( T.x + 2 ), Convert.ToInt32( T.y + 1 ), Convert.ToInt32( T.z ) );
				E2 = this.created_field[3];
				E2.loc = Map13.GetTile( Convert.ToInt32( T.x + 2 ), Convert.ToInt32( T.y ), Convert.ToInt32( T.z ) );
				E2 = this.created_field[4];
				E2.loc = Map13.GetTile( Convert.ToInt32( T.x + 2 ), Convert.ToInt32( T.y - 1 ), Convert.ToInt32( T.z ) );
				E2 = this.created_field[5];
				E2.loc = Map13.GetTile( Convert.ToInt32( T.x + 2 ), Convert.ToInt32( T.y - 2 ), Convert.ToInt32( T.z ) );
				E2 = this.created_field[6];
				E2.loc = Map13.GetTile( Convert.ToInt32( T.x + 1 ), Convert.ToInt32( T.y + 2 ), Convert.ToInt32( T.z ) );
				E2 = this.created_field[7];
				E2.loc = Map13.GetTile( Convert.ToInt32( T.x + 1 ), Convert.ToInt32( T.y - 2 ), Convert.ToInt32( T.z ) );
				E2 = this.created_field[8];
				E2.loc = Map13.GetTile( Convert.ToInt32( T.x ), Convert.ToInt32( T.y + 2 ), Convert.ToInt32( T.z ) );
				E2 = this.created_field[9];
				E2.loc = Map13.GetTile( Convert.ToInt32( T.x ), Convert.ToInt32( T.y - 2 ), Convert.ToInt32( T.z ) );
				E2 = this.created_field[10];
				E2.loc = Map13.GetTile( Convert.ToInt32( T.x - 1 ), Convert.ToInt32( T.y + 2 ), Convert.ToInt32( T.z ) );
				E2 = this.created_field[11];
				E2.loc = Map13.GetTile( Convert.ToInt32( T.x - 1 ), Convert.ToInt32( T.y - 2 ), Convert.ToInt32( T.z ) );
				E2 = this.created_field[12];
				E2.loc = Map13.GetTile( Convert.ToInt32( T.x - 2 ), Convert.ToInt32( T.y + 2 ), Convert.ToInt32( T.z ) );
				E2 = this.created_field[13];
				E2.loc = Map13.GetTile( Convert.ToInt32( T.x - 2 ), Convert.ToInt32( T.y + 1 ), Convert.ToInt32( T.z ) );
				E2 = this.created_field[14];
				E2.loc = Map13.GetTile( Convert.ToInt32( T.x - 2 ), Convert.ToInt32( T.y ), Convert.ToInt32( T.z ) );
				E2 = this.created_field[15];
				E2.loc = Map13.GetTile( Convert.ToInt32( T.x - 2 ), Convert.ToInt32( T.y - 1 ), Convert.ToInt32( T.z ) );
				E2 = this.created_field[16];
				E2.loc = Map13.GetTile( Convert.ToInt32( T.x - 2 ), Convert.ToInt32( T.y - 2 ), Convert.ToInt32( T.z ) );
			}
			return;
		}

		// Function from file: unknown_effect_forcefield.dm
		public override void process(  ) {
			Obj_Effect_EnergyField E = null;

			base.process();

			foreach (dynamic _a in Lang13.Enumerate( this.created_field, typeof(Obj_Effect_EnergyField) )) {
				E = _a;
				

				if ( E.strength < 1 ) {
					E.Strengthen( 0.15 );
				} else if ( E.strength < 5 ) {
					E.Strengthen( 0.25 );
				}
			}
			return;
		}

		// Function from file: unknown_effect_forcefield.dm
		public override bool ToggleActivate( bool? reveal_toggle = null ) {
			Obj_Effect_EnergyField F = null;
			dynamic T = null;
			Obj_Effect_EnergyField E = null;

			base.ToggleActivate( reveal_toggle );

			if ( this.created_field.len != 0 ) {
				
				foreach (dynamic _a in Lang13.Enumerate( this.created_field, typeof(Obj_Effect_EnergyField) )) {
					F = _a;
					
					this.created_field.Remove( F );
					GlobalFuncs.qdel( F );
				}
			} else if ( this.holder != null ) {
				T = GlobalFuncs.get_turf( this.holder );

				while (this.created_field.len < 16) {
					E = new Obj_Effect_EnergyField( Map13.GetTile( Convert.ToInt32( T.x ), Convert.ToInt32( T.y ), Convert.ToInt32( T.z ) ) );
					this.created_field.Add( E );
					E.strength = 1;
					E.density = true;
					E.anchored = 1;
					E.invisibility = 0;
				}
				Task13.Schedule( 10, (Task13.Closure)(() => {
					this.UpdateMove();
					return;
				}));
			}
			return true;
		}

	}

}