// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class MoneyAccount : Game_Data {

		public dynamic owner_name = "";
		public double? account_number = 0;
		public int remote_access_pin = 0;
		public double? money = 0;
		public ByTable transaction_log = new ByTable();
		public int? security_level = 1;
		public bool v_virtual = false;

		// Function from file: utils.dm
		public bool charge( double? transaction_amount = null, MoneyAccount dest = null, string transaction_purpose = null, string terminal_name = null, dynamic terminal_id = null, string dest_name = null ) {
			terminal_name = terminal_name ?? "";
			terminal_id = terminal_id ?? 0;
			dest_name = dest_name ?? "UNKNOWN";

			Transaction T = null;

			
			if ( ( transaction_amount ??0) <= ( this.money ??0) ) {
				this.money -= transaction_amount ??0;

				if ( dest != null ) {
					dest.money += transaction_amount ??0;
				}

				if ( dest != null ) {
					T = new Transaction();
					T.target_name = this.owner_name;

					if ( terminal_name != "" ) {
						T.target_name += " (via " + terminal_name + ")";
					}
					T.purpose = transaction_purpose;
					T.amount = "" + transaction_amount;
					T.source_terminal = terminal_name;
					T.date = GlobalVars.current_date_string;
					T.time = GlobalFuncs.worldtime2text();
					dest.transaction_log.Add( T );
				}
				T = new Transaction();
				T.target_name = ( !( dest != null ) ? ((dynamic)( dest_name )) : dest.owner_name );

				if ( terminal_name != "" ) {
					T.target_name += " (via " + terminal_name + ")";
				}
				T.purpose = transaction_purpose;

				if ( ( transaction_amount ??0) < 0 ) {
					T.amount = "" + ( transaction_amount ??0) * -1;
				} else {
					T.amount = "-" + transaction_amount;
				}
				T.source_terminal = terminal_name;
				T.date = GlobalVars.current_date_string;
				T.time = GlobalFuncs.worldtime2text();
				this.transaction_log.Add( T );
				return true;
			} else {
				GlobalFuncs.to_chat( Task13.User, new Txt().icon( this ).str( "<span class='warning'>You don't have that much money!</span>" ).ToString() );
				return false;
			}
		}

		// Function from file: utils.dm
		public string fmtBalance(  ) {
			return "$" + GlobalFuncs.num2septext( this.money );
		}

	}

}