// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class _Event : Game_Data {

		public ByTable handlers = new ByTable();
		public Game_Data holder = null;

		// Function from file: events.dm
		public _Event ( dynamic loc = null, Game_Data owner = null ) {
			// Warning: Super call was HERE! If anything above HERE is needed by the super call, it might break!;
			this.holder = owner;
			return;
		}

		// Function from file: events.dm
		public void Invoke( ByTable args = null ) {
			dynamic key = null;
			dynamic handler = null;
			dynamic objRef = null;
			dynamic procName = null;

			
			if ( this.handlers.len == 0 ) {
				return;
			}

			foreach (dynamic _a in Lang13.Enumerate( this.handlers )) {
				key = _a;
				
				handler = this.handlers[key];

				if ( !Lang13.Bool( handler ) ) {
					continue;
				}
				objRef = handler["o"];
				procName = handler["p"];

				if ( objRef == null ) {
					this.handlers.Remove( handler );
					continue;
				}
				args["event"] = this;
				Lang13.Call( Lang13.BindFunc( objRef, procName ), args );
			}
			return;
		}

		// Function from file: events.dm
		public bool Remove( dynamic key = null ) {
			return this.handlers.Remove( key );
		}

		// Function from file: events.dm
		public string Add( Game_Data objectRef = null, string procName = null ) {
			string key = null;

			key = new Txt().Ref( objectRef ).str( ":" ).item( procName ).ToString();
			this.handlers[key] = new ByTable().Set( "o", objectRef ).Set( "p", procName );
			return key;
		}

	}

}