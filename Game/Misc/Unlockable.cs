// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Unlockable : Game_Data {

		public string id = "";
		public string name = "";
		public string desc = "";
		public double cost = 0;
		public string cost_units = "";
		public int time = 0;
		public bool unlocked = false;
		public ByTable prerequisites = new ByTable();
		public ResearchTree tree = null;

		// Function from file: unlockable.dm
		public virtual bool can_buy(  ) {
			return this.unlock_check() && !this.tree.unlocking;
		}

		// Function from file: unlockable.dm
		public virtual void relock_action(  ) {
			return;
		}

		// Function from file: unlockable.dm
		public virtual void unlock_action(  ) {
			return;
		}

		// Function from file: unlockable.dm
		public virtual bool unlock_check(  ) {
			return false;
		}

		// Function from file: unlockable.dm
		public string toTableRow( ResearchTree tree = null, dynamic user = null ) {
			return new Txt( "\n	<tr>\n		<th>\n			<a href=\"?src=" ).Ref( tree ).str( ";user=" ).Ref( user ).str( ";unlock=" ).item( this.id ).str( "\">" ).item( this.name ).str( "</a>\n		</th>\n		<th>\n			" ).item( this.cost ).item( this.cost_units ).str( "\n		</th>\n		<th>\n			" ).item( GlobalFuncs.altFormatTimeDuration( this.time ) ).str( @"
		</th>
	</tr>
	<tr>
		<td colspan=""3"">" ).item( this.desc ).str( "</td>\n	</tr>" ).ToString();
		}

		// Function from file: unlockable.dm
		public virtual void end_unlock(  ) {
			return;
		}

		// Function from file: unlockable.dm
		public virtual void begin_unlock(  ) {
			return;
		}

		// Function from file: unlockable.dm
		public bool relock(  ) {
			this.unlocked = false;
			this.relock_action();
			return true;
		}

		// Function from file: unlockable.dm
		public bool unlock(  ) {
			
			if ( this.tree.unlocking ) {
				return false;
			}
			this.begin_unlock();
			this.tree.unlocking = true;

			if ( this.unlock_check() ) {
				Task13.Sleep( this.time );

				if ( this.unlock_check() ) {
					this.unlock_action();
					this.end_unlock();
					this.unlocked = true;
				}
			}
			this.tree.unlocking = false;
			return true;
		}

		// Function from file: unlockable.dm
		public bool check_prerequisites(  ) {
			dynamic prereq = null;

			
			if ( this.prerequisites.len > 0 ) {
				
				foreach (dynamic _a in Lang13.Enumerate( this.prerequisites )) {
					prereq = _a;
					

					if ( !this.tree.unlocked.Contains( prereq ) ) {
						return false;
					}
				}
			}
			return true;
		}

		// Function from file: unlockable.dm
		public virtual void set_context( ResearchTree T = null ) {
			this.tree = T;
			return;
		}

	}

}