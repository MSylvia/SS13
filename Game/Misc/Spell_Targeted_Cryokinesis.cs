// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Spell_Targeted_Cryokinesis : Spell_Targeted {

		protected override void __FieldInit() {
			base.__FieldInit();

			this.name = "Cryokinesis";
			this.desc = "Drops the bodytemperature of another person.";
			this.panel = "Mutant Powers";
			this.charge_max = 600;
			this.spell_flags = 0;
			this.range = 1;
			this.selection_type = "range";
			this.override_base = "genetic";
			this.hud_state = "gen_ice";
			this.compatible_mobs = new ByTable(new object [] { typeof(Mob_Living_Carbon_Human), typeof(Mob_Living_Carbon_Monkey) });
		}

		// Function from file: goon_powers.dm
		public override bool cast( ByTable targets = null, Mob user = null ) {
			Mob_Living_Carbon target = null;
			bool handle_suit = false;
			Mob_Living_Carbon H = null;

			base.cast( targets, user );

			foreach (dynamic _a in Lang13.Enumerate( targets, typeof(Mob_Living_Carbon) )) {
				target = _a;
				
				Interface13.Stat( null, target.mutations.Contains( 2 ) );

				if ( target is Mob_Living_Carbon ) {
					target.visible_message( "<span class='warning'>A cloud of fine ice crystals engulfs " + target.name + ", but disappears almost instantly!</span>" );
					return false;
				}
				handle_suit = false;

				if ( target is Mob_Living_Carbon_Human ) {
					H = target;

					if ( ((dynamic)H).head is Obj_Item_Clothing_Head_Helmet_Space ) {
						
						if ( ((dynamic)H).wear_suit is Obj_Item_Clothing_Suit_Space ) {
							handle_suit = true;

							if ( Lang13.Bool( H.v_internal ) ) {
								H.visible_message( "<span class='warning'>A cloud of fine ice crystals engulfs " + H + "!</span>", "<span class='notice'>A cloud of fine ice crystals cover your " + ((dynamic)H).head + "'s visor.</span>" );
							} else {
								H.visible_message( "<span class='warning'>A cloud of fine ice crystals engulfs " + H + "!</span>", "<span class='warning'>A cloud of fine ice crystals cover your " + ((dynamic)H).head + "'s visor and make it into your air vents!.</span>" );
								H.bodytemperature = Num13.MaxInt( ((int)( 304.41 )), Convert.ToInt32( H.bodytemperature - 3 ) );
								H.adjustFireLoss( 5 );
							}
						}
					}
				}

				if ( !handle_suit ) {
					target.bodytemperature = Num13.MaxInt( ((int)( 302.41 )), Convert.ToInt32( target.bodytemperature - 5 ) );
					target.adjustFireLoss( 10 );
					target.ExtinguishMob();
					target.visible_message( "<span class='warning'>A cloud of fine ice crystals engulfs " + target + "!</span>" );
				}
				new Obj_Effects_SelfDeleting( target.loc, new Icon( "icons/effects/genetics.dmi", "cryokinesis" ) );
			}
			return false;
		}

	}

}