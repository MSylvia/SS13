// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class ArtifactEffect_Celldrain : ArtifactEffect {

		public int next_message = 0;

		protected override void __FieldInit() {
			base.__FieldInit();

			this.effecttype = "celldrain";
			this.effect_type = 3;
		}

		public ArtifactEffect_Celldrain ( dynamic location = null ) : base( (object)(location) ) {
			
		}

		// Function from file: unknown_effect_celldrain.dm
		public override bool DoEffectPulse( dynamic holder = null ) {
			Obj_Machinery_Power_Apc C = null;
			Obj_Machinery_Power_Battery S = null;
			Mob_Living_Silicon_Robot M = null;

			
			if ( this.holder != null ) {
				
				foreach (dynamic _a in Lang13.Enumerate( Map13.FetchInRange( this.holder, this.effectrange ), typeof(Obj_Machinery_Power_Apc) )) {
					C = _a;
					

					if ( Lang13.Bool( C.cell ) ) {
						C.cell.charge = Num13.MaxInt( Convert.ToInt32( C.cell.charge - Rand13.Float() * 100 ), 0 );
					}
				}

				foreach (dynamic _b in Lang13.Enumerate( Map13.FetchInRange( this.holder, this.effectrange ), typeof(Obj_Machinery_Power_Battery) )) {
					S = _b;
					
					S.charge = Num13.MaxInt( Convert.ToInt32( S.charge - Rand13.Float() * 100 ), 0 );
				}

				foreach (dynamic _c in Lang13.Enumerate( GlobalVars.mob_list, typeof(Mob_Living_Silicon_Robot) )) {
					M = _c;
					

					if ( Lang13.Bool( M.cell ) ) {
						M.cell.charge = Num13.MaxInt( Convert.ToInt32( M.cell.charge - Rand13.Float() * 100 ), 0 );

						if ( Game13.time >= this.next_message ) {
							GlobalFuncs.to_chat( M, "<span class='danger'>SYSTEM ALERT: Large energy drain detected!</span>" );
						}
					}
				}

				if ( Game13.time >= this.next_message ) {
					this.next_message = Game13.time + 300;
				}
				return true;
			}
			return false;
		}

		// Function from file: unknown_effect_celldrain.dm
		public override bool DoEffectAura( dynamic holder = null ) {
			Obj_Machinery_Power_Apc C = null;
			Obj_Machinery_Power_Battery S = null;
			Mob_Living_Silicon_Robot M = null;

			
			if ( this.holder != null ) {
				
				foreach (dynamic _a in Lang13.Enumerate( Map13.FetchInRange( this.holder, this.effectrange ), typeof(Obj_Machinery_Power_Apc) )) {
					C = _a;
					

					if ( Lang13.Bool( C.cell ) ) {
						C.cell.charge = Num13.MaxInt( Convert.ToInt32( C.cell.charge - 50 ), 0 );
					}
				}

				foreach (dynamic _b in Lang13.Enumerate( Map13.FetchInRange( this.holder, this.effectrange ), typeof(Obj_Machinery_Power_Battery) )) {
					S = _b;
					
					S.charge = Num13.MaxInt( Convert.ToInt32( S.charge - 50 ), 0 );
				}

				foreach (dynamic _c in Lang13.Enumerate( GlobalVars.mob_list, typeof(Mob_Living_Silicon_Robot) )) {
					M = _c;
					

					if ( Lang13.Bool( M.cell ) ) {
						M.cell.charge = Num13.MaxInt( Convert.ToInt32( M.cell.charge - 50 ), 0 );

						if ( Game13.time >= this.next_message ) {
							GlobalFuncs.to_chat( M, "<span class='warning'>SYSTEM ALERT: Energy drain detected!</span>" );
						}
					}
				}

				if ( Game13.time >= this.next_message ) {
					this.next_message = Game13.time + 300;
				}
				return true;
			}
			return false;
		}

		// Function from file: unknown_effect_celldrain.dm
		public override bool DoEffectTouch( dynamic user = null ) {
			dynamic R = null;

			
			if ( user is Mob_Living_Silicon_Robot ) {
				R = user;

				if ( Lang13.Bool( R.cell ) ) {
					R.cell.charge = Num13.MaxInt( Convert.ToInt32( R.cell.charge - Rand13.Float() * 100 ), 0 );
					GlobalFuncs.to_chat( R, "<span class='danger'>SYSTEM ALERT: Large energy drain detected!</span>" );
				}

				if ( Game13.time >= this.next_message ) {
					this.next_message = Game13.time + 50;
				}
				return true;
			}
			return false;
		}

	}

}