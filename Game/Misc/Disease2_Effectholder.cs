// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Disease2_Effectholder : Disease2 {

		public string name = "Holder";
		public dynamic effect = null;
		public dynamic chance = 0;
		public string cure = "";
		public int happensonce = 0;
		public int multiplier = 1;
		public int? stage = 0;
		public dynamic virus = null;

		// Function from file: effect.dm
		public Disease2_Effectholder ( dynamic D = null ) {
			this.virus = D;
			return;
		}

		// Function from file: effect.dm
		public void majormutate(  ) {
			this.getrandomeffect( 2 );
			return;
		}

		// Function from file: effect.dm
		public void minormutate(  ) {
			
			dynamic _a = Rand13.Pick(new object [] { 1, 2, 3, 4, 5 }); // Was a switch-case, sorry for the mess.
			if ( _a==1 ) {
				this.chance = Rand13.Int( 0, this.effect.chance_maxm );
			} else if ( _a==2 ) {
				this.multiplier = Rand13.Int( 1, this.effect.maxm );
			}
			return;
		}

		// Function from file: effect.dm
		public void getrandomeffect( int? badness = null ) {
			badness = badness ?? 1;

			ByTable list = null;
			dynamic e = null;
			dynamic f = null;

			
			if ( Lang13.Bool( this.effect ) ) {
				this.virus.log += "<br />" + GlobalFuncs.timestamp() + " Effect " + this.effect.name + " " + this.chance + "% is now ";
			} else {
				this.virus.log += "<br />" + GlobalFuncs.timestamp() + " Added effect ";
			}
			list = new ByTable();

			foreach (dynamic _a in Lang13.Enumerate( Lang13.GetTypes( typeof(Disease2_Effect) ) - typeof(Disease2_Effect) )) {
				e = _a;
				
				f = Lang13.Call( e );

				if ( ( f.badness ??0) > ( badness ??0) ) {
					continue;
				}

				if ( Lang13.IntNullable( f.stage ) == this.stage ) {
					list.Add( f );
				}
			}
			this.effect = Rand13.PickFromTable( list );
			this.chance = Rand13.Int( 1, 6 );
			this.virus.log += "" + this.effect.name + " " + this.chance + "%:";
			return;
		}

		// Function from file: effect.dm
		public void runeffect( Mob_Living_Carbon mob = null, int? stage = null ) {
			
			if ( this.happensonce > -1 && Convert.ToDouble( this.effect.stage ) <= ( stage ??0) && Rand13.PercentChance( Convert.ToInt32( this.chance ) ) ) {
				this.effect.activate( mob );

				if ( this.happensonce == 1 ) {
					this.happensonce = -1;
				}
			}
			return;
		}

	}

}