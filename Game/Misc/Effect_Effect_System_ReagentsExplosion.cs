// FILE AUTOGENERATED BY SOMNIUM13.

using System;
using Somnium.Engine.ByImpl;

namespace Somnium.Game {
	class Effect_Effect_System_ReagentsExplosion : Effect_Effect_System {

		public dynamic amount = null;
		public dynamic flashing = 0;
		public dynamic flashing_factor = 0;

		// Function from file: effect_system.dm
		public void holder_damage( Ent_Static holder = null ) {
			double? dmglevel = null;

			
			if ( holder != null ) {
				dmglevel = 4;

				if ( Num13.Floor( Convert.ToDouble( this.amount / 8 ) ) > 0 ) {
					dmglevel = 1;
				} else if ( Num13.Floor( Convert.ToDouble( this.amount / 4 ) ) > 0 ) {
					dmglevel = 2;
				} else if ( Num13.Floor( Convert.ToDouble( this.amount / 2 ) ) > 0 ) {
					dmglevel = 3;
				}

				if ( ( dmglevel ??0) < 4 ) {
					holder.ex_act( dmglevel );
				}
			}
			return;
		}

		// Function from file: effect_system.dm
		public override void start(  ) {
			Effect_Effect_System_SparkSpread s = null;
			dynamic M = null;
			dynamic M2 = null;
			double devastation = 0;
			double heavy = 0;
			double light = 0;
			double flash = 0;
			int range = 0;
			dynamic M3 = null;

			
			if ( Convert.ToDouble( this.amount ) <= 2 ) {
				s = new Effect_Effect_System_SparkSpread();
				s.set_up( 2, 1, this.location );
				s.start();

				foreach (dynamic _a in Lang13.Enumerate( Map13.FetchViewers( this.location, 5 ) )) {
					M = _a;
					
					GlobalFuncs.to_chat( M, "<span class='warning'>The solution violently explodes.</span>" );
				}

				foreach (dynamic _b in Lang13.Enumerate( Map13.FetchViewers( this.location, 1 ) )) {
					M2 = _b;
					

					if ( Rand13.PercentChance( Convert.ToInt32( this.amount * 50 ) ) ) {
						GlobalFuncs.to_chat( M2, "<span class='warning'>The explosion knocks you down.</span>" );
						((Mob)M2).Weaken( Rand13.Int( 1, 5 ) );
					}
				}
				return;
			} else {
				devastation = -1;
				heavy = -1;
				light = -1;
				flash = -1;
				range = 0;
				range = Num13.MinInt( Convert.ToInt32( GlobalVars.MAX_EXPLOSION_RANGE ), ((int)( light + Num13.Floor( Convert.ToDouble( this.amount / 3 ) ) )) );
				devastation = Num13.Floor( Num13.MinInt( 1, ((int)( range * 0.25 )) ) );
				heavy = Num13.Floor( Num13.MinInt( 3, ((int)( range * 0.5 )) ) );
				light = Num13.MinInt( 6, range );
				flash = range * 1.5;

				foreach (dynamic _c in Lang13.Enumerate( Map13.FetchViewers( this.location, 8 ) )) {
					M3 = _c;
					
					GlobalFuncs.to_chat( M3, "<span class='warning'>The solution violently explodes.</span>" );
				}
				GlobalFuncs.explosion( this.location, devastation, heavy, light, flash );
			}
			return;
		}

		// Function from file: effect_system.dm
		public override void set_up( dynamic carry = null, dynamic n = null, dynamic c = null, dynamic loca = null, dynamic direct = null ) {
			c = c ?? 0;
			loca = loca ?? 0;

			this.amount = carry;

			if ( n is Tile ) {
				this.location = n;
			} else {
				this.location = GlobalFuncs.get_turf( n );
			}
			this.flashing = c;
			this.flashing_factor = loca;
			return;
		}

	}

}